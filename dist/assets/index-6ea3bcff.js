var Cc=Object.defineProperty;var Ec=(t,e,i)=>e in t?Cc(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var c=(t,e,i)=>(Ec(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();function Pc(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var al={exports:{}},pr={},ll={exports:{}},I={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var un=Symbol.for("react.element"),kc=Symbol.for("react.portal"),Mc=Symbol.for("react.fragment"),Tc=Symbol.for("react.strict_mode"),bc=Symbol.for("react.profiler"),Ac=Symbol.for("react.provider"),_c=Symbol.for("react.context"),Fc=Symbol.for("react.forward_ref"),Lc=Symbol.for("react.suspense"),Rc=Symbol.for("react.memo"),zc=Symbol.for("react.lazy"),qs=Symbol.iterator;function Ic(t){return t===null||typeof t!="object"?null:(t=qs&&t[qs]||t["@@iterator"],typeof t=="function"?t:null)}var ul={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},cl=Object.assign,dl={};function vi(t,e,i){this.props=t,this.context=e,this.refs=dl,this.updater=i||ul}vi.prototype.isReactComponent={};vi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};vi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function hl(){}hl.prototype=vi.prototype;function Jo(t,e,i){this.props=t,this.context=e,this.refs=dl,this.updater=i||ul}var es=Jo.prototype=new hl;es.constructor=Jo;cl(es,vi.prototype);es.isPureReactComponent=!0;var Ys=Array.isArray,fl=Object.prototype.hasOwnProperty,ts={current:null},gl={key:!0,ref:!0,__self:!0,__source:!0};function ml(t,e,i){var n,r={},o=null,s=null;if(e!=null)for(n in e.ref!==void 0&&(s=e.ref),e.key!==void 0&&(o=""+e.key),e)fl.call(e,n)&&!gl.hasOwnProperty(n)&&(r[n]=e[n]);var a=arguments.length-2;if(a===1)r.children=i;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];r.children=l}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)r[n]===void 0&&(r[n]=a[n]);return{$$typeof:un,type:t,key:o,ref:s,props:r,_owner:ts.current}}function Dc(t,e){return{$$typeof:un,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function is(t){return typeof t=="object"&&t!==null&&t.$$typeof===un}function Bc(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(i){return e[i]})}var Ks=/\/+/g;function Rr(t,e){return typeof t=="object"&&t!==null&&t.key!=null?Bc(""+t.key):e.toString(36)}function Rn(t,e,i,n,r){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var s=!1;if(t===null)s=!0;else switch(o){case"string":case"number":s=!0;break;case"object":switch(t.$$typeof){case un:case kc:s=!0}}if(s)return s=t,r=r(s),t=n===""?"."+Rr(s,0):n,Ys(r)?(i="",t!=null&&(i=t.replace(Ks,"$&/")+"/"),Rn(r,e,i,"",function(u){return u})):r!=null&&(is(r)&&(r=Dc(r,i+(!r.key||s&&s.key===r.key?"":(""+r.key).replace(Ks,"$&/")+"/")+t)),e.push(r)),1;if(s=0,n=n===""?".":n+":",Ys(t))for(var a=0;a<t.length;a++){o=t[a];var l=n+Rr(o,a);s+=Rn(o,e,i,l,r)}else if(l=Ic(t),typeof l=="function")for(t=l.call(t),a=0;!(o=t.next()).done;)o=o.value,l=n+Rr(o,a++),s+=Rn(o,e,i,l,r);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return s}function pn(t,e,i){if(t==null)return t;var n=[],r=0;return Rn(t,n,"","",function(o){return e.call(i,o,r++)}),n}function Oc(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(i){(t._status===0||t._status===-1)&&(t._status=1,t._result=i)},function(i){(t._status===0||t._status===-1)&&(t._status=2,t._result=i)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var pe={current:null},zn={transition:null},Nc={ReactCurrentDispatcher:pe,ReactCurrentBatchConfig:zn,ReactCurrentOwner:ts};function pl(){throw Error("act(...) is not supported in production builds of React.")}I.Children={map:pn,forEach:function(t,e,i){pn(t,function(){e.apply(this,arguments)},i)},count:function(t){var e=0;return pn(t,function(){e++}),e},toArray:function(t){return pn(t,function(e){return e})||[]},only:function(t){if(!is(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};I.Component=vi;I.Fragment=Mc;I.Profiler=bc;I.PureComponent=Jo;I.StrictMode=Tc;I.Suspense=Lc;I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Nc;I.act=pl;I.cloneElement=function(t,e,i){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=cl({},t.props),r=t.key,o=t.ref,s=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,s=ts.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)fl.call(e,l)&&!gl.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=i;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];n.children=a}return{$$typeof:un,type:t.type,key:r,ref:o,props:n,_owner:s}};I.createContext=function(t){return t={$$typeof:_c,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Ac,_context:t},t.Consumer=t};I.createElement=ml;I.createFactory=function(t){var e=ml.bind(null,t);return e.type=t,e};I.createRef=function(){return{current:null}};I.forwardRef=function(t){return{$$typeof:Fc,render:t}};I.isValidElement=is;I.lazy=function(t){return{$$typeof:zc,_payload:{_status:-1,_result:t},_init:Oc}};I.memo=function(t,e){return{$$typeof:Rc,type:t,compare:e===void 0?null:e}};I.startTransition=function(t){var e=zn.transition;zn.transition={};try{t()}finally{zn.transition=e}};I.unstable_act=pl;I.useCallback=function(t,e){return pe.current.useCallback(t,e)};I.useContext=function(t){return pe.current.useContext(t)};I.useDebugValue=function(){};I.useDeferredValue=function(t){return pe.current.useDeferredValue(t)};I.useEffect=function(t,e){return pe.current.useEffect(t,e)};I.useId=function(){return pe.current.useId()};I.useImperativeHandle=function(t,e,i){return pe.current.useImperativeHandle(t,e,i)};I.useInsertionEffect=function(t,e){return pe.current.useInsertionEffect(t,e)};I.useLayoutEffect=function(t,e){return pe.current.useLayoutEffect(t,e)};I.useMemo=function(t,e){return pe.current.useMemo(t,e)};I.useReducer=function(t,e,i){return pe.current.useReducer(t,e,i)};I.useRef=function(t){return pe.current.useRef(t)};I.useState=function(t){return pe.current.useState(t)};I.useSyncExternalStore=function(t,e,i){return pe.current.useSyncExternalStore(t,e,i)};I.useTransition=function(){return pe.current.useTransition()};I.version="18.3.1";ll.exports=I;var O=ll.exports;const Gc=Pc(O);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vc=O,jc=Symbol.for("react.element"),Uc=Symbol.for("react.fragment"),Wc=Object.prototype.hasOwnProperty,Hc=Vc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Qc={key:!0,ref:!0,__self:!0,__source:!0};function yl(t,e,i){var n,r={},o=null,s=null;i!==void 0&&(o=""+i),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(s=e.ref);for(n in e)Wc.call(e,n)&&!Qc.hasOwnProperty(n)&&(r[n]=e[n]);if(t&&t.defaultProps)for(n in e=t.defaultProps,e)r[n]===void 0&&(r[n]=e[n]);return{$$typeof:jc,type:t,key:o,ref:s,props:r,_owner:Hc.current}}pr.Fragment=Uc;pr.jsx=yl;pr.jsxs=yl;al.exports=pr;var f=al.exports,oo={},vl={exports:{}},be={},Sl={exports:{}},xl={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(b,R){var z=b.length;b.push(R);e:for(;0<z;){var Y=z-1>>>1,te=b[Y];if(0<r(te,R))b[Y]=R,b[z]=te,z=Y;else break e}}function i(b){return b.length===0?null:b[0]}function n(b){if(b.length===0)return null;var R=b[0],z=b.pop();if(z!==R){b[0]=z;e:for(var Y=0,te=b.length,gn=te>>>1;Y<gn;){var Tt=2*(Y+1)-1,Lr=b[Tt],bt=Tt+1,mn=b[bt];if(0>r(Lr,z))bt<te&&0>r(mn,Lr)?(b[Y]=mn,b[bt]=z,Y=bt):(b[Y]=Lr,b[Tt]=z,Y=Tt);else if(bt<te&&0>r(mn,z))b[Y]=mn,b[bt]=z,Y=bt;else break e}}return R}function r(b,R){var z=b.sortIndex-R.sortIndex;return z!==0?z:b.id-R.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,a=s.now();t.unstable_now=function(){return s.now()-a}}var l=[],u=[],d=1,m=null,p=3,x=!1,S=!1,E=!1,D=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,h=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(b){for(var R=i(u);R!==null;){if(R.callback===null)n(u);else if(R.startTime<=b)n(u),R.sortIndex=R.expirationTime,e(l,R);else break;R=i(u)}}function w(b){if(E=!1,y(b),!S)if(i(l)!==null)S=!0,Ei(M);else{var R=i(u);R!==null&&Ht(w,R.startTime-b)}}function M(b,R){S=!1,E&&(E=!1,g(A),A=-1),x=!0;var z=p;try{for(y(R),m=i(l);m!==null&&(!(m.expirationTime>R)||b&&!ue());){var Y=m.callback;if(typeof Y=="function"){m.callback=null,p=m.priorityLevel;var te=Y(m.expirationTime<=R);R=t.unstable_now(),typeof te=="function"?m.callback=te:m===i(l)&&n(l),y(R)}else n(l);m=i(l)}if(m!==null)var gn=!0;else{var Tt=i(u);Tt!==null&&Ht(w,Tt.startTime-R),gn=!1}return gn}finally{m=null,p=z,x=!1}}var P=!1,k=null,A=-1,G=5,L=-1;function ue(){return!(t.unstable_now()-L<G)}function ot(){if(k!==null){var b=t.unstable_now();L=b;var R=!0;try{R=k(!0,b)}finally{R?st():(P=!1,k=null)}}else P=!1}var st;if(typeof h=="function")st=function(){h(ot)};else if(typeof MessageChannel<"u"){var wi=new MessageChannel,Ci=wi.port2;wi.port1.onmessage=ot,st=function(){Ci.postMessage(null)}}else st=function(){D(ot,0)};function Ei(b){k=b,P||(P=!0,st())}function Ht(b,R){A=D(function(){b(t.unstable_now())},R)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(b){b.callback=null},t.unstable_continueExecution=function(){S||x||(S=!0,Ei(M))},t.unstable_forceFrameRate=function(b){0>b||125<b?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<b?Math.floor(1e3/b):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_getFirstCallbackNode=function(){return i(l)},t.unstable_next=function(b){switch(p){case 1:case 2:case 3:var R=3;break;default:R=p}var z=p;p=R;try{return b()}finally{p=z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(b,R){switch(b){case 1:case 2:case 3:case 4:case 5:break;default:b=3}var z=p;p=b;try{return R()}finally{p=z}},t.unstable_scheduleCallback=function(b,R,z){var Y=t.unstable_now();switch(typeof z=="object"&&z!==null?(z=z.delay,z=typeof z=="number"&&0<z?Y+z:Y):z=Y,b){case 1:var te=-1;break;case 2:te=250;break;case 5:te=1073741823;break;case 4:te=1e4;break;default:te=5e3}return te=z+te,b={id:d++,callback:R,priorityLevel:b,startTime:z,expirationTime:te,sortIndex:-1},z>Y?(b.sortIndex=z,e(u,b),i(l)===null&&b===i(u)&&(E?(g(A),A=-1):E=!0,Ht(w,z-Y))):(b.sortIndex=te,e(l,b),S||x||(S=!0,Ei(M))),b},t.unstable_shouldYield=ue,t.unstable_wrapCallback=function(b){var R=p;return function(){var z=p;p=R;try{return b.apply(this,arguments)}finally{p=z}}}})(xl);Sl.exports=xl;var $c=Sl.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qc=O,Te=$c;function C(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,i=1;i<arguments.length;i++)e+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var wl=new Set,Hi={};function Ut(t,e){di(t,e),di(t+"Capture",e)}function di(t,e){for(Hi[t]=e,t=0;t<e.length;t++)wl.add(e[t])}var et=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),so=Object.prototype.hasOwnProperty,Yc=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Xs={},Zs={};function Kc(t){return so.call(Zs,t)?!0:so.call(Xs,t)?!1:Yc.test(t)?Zs[t]=!0:(Xs[t]=!0,!1)}function Xc(t,e,i,n){if(i!==null&&i.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:i!==null?!i.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Zc(t,e,i,n){if(e===null||typeof e>"u"||Xc(t,e,i,n))return!0;if(n)return!1;if(i!==null)switch(i.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ye(t,e,i,n,r,o,s){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=r,this.mustUseProperty=i,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=s}var le={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){le[t]=new ye(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];le[e]=new ye(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){le[t]=new ye(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){le[t]=new ye(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){le[t]=new ye(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){le[t]=new ye(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){le[t]=new ye(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){le[t]=new ye(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){le[t]=new ye(t,5,!1,t.toLowerCase(),null,!1,!1)});var ns=/[\-:]([a-z])/g;function rs(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(ns,rs);le[e]=new ye(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(ns,rs);le[e]=new ye(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(ns,rs);le[e]=new ye(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){le[t]=new ye(t,1,!1,t.toLowerCase(),null,!1,!1)});le.xlinkHref=new ye("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){le[t]=new ye(t,1,!1,t.toLowerCase(),null,!0,!0)});function os(t,e,i,n){var r=le.hasOwnProperty(e)?le[e]:null;(r!==null?r.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Zc(e,i,r,n)&&(i=null),n||r===null?Kc(e)&&(i===null?t.removeAttribute(e):t.setAttribute(e,""+i)):r.mustUseProperty?t[r.propertyName]=i===null?r.type===3?!1:"":i:(e=r.attributeName,n=r.attributeNamespace,i===null?t.removeAttribute(e):(r=r.type,i=r===3||r===4&&i===!0?"":""+i,n?t.setAttributeNS(n,e,i):t.setAttribute(e,i))))}var rt=qc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,yn=Symbol.for("react.element"),$t=Symbol.for("react.portal"),qt=Symbol.for("react.fragment"),ss=Symbol.for("react.strict_mode"),ao=Symbol.for("react.profiler"),Cl=Symbol.for("react.provider"),El=Symbol.for("react.context"),as=Symbol.for("react.forward_ref"),lo=Symbol.for("react.suspense"),uo=Symbol.for("react.suspense_list"),ls=Symbol.for("react.memo"),lt=Symbol.for("react.lazy"),Pl=Symbol.for("react.offscreen"),Js=Symbol.iterator;function Pi(t){return t===null||typeof t!="object"?null:(t=Js&&t[Js]||t["@@iterator"],typeof t=="function"?t:null)}var $=Object.assign,zr;function Li(t){if(zr===void 0)try{throw Error()}catch(i){var e=i.stack.trim().match(/\n( *(at )?)/);zr=e&&e[1]||""}return`
`+zr+t}var Ir=!1;function Dr(t,e){if(!t||Ir)return"";Ir=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){n=u}t.call(e.prototype)}else{try{throw Error()}catch(u){n=u}t()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var r=u.stack.split(`
`),o=n.stack.split(`
`),s=r.length-1,a=o.length-1;1<=s&&0<=a&&r[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(r[s]!==o[a]){if(s!==1||a!==1)do if(s--,a--,0>a||r[s]!==o[a]){var l=`
`+r[s].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=s&&0<=a);break}}}finally{Ir=!1,Error.prepareStackTrace=i}return(t=t?t.displayName||t.name:"")?Li(t):""}function Jc(t){switch(t.tag){case 5:return Li(t.type);case 16:return Li("Lazy");case 13:return Li("Suspense");case 19:return Li("SuspenseList");case 0:case 2:case 15:return t=Dr(t.type,!1),t;case 11:return t=Dr(t.type.render,!1),t;case 1:return t=Dr(t.type,!0),t;default:return""}}function co(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case qt:return"Fragment";case $t:return"Portal";case ao:return"Profiler";case ss:return"StrictMode";case lo:return"Suspense";case uo:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case El:return(t.displayName||"Context")+".Consumer";case Cl:return(t._context.displayName||"Context")+".Provider";case as:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case ls:return e=t.displayName||null,e!==null?e:co(t.type)||"Memo";case lt:e=t._payload,t=t._init;try{return co(t(e))}catch{}}return null}function ed(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return co(e);case 8:return e===ss?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ct(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function kl(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function td(t){var e=kl(t)?"checked":"value",i=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var r=i.get,o=i.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(s){n=""+s,o.call(this,s)}}),Object.defineProperty(t,e,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(s){n=""+s},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function vn(t){t._valueTracker||(t._valueTracker=td(t))}function Ml(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var i=e.getValue(),n="";return t&&(n=kl(t)?t.checked?"true":"false":t.value),t=n,t!==i?(e.setValue(t),!0):!1}function Qn(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ho(t,e){var i=e.checked;return $({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:i??t._wrapperState.initialChecked})}function ea(t,e){var i=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;i=Ct(e.value!=null?e.value:i),t._wrapperState={initialChecked:n,initialValue:i,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function Tl(t,e){e=e.checked,e!=null&&os(t,"checked",e,!1)}function fo(t,e){Tl(t,e);var i=Ct(e.value),n=e.type;if(i!=null)n==="number"?(i===0&&t.value===""||t.value!=i)&&(t.value=""+i):t.value!==""+i&&(t.value=""+i);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?go(t,e.type,i):e.hasOwnProperty("defaultValue")&&go(t,e.type,Ct(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ta(t,e,i){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,i||e===t.value||(t.value=e),t.defaultValue=e}i=t.name,i!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,i!==""&&(t.name=i)}function go(t,e,i){(e!=="number"||Qn(t.ownerDocument)!==t)&&(i==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+i&&(t.defaultValue=""+i))}var Ri=Array.isArray;function oi(t,e,i,n){if(t=t.options,e){e={};for(var r=0;r<i.length;r++)e["$"+i[r]]=!0;for(i=0;i<t.length;i++)r=e.hasOwnProperty("$"+t[i].value),t[i].selected!==r&&(t[i].selected=r),r&&n&&(t[i].defaultSelected=!0)}else{for(i=""+Ct(i),e=null,r=0;r<t.length;r++){if(t[r].value===i){t[r].selected=!0,n&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function mo(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(C(91));return $({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function ia(t,e){var i=e.value;if(i==null){if(i=e.children,e=e.defaultValue,i!=null){if(e!=null)throw Error(C(92));if(Ri(i)){if(1<i.length)throw Error(C(93));i=i[0]}e=i}e==null&&(e=""),i=e}t._wrapperState={initialValue:Ct(i)}}function bl(t,e){var i=Ct(e.value),n=Ct(e.defaultValue);i!=null&&(i=""+i,i!==t.value&&(t.value=i),e.defaultValue==null&&t.defaultValue!==i&&(t.defaultValue=i)),n!=null&&(t.defaultValue=""+n)}function na(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function Al(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function po(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?Al(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Sn,_l=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,i,n,r){MSApp.execUnsafeLocalFunction(function(){return t(e,i,n,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Sn=Sn||document.createElement("div"),Sn.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Sn.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Qi(t,e){if(e){var i=t.firstChild;if(i&&i===t.lastChild&&i.nodeType===3){i.nodeValue=e;return}}t.textContent=e}var Di={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},id=["Webkit","ms","Moz","O"];Object.keys(Di).forEach(function(t){id.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Di[e]=Di[t]})});function Fl(t,e,i){return e==null||typeof e=="boolean"||e===""?"":i||typeof e!="number"||e===0||Di.hasOwnProperty(t)&&Di[t]?(""+e).trim():e+"px"}function Ll(t,e){t=t.style;for(var i in e)if(e.hasOwnProperty(i)){var n=i.indexOf("--")===0,r=Fl(i,e[i],n);i==="float"&&(i="cssFloat"),n?t.setProperty(i,r):t[i]=r}}var nd=$({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function yo(t,e){if(e){if(nd[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(C(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(C(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(C(61))}if(e.style!=null&&typeof e.style!="object")throw Error(C(62))}}function vo(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var So=null;function us(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var xo=null,si=null,ai=null;function ra(t){if(t=hn(t)){if(typeof xo!="function")throw Error(C(280));var e=t.stateNode;e&&(e=wr(e),xo(t.stateNode,t.type,e))}}function Rl(t){si?ai?ai.push(t):ai=[t]:si=t}function zl(){if(si){var t=si,e=ai;if(ai=si=null,ra(t),e)for(t=0;t<e.length;t++)ra(e[t])}}function Il(t,e){return t(e)}function Dl(){}var Br=!1;function Bl(t,e,i){if(Br)return t(e,i);Br=!0;try{return Il(t,e,i)}finally{Br=!1,(si!==null||ai!==null)&&(Dl(),zl())}}function $i(t,e){var i=t.stateNode;if(i===null)return null;var n=wr(i);if(n===null)return null;i=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(i&&typeof i!="function")throw Error(C(231,e,typeof i));return i}var wo=!1;if(et)try{var ki={};Object.defineProperty(ki,"passive",{get:function(){wo=!0}}),window.addEventListener("test",ki,ki),window.removeEventListener("test",ki,ki)}catch{wo=!1}function rd(t,e,i,n,r,o,s,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(i,u)}catch(d){this.onError(d)}}var Bi=!1,$n=null,qn=!1,Co=null,od={onError:function(t){Bi=!0,$n=t}};function sd(t,e,i,n,r,o,s,a,l){Bi=!1,$n=null,rd.apply(od,arguments)}function ad(t,e,i,n,r,o,s,a,l){if(sd.apply(this,arguments),Bi){if(Bi){var u=$n;Bi=!1,$n=null}else throw Error(C(198));qn||(qn=!0,Co=u)}}function Wt(t){var e=t,i=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(i=e.return),t=e.return;while(t)}return e.tag===3?i:null}function Ol(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function oa(t){if(Wt(t)!==t)throw Error(C(188))}function ld(t){var e=t.alternate;if(!e){if(e=Wt(t),e===null)throw Error(C(188));return e!==t?null:t}for(var i=t,n=e;;){var r=i.return;if(r===null)break;var o=r.alternate;if(o===null){if(n=r.return,n!==null){i=n;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===i)return oa(r),t;if(o===n)return oa(r),e;o=o.sibling}throw Error(C(188))}if(i.return!==n.return)i=r,n=o;else{for(var s=!1,a=r.child;a;){if(a===i){s=!0,i=r,n=o;break}if(a===n){s=!0,n=r,i=o;break}a=a.sibling}if(!s){for(a=o.child;a;){if(a===i){s=!0,i=o,n=r;break}if(a===n){s=!0,n=o,i=r;break}a=a.sibling}if(!s)throw Error(C(189))}}if(i.alternate!==n)throw Error(C(190))}if(i.tag!==3)throw Error(C(188));return i.stateNode.current===i?t:e}function Nl(t){return t=ld(t),t!==null?Gl(t):null}function Gl(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Gl(t);if(e!==null)return e;t=t.sibling}return null}var Vl=Te.unstable_scheduleCallback,sa=Te.unstable_cancelCallback,ud=Te.unstable_shouldYield,cd=Te.unstable_requestPaint,K=Te.unstable_now,dd=Te.unstable_getCurrentPriorityLevel,cs=Te.unstable_ImmediatePriority,jl=Te.unstable_UserBlockingPriority,Yn=Te.unstable_NormalPriority,hd=Te.unstable_LowPriority,Ul=Te.unstable_IdlePriority,yr=null,$e=null;function fd(t){if($e&&typeof $e.onCommitFiberRoot=="function")try{$e.onCommitFiberRoot(yr,t,void 0,(t.current.flags&128)===128)}catch{}}var Ve=Math.clz32?Math.clz32:pd,gd=Math.log,md=Math.LN2;function pd(t){return t>>>=0,t===0?32:31-(gd(t)/md|0)|0}var xn=64,wn=4194304;function zi(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Kn(t,e){var i=t.pendingLanes;if(i===0)return 0;var n=0,r=t.suspendedLanes,o=t.pingedLanes,s=i&268435455;if(s!==0){var a=s&~r;a!==0?n=zi(a):(o&=s,o!==0&&(n=zi(o)))}else s=i&~r,s!==0?n=zi(s):o!==0&&(n=zi(o));if(n===0)return 0;if(e!==0&&e!==n&&!(e&r)&&(r=n&-n,o=e&-e,r>=o||r===16&&(o&4194240)!==0))return e;if(n&4&&(n|=i&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)i=31-Ve(e),r=1<<i,n|=t[i],e&=~r;return n}function yd(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vd(t,e){for(var i=t.suspendedLanes,n=t.pingedLanes,r=t.expirationTimes,o=t.pendingLanes;0<o;){var s=31-Ve(o),a=1<<s,l=r[s];l===-1?(!(a&i)||a&n)&&(r[s]=yd(a,e)):l<=e&&(t.expiredLanes|=a),o&=~a}}function Eo(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Wl(){var t=xn;return xn<<=1,!(xn&4194240)&&(xn=64),t}function Or(t){for(var e=[],i=0;31>i;i++)e.push(t);return e}function cn(t,e,i){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ve(e),t[e]=i}function Sd(t,e){var i=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<i;){var r=31-Ve(i),o=1<<r;e[r]=0,n[r]=-1,t[r]=-1,i&=~o}}function ds(t,e){var i=t.entangledLanes|=e;for(t=t.entanglements;i;){var n=31-Ve(i),r=1<<n;r&e|t[n]&e&&(t[n]|=e),i&=~r}}var N=0;function Hl(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Ql,hs,$l,ql,Yl,Po=!1,Cn=[],gt=null,mt=null,pt=null,qi=new Map,Yi=new Map,ct=[],xd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function aa(t,e){switch(t){case"focusin":case"focusout":gt=null;break;case"dragenter":case"dragleave":mt=null;break;case"mouseover":case"mouseout":pt=null;break;case"pointerover":case"pointerout":qi.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Yi.delete(e.pointerId)}}function Mi(t,e,i,n,r,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:i,eventSystemFlags:n,nativeEvent:o,targetContainers:[r]},e!==null&&(e=hn(e),e!==null&&hs(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function wd(t,e,i,n,r){switch(e){case"focusin":return gt=Mi(gt,t,e,i,n,r),!0;case"dragenter":return mt=Mi(mt,t,e,i,n,r),!0;case"mouseover":return pt=Mi(pt,t,e,i,n,r),!0;case"pointerover":var o=r.pointerId;return qi.set(o,Mi(qi.get(o)||null,t,e,i,n,r)),!0;case"gotpointercapture":return o=r.pointerId,Yi.set(o,Mi(Yi.get(o)||null,t,e,i,n,r)),!0}return!1}function Kl(t){var e=Rt(t.target);if(e!==null){var i=Wt(e);if(i!==null){if(e=i.tag,e===13){if(e=Ol(i),e!==null){t.blockedOn=e,Yl(t.priority,function(){$l(i)});return}}else if(e===3&&i.stateNode.current.memoizedState.isDehydrated){t.blockedOn=i.tag===3?i.stateNode.containerInfo:null;return}}}t.blockedOn=null}function In(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var i=ko(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(i===null){i=t.nativeEvent;var n=new i.constructor(i.type,i);So=n,i.target.dispatchEvent(n),So=null}else return e=hn(i),e!==null&&hs(e),t.blockedOn=i,!1;e.shift()}return!0}function la(t,e,i){In(t)&&i.delete(e)}function Cd(){Po=!1,gt!==null&&In(gt)&&(gt=null),mt!==null&&In(mt)&&(mt=null),pt!==null&&In(pt)&&(pt=null),qi.forEach(la),Yi.forEach(la)}function Ti(t,e){t.blockedOn===e&&(t.blockedOn=null,Po||(Po=!0,Te.unstable_scheduleCallback(Te.unstable_NormalPriority,Cd)))}function Ki(t){function e(r){return Ti(r,t)}if(0<Cn.length){Ti(Cn[0],t);for(var i=1;i<Cn.length;i++){var n=Cn[i];n.blockedOn===t&&(n.blockedOn=null)}}for(gt!==null&&Ti(gt,t),mt!==null&&Ti(mt,t),pt!==null&&Ti(pt,t),qi.forEach(e),Yi.forEach(e),i=0;i<ct.length;i++)n=ct[i],n.blockedOn===t&&(n.blockedOn=null);for(;0<ct.length&&(i=ct[0],i.blockedOn===null);)Kl(i),i.blockedOn===null&&ct.shift()}var li=rt.ReactCurrentBatchConfig,Xn=!0;function Ed(t,e,i,n){var r=N,o=li.transition;li.transition=null;try{N=1,fs(t,e,i,n)}finally{N=r,li.transition=o}}function Pd(t,e,i,n){var r=N,o=li.transition;li.transition=null;try{N=4,fs(t,e,i,n)}finally{N=r,li.transition=o}}function fs(t,e,i,n){if(Xn){var r=ko(t,e,i,n);if(r===null)qr(t,e,n,Zn,i),aa(t,n);else if(wd(r,t,e,i,n))n.stopPropagation();else if(aa(t,n),e&4&&-1<xd.indexOf(t)){for(;r!==null;){var o=hn(r);if(o!==null&&Ql(o),o=ko(t,e,i,n),o===null&&qr(t,e,n,Zn,i),o===r)break;r=o}r!==null&&n.stopPropagation()}else qr(t,e,n,null,i)}}var Zn=null;function ko(t,e,i,n){if(Zn=null,t=us(n),t=Rt(t),t!==null)if(e=Wt(t),e===null)t=null;else if(i=e.tag,i===13){if(t=Ol(e),t!==null)return t;t=null}else if(i===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Zn=t,null}function Xl(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dd()){case cs:return 1;case jl:return 4;case Yn:case hd:return 16;case Ul:return 536870912;default:return 16}default:return 16}}var ht=null,gs=null,Dn=null;function Zl(){if(Dn)return Dn;var t,e=gs,i=e.length,n,r="value"in ht?ht.value:ht.textContent,o=r.length;for(t=0;t<i&&e[t]===r[t];t++);var s=i-t;for(n=1;n<=s&&e[i-n]===r[o-n];n++);return Dn=r.slice(t,1<n?1-n:void 0)}function Bn(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function En(){return!0}function ua(){return!1}function Ae(t){function e(i,n,r,o,s){this._reactName=i,this._targetInst=r,this.type=n,this.nativeEvent=o,this.target=s,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(i=t[a],this[a]=i?i(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?En:ua,this.isPropagationStopped=ua,this}return $(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var i=this.nativeEvent;i&&(i.preventDefault?i.preventDefault():typeof i.returnValue!="unknown"&&(i.returnValue=!1),this.isDefaultPrevented=En)},stopPropagation:function(){var i=this.nativeEvent;i&&(i.stopPropagation?i.stopPropagation():typeof i.cancelBubble!="unknown"&&(i.cancelBubble=!0),this.isPropagationStopped=En)},persist:function(){},isPersistent:En}),e}var Si={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ms=Ae(Si),dn=$({},Si,{view:0,detail:0}),kd=Ae(dn),Nr,Gr,bi,vr=$({},dn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ps,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==bi&&(bi&&t.type==="mousemove"?(Nr=t.screenX-bi.screenX,Gr=t.screenY-bi.screenY):Gr=Nr=0,bi=t),Nr)},movementY:function(t){return"movementY"in t?t.movementY:Gr}}),ca=Ae(vr),Md=$({},vr,{dataTransfer:0}),Td=Ae(Md),bd=$({},dn,{relatedTarget:0}),Vr=Ae(bd),Ad=$({},Si,{animationName:0,elapsedTime:0,pseudoElement:0}),_d=Ae(Ad),Fd=$({},Si,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),Ld=Ae(Fd),Rd=$({},Si,{data:0}),da=Ae(Rd),zd={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Id={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Dd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Bd(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=Dd[t])?!!e[t]:!1}function ps(){return Bd}var Od=$({},dn,{key:function(t){if(t.key){var e=zd[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Bn(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?Id[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ps,charCode:function(t){return t.type==="keypress"?Bn(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Bn(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),Nd=Ae(Od),Gd=$({},vr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ha=Ae(Gd),Vd=$({},dn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ps}),jd=Ae(Vd),Ud=$({},Si,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wd=Ae(Ud),Hd=$({},vr,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Qd=Ae(Hd),$d=[9,13,27,32],ys=et&&"CompositionEvent"in window,Oi=null;et&&"documentMode"in document&&(Oi=document.documentMode);var qd=et&&"TextEvent"in window&&!Oi,Jl=et&&(!ys||Oi&&8<Oi&&11>=Oi),fa=String.fromCharCode(32),ga=!1;function eu(t,e){switch(t){case"keyup":return $d.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function tu(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Yt=!1;function Yd(t,e){switch(t){case"compositionend":return tu(e);case"keypress":return e.which!==32?null:(ga=!0,fa);case"textInput":return t=e.data,t===fa&&ga?null:t;default:return null}}function Kd(t,e){if(Yt)return t==="compositionend"||!ys&&eu(t,e)?(t=Zl(),Dn=gs=ht=null,Yt=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Jl&&e.locale!=="ko"?null:e.data;default:return null}}var Xd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ma(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Xd[t.type]:e==="textarea"}function iu(t,e,i,n){Rl(n),e=Jn(e,"onChange"),0<e.length&&(i=new ms("onChange","change",null,i,n),t.push({event:i,listeners:e}))}var Ni=null,Xi=null;function Zd(t){fu(t,0)}function Sr(t){var e=Zt(t);if(Ml(e))return t}function Jd(t,e){if(t==="change")return e}var nu=!1;if(et){var jr;if(et){var Ur="oninput"in document;if(!Ur){var pa=document.createElement("div");pa.setAttribute("oninput","return;"),Ur=typeof pa.oninput=="function"}jr=Ur}else jr=!1;nu=jr&&(!document.documentMode||9<document.documentMode)}function ya(){Ni&&(Ni.detachEvent("onpropertychange",ru),Xi=Ni=null)}function ru(t){if(t.propertyName==="value"&&Sr(Xi)){var e=[];iu(e,Xi,t,us(t)),Bl(Zd,e)}}function eh(t,e,i){t==="focusin"?(ya(),Ni=e,Xi=i,Ni.attachEvent("onpropertychange",ru)):t==="focusout"&&ya()}function th(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Sr(Xi)}function ih(t,e){if(t==="click")return Sr(e)}function nh(t,e){if(t==="input"||t==="change")return Sr(e)}function rh(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ue=typeof Object.is=="function"?Object.is:rh;function Zi(t,e){if(Ue(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++){var r=i[n];if(!so.call(e,r)||!Ue(t[r],e[r]))return!1}return!0}function va(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Sa(t,e){var i=va(t);t=0;for(var n;i;){if(i.nodeType===3){if(n=t+i.textContent.length,t<=e&&n>=e)return{node:i,offset:e-t};t=n}e:{for(;i;){if(i.nextSibling){i=i.nextSibling;break e}i=i.parentNode}i=void 0}i=va(i)}}function ou(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?ou(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function su(){for(var t=window,e=Qn();e instanceof t.HTMLIFrameElement;){try{var i=typeof e.contentWindow.location.href=="string"}catch{i=!1}if(i)t=e.contentWindow;else break;e=Qn(t.document)}return e}function vs(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function oh(t){var e=su(),i=t.focusedElem,n=t.selectionRange;if(e!==i&&i&&i.ownerDocument&&ou(i.ownerDocument.documentElement,i)){if(n!==null&&vs(i)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in i)i.selectionStart=e,i.selectionEnd=Math.min(t,i.value.length);else if(t=(e=i.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=i.textContent.length,o=Math.min(n.start,r);n=n.end===void 0?o:Math.min(n.end,r),!t.extend&&o>n&&(r=n,n=o,o=r),r=Sa(i,o);var s=Sa(i,n);r&&s&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==s.node||t.focusOffset!==s.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),o>n?(t.addRange(e),t.extend(s.node,s.offset)):(e.setEnd(s.node,s.offset),t.addRange(e)))}}for(e=[],t=i;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof i.focus=="function"&&i.focus(),i=0;i<e.length;i++)t=e[i],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var sh=et&&"documentMode"in document&&11>=document.documentMode,Kt=null,Mo=null,Gi=null,To=!1;function xa(t,e,i){var n=i.window===i?i.document:i.nodeType===9?i:i.ownerDocument;To||Kt==null||Kt!==Qn(n)||(n=Kt,"selectionStart"in n&&vs(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Gi&&Zi(Gi,n)||(Gi=n,n=Jn(Mo,"onSelect"),0<n.length&&(e=new ms("onSelect","select",null,e,i),t.push({event:e,listeners:n}),e.target=Kt)))}function Pn(t,e){var i={};return i[t.toLowerCase()]=e.toLowerCase(),i["Webkit"+t]="webkit"+e,i["Moz"+t]="moz"+e,i}var Xt={animationend:Pn("Animation","AnimationEnd"),animationiteration:Pn("Animation","AnimationIteration"),animationstart:Pn("Animation","AnimationStart"),transitionend:Pn("Transition","TransitionEnd")},Wr={},au={};et&&(au=document.createElement("div").style,"AnimationEvent"in window||(delete Xt.animationend.animation,delete Xt.animationiteration.animation,delete Xt.animationstart.animation),"TransitionEvent"in window||delete Xt.transitionend.transition);function xr(t){if(Wr[t])return Wr[t];if(!Xt[t])return t;var e=Xt[t],i;for(i in e)if(e.hasOwnProperty(i)&&i in au)return Wr[t]=e[i];return t}var lu=xr("animationend"),uu=xr("animationiteration"),cu=xr("animationstart"),du=xr("transitionend"),hu=new Map,wa="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pt(t,e){hu.set(t,e),Ut(e,[t])}for(var Hr=0;Hr<wa.length;Hr++){var Qr=wa[Hr],ah=Qr.toLowerCase(),lh=Qr[0].toUpperCase()+Qr.slice(1);Pt(ah,"on"+lh)}Pt(lu,"onAnimationEnd");Pt(uu,"onAnimationIteration");Pt(cu,"onAnimationStart");Pt("dblclick","onDoubleClick");Pt("focusin","onFocus");Pt("focusout","onBlur");Pt(du,"onTransitionEnd");di("onMouseEnter",["mouseout","mouseover"]);di("onMouseLeave",["mouseout","mouseover"]);di("onPointerEnter",["pointerout","pointerover"]);di("onPointerLeave",["pointerout","pointerover"]);Ut("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ut("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ut("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ut("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ut("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ut("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ii="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),uh=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ii));function Ca(t,e,i){var n=t.type||"unknown-event";t.currentTarget=i,ad(n,e,void 0,t),t.currentTarget=null}function fu(t,e){e=(e&4)!==0;for(var i=0;i<t.length;i++){var n=t[i],r=n.event;n=n.listeners;e:{var o=void 0;if(e)for(var s=n.length-1;0<=s;s--){var a=n[s],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;Ca(r,a,u),o=l}else for(s=0;s<n.length;s++){if(a=n[s],l=a.instance,u=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;Ca(r,a,u),o=l}}}if(qn)throw t=Co,qn=!1,Co=null,t}function j(t,e){var i=e[Lo];i===void 0&&(i=e[Lo]=new Set);var n=t+"__bubble";i.has(n)||(gu(e,t,2,!1),i.add(n))}function $r(t,e,i){var n=0;e&&(n|=4),gu(i,t,n,e)}var kn="_reactListening"+Math.random().toString(36).slice(2);function Ji(t){if(!t[kn]){t[kn]=!0,wl.forEach(function(i){i!=="selectionchange"&&(uh.has(i)||$r(i,!1,t),$r(i,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[kn]||(e[kn]=!0,$r("selectionchange",!1,e))}}function gu(t,e,i,n){switch(Xl(e)){case 1:var r=Ed;break;case 4:r=Pd;break;default:r=fs}i=r.bind(null,e,i,t),r=void 0,!wo||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),n?r!==void 0?t.addEventListener(e,i,{capture:!0,passive:r}):t.addEventListener(e,i,!0):r!==void 0?t.addEventListener(e,i,{passive:r}):t.addEventListener(e,i,!1)}function qr(t,e,i,n,r){var o=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var s=n.tag;if(s===3||s===4){var a=n.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(s===4)for(s=n.return;s!==null;){var l=s.tag;if((l===3||l===4)&&(l=s.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;s=s.return}for(;a!==null;){if(s=Rt(a),s===null)return;if(l=s.tag,l===5||l===6){n=o=s;continue e}a=a.parentNode}}n=n.return}Bl(function(){var u=o,d=us(i),m=[];e:{var p=hu.get(t);if(p!==void 0){var x=ms,S=t;switch(t){case"keypress":if(Bn(i)===0)break e;case"keydown":case"keyup":x=Nd;break;case"focusin":S="focus",x=Vr;break;case"focusout":S="blur",x=Vr;break;case"beforeblur":case"afterblur":x=Vr;break;case"click":if(i.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=ca;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=Td;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=jd;break;case lu:case uu:case cu:x=_d;break;case du:x=Wd;break;case"scroll":x=kd;break;case"wheel":x=Qd;break;case"copy":case"cut":case"paste":x=Ld;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=ha}var E=(e&4)!==0,D=!E&&t==="scroll",g=E?p!==null?p+"Capture":null:p;E=[];for(var h=u,y;h!==null;){y=h;var w=y.stateNode;if(y.tag===5&&w!==null&&(y=w,g!==null&&(w=$i(h,g),w!=null&&E.push(en(h,w,y)))),D)break;h=h.return}0<E.length&&(p=new x(p,S,null,i,d),m.push({event:p,listeners:E}))}}if(!(e&7)){e:{if(p=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",p&&i!==So&&(S=i.relatedTarget||i.fromElement)&&(Rt(S)||S[tt]))break e;if((x||p)&&(p=d.window===d?d:(p=d.ownerDocument)?p.defaultView||p.parentWindow:window,x?(S=i.relatedTarget||i.toElement,x=u,S=S?Rt(S):null,S!==null&&(D=Wt(S),S!==D||S.tag!==5&&S.tag!==6)&&(S=null)):(x=null,S=u),x!==S)){if(E=ca,w="onMouseLeave",g="onMouseEnter",h="mouse",(t==="pointerout"||t==="pointerover")&&(E=ha,w="onPointerLeave",g="onPointerEnter",h="pointer"),D=x==null?p:Zt(x),y=S==null?p:Zt(S),p=new E(w,h+"leave",x,i,d),p.target=D,p.relatedTarget=y,w=null,Rt(d)===u&&(E=new E(g,h+"enter",S,i,d),E.target=y,E.relatedTarget=D,w=E),D=w,x&&S)t:{for(E=x,g=S,h=0,y=E;y;y=Qt(y))h++;for(y=0,w=g;w;w=Qt(w))y++;for(;0<h-y;)E=Qt(E),h--;for(;0<y-h;)g=Qt(g),y--;for(;h--;){if(E===g||g!==null&&E===g.alternate)break t;E=Qt(E),g=Qt(g)}E=null}else E=null;x!==null&&Ea(m,p,x,E,!1),S!==null&&D!==null&&Ea(m,D,S,E,!0)}}e:{if(p=u?Zt(u):window,x=p.nodeName&&p.nodeName.toLowerCase(),x==="select"||x==="input"&&p.type==="file")var M=Jd;else if(ma(p))if(nu)M=nh;else{M=th;var P=eh}else(x=p.nodeName)&&x.toLowerCase()==="input"&&(p.type==="checkbox"||p.type==="radio")&&(M=ih);if(M&&(M=M(t,u))){iu(m,M,i,d);break e}P&&P(t,p,u),t==="focusout"&&(P=p._wrapperState)&&P.controlled&&p.type==="number"&&go(p,"number",p.value)}switch(P=u?Zt(u):window,t){case"focusin":(ma(P)||P.contentEditable==="true")&&(Kt=P,Mo=u,Gi=null);break;case"focusout":Gi=Mo=Kt=null;break;case"mousedown":To=!0;break;case"contextmenu":case"mouseup":case"dragend":To=!1,xa(m,i,d);break;case"selectionchange":if(sh)break;case"keydown":case"keyup":xa(m,i,d)}var k;if(ys)e:{switch(t){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else Yt?eu(t,i)&&(A="onCompositionEnd"):t==="keydown"&&i.keyCode===229&&(A="onCompositionStart");A&&(Jl&&i.locale!=="ko"&&(Yt||A!=="onCompositionStart"?A==="onCompositionEnd"&&Yt&&(k=Zl()):(ht=d,gs="value"in ht?ht.value:ht.textContent,Yt=!0)),P=Jn(u,A),0<P.length&&(A=new da(A,t,null,i,d),m.push({event:A,listeners:P}),k?A.data=k:(k=tu(i),k!==null&&(A.data=k)))),(k=qd?Yd(t,i):Kd(t,i))&&(u=Jn(u,"onBeforeInput"),0<u.length&&(d=new da("onBeforeInput","beforeinput",null,i,d),m.push({event:d,listeners:u}),d.data=k))}fu(m,e)})}function en(t,e,i){return{instance:t,listener:e,currentTarget:i}}function Jn(t,e){for(var i=e+"Capture",n=[];t!==null;){var r=t,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=$i(t,i),o!=null&&n.unshift(en(t,o,r)),o=$i(t,e),o!=null&&n.push(en(t,o,r))),t=t.return}return n}function Qt(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ea(t,e,i,n,r){for(var o=e._reactName,s=[];i!==null&&i!==n;){var a=i,l=a.alternate,u=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&u!==null&&(a=u,r?(l=$i(i,o),l!=null&&s.unshift(en(i,l,a))):r||(l=$i(i,o),l!=null&&s.push(en(i,l,a)))),i=i.return}s.length!==0&&t.push({event:e,listeners:s})}var ch=/\r\n?/g,dh=/\u0000|\uFFFD/g;function Pa(t){return(typeof t=="string"?t:""+t).replace(ch,`
`).replace(dh,"")}function Mn(t,e,i){if(e=Pa(e),Pa(t)!==e&&i)throw Error(C(425))}function er(){}var bo=null,Ao=null;function _o(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Fo=typeof setTimeout=="function"?setTimeout:void 0,hh=typeof clearTimeout=="function"?clearTimeout:void 0,ka=typeof Promise=="function"?Promise:void 0,fh=typeof queueMicrotask=="function"?queueMicrotask:typeof ka<"u"?function(t){return ka.resolve(null).then(t).catch(gh)}:Fo;function gh(t){setTimeout(function(){throw t})}function Yr(t,e){var i=e,n=0;do{var r=i.nextSibling;if(t.removeChild(i),r&&r.nodeType===8)if(i=r.data,i==="/$"){if(n===0){t.removeChild(r),Ki(e);return}n--}else i!=="$"&&i!=="$?"&&i!=="$!"||n++;i=r}while(i);Ki(e)}function yt(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ma(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="$"||i==="$!"||i==="$?"){if(e===0)return t;e--}else i==="/$"&&e++}t=t.previousSibling}return null}var xi=Math.random().toString(36).slice(2),Qe="__reactFiber$"+xi,tn="__reactProps$"+xi,tt="__reactContainer$"+xi,Lo="__reactEvents$"+xi,mh="__reactListeners$"+xi,ph="__reactHandles$"+xi;function Rt(t){var e=t[Qe];if(e)return e;for(var i=t.parentNode;i;){if(e=i[tt]||i[Qe]){if(i=e.alternate,e.child!==null||i!==null&&i.child!==null)for(t=Ma(t);t!==null;){if(i=t[Qe])return i;t=Ma(t)}return e}t=i,i=t.parentNode}return null}function hn(t){return t=t[Qe]||t[tt],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Zt(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(C(33))}function wr(t){return t[tn]||null}var Ro=[],Jt=-1;function kt(t){return{current:t}}function U(t){0>Jt||(t.current=Ro[Jt],Ro[Jt]=null,Jt--)}function V(t,e){Jt++,Ro[Jt]=t.current,t.current=e}var Et={},fe=kt(Et),we=kt(!1),Ot=Et;function hi(t,e){var i=t.type.contextTypes;if(!i)return Et;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in i)r[o]=e[o];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function Ce(t){return t=t.childContextTypes,t!=null}function tr(){U(we),U(fe)}function Ta(t,e,i){if(fe.current!==Et)throw Error(C(168));V(fe,e),V(we,i)}function mu(t,e,i){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return i;n=n.getChildContext();for(var r in n)if(!(r in e))throw Error(C(108,ed(t)||"Unknown",r));return $({},i,n)}function ir(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Et,Ot=fe.current,V(fe,t),V(we,we.current),!0}function ba(t,e,i){var n=t.stateNode;if(!n)throw Error(C(169));i?(t=mu(t,e,Ot),n.__reactInternalMemoizedMergedChildContext=t,U(we),U(fe),V(fe,t)):U(we),V(we,i)}var Ke=null,Cr=!1,Kr=!1;function pu(t){Ke===null?Ke=[t]:Ke.push(t)}function yh(t){Cr=!0,pu(t)}function Mt(){if(!Kr&&Ke!==null){Kr=!0;var t=0,e=N;try{var i=Ke;for(N=1;t<i.length;t++){var n=i[t];do n=n(!0);while(n!==null)}Ke=null,Cr=!1}catch(r){throw Ke!==null&&(Ke=Ke.slice(t+1)),Vl(cs,Mt),r}finally{N=e,Kr=!1}}return null}var ei=[],ti=0,nr=null,rr=0,_e=[],Fe=0,Nt=null,Xe=1,Ze="";function At(t,e){ei[ti++]=rr,ei[ti++]=nr,nr=t,rr=e}function yu(t,e,i){_e[Fe++]=Xe,_e[Fe++]=Ze,_e[Fe++]=Nt,Nt=t;var n=Xe;t=Ze;var r=32-Ve(n)-1;n&=~(1<<r),i+=1;var o=32-Ve(e)+r;if(30<o){var s=r-r%5;o=(n&(1<<s)-1).toString(32),n>>=s,r-=s,Xe=1<<32-Ve(e)+r|i<<r|n,Ze=o+t}else Xe=1<<o|i<<r|n,Ze=t}function Ss(t){t.return!==null&&(At(t,1),yu(t,1,0))}function xs(t){for(;t===nr;)nr=ei[--ti],ei[ti]=null,rr=ei[--ti],ei[ti]=null;for(;t===Nt;)Nt=_e[--Fe],_e[Fe]=null,Ze=_e[--Fe],_e[Fe]=null,Xe=_e[--Fe],_e[Fe]=null}var Me=null,ke=null,W=!1,Ge=null;function vu(t,e){var i=Le(5,null,null,0);i.elementType="DELETED",i.stateNode=e,i.return=t,e=t.deletions,e===null?(t.deletions=[i],t.flags|=16):e.push(i)}function Aa(t,e){switch(t.tag){case 5:var i=t.type;return e=e.nodeType!==1||i.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Me=t,ke=yt(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Me=t,ke=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(i=Nt!==null?{id:Xe,overflow:Ze}:null,t.memoizedState={dehydrated:e,treeContext:i,retryLane:1073741824},i=Le(18,null,null,0),i.stateNode=e,i.return=t,t.child=i,Me=t,ke=null,!0):!1;default:return!1}}function zo(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Io(t){if(W){var e=ke;if(e){var i=e;if(!Aa(t,e)){if(zo(t))throw Error(C(418));e=yt(i.nextSibling);var n=Me;e&&Aa(t,e)?vu(n,i):(t.flags=t.flags&-4097|2,W=!1,Me=t)}}else{if(zo(t))throw Error(C(418));t.flags=t.flags&-4097|2,W=!1,Me=t}}}function _a(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Me=t}function Tn(t){if(t!==Me)return!1;if(!W)return _a(t),W=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!_o(t.type,t.memoizedProps)),e&&(e=ke)){if(zo(t))throw Su(),Error(C(418));for(;e;)vu(t,e),e=yt(e.nextSibling)}if(_a(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(C(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var i=t.data;if(i==="/$"){if(e===0){ke=yt(t.nextSibling);break e}e--}else i!=="$"&&i!=="$!"&&i!=="$?"||e++}t=t.nextSibling}ke=null}}else ke=Me?yt(t.stateNode.nextSibling):null;return!0}function Su(){for(var t=ke;t;)t=yt(t.nextSibling)}function fi(){ke=Me=null,W=!1}function ws(t){Ge===null?Ge=[t]:Ge.push(t)}var vh=rt.ReactCurrentBatchConfig;function Ai(t,e,i){if(t=i.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(i._owner){if(i=i._owner,i){if(i.tag!==1)throw Error(C(309));var n=i.stateNode}if(!n)throw Error(C(147,t));var r=n,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(s){var a=r.refs;s===null?delete a[o]:a[o]=s},e._stringRef=o,e)}if(typeof t!="string")throw Error(C(284));if(!i._owner)throw Error(C(290,t))}return t}function bn(t,e){throw t=Object.prototype.toString.call(e),Error(C(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Fa(t){var e=t._init;return e(t._payload)}function xu(t){function e(g,h){if(t){var y=g.deletions;y===null?(g.deletions=[h],g.flags|=16):y.push(h)}}function i(g,h){if(!t)return null;for(;h!==null;)e(g,h),h=h.sibling;return null}function n(g,h){for(g=new Map;h!==null;)h.key!==null?g.set(h.key,h):g.set(h.index,h),h=h.sibling;return g}function r(g,h){return g=wt(g,h),g.index=0,g.sibling=null,g}function o(g,h,y){return g.index=y,t?(y=g.alternate,y!==null?(y=y.index,y<h?(g.flags|=2,h):y):(g.flags|=2,h)):(g.flags|=1048576,h)}function s(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,h,y,w){return h===null||h.tag!==6?(h=no(y,g.mode,w),h.return=g,h):(h=r(h,y),h.return=g,h)}function l(g,h,y,w){var M=y.type;return M===qt?d(g,h,y.props.children,w,y.key):h!==null&&(h.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===lt&&Fa(M)===h.type)?(w=r(h,y.props),w.ref=Ai(g,h,y),w.return=g,w):(w=Wn(y.type,y.key,y.props,null,g.mode,w),w.ref=Ai(g,h,y),w.return=g,w)}function u(g,h,y,w){return h===null||h.tag!==4||h.stateNode.containerInfo!==y.containerInfo||h.stateNode.implementation!==y.implementation?(h=ro(y,g.mode,w),h.return=g,h):(h=r(h,y.children||[]),h.return=g,h)}function d(g,h,y,w,M){return h===null||h.tag!==7?(h=Bt(y,g.mode,w,M),h.return=g,h):(h=r(h,y),h.return=g,h)}function m(g,h,y){if(typeof h=="string"&&h!==""||typeof h=="number")return h=no(""+h,g.mode,y),h.return=g,h;if(typeof h=="object"&&h!==null){switch(h.$$typeof){case yn:return y=Wn(h.type,h.key,h.props,null,g.mode,y),y.ref=Ai(g,null,h),y.return=g,y;case $t:return h=ro(h,g.mode,y),h.return=g,h;case lt:var w=h._init;return m(g,w(h._payload),y)}if(Ri(h)||Pi(h))return h=Bt(h,g.mode,y,null),h.return=g,h;bn(g,h)}return null}function p(g,h,y,w){var M=h!==null?h.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return M!==null?null:a(g,h,""+y,w);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case yn:return y.key===M?l(g,h,y,w):null;case $t:return y.key===M?u(g,h,y,w):null;case lt:return M=y._init,p(g,h,M(y._payload),w)}if(Ri(y)||Pi(y))return M!==null?null:d(g,h,y,w,null);bn(g,y)}return null}function x(g,h,y,w,M){if(typeof w=="string"&&w!==""||typeof w=="number")return g=g.get(y)||null,a(h,g,""+w,M);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case yn:return g=g.get(w.key===null?y:w.key)||null,l(h,g,w,M);case $t:return g=g.get(w.key===null?y:w.key)||null,u(h,g,w,M);case lt:var P=w._init;return x(g,h,y,P(w._payload),M)}if(Ri(w)||Pi(w))return g=g.get(y)||null,d(h,g,w,M,null);bn(h,w)}return null}function S(g,h,y,w){for(var M=null,P=null,k=h,A=h=0,G=null;k!==null&&A<y.length;A++){k.index>A?(G=k,k=null):G=k.sibling;var L=p(g,k,y[A],w);if(L===null){k===null&&(k=G);break}t&&k&&L.alternate===null&&e(g,k),h=o(L,h,A),P===null?M=L:P.sibling=L,P=L,k=G}if(A===y.length)return i(g,k),W&&At(g,A),M;if(k===null){for(;A<y.length;A++)k=m(g,y[A],w),k!==null&&(h=o(k,h,A),P===null?M=k:P.sibling=k,P=k);return W&&At(g,A),M}for(k=n(g,k);A<y.length;A++)G=x(k,g,A,y[A],w),G!==null&&(t&&G.alternate!==null&&k.delete(G.key===null?A:G.key),h=o(G,h,A),P===null?M=G:P.sibling=G,P=G);return t&&k.forEach(function(ue){return e(g,ue)}),W&&At(g,A),M}function E(g,h,y,w){var M=Pi(y);if(typeof M!="function")throw Error(C(150));if(y=M.call(y),y==null)throw Error(C(151));for(var P=M=null,k=h,A=h=0,G=null,L=y.next();k!==null&&!L.done;A++,L=y.next()){k.index>A?(G=k,k=null):G=k.sibling;var ue=p(g,k,L.value,w);if(ue===null){k===null&&(k=G);break}t&&k&&ue.alternate===null&&e(g,k),h=o(ue,h,A),P===null?M=ue:P.sibling=ue,P=ue,k=G}if(L.done)return i(g,k),W&&At(g,A),M;if(k===null){for(;!L.done;A++,L=y.next())L=m(g,L.value,w),L!==null&&(h=o(L,h,A),P===null?M=L:P.sibling=L,P=L);return W&&At(g,A),M}for(k=n(g,k);!L.done;A++,L=y.next())L=x(k,g,A,L.value,w),L!==null&&(t&&L.alternate!==null&&k.delete(L.key===null?A:L.key),h=o(L,h,A),P===null?M=L:P.sibling=L,P=L);return t&&k.forEach(function(ot){return e(g,ot)}),W&&At(g,A),M}function D(g,h,y,w){if(typeof y=="object"&&y!==null&&y.type===qt&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case yn:e:{for(var M=y.key,P=h;P!==null;){if(P.key===M){if(M=y.type,M===qt){if(P.tag===7){i(g,P.sibling),h=r(P,y.props.children),h.return=g,g=h;break e}}else if(P.elementType===M||typeof M=="object"&&M!==null&&M.$$typeof===lt&&Fa(M)===P.type){i(g,P.sibling),h=r(P,y.props),h.ref=Ai(g,P,y),h.return=g,g=h;break e}i(g,P);break}else e(g,P);P=P.sibling}y.type===qt?(h=Bt(y.props.children,g.mode,w,y.key),h.return=g,g=h):(w=Wn(y.type,y.key,y.props,null,g.mode,w),w.ref=Ai(g,h,y),w.return=g,g=w)}return s(g);case $t:e:{for(P=y.key;h!==null;){if(h.key===P)if(h.tag===4&&h.stateNode.containerInfo===y.containerInfo&&h.stateNode.implementation===y.implementation){i(g,h.sibling),h=r(h,y.children||[]),h.return=g,g=h;break e}else{i(g,h);break}else e(g,h);h=h.sibling}h=ro(y,g.mode,w),h.return=g,g=h}return s(g);case lt:return P=y._init,D(g,h,P(y._payload),w)}if(Ri(y))return S(g,h,y,w);if(Pi(y))return E(g,h,y,w);bn(g,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,h!==null&&h.tag===6?(i(g,h.sibling),h=r(h,y),h.return=g,g=h):(i(g,h),h=no(y,g.mode,w),h.return=g,g=h),s(g)):i(g,h)}return D}var gi=xu(!0),wu=xu(!1),or=kt(null),sr=null,ii=null,Cs=null;function Es(){Cs=ii=sr=null}function Ps(t){var e=or.current;U(or),t._currentValue=e}function Do(t,e,i){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===i)break;t=t.return}}function ui(t,e){sr=t,Cs=ii=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(xe=!0),t.firstContext=null)}function ze(t){var e=t._currentValue;if(Cs!==t)if(t={context:t,memoizedValue:e,next:null},ii===null){if(sr===null)throw Error(C(308));ii=t,sr.dependencies={lanes:0,firstContext:t}}else ii=ii.next=t;return e}var zt=null;function ks(t){zt===null?zt=[t]:zt.push(t)}function Cu(t,e,i,n){var r=e.interleaved;return r===null?(i.next=i,ks(e)):(i.next=r.next,r.next=i),e.interleaved=i,it(t,n)}function it(t,e){t.lanes|=e;var i=t.alternate;for(i!==null&&(i.lanes|=e),i=t,t=t.return;t!==null;)t.childLanes|=e,i=t.alternate,i!==null&&(i.childLanes|=e),i=t,t=t.return;return i.tag===3?i.stateNode:null}var ut=!1;function Ms(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Eu(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Je(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function vt(t,e,i){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,B&2){var r=n.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),n.pending=e,it(t,i)}return r=n.interleaved,r===null?(e.next=e,ks(n)):(e.next=r.next,r.next=e),n.interleaved=e,it(t,i)}function On(t,e,i){if(e=e.updateQueue,e!==null&&(e=e.shared,(i&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,i|=n,e.lanes=i,ds(t,i)}}function La(t,e){var i=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,i===n)){var r=null,o=null;if(i=i.firstBaseUpdate,i!==null){do{var s={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};o===null?r=o=s:o=o.next=s,i=i.next}while(i!==null);o===null?r=o=e:o=o.next=e}else r=o=e;i={baseState:n.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:n.shared,effects:n.effects},t.updateQueue=i;return}t=i.lastBaseUpdate,t===null?i.firstBaseUpdate=e:t.next=e,i.lastBaseUpdate=e}function ar(t,e,i,n){var r=t.updateQueue;ut=!1;var o=r.firstBaseUpdate,s=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,u=l.next;l.next=null,s===null?o=u:s.next=u,s=l;var d=t.alternate;d!==null&&(d=d.updateQueue,a=d.lastBaseUpdate,a!==s&&(a===null?d.firstBaseUpdate=u:a.next=u,d.lastBaseUpdate=l))}if(o!==null){var m=r.baseState;s=0,d=u=l=null,a=o;do{var p=a.lane,x=a.eventTime;if((n&p)===p){d!==null&&(d=d.next={eventTime:x,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var S=t,E=a;switch(p=e,x=i,E.tag){case 1:if(S=E.payload,typeof S=="function"){m=S.call(x,m,p);break e}m=S;break e;case 3:S.flags=S.flags&-65537|128;case 0:if(S=E.payload,p=typeof S=="function"?S.call(x,m,p):S,p==null)break e;m=$({},m,p);break e;case 2:ut=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,p=r.effects,p===null?r.effects=[a]:p.push(a))}else x={eventTime:x,lane:p,tag:a.tag,payload:a.payload,callback:a.callback,next:null},d===null?(u=d=x,l=m):d=d.next=x,s|=p;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;p=a,a=p.next,p.next=null,r.lastBaseUpdate=p,r.shared.pending=null}}while(1);if(d===null&&(l=m),r.baseState=l,r.firstBaseUpdate=u,r.lastBaseUpdate=d,e=r.shared.interleaved,e!==null){r=e;do s|=r.lane,r=r.next;while(r!==e)}else o===null&&(r.shared.lanes=0);Vt|=s,t.lanes=s,t.memoizedState=m}}function Ra(t,e,i){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],r=n.callback;if(r!==null){if(n.callback=null,n=i,typeof r!="function")throw Error(C(191,r));r.call(n)}}}var fn={},qe=kt(fn),nn=kt(fn),rn=kt(fn);function It(t){if(t===fn)throw Error(C(174));return t}function Ts(t,e){switch(V(rn,e),V(nn,t),V(qe,fn),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:po(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=po(e,t)}U(qe),V(qe,e)}function mi(){U(qe),U(nn),U(rn)}function Pu(t){It(rn.current);var e=It(qe.current),i=po(e,t.type);e!==i&&(V(nn,t),V(qe,i))}function bs(t){nn.current===t&&(U(qe),U(nn))}var H=kt(0);function lr(t){for(var e=t;e!==null;){if(e.tag===13){var i=e.memoizedState;if(i!==null&&(i=i.dehydrated,i===null||i.data==="$?"||i.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Xr=[];function As(){for(var t=0;t<Xr.length;t++)Xr[t]._workInProgressVersionPrimary=null;Xr.length=0}var Nn=rt.ReactCurrentDispatcher,Zr=rt.ReactCurrentBatchConfig,Gt=0,Q=null,Z=null,ne=null,ur=!1,Vi=!1,on=0,Sh=0;function ce(){throw Error(C(321))}function _s(t,e){if(e===null)return!1;for(var i=0;i<e.length&&i<t.length;i++)if(!Ue(t[i],e[i]))return!1;return!0}function Fs(t,e,i,n,r,o){if(Gt=o,Q=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Nn.current=t===null||t.memoizedState===null?Eh:Ph,t=i(n,r),Vi){o=0;do{if(Vi=!1,on=0,25<=o)throw Error(C(301));o+=1,ne=Z=null,e.updateQueue=null,Nn.current=kh,t=i(n,r)}while(Vi)}if(Nn.current=cr,e=Z!==null&&Z.next!==null,Gt=0,ne=Z=Q=null,ur=!1,e)throw Error(C(300));return t}function Ls(){var t=on!==0;return on=0,t}function He(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ne===null?Q.memoizedState=ne=t:ne=ne.next=t,ne}function Ie(){if(Z===null){var t=Q.alternate;t=t!==null?t.memoizedState:null}else t=Z.next;var e=ne===null?Q.memoizedState:ne.next;if(e!==null)ne=e,Z=t;else{if(t===null)throw Error(C(310));Z=t,t={memoizedState:Z.memoizedState,baseState:Z.baseState,baseQueue:Z.baseQueue,queue:Z.queue,next:null},ne===null?Q.memoizedState=ne=t:ne=ne.next=t}return ne}function sn(t,e){return typeof e=="function"?e(t):e}function Jr(t){var e=Ie(),i=e.queue;if(i===null)throw Error(C(311));i.lastRenderedReducer=t;var n=Z,r=n.baseQueue,o=i.pending;if(o!==null){if(r!==null){var s=r.next;r.next=o.next,o.next=s}n.baseQueue=r=o,i.pending=null}if(r!==null){o=r.next,n=n.baseState;var a=s=null,l=null,u=o;do{var d=u.lane;if((Gt&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:t(n,u.action);else{var m={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=m,s=n):l=l.next=m,Q.lanes|=d,Vt|=d}u=u.next}while(u!==null&&u!==o);l===null?s=n:l.next=a,Ue(n,e.memoizedState)||(xe=!0),e.memoizedState=n,e.baseState=s,e.baseQueue=l,i.lastRenderedState=n}if(t=i.interleaved,t!==null){r=t;do o=r.lane,Q.lanes|=o,Vt|=o,r=r.next;while(r!==t)}else r===null&&(i.lanes=0);return[e.memoizedState,i.dispatch]}function eo(t){var e=Ie(),i=e.queue;if(i===null)throw Error(C(311));i.lastRenderedReducer=t;var n=i.dispatch,r=i.pending,o=e.memoizedState;if(r!==null){i.pending=null;var s=r=r.next;do o=t(o,s.action),s=s.next;while(s!==r);Ue(o,e.memoizedState)||(xe=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),i.lastRenderedState=o}return[o,n]}function ku(){}function Mu(t,e){var i=Q,n=Ie(),r=e(),o=!Ue(n.memoizedState,r);if(o&&(n.memoizedState=r,xe=!0),n=n.queue,Rs(Au.bind(null,i,n,t),[t]),n.getSnapshot!==e||o||ne!==null&&ne.memoizedState.tag&1){if(i.flags|=2048,an(9,bu.bind(null,i,n,r,e),void 0,null),re===null)throw Error(C(349));Gt&30||Tu(i,e,r)}return r}function Tu(t,e,i){t.flags|=16384,t={getSnapshot:e,value:i},e=Q.updateQueue,e===null?(e={lastEffect:null,stores:null},Q.updateQueue=e,e.stores=[t]):(i=e.stores,i===null?e.stores=[t]:i.push(t))}function bu(t,e,i,n){e.value=i,e.getSnapshot=n,_u(e)&&Fu(t)}function Au(t,e,i){return i(function(){_u(e)&&Fu(t)})}function _u(t){var e=t.getSnapshot;t=t.value;try{var i=e();return!Ue(t,i)}catch{return!0}}function Fu(t){var e=it(t,1);e!==null&&je(e,t,1,-1)}function za(t){var e=He();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:sn,lastRenderedState:t},e.queue=t,t=t.dispatch=Ch.bind(null,Q,t),[e.memoizedState,t]}function an(t,e,i,n){return t={tag:t,create:e,destroy:i,deps:n,next:null},e=Q.updateQueue,e===null?(e={lastEffect:null,stores:null},Q.updateQueue=e,e.lastEffect=t.next=t):(i=e.lastEffect,i===null?e.lastEffect=t.next=t:(n=i.next,i.next=t,t.next=n,e.lastEffect=t)),t}function Lu(){return Ie().memoizedState}function Gn(t,e,i,n){var r=He();Q.flags|=t,r.memoizedState=an(1|e,i,void 0,n===void 0?null:n)}function Er(t,e,i,n){var r=Ie();n=n===void 0?null:n;var o=void 0;if(Z!==null){var s=Z.memoizedState;if(o=s.destroy,n!==null&&_s(n,s.deps)){r.memoizedState=an(e,i,o,n);return}}Q.flags|=t,r.memoizedState=an(1|e,i,o,n)}function Ia(t,e){return Gn(8390656,8,t,e)}function Rs(t,e){return Er(2048,8,t,e)}function Ru(t,e){return Er(4,2,t,e)}function zu(t,e){return Er(4,4,t,e)}function Iu(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Du(t,e,i){return i=i!=null?i.concat([t]):null,Er(4,4,Iu.bind(null,e,t),i)}function zs(){}function Bu(t,e){var i=Ie();e=e===void 0?null:e;var n=i.memoizedState;return n!==null&&e!==null&&_s(e,n[1])?n[0]:(i.memoizedState=[t,e],t)}function Ou(t,e){var i=Ie();e=e===void 0?null:e;var n=i.memoizedState;return n!==null&&e!==null&&_s(e,n[1])?n[0]:(t=t(),i.memoizedState=[t,e],t)}function Nu(t,e,i){return Gt&21?(Ue(i,e)||(i=Wl(),Q.lanes|=i,Vt|=i,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,xe=!0),t.memoizedState=i)}function xh(t,e){var i=N;N=i!==0&&4>i?i:4,t(!0);var n=Zr.transition;Zr.transition={};try{t(!1),e()}finally{N=i,Zr.transition=n}}function Gu(){return Ie().memoizedState}function wh(t,e,i){var n=xt(t);if(i={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null},Vu(t))ju(e,i);else if(i=Cu(t,e,i,n),i!==null){var r=me();je(i,t,n,r),Uu(i,e,n)}}function Ch(t,e,i){var n=xt(t),r={lane:n,action:i,hasEagerState:!1,eagerState:null,next:null};if(Vu(t))ju(e,r);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var s=e.lastRenderedState,a=o(s,i);if(r.hasEagerState=!0,r.eagerState=a,Ue(a,s)){var l=e.interleaved;l===null?(r.next=r,ks(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}i=Cu(t,e,r,n),i!==null&&(r=me(),je(i,t,n,r),Uu(i,e,n))}}function Vu(t){var e=t.alternate;return t===Q||e!==null&&e===Q}function ju(t,e){Vi=ur=!0;var i=t.pending;i===null?e.next=e:(e.next=i.next,i.next=e),t.pending=e}function Uu(t,e,i){if(i&4194240){var n=e.lanes;n&=t.pendingLanes,i|=n,e.lanes=i,ds(t,i)}}var cr={readContext:ze,useCallback:ce,useContext:ce,useEffect:ce,useImperativeHandle:ce,useInsertionEffect:ce,useLayoutEffect:ce,useMemo:ce,useReducer:ce,useRef:ce,useState:ce,useDebugValue:ce,useDeferredValue:ce,useTransition:ce,useMutableSource:ce,useSyncExternalStore:ce,useId:ce,unstable_isNewReconciler:!1},Eh={readContext:ze,useCallback:function(t,e){return He().memoizedState=[t,e===void 0?null:e],t},useContext:ze,useEffect:Ia,useImperativeHandle:function(t,e,i){return i=i!=null?i.concat([t]):null,Gn(4194308,4,Iu.bind(null,e,t),i)},useLayoutEffect:function(t,e){return Gn(4194308,4,t,e)},useInsertionEffect:function(t,e){return Gn(4,2,t,e)},useMemo:function(t,e){var i=He();return e=e===void 0?null:e,t=t(),i.memoizedState=[t,e],t},useReducer:function(t,e,i){var n=He();return e=i!==void 0?i(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=wh.bind(null,Q,t),[n.memoizedState,t]},useRef:function(t){var e=He();return t={current:t},e.memoizedState=t},useState:za,useDebugValue:zs,useDeferredValue:function(t){return He().memoizedState=t},useTransition:function(){var t=za(!1),e=t[0];return t=xh.bind(null,t[1]),He().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,i){var n=Q,r=He();if(W){if(i===void 0)throw Error(C(407));i=i()}else{if(i=e(),re===null)throw Error(C(349));Gt&30||Tu(n,e,i)}r.memoizedState=i;var o={value:i,getSnapshot:e};return r.queue=o,Ia(Au.bind(null,n,o,t),[t]),n.flags|=2048,an(9,bu.bind(null,n,o,i,e),void 0,null),i},useId:function(){var t=He(),e=re.identifierPrefix;if(W){var i=Ze,n=Xe;i=(n&~(1<<32-Ve(n)-1)).toString(32)+i,e=":"+e+"R"+i,i=on++,0<i&&(e+="H"+i.toString(32)),e+=":"}else i=Sh++,e=":"+e+"r"+i.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Ph={readContext:ze,useCallback:Bu,useContext:ze,useEffect:Rs,useImperativeHandle:Du,useInsertionEffect:Ru,useLayoutEffect:zu,useMemo:Ou,useReducer:Jr,useRef:Lu,useState:function(){return Jr(sn)},useDebugValue:zs,useDeferredValue:function(t){var e=Ie();return Nu(e,Z.memoizedState,t)},useTransition:function(){var t=Jr(sn)[0],e=Ie().memoizedState;return[t,e]},useMutableSource:ku,useSyncExternalStore:Mu,useId:Gu,unstable_isNewReconciler:!1},kh={readContext:ze,useCallback:Bu,useContext:ze,useEffect:Rs,useImperativeHandle:Du,useInsertionEffect:Ru,useLayoutEffect:zu,useMemo:Ou,useReducer:eo,useRef:Lu,useState:function(){return eo(sn)},useDebugValue:zs,useDeferredValue:function(t){var e=Ie();return Z===null?e.memoizedState=t:Nu(e,Z.memoizedState,t)},useTransition:function(){var t=eo(sn)[0],e=Ie().memoizedState;return[t,e]},useMutableSource:ku,useSyncExternalStore:Mu,useId:Gu,unstable_isNewReconciler:!1};function Oe(t,e){if(t&&t.defaultProps){e=$({},e),t=t.defaultProps;for(var i in t)e[i]===void 0&&(e[i]=t[i]);return e}return e}function Bo(t,e,i,n){e=t.memoizedState,i=i(n,e),i=i==null?e:$({},e,i),t.memoizedState=i,t.lanes===0&&(t.updateQueue.baseState=i)}var Pr={isMounted:function(t){return(t=t._reactInternals)?Wt(t)===t:!1},enqueueSetState:function(t,e,i){t=t._reactInternals;var n=me(),r=xt(t),o=Je(n,r);o.payload=e,i!=null&&(o.callback=i),e=vt(t,o,r),e!==null&&(je(e,t,r,n),On(e,t,r))},enqueueReplaceState:function(t,e,i){t=t._reactInternals;var n=me(),r=xt(t),o=Je(n,r);o.tag=1,o.payload=e,i!=null&&(o.callback=i),e=vt(t,o,r),e!==null&&(je(e,t,r,n),On(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var i=me(),n=xt(t),r=Je(i,n);r.tag=2,e!=null&&(r.callback=e),e=vt(t,r,n),e!==null&&(je(e,t,n,i),On(e,t,n))}};function Da(t,e,i,n,r,o,s){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,o,s):e.prototype&&e.prototype.isPureReactComponent?!Zi(i,n)||!Zi(r,o):!0}function Wu(t,e,i){var n=!1,r=Et,o=e.contextType;return typeof o=="object"&&o!==null?o=ze(o):(r=Ce(e)?Ot:fe.current,n=e.contextTypes,o=(n=n!=null)?hi(t,r):Et),e=new e(i,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Pr,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=o),e}function Ba(t,e,i,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(i,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(i,n),e.state!==t&&Pr.enqueueReplaceState(e,e.state,null)}function Oo(t,e,i,n){var r=t.stateNode;r.props=i,r.state=t.memoizedState,r.refs={},Ms(t);var o=e.contextType;typeof o=="object"&&o!==null?r.context=ze(o):(o=Ce(e)?Ot:fe.current,r.context=hi(t,o)),r.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Bo(t,e,o,i),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Pr.enqueueReplaceState(r,r.state,null),ar(t,i,r,n),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function pi(t,e){try{var i="",n=e;do i+=Jc(n),n=n.return;while(n);var r=i}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:r,digest:null}}function to(t,e,i){return{value:t,source:null,stack:i??null,digest:e??null}}function No(t,e){try{console.error(e.value)}catch(i){setTimeout(function(){throw i})}}var Mh=typeof WeakMap=="function"?WeakMap:Map;function Hu(t,e,i){i=Je(-1,i),i.tag=3,i.payload={element:null};var n=e.value;return i.callback=function(){hr||(hr=!0,Yo=n),No(t,e)},i}function Qu(t,e,i){i=Je(-1,i),i.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var r=e.value;i.payload=function(){return n(r)},i.callback=function(){No(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(i.callback=function(){No(t,e),typeof n!="function"&&(St===null?St=new Set([this]):St.add(this));var s=e.stack;this.componentDidCatch(e.value,{componentStack:s!==null?s:""})}),i}function Oa(t,e,i){var n=t.pingCache;if(n===null){n=t.pingCache=new Mh;var r=new Set;n.set(e,r)}else r=n.get(e),r===void 0&&(r=new Set,n.set(e,r));r.has(i)||(r.add(i),t=Gh.bind(null,t,e,i),e.then(t,t))}function Na(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ga(t,e,i,n,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,i.flags|=131072,i.flags&=-52805,i.tag===1&&(i.alternate===null?i.tag=17:(e=Je(-1,1),e.tag=2,vt(i,e,1))),i.lanes|=1),t)}var Th=rt.ReactCurrentOwner,xe=!1;function ge(t,e,i,n){e.child=t===null?wu(e,null,i,n):gi(e,t.child,i,n)}function Va(t,e,i,n,r){i=i.render;var o=e.ref;return ui(e,r),n=Fs(t,e,i,n,o,r),i=Ls(),t!==null&&!xe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,nt(t,e,r)):(W&&i&&Ss(e),e.flags|=1,ge(t,e,n,r),e.child)}function ja(t,e,i,n,r){if(t===null){var o=i.type;return typeof o=="function"&&!js(o)&&o.defaultProps===void 0&&i.compare===null&&i.defaultProps===void 0?(e.tag=15,e.type=o,$u(t,e,o,n,r)):(t=Wn(i.type,null,n,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&r)){var s=o.memoizedProps;if(i=i.compare,i=i!==null?i:Zi,i(s,n)&&t.ref===e.ref)return nt(t,e,r)}return e.flags|=1,t=wt(o,n),t.ref=e.ref,t.return=e,e.child=t}function $u(t,e,i,n,r){if(t!==null){var o=t.memoizedProps;if(Zi(o,n)&&t.ref===e.ref)if(xe=!1,e.pendingProps=n=o,(t.lanes&r)!==0)t.flags&131072&&(xe=!0);else return e.lanes=t.lanes,nt(t,e,r)}return Go(t,e,i,n,r)}function qu(t,e,i){var n=e.pendingProps,r=n.children,o=t!==null?t.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},V(ri,Pe),Pe|=i;else{if(!(i&1073741824))return t=o!==null?o.baseLanes|i:i,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,V(ri,Pe),Pe|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=o!==null?o.baseLanes:i,V(ri,Pe),Pe|=n}else o!==null?(n=o.baseLanes|i,e.memoizedState=null):n=i,V(ri,Pe),Pe|=n;return ge(t,e,r,i),e.child}function Yu(t,e){var i=e.ref;(t===null&&i!==null||t!==null&&t.ref!==i)&&(e.flags|=512,e.flags|=2097152)}function Go(t,e,i,n,r){var o=Ce(i)?Ot:fe.current;return o=hi(e,o),ui(e,r),i=Fs(t,e,i,n,o,r),n=Ls(),t!==null&&!xe?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,nt(t,e,r)):(W&&n&&Ss(e),e.flags|=1,ge(t,e,i,r),e.child)}function Ua(t,e,i,n,r){if(Ce(i)){var o=!0;ir(e)}else o=!1;if(ui(e,r),e.stateNode===null)Vn(t,e),Wu(e,i,n),Oo(e,i,n,r),n=!0;else if(t===null){var s=e.stateNode,a=e.memoizedProps;s.props=a;var l=s.context,u=i.contextType;typeof u=="object"&&u!==null?u=ze(u):(u=Ce(i)?Ot:fe.current,u=hi(e,u));var d=i.getDerivedStateFromProps,m=typeof d=="function"||typeof s.getSnapshotBeforeUpdate=="function";m||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==n||l!==u)&&Ba(e,s,n,u),ut=!1;var p=e.memoizedState;s.state=p,ar(e,n,s,r),l=e.memoizedState,a!==n||p!==l||we.current||ut?(typeof d=="function"&&(Bo(e,i,d,n),l=e.memoizedState),(a=ut||Da(e,i,a,n,p,l,u))?(m||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount()),typeof s.componentDidMount=="function"&&(e.flags|=4194308)):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),s.props=n,s.state=l,s.context=u,n=a):(typeof s.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{s=e.stateNode,Eu(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:Oe(e.type,a),s.props=u,m=e.pendingProps,p=s.context,l=i.contextType,typeof l=="object"&&l!==null?l=ze(l):(l=Ce(i)?Ot:fe.current,l=hi(e,l));var x=i.getDerivedStateFromProps;(d=typeof x=="function"||typeof s.getSnapshotBeforeUpdate=="function")||typeof s.UNSAFE_componentWillReceiveProps!="function"&&typeof s.componentWillReceiveProps!="function"||(a!==m||p!==l)&&Ba(e,s,n,l),ut=!1,p=e.memoizedState,s.state=p,ar(e,n,s,r);var S=e.memoizedState;a!==m||p!==S||we.current||ut?(typeof x=="function"&&(Bo(e,i,x,n),S=e.memoizedState),(u=ut||Da(e,i,u,n,p,S,l)||!1)?(d||typeof s.UNSAFE_componentWillUpdate!="function"&&typeof s.componentWillUpdate!="function"||(typeof s.componentWillUpdate=="function"&&s.componentWillUpdate(n,S,l),typeof s.UNSAFE_componentWillUpdate=="function"&&s.UNSAFE_componentWillUpdate(n,S,l)),typeof s.componentDidUpdate=="function"&&(e.flags|=4),typeof s.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=S),s.props=n,s.state=S,s.context=l,n=u):(typeof s.componentDidUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=4),typeof s.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&p===t.memoizedState||(e.flags|=1024),n=!1)}return Vo(t,e,i,n,o,r)}function Vo(t,e,i,n,r,o){Yu(t,e);var s=(e.flags&128)!==0;if(!n&&!s)return r&&ba(e,i,!1),nt(t,e,o);n=e.stateNode,Th.current=e;var a=s&&typeof i.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&s?(e.child=gi(e,t.child,null,o),e.child=gi(e,null,a,o)):ge(t,e,a,o),e.memoizedState=n.state,r&&ba(e,i,!0),e.child}function Ku(t){var e=t.stateNode;e.pendingContext?Ta(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Ta(t,e.context,!1),Ts(t,e.containerInfo)}function Wa(t,e,i,n,r){return fi(),ws(r),e.flags|=256,ge(t,e,i,n),e.child}var jo={dehydrated:null,treeContext:null,retryLane:0};function Uo(t){return{baseLanes:t,cachePool:null,transitions:null}}function Xu(t,e,i){var n=e.pendingProps,r=H.current,o=!1,s=(e.flags&128)!==0,a;if((a=s)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),V(H,r&1),t===null)return Io(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(s=n.children,t=n.fallback,o?(n=e.mode,o=e.child,s={mode:"hidden",children:s},!(n&1)&&o!==null?(o.childLanes=0,o.pendingProps=s):o=Tr(s,n,0,null),t=Bt(t,n,i,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=Uo(i),e.memoizedState=jo,t):Is(e,s));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return bh(t,e,s,n,a,r,i);if(o){o=n.fallback,s=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:n.children};return!(s&1)&&e.child!==r?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=wt(r,l),n.subtreeFlags=r.subtreeFlags&14680064),a!==null?o=wt(a,o):(o=Bt(o,s,i,null),o.flags|=2),o.return=e,n.return=e,n.sibling=o,e.child=n,n=o,o=e.child,s=t.child.memoizedState,s=s===null?Uo(i):{baseLanes:s.baseLanes|i,cachePool:null,transitions:s.transitions},o.memoizedState=s,o.childLanes=t.childLanes&~i,e.memoizedState=jo,n}return o=t.child,t=o.sibling,n=wt(o,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=i),n.return=e,n.sibling=null,t!==null&&(i=e.deletions,i===null?(e.deletions=[t],e.flags|=16):i.push(t)),e.child=n,e.memoizedState=null,n}function Is(t,e){return e=Tr({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function An(t,e,i,n){return n!==null&&ws(n),gi(e,t.child,null,i),t=Is(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function bh(t,e,i,n,r,o,s){if(i)return e.flags&256?(e.flags&=-257,n=to(Error(C(422))),An(t,e,s,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=n.fallback,r=e.mode,n=Tr({mode:"visible",children:n.children},r,0,null),o=Bt(o,r,s,null),o.flags|=2,n.return=e,o.return=e,n.sibling=o,e.child=n,e.mode&1&&gi(e,t.child,null,s),e.child.memoizedState=Uo(s),e.memoizedState=jo,o);if(!(e.mode&1))return An(t,e,s,null);if(r.data==="$!"){if(n=r.nextSibling&&r.nextSibling.dataset,n)var a=n.dgst;return n=a,o=Error(C(419)),n=to(o,n,void 0),An(t,e,s,n)}if(a=(s&t.childLanes)!==0,xe||a){if(n=re,n!==null){switch(s&-s){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(n.suspendedLanes|s)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,it(t,r),je(n,t,r,-1))}return Vs(),n=to(Error(C(421))),An(t,e,s,n)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=Vh.bind(null,t),r._reactRetry=e,null):(t=o.treeContext,ke=yt(r.nextSibling),Me=e,W=!0,Ge=null,t!==null&&(_e[Fe++]=Xe,_e[Fe++]=Ze,_e[Fe++]=Nt,Xe=t.id,Ze=t.overflow,Nt=e),e=Is(e,n.children),e.flags|=4096,e)}function Ha(t,e,i){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),Do(t.return,e,i)}function io(t,e,i,n,r){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:r}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=i,o.tailMode=r)}function Zu(t,e,i){var n=e.pendingProps,r=n.revealOrder,o=n.tail;if(ge(t,e,n.children,i),n=H.current,n&2)n=n&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ha(t,i,e);else if(t.tag===19)Ha(t,i,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(V(H,n),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(i=e.child,r=null;i!==null;)t=i.alternate,t!==null&&lr(t)===null&&(r=i),i=i.sibling;i=r,i===null?(r=e.child,e.child=null):(r=i.sibling,i.sibling=null),io(e,!1,r,i,o);break;case"backwards":for(i=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&lr(t)===null){e.child=r;break}t=r.sibling,r.sibling=i,i=r,r=t}io(e,!0,i,null,o);break;case"together":io(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Vn(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function nt(t,e,i){if(t!==null&&(e.dependencies=t.dependencies),Vt|=e.lanes,!(i&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(C(153));if(e.child!==null){for(t=e.child,i=wt(t,t.pendingProps),e.child=i,i.return=e;t.sibling!==null;)t=t.sibling,i=i.sibling=wt(t,t.pendingProps),i.return=e;i.sibling=null}return e.child}function Ah(t,e,i){switch(e.tag){case 3:Ku(e),fi();break;case 5:Pu(e);break;case 1:Ce(e.type)&&ir(e);break;case 4:Ts(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,r=e.memoizedProps.value;V(or,n._currentValue),n._currentValue=r;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(V(H,H.current&1),e.flags|=128,null):i&e.child.childLanes?Xu(t,e,i):(V(H,H.current&1),t=nt(t,e,i),t!==null?t.sibling:null);V(H,H.current&1);break;case 19:if(n=(i&e.childLanes)!==0,t.flags&128){if(n)return Zu(t,e,i);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),V(H,H.current),n)break;return null;case 22:case 23:return e.lanes=0,qu(t,e,i)}return nt(t,e,i)}var Ju,Wo,ec,tc;Ju=function(t,e){for(var i=e.child;i!==null;){if(i.tag===5||i.tag===6)t.appendChild(i.stateNode);else if(i.tag!==4&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};Wo=function(){};ec=function(t,e,i,n){var r=t.memoizedProps;if(r!==n){t=e.stateNode,It(qe.current);var o=null;switch(i){case"input":r=ho(t,r),n=ho(t,n),o=[];break;case"select":r=$({},r,{value:void 0}),n=$({},n,{value:void 0}),o=[];break;case"textarea":r=mo(t,r),n=mo(t,n),o=[];break;default:typeof r.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=er)}yo(i,n);var s;i=null;for(u in r)if(!n.hasOwnProperty(u)&&r.hasOwnProperty(u)&&r[u]!=null)if(u==="style"){var a=r[u];for(s in a)a.hasOwnProperty(s)&&(i||(i={}),i[s]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Hi.hasOwnProperty(u)?o||(o=[]):(o=o||[]).push(u,null));for(u in n){var l=n[u];if(a=r!=null?r[u]:void 0,n.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(s in a)!a.hasOwnProperty(s)||l&&l.hasOwnProperty(s)||(i||(i={}),i[s]="");for(s in l)l.hasOwnProperty(s)&&a[s]!==l[s]&&(i||(i={}),i[s]=l[s])}else i||(o||(o=[]),o.push(u,i)),i=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Hi.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&j("scroll",t),o||a===l||(o=[])):(o=o||[]).push(u,l))}i&&(o=o||[]).push("style",i);var u=o;(e.updateQueue=u)&&(e.flags|=4)}};tc=function(t,e,i,n){i!==n&&(e.flags|=4)};function _i(t,e){if(!W)switch(t.tailMode){case"hidden":e=t.tail;for(var i=null;e!==null;)e.alternate!==null&&(i=e),e=e.sibling;i===null?t.tail=null:i.sibling=null;break;case"collapsed":i=t.tail;for(var n=null;i!==null;)i.alternate!==null&&(n=i),i=i.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function de(t){var e=t.alternate!==null&&t.alternate.child===t.child,i=0,n=0;if(e)for(var r=t.child;r!==null;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags&14680064,n|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)i|=r.lanes|r.childLanes,n|=r.subtreeFlags,n|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=n,t.childLanes=i,e}function _h(t,e,i){var n=e.pendingProps;switch(xs(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return de(e),null;case 1:return Ce(e.type)&&tr(),de(e),null;case 3:return n=e.stateNode,mi(),U(we),U(fe),As(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(Tn(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ge!==null&&(Zo(Ge),Ge=null))),Wo(t,e),de(e),null;case 5:bs(e);var r=It(rn.current);if(i=e.type,t!==null&&e.stateNode!=null)ec(t,e,i,n,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(C(166));return de(e),null}if(t=It(qe.current),Tn(e)){n=e.stateNode,i=e.type;var o=e.memoizedProps;switch(n[Qe]=e,n[tn]=o,t=(e.mode&1)!==0,i){case"dialog":j("cancel",n),j("close",n);break;case"iframe":case"object":case"embed":j("load",n);break;case"video":case"audio":for(r=0;r<Ii.length;r++)j(Ii[r],n);break;case"source":j("error",n);break;case"img":case"image":case"link":j("error",n),j("load",n);break;case"details":j("toggle",n);break;case"input":ea(n,o),j("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!o.multiple},j("invalid",n);break;case"textarea":ia(n,o),j("invalid",n)}yo(i,o),r=null;for(var s in o)if(o.hasOwnProperty(s)){var a=o[s];s==="children"?typeof a=="string"?n.textContent!==a&&(o.suppressHydrationWarning!==!0&&Mn(n.textContent,a,t),r=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Mn(n.textContent,a,t),r=["children",""+a]):Hi.hasOwnProperty(s)&&a!=null&&s==="onScroll"&&j("scroll",n)}switch(i){case"input":vn(n),ta(n,o,!0);break;case"textarea":vn(n),na(n);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(n.onclick=er)}n=r,e.updateQueue=n,n!==null&&(e.flags|=4)}else{s=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Al(i)),t==="http://www.w3.org/1999/xhtml"?i==="script"?(t=s.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=s.createElement(i,{is:n.is}):(t=s.createElement(i),i==="select"&&(s=t,n.multiple?s.multiple=!0:n.size&&(s.size=n.size))):t=s.createElementNS(t,i),t[Qe]=e,t[tn]=n,Ju(t,e,!1,!1),e.stateNode=t;e:{switch(s=vo(i,n),i){case"dialog":j("cancel",t),j("close",t),r=n;break;case"iframe":case"object":case"embed":j("load",t),r=n;break;case"video":case"audio":for(r=0;r<Ii.length;r++)j(Ii[r],t);r=n;break;case"source":j("error",t),r=n;break;case"img":case"image":case"link":j("error",t),j("load",t),r=n;break;case"details":j("toggle",t),r=n;break;case"input":ea(t,n),r=ho(t,n),j("invalid",t);break;case"option":r=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},r=$({},n,{value:void 0}),j("invalid",t);break;case"textarea":ia(t,n),r=mo(t,n),j("invalid",t);break;default:r=n}yo(i,r),a=r;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?Ll(t,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&_l(t,l)):o==="children"?typeof l=="string"?(i!=="textarea"||l!=="")&&Qi(t,l):typeof l=="number"&&Qi(t,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Hi.hasOwnProperty(o)?l!=null&&o==="onScroll"&&j("scroll",t):l!=null&&os(t,o,l,s))}switch(i){case"input":vn(t),ta(t,n,!1);break;case"textarea":vn(t),na(t);break;case"option":n.value!=null&&t.setAttribute("value",""+Ct(n.value));break;case"select":t.multiple=!!n.multiple,o=n.value,o!=null?oi(t,!!n.multiple,o,!1):n.defaultValue!=null&&oi(t,!!n.multiple,n.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=er)}switch(i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return de(e),null;case 6:if(t&&e.stateNode!=null)tc(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(C(166));if(i=It(rn.current),It(qe.current),Tn(e)){if(n=e.stateNode,i=e.memoizedProps,n[Qe]=e,(o=n.nodeValue!==i)&&(t=Me,t!==null))switch(t.tag){case 3:Mn(n.nodeValue,i,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Mn(n.nodeValue,i,(t.mode&1)!==0)}o&&(e.flags|=4)}else n=(i.nodeType===9?i:i.ownerDocument).createTextNode(n),n[Qe]=e,e.stateNode=n}return de(e),null;case 13:if(U(H),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(W&&ke!==null&&e.mode&1&&!(e.flags&128))Su(),fi(),e.flags|=98560,o=!1;else if(o=Tn(e),n!==null&&n.dehydrated!==null){if(t===null){if(!o)throw Error(C(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(C(317));o[Qe]=e}else fi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;de(e),o=!1}else Ge!==null&&(Zo(Ge),Ge=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=i,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(t===null||H.current&1?ee===0&&(ee=3):Vs())),e.updateQueue!==null&&(e.flags|=4),de(e),null);case 4:return mi(),Wo(t,e),t===null&&Ji(e.stateNode.containerInfo),de(e),null;case 10:return Ps(e.type._context),de(e),null;case 17:return Ce(e.type)&&tr(),de(e),null;case 19:if(U(H),o=e.memoizedState,o===null)return de(e),null;if(n=(e.flags&128)!==0,s=o.rendering,s===null)if(n)_i(o,!1);else{if(ee!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(s=lr(t),s!==null){for(e.flags|=128,_i(o,!1),n=s.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=i,i=e.child;i!==null;)o=i,t=n,o.flags&=14680066,s=o.alternate,s===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,o.type=s.type,t=s.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),i=i.sibling;return V(H,H.current&1|2),e.child}t=t.sibling}o.tail!==null&&K()>yi&&(e.flags|=128,n=!0,_i(o,!1),e.lanes=4194304)}else{if(!n)if(t=lr(s),t!==null){if(e.flags|=128,n=!0,i=t.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),_i(o,!0),o.tail===null&&o.tailMode==="hidden"&&!s.alternate&&!W)return de(e),null}else 2*K()-o.renderingStartTime>yi&&i!==1073741824&&(e.flags|=128,n=!0,_i(o,!1),e.lanes=4194304);o.isBackwards?(s.sibling=e.child,e.child=s):(i=o.last,i!==null?i.sibling=s:e.child=s,o.last=s)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=K(),e.sibling=null,i=H.current,V(H,n?i&1|2:i&1),e):(de(e),null);case 22:case 23:return Gs(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?Pe&1073741824&&(de(e),e.subtreeFlags&6&&(e.flags|=8192)):de(e),null;case 24:return null;case 25:return null}throw Error(C(156,e.tag))}function Fh(t,e){switch(xs(e),e.tag){case 1:return Ce(e.type)&&tr(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return mi(),U(we),U(fe),As(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return bs(e),null;case 13:if(U(H),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(C(340));fi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return U(H),null;case 4:return mi(),null;case 10:return Ps(e.type._context),null;case 22:case 23:return Gs(),null;case 24:return null;default:return null}}var _n=!1,he=!1,Lh=typeof WeakSet=="function"?WeakSet:Set,T=null;function ni(t,e){var i=t.ref;if(i!==null)if(typeof i=="function")try{i(null)}catch(n){q(t,e,n)}else i.current=null}function Ho(t,e,i){try{i()}catch(n){q(t,e,n)}}var Qa=!1;function Rh(t,e){if(bo=Xn,t=su(),vs(t)){if("selectionStart"in t)var i={start:t.selectionStart,end:t.selectionEnd};else e:{i=(i=t.ownerDocument)&&i.defaultView||window;var n=i.getSelection&&i.getSelection();if(n&&n.rangeCount!==0){i=n.anchorNode;var r=n.anchorOffset,o=n.focusNode;n=n.focusOffset;try{i.nodeType,o.nodeType}catch{i=null;break e}var s=0,a=-1,l=-1,u=0,d=0,m=t,p=null;t:for(;;){for(var x;m!==i||r!==0&&m.nodeType!==3||(a=s+r),m!==o||n!==0&&m.nodeType!==3||(l=s+n),m.nodeType===3&&(s+=m.nodeValue.length),(x=m.firstChild)!==null;)p=m,m=x;for(;;){if(m===t)break t;if(p===i&&++u===r&&(a=s),p===o&&++d===n&&(l=s),(x=m.nextSibling)!==null)break;m=p,p=m.parentNode}m=x}i=a===-1||l===-1?null:{start:a,end:l}}else i=null}i=i||{start:0,end:0}}else i=null;for(Ao={focusedElem:t,selectionRange:i},Xn=!1,T=e;T!==null;)if(e=T,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,T=t;else for(;T!==null;){e=T;try{var S=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(S!==null){var E=S.memoizedProps,D=S.memoizedState,g=e.stateNode,h=g.getSnapshotBeforeUpdate(e.elementType===e.type?E:Oe(e.type,E),D);g.__reactInternalSnapshotBeforeUpdate=h}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(C(163))}}catch(w){q(e,e.return,w)}if(t=e.sibling,t!==null){t.return=e.return,T=t;break}T=e.return}return S=Qa,Qa=!1,S}function ji(t,e,i){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var r=n=n.next;do{if((r.tag&t)===t){var o=r.destroy;r.destroy=void 0,o!==void 0&&Ho(e,i,o)}r=r.next}while(r!==n)}}function kr(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var i=e=e.next;do{if((i.tag&t)===t){var n=i.create;i.destroy=n()}i=i.next}while(i!==e)}}function Qo(t){var e=t.ref;if(e!==null){var i=t.stateNode;switch(t.tag){case 5:t=i;break;default:t=i}typeof e=="function"?e(t):e.current=t}}function ic(t){var e=t.alternate;e!==null&&(t.alternate=null,ic(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Qe],delete e[tn],delete e[Lo],delete e[mh],delete e[ph])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function nc(t){return t.tag===5||t.tag===3||t.tag===4}function $a(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||nc(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function $o(t,e,i){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?i.nodeType===8?i.parentNode.insertBefore(t,e):i.insertBefore(t,e):(i.nodeType===8?(e=i.parentNode,e.insertBefore(t,i)):(e=i,e.appendChild(t)),i=i._reactRootContainer,i!=null||e.onclick!==null||(e.onclick=er));else if(n!==4&&(t=t.child,t!==null))for($o(t,e,i),t=t.sibling;t!==null;)$o(t,e,i),t=t.sibling}function qo(t,e,i){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?i.insertBefore(t,e):i.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(qo(t,e,i),t=t.sibling;t!==null;)qo(t,e,i),t=t.sibling}var oe=null,Ne=!1;function at(t,e,i){for(i=i.child;i!==null;)rc(t,e,i),i=i.sibling}function rc(t,e,i){if($e&&typeof $e.onCommitFiberUnmount=="function")try{$e.onCommitFiberUnmount(yr,i)}catch{}switch(i.tag){case 5:he||ni(i,e);case 6:var n=oe,r=Ne;oe=null,at(t,e,i),oe=n,Ne=r,oe!==null&&(Ne?(t=oe,i=i.stateNode,t.nodeType===8?t.parentNode.removeChild(i):t.removeChild(i)):oe.removeChild(i.stateNode));break;case 18:oe!==null&&(Ne?(t=oe,i=i.stateNode,t.nodeType===8?Yr(t.parentNode,i):t.nodeType===1&&Yr(t,i),Ki(t)):Yr(oe,i.stateNode));break;case 4:n=oe,r=Ne,oe=i.stateNode.containerInfo,Ne=!0,at(t,e,i),oe=n,Ne=r;break;case 0:case 11:case 14:case 15:if(!he&&(n=i.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){r=n=n.next;do{var o=r,s=o.destroy;o=o.tag,s!==void 0&&(o&2||o&4)&&Ho(i,e,s),r=r.next}while(r!==n)}at(t,e,i);break;case 1:if(!he&&(ni(i,e),n=i.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=i.memoizedProps,n.state=i.memoizedState,n.componentWillUnmount()}catch(a){q(i,e,a)}at(t,e,i);break;case 21:at(t,e,i);break;case 22:i.mode&1?(he=(n=he)||i.memoizedState!==null,at(t,e,i),he=n):at(t,e,i);break;default:at(t,e,i)}}function qa(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var i=t.stateNode;i===null&&(i=t.stateNode=new Lh),e.forEach(function(n){var r=jh.bind(null,t,n);i.has(n)||(i.add(n),n.then(r,r))})}}function De(t,e){var i=e.deletions;if(i!==null)for(var n=0;n<i.length;n++){var r=i[n];try{var o=t,s=e,a=s;e:for(;a!==null;){switch(a.tag){case 5:oe=a.stateNode,Ne=!1;break e;case 3:oe=a.stateNode.containerInfo,Ne=!0;break e;case 4:oe=a.stateNode.containerInfo,Ne=!0;break e}a=a.return}if(oe===null)throw Error(C(160));rc(o,s,r),oe=null,Ne=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(u){q(r,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)oc(e,t),e=e.sibling}function oc(t,e){var i=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(De(e,t),We(t),n&4){try{ji(3,t,t.return),kr(3,t)}catch(E){q(t,t.return,E)}try{ji(5,t,t.return)}catch(E){q(t,t.return,E)}}break;case 1:De(e,t),We(t),n&512&&i!==null&&ni(i,i.return);break;case 5:if(De(e,t),We(t),n&512&&i!==null&&ni(i,i.return),t.flags&32){var r=t.stateNode;try{Qi(r,"")}catch(E){q(t,t.return,E)}}if(n&4&&(r=t.stateNode,r!=null)){var o=t.memoizedProps,s=i!==null?i.memoizedProps:o,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&Tl(r,o),vo(a,s);var u=vo(a,o);for(s=0;s<l.length;s+=2){var d=l[s],m=l[s+1];d==="style"?Ll(r,m):d==="dangerouslySetInnerHTML"?_l(r,m):d==="children"?Qi(r,m):os(r,d,m,u)}switch(a){case"input":fo(r,o);break;case"textarea":bl(r,o);break;case"select":var p=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var x=o.value;x!=null?oi(r,!!o.multiple,x,!1):p!==!!o.multiple&&(o.defaultValue!=null?oi(r,!!o.multiple,o.defaultValue,!0):oi(r,!!o.multiple,o.multiple?[]:"",!1))}r[tn]=o}catch(E){q(t,t.return,E)}}break;case 6:if(De(e,t),We(t),n&4){if(t.stateNode===null)throw Error(C(162));r=t.stateNode,o=t.memoizedProps;try{r.nodeValue=o}catch(E){q(t,t.return,E)}}break;case 3:if(De(e,t),We(t),n&4&&i!==null&&i.memoizedState.isDehydrated)try{Ki(e.containerInfo)}catch(E){q(t,t.return,E)}break;case 4:De(e,t),We(t);break;case 13:De(e,t),We(t),r=t.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(Os=K())),n&4&&qa(t);break;case 22:if(d=i!==null&&i.memoizedState!==null,t.mode&1?(he=(u=he)||d,De(e,t),he=u):De(e,t),We(t),n&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!d&&t.mode&1)for(T=t,d=t.child;d!==null;){for(m=T=d;T!==null;){switch(p=T,x=p.child,p.tag){case 0:case 11:case 14:case 15:ji(4,p,p.return);break;case 1:ni(p,p.return);var S=p.stateNode;if(typeof S.componentWillUnmount=="function"){n=p,i=p.return;try{e=n,S.props=e.memoizedProps,S.state=e.memoizedState,S.componentWillUnmount()}catch(E){q(n,i,E)}}break;case 5:ni(p,p.return);break;case 22:if(p.memoizedState!==null){Ka(m);continue}}x!==null?(x.return=p,T=x):Ka(m)}d=d.sibling}e:for(d=null,m=t;;){if(m.tag===5){if(d===null){d=m;try{r=m.stateNode,u?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=m.stateNode,l=m.memoizedProps.style,s=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=Fl("display",s))}catch(E){q(t,t.return,E)}}}else if(m.tag===6){if(d===null)try{m.stateNode.nodeValue=u?"":m.memoizedProps}catch(E){q(t,t.return,E)}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===t)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===t)break e;for(;m.sibling===null;){if(m.return===null||m.return===t)break e;d===m&&(d=null),m=m.return}d===m&&(d=null),m.sibling.return=m.return,m=m.sibling}}break;case 19:De(e,t),We(t),n&4&&qa(t);break;case 21:break;default:De(e,t),We(t)}}function We(t){var e=t.flags;if(e&2){try{e:{for(var i=t.return;i!==null;){if(nc(i)){var n=i;break e}i=i.return}throw Error(C(160))}switch(n.tag){case 5:var r=n.stateNode;n.flags&32&&(Qi(r,""),n.flags&=-33);var o=$a(t);qo(t,o,r);break;case 3:case 4:var s=n.stateNode.containerInfo,a=$a(t);$o(t,a,s);break;default:throw Error(C(161))}}catch(l){q(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function zh(t,e,i){T=t,sc(t)}function sc(t,e,i){for(var n=(t.mode&1)!==0;T!==null;){var r=T,o=r.child;if(r.tag===22&&n){var s=r.memoizedState!==null||_n;if(!s){var a=r.alternate,l=a!==null&&a.memoizedState!==null||he;a=_n;var u=he;if(_n=s,(he=l)&&!u)for(T=r;T!==null;)s=T,l=s.child,s.tag===22&&s.memoizedState!==null?Xa(r):l!==null?(l.return=s,T=l):Xa(r);for(;o!==null;)T=o,sc(o),o=o.sibling;T=r,_n=a,he=u}Ya(t)}else r.subtreeFlags&8772&&o!==null?(o.return=r,T=o):Ya(t)}}function Ya(t){for(;T!==null;){var e=T;if(e.flags&8772){var i=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:he||kr(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!he)if(i===null)n.componentDidMount();else{var r=e.elementType===e.type?i.memoizedProps:Oe(e.type,i.memoizedProps);n.componentDidUpdate(r,i.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&Ra(e,o,n);break;case 3:var s=e.updateQueue;if(s!==null){if(i=null,e.child!==null)switch(e.child.tag){case 5:i=e.child.stateNode;break;case 1:i=e.child.stateNode}Ra(e,s,i)}break;case 5:var a=e.stateNode;if(i===null&&e.flags&4){i=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&i.focus();break;case"img":l.src&&(i.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var m=d.dehydrated;m!==null&&Ki(m)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(C(163))}he||e.flags&512&&Qo(e)}catch(p){q(e,e.return,p)}}if(e===t){T=null;break}if(i=e.sibling,i!==null){i.return=e.return,T=i;break}T=e.return}}function Ka(t){for(;T!==null;){var e=T;if(e===t){T=null;break}var i=e.sibling;if(i!==null){i.return=e.return,T=i;break}T=e.return}}function Xa(t){for(;T!==null;){var e=T;try{switch(e.tag){case 0:case 11:case 15:var i=e.return;try{kr(4,e)}catch(l){q(e,i,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var r=e.return;try{n.componentDidMount()}catch(l){q(e,r,l)}}var o=e.return;try{Qo(e)}catch(l){q(e,o,l)}break;case 5:var s=e.return;try{Qo(e)}catch(l){q(e,s,l)}}}catch(l){q(e,e.return,l)}if(e===t){T=null;break}var a=e.sibling;if(a!==null){a.return=e.return,T=a;break}T=e.return}}var Ih=Math.ceil,dr=rt.ReactCurrentDispatcher,Ds=rt.ReactCurrentOwner,Re=rt.ReactCurrentBatchConfig,B=0,re=null,X=null,ae=0,Pe=0,ri=kt(0),ee=0,ln=null,Vt=0,Mr=0,Bs=0,Ui=null,Se=null,Os=0,yi=1/0,Ye=null,hr=!1,Yo=null,St=null,Fn=!1,ft=null,fr=0,Wi=0,Ko=null,jn=-1,Un=0;function me(){return B&6?K():jn!==-1?jn:jn=K()}function xt(t){return t.mode&1?B&2&&ae!==0?ae&-ae:vh.transition!==null?(Un===0&&(Un=Wl()),Un):(t=N,t!==0||(t=window.event,t=t===void 0?16:Xl(t.type)),t):1}function je(t,e,i,n){if(50<Wi)throw Wi=0,Ko=null,Error(C(185));cn(t,i,n),(!(B&2)||t!==re)&&(t===re&&(!(B&2)&&(Mr|=i),ee===4&&dt(t,ae)),Ee(t,n),i===1&&B===0&&!(e.mode&1)&&(yi=K()+500,Cr&&Mt()))}function Ee(t,e){var i=t.callbackNode;vd(t,e);var n=Kn(t,t===re?ae:0);if(n===0)i!==null&&sa(i),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(i!=null&&sa(i),e===1)t.tag===0?yh(Za.bind(null,t)):pu(Za.bind(null,t)),fh(function(){!(B&6)&&Mt()}),i=null;else{switch(Hl(n)){case 1:i=cs;break;case 4:i=jl;break;case 16:i=Yn;break;case 536870912:i=Ul;break;default:i=Yn}i=gc(i,ac.bind(null,t))}t.callbackPriority=e,t.callbackNode=i}}function ac(t,e){if(jn=-1,Un=0,B&6)throw Error(C(327));var i=t.callbackNode;if(ci()&&t.callbackNode!==i)return null;var n=Kn(t,t===re?ae:0);if(n===0)return null;if(n&30||n&t.expiredLanes||e)e=gr(t,n);else{e=n;var r=B;B|=2;var o=uc();(re!==t||ae!==e)&&(Ye=null,yi=K()+500,Dt(t,e));do try{Oh();break}catch(a){lc(t,a)}while(1);Es(),dr.current=o,B=r,X!==null?e=0:(re=null,ae=0,e=ee)}if(e!==0){if(e===2&&(r=Eo(t),r!==0&&(n=r,e=Xo(t,r))),e===1)throw i=ln,Dt(t,0),dt(t,n),Ee(t,K()),i;if(e===6)dt(t,n);else{if(r=t.current.alternate,!(n&30)&&!Dh(r)&&(e=gr(t,n),e===2&&(o=Eo(t),o!==0&&(n=o,e=Xo(t,o))),e===1))throw i=ln,Dt(t,0),dt(t,n),Ee(t,K()),i;switch(t.finishedWork=r,t.finishedLanes=n,e){case 0:case 1:throw Error(C(345));case 2:_t(t,Se,Ye);break;case 3:if(dt(t,n),(n&130023424)===n&&(e=Os+500-K(),10<e)){if(Kn(t,0)!==0)break;if(r=t.suspendedLanes,(r&n)!==n){me(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=Fo(_t.bind(null,t,Se,Ye),e);break}_t(t,Se,Ye);break;case 4:if(dt(t,n),(n&4194240)===n)break;for(e=t.eventTimes,r=-1;0<n;){var s=31-Ve(n);o=1<<s,s=e[s],s>r&&(r=s),n&=~o}if(n=r,n=K()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*Ih(n/1960))-n,10<n){t.timeoutHandle=Fo(_t.bind(null,t,Se,Ye),n);break}_t(t,Se,Ye);break;case 5:_t(t,Se,Ye);break;default:throw Error(C(329))}}}return Ee(t,K()),t.callbackNode===i?ac.bind(null,t):null}function Xo(t,e){var i=Ui;return t.current.memoizedState.isDehydrated&&(Dt(t,e).flags|=256),t=gr(t,e),t!==2&&(e=Se,Se=i,e!==null&&Zo(e)),t}function Zo(t){Se===null?Se=t:Se.push.apply(Se,t)}function Dh(t){for(var e=t;;){if(e.flags&16384){var i=e.updateQueue;if(i!==null&&(i=i.stores,i!==null))for(var n=0;n<i.length;n++){var r=i[n],o=r.getSnapshot;r=r.value;try{if(!Ue(o(),r))return!1}catch{return!1}}}if(i=e.child,e.subtreeFlags&16384&&i!==null)i.return=e,e=i;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function dt(t,e){for(e&=~Bs,e&=~Mr,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var i=31-Ve(e),n=1<<i;t[i]=-1,e&=~n}}function Za(t){if(B&6)throw Error(C(327));ci();var e=Kn(t,0);if(!(e&1))return Ee(t,K()),null;var i=gr(t,e);if(t.tag!==0&&i===2){var n=Eo(t);n!==0&&(e=n,i=Xo(t,n))}if(i===1)throw i=ln,Dt(t,0),dt(t,e),Ee(t,K()),i;if(i===6)throw Error(C(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,_t(t,Se,Ye),Ee(t,K()),null}function Ns(t,e){var i=B;B|=1;try{return t(e)}finally{B=i,B===0&&(yi=K()+500,Cr&&Mt())}}function jt(t){ft!==null&&ft.tag===0&&!(B&6)&&ci();var e=B;B|=1;var i=Re.transition,n=N;try{if(Re.transition=null,N=1,t)return t()}finally{N=n,Re.transition=i,B=e,!(B&6)&&Mt()}}function Gs(){Pe=ri.current,U(ri)}function Dt(t,e){t.finishedWork=null,t.finishedLanes=0;var i=t.timeoutHandle;if(i!==-1&&(t.timeoutHandle=-1,hh(i)),X!==null)for(i=X.return;i!==null;){var n=i;switch(xs(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&tr();break;case 3:mi(),U(we),U(fe),As();break;case 5:bs(n);break;case 4:mi();break;case 13:U(H);break;case 19:U(H);break;case 10:Ps(n.type._context);break;case 22:case 23:Gs()}i=i.return}if(re=t,X=t=wt(t.current,null),ae=Pe=e,ee=0,ln=null,Bs=Mr=Vt=0,Se=Ui=null,zt!==null){for(e=0;e<zt.length;e++)if(i=zt[e],n=i.interleaved,n!==null){i.interleaved=null;var r=n.next,o=i.pending;if(o!==null){var s=o.next;o.next=r,n.next=s}i.pending=n}zt=null}return t}function lc(t,e){do{var i=X;try{if(Es(),Nn.current=cr,ur){for(var n=Q.memoizedState;n!==null;){var r=n.queue;r!==null&&(r.pending=null),n=n.next}ur=!1}if(Gt=0,ne=Z=Q=null,Vi=!1,on=0,Ds.current=null,i===null||i.return===null){ee=1,ln=e,X=null;break}e:{var o=t,s=i.return,a=i,l=e;if(e=ae,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=a,m=d.tag;if(!(d.mode&1)&&(m===0||m===11||m===15)){var p=d.alternate;p?(d.updateQueue=p.updateQueue,d.memoizedState=p.memoizedState,d.lanes=p.lanes):(d.updateQueue=null,d.memoizedState=null)}var x=Na(s);if(x!==null){x.flags&=-257,Ga(x,s,a,o,e),x.mode&1&&Oa(o,u,e),e=x,l=u;var S=e.updateQueue;if(S===null){var E=new Set;E.add(l),e.updateQueue=E}else S.add(l);break e}else{if(!(e&1)){Oa(o,u,e),Vs();break e}l=Error(C(426))}}else if(W&&a.mode&1){var D=Na(s);if(D!==null){!(D.flags&65536)&&(D.flags|=256),Ga(D,s,a,o,e),ws(pi(l,a));break e}}o=l=pi(l,a),ee!==4&&(ee=2),Ui===null?Ui=[o]:Ui.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var g=Hu(o,l,e);La(o,g);break e;case 1:a=l;var h=o.type,y=o.stateNode;if(!(o.flags&128)&&(typeof h.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(St===null||!St.has(y)))){o.flags|=65536,e&=-e,o.lanes|=e;var w=Qu(o,a,e);La(o,w);break e}}o=o.return}while(o!==null)}dc(i)}catch(M){e=M,X===i&&i!==null&&(X=i=i.return);continue}break}while(1)}function uc(){var t=dr.current;return dr.current=cr,t===null?cr:t}function Vs(){(ee===0||ee===3||ee===2)&&(ee=4),re===null||!(Vt&268435455)&&!(Mr&268435455)||dt(re,ae)}function gr(t,e){var i=B;B|=2;var n=uc();(re!==t||ae!==e)&&(Ye=null,Dt(t,e));do try{Bh();break}catch(r){lc(t,r)}while(1);if(Es(),B=i,dr.current=n,X!==null)throw Error(C(261));return re=null,ae=0,ee}function Bh(){for(;X!==null;)cc(X)}function Oh(){for(;X!==null&&!ud();)cc(X)}function cc(t){var e=fc(t.alternate,t,Pe);t.memoizedProps=t.pendingProps,e===null?dc(t):X=e,Ds.current=null}function dc(t){var e=t;do{var i=e.alternate;if(t=e.return,e.flags&32768){if(i=Fh(i,e),i!==null){i.flags&=32767,X=i;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ee=6,X=null;return}}else if(i=_h(i,e,Pe),i!==null){X=i;return}if(e=e.sibling,e!==null){X=e;return}X=e=t}while(e!==null);ee===0&&(ee=5)}function _t(t,e,i){var n=N,r=Re.transition;try{Re.transition=null,N=1,Nh(t,e,i,n)}finally{Re.transition=r,N=n}return null}function Nh(t,e,i,n){do ci();while(ft!==null);if(B&6)throw Error(C(327));i=t.finishedWork;var r=t.finishedLanes;if(i===null)return null;if(t.finishedWork=null,t.finishedLanes=0,i===t.current)throw Error(C(177));t.callbackNode=null,t.callbackPriority=0;var o=i.lanes|i.childLanes;if(Sd(t,o),t===re&&(X=re=null,ae=0),!(i.subtreeFlags&2064)&&!(i.flags&2064)||Fn||(Fn=!0,gc(Yn,function(){return ci(),null})),o=(i.flags&15990)!==0,i.subtreeFlags&15990||o){o=Re.transition,Re.transition=null;var s=N;N=1;var a=B;B|=4,Ds.current=null,Rh(t,i),oc(i,t),oh(Ao),Xn=!!bo,Ao=bo=null,t.current=i,zh(i),cd(),B=a,N=s,Re.transition=o}else t.current=i;if(Fn&&(Fn=!1,ft=t,fr=r),o=t.pendingLanes,o===0&&(St=null),fd(i.stateNode),Ee(t,K()),e!==null)for(n=t.onRecoverableError,i=0;i<e.length;i++)r=e[i],n(r.value,{componentStack:r.stack,digest:r.digest});if(hr)throw hr=!1,t=Yo,Yo=null,t;return fr&1&&t.tag!==0&&ci(),o=t.pendingLanes,o&1?t===Ko?Wi++:(Wi=0,Ko=t):Wi=0,Mt(),null}function ci(){if(ft!==null){var t=Hl(fr),e=Re.transition,i=N;try{if(Re.transition=null,N=16>t?16:t,ft===null)var n=!1;else{if(t=ft,ft=null,fr=0,B&6)throw Error(C(331));var r=B;for(B|=4,T=t.current;T!==null;){var o=T,s=o.child;if(T.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(T=u;T!==null;){var d=T;switch(d.tag){case 0:case 11:case 15:ji(8,d,o)}var m=d.child;if(m!==null)m.return=d,T=m;else for(;T!==null;){d=T;var p=d.sibling,x=d.return;if(ic(d),d===u){T=null;break}if(p!==null){p.return=x,T=p;break}T=x}}}var S=o.alternate;if(S!==null){var E=S.child;if(E!==null){S.child=null;do{var D=E.sibling;E.sibling=null,E=D}while(E!==null)}}T=o}}if(o.subtreeFlags&2064&&s!==null)s.return=o,T=s;else e:for(;T!==null;){if(o=T,o.flags&2048)switch(o.tag){case 0:case 11:case 15:ji(9,o,o.return)}var g=o.sibling;if(g!==null){g.return=o.return,T=g;break e}T=o.return}}var h=t.current;for(T=h;T!==null;){s=T;var y=s.child;if(s.subtreeFlags&2064&&y!==null)y.return=s,T=y;else e:for(s=h;T!==null;){if(a=T,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:kr(9,a)}}catch(M){q(a,a.return,M)}if(a===s){T=null;break e}var w=a.sibling;if(w!==null){w.return=a.return,T=w;break e}T=a.return}}if(B=r,Mt(),$e&&typeof $e.onPostCommitFiberRoot=="function")try{$e.onPostCommitFiberRoot(yr,t)}catch{}n=!0}return n}finally{N=i,Re.transition=e}}return!1}function Ja(t,e,i){e=pi(i,e),e=Hu(t,e,1),t=vt(t,e,1),e=me(),t!==null&&(cn(t,1,e),Ee(t,e))}function q(t,e,i){if(t.tag===3)Ja(t,t,i);else for(;e!==null;){if(e.tag===3){Ja(e,t,i);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(St===null||!St.has(n))){t=pi(i,t),t=Qu(e,t,1),e=vt(e,t,1),t=me(),e!==null&&(cn(e,1,t),Ee(e,t));break}}e=e.return}}function Gh(t,e,i){var n=t.pingCache;n!==null&&n.delete(e),e=me(),t.pingedLanes|=t.suspendedLanes&i,re===t&&(ae&i)===i&&(ee===4||ee===3&&(ae&130023424)===ae&&500>K()-Os?Dt(t,0):Bs|=i),Ee(t,e)}function hc(t,e){e===0&&(t.mode&1?(e=wn,wn<<=1,!(wn&130023424)&&(wn=4194304)):e=1);var i=me();t=it(t,e),t!==null&&(cn(t,e,i),Ee(t,i))}function Vh(t){var e=t.memoizedState,i=0;e!==null&&(i=e.retryLane),hc(t,i)}function jh(t,e){var i=0;switch(t.tag){case 13:var n=t.stateNode,r=t.memoizedState;r!==null&&(i=r.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(C(314))}n!==null&&n.delete(e),hc(t,i)}var fc;fc=function(t,e,i){if(t!==null)if(t.memoizedProps!==e.pendingProps||we.current)xe=!0;else{if(!(t.lanes&i)&&!(e.flags&128))return xe=!1,Ah(t,e,i);xe=!!(t.flags&131072)}else xe=!1,W&&e.flags&1048576&&yu(e,rr,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Vn(t,e),t=e.pendingProps;var r=hi(e,fe.current);ui(e,i),r=Fs(null,e,n,t,r,i);var o=Ls();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Ce(n)?(o=!0,ir(e)):o=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Ms(e),r.updater=Pr,e.stateNode=r,r._reactInternals=e,Oo(e,n,t,i),e=Vo(null,e,n,!0,o,i)):(e.tag=0,W&&o&&Ss(e),ge(null,e,r,i),e=e.child),e;case 16:n=e.elementType;e:{switch(Vn(t,e),t=e.pendingProps,r=n._init,n=r(n._payload),e.type=n,r=e.tag=Wh(n),t=Oe(n,t),r){case 0:e=Go(null,e,n,t,i);break e;case 1:e=Ua(null,e,n,t,i);break e;case 11:e=Va(null,e,n,t,i);break e;case 14:e=ja(null,e,n,Oe(n.type,t),i);break e}throw Error(C(306,n,""))}return e;case 0:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Oe(n,r),Go(t,e,n,r,i);case 1:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Oe(n,r),Ua(t,e,n,r,i);case 3:e:{if(Ku(e),t===null)throw Error(C(387));n=e.pendingProps,o=e.memoizedState,r=o.element,Eu(t,e),ar(e,n,null,i);var s=e.memoizedState;if(n=s.element,o.isDehydrated)if(o={element:n,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){r=pi(Error(C(423)),e),e=Wa(t,e,n,i,r);break e}else if(n!==r){r=pi(Error(C(424)),e),e=Wa(t,e,n,i,r);break e}else for(ke=yt(e.stateNode.containerInfo.firstChild),Me=e,W=!0,Ge=null,i=wu(e,null,n,i),e.child=i;i;)i.flags=i.flags&-3|4096,i=i.sibling;else{if(fi(),n===r){e=nt(t,e,i);break e}ge(t,e,n,i)}e=e.child}return e;case 5:return Pu(e),t===null&&Io(e),n=e.type,r=e.pendingProps,o=t!==null?t.memoizedProps:null,s=r.children,_o(n,r)?s=null:o!==null&&_o(n,o)&&(e.flags|=32),Yu(t,e),ge(t,e,s,i),e.child;case 6:return t===null&&Io(e),null;case 13:return Xu(t,e,i);case 4:return Ts(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=gi(e,null,n,i):ge(t,e,n,i),e.child;case 11:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Oe(n,r),Va(t,e,n,r,i);case 7:return ge(t,e,e.pendingProps,i),e.child;case 8:return ge(t,e,e.pendingProps.children,i),e.child;case 12:return ge(t,e,e.pendingProps.children,i),e.child;case 10:e:{if(n=e.type._context,r=e.pendingProps,o=e.memoizedProps,s=r.value,V(or,n._currentValue),n._currentValue=s,o!==null)if(Ue(o.value,s)){if(o.children===r.children&&!we.current){e=nt(t,e,i);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){s=o.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(o.tag===1){l=Je(-1,i&-i),l.tag=2;var u=o.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}o.lanes|=i,l=o.alternate,l!==null&&(l.lanes|=i),Do(o.return,i,e),a.lanes|=i;break}l=l.next}}else if(o.tag===10)s=o.type===e.type?null:o.child;else if(o.tag===18){if(s=o.return,s===null)throw Error(C(341));s.lanes|=i,a=s.alternate,a!==null&&(a.lanes|=i),Do(s,i,e),s=o.sibling}else s=o.child;if(s!==null)s.return=o;else for(s=o;s!==null;){if(s===e){s=null;break}if(o=s.sibling,o!==null){o.return=s.return,s=o;break}s=s.return}o=s}ge(t,e,r.children,i),e=e.child}return e;case 9:return r=e.type,n=e.pendingProps.children,ui(e,i),r=ze(r),n=n(r),e.flags|=1,ge(t,e,n,i),e.child;case 14:return n=e.type,r=Oe(n,e.pendingProps),r=Oe(n.type,r),ja(t,e,n,r,i);case 15:return $u(t,e,e.type,e.pendingProps,i);case 17:return n=e.type,r=e.pendingProps,r=e.elementType===n?r:Oe(n,r),Vn(t,e),e.tag=1,Ce(n)?(t=!0,ir(e)):t=!1,ui(e,i),Wu(e,n,r),Oo(e,n,r,i),Vo(null,e,n,!0,t,i);case 19:return Zu(t,e,i);case 22:return qu(t,e,i)}throw Error(C(156,e.tag))};function gc(t,e){return Vl(t,e)}function Uh(t,e,i,n){this.tag=t,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Le(t,e,i,n){return new Uh(t,e,i,n)}function js(t){return t=t.prototype,!(!t||!t.isReactComponent)}function Wh(t){if(typeof t=="function")return js(t)?1:0;if(t!=null){if(t=t.$$typeof,t===as)return 11;if(t===ls)return 14}return 2}function wt(t,e){var i=t.alternate;return i===null?(i=Le(t.tag,e,t.key,t.mode),i.elementType=t.elementType,i.type=t.type,i.stateNode=t.stateNode,i.alternate=t,t.alternate=i):(i.pendingProps=e,i.type=t.type,i.flags=0,i.subtreeFlags=0,i.deletions=null),i.flags=t.flags&14680064,i.childLanes=t.childLanes,i.lanes=t.lanes,i.child=t.child,i.memoizedProps=t.memoizedProps,i.memoizedState=t.memoizedState,i.updateQueue=t.updateQueue,e=t.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},i.sibling=t.sibling,i.index=t.index,i.ref=t.ref,i}function Wn(t,e,i,n,r,o){var s=2;if(n=t,typeof t=="function")js(t)&&(s=1);else if(typeof t=="string")s=5;else e:switch(t){case qt:return Bt(i.children,r,o,e);case ss:s=8,r|=8;break;case ao:return t=Le(12,i,e,r|2),t.elementType=ao,t.lanes=o,t;case lo:return t=Le(13,i,e,r),t.elementType=lo,t.lanes=o,t;case uo:return t=Le(19,i,e,r),t.elementType=uo,t.lanes=o,t;case Pl:return Tr(i,r,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Cl:s=10;break e;case El:s=9;break e;case as:s=11;break e;case ls:s=14;break e;case lt:s=16,n=null;break e}throw Error(C(130,t==null?t:typeof t,""))}return e=Le(s,i,e,r),e.elementType=t,e.type=n,e.lanes=o,e}function Bt(t,e,i,n){return t=Le(7,t,n,e),t.lanes=i,t}function Tr(t,e,i,n){return t=Le(22,t,n,e),t.elementType=Pl,t.lanes=i,t.stateNode={isHidden:!1},t}function no(t,e,i){return t=Le(6,t,null,e),t.lanes=i,t}function ro(t,e,i){return e=Le(4,t.children!==null?t.children:[],t.key,e),e.lanes=i,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function Hh(t,e,i,n,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Or(0),this.expirationTimes=Or(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Or(0),this.identifierPrefix=n,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Us(t,e,i,n,r,o,s,a,l){return t=new Hh(t,e,i,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Le(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:n,isDehydrated:i,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ms(o),t}function Qh(t,e,i){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$t,key:n==null?null:""+n,children:t,containerInfo:e,implementation:i}}function mc(t){if(!t)return Et;t=t._reactInternals;e:{if(Wt(t)!==t||t.tag!==1)throw Error(C(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Ce(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(C(171))}if(t.tag===1){var i=t.type;if(Ce(i))return mu(t,i,e)}return e}function pc(t,e,i,n,r,o,s,a,l){return t=Us(i,n,!0,t,r,o,s,a,l),t.context=mc(null),i=t.current,n=me(),r=xt(i),o=Je(n,r),o.callback=e??null,vt(i,o,r),t.current.lanes=r,cn(t,r,n),Ee(t,n),t}function br(t,e,i,n){var r=e.current,o=me(),s=xt(r);return i=mc(i),e.context===null?e.context=i:e.pendingContext=i,e=Je(o,s),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=vt(r,e,s),t!==null&&(je(t,r,s,o),On(t,r,s)),s}function mr(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function el(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var i=t.retryLane;t.retryLane=i!==0&&i<e?i:e}}function Ws(t,e){el(t,e),(t=t.alternate)&&el(t,e)}function $h(){return null}var yc=typeof reportError=="function"?reportError:function(t){console.error(t)};function Hs(t){this._internalRoot=t}Ar.prototype.render=Hs.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(C(409));br(t,e,null,null)};Ar.prototype.unmount=Hs.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;jt(function(){br(null,t,null,null)}),e[tt]=null}};function Ar(t){this._internalRoot=t}Ar.prototype.unstable_scheduleHydration=function(t){if(t){var e=ql();t={blockedOn:null,target:t,priority:e};for(var i=0;i<ct.length&&e!==0&&e<ct[i].priority;i++);ct.splice(i,0,t),i===0&&Kl(t)}};function Qs(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function _r(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function tl(){}function qh(t,e,i,n,r){if(r){if(typeof n=="function"){var o=n;n=function(){var u=mr(s);o.call(u)}}var s=pc(e,n,t,0,null,!1,!1,"",tl);return t._reactRootContainer=s,t[tt]=s.current,Ji(t.nodeType===8?t.parentNode:t),jt(),s}for(;r=t.lastChild;)t.removeChild(r);if(typeof n=="function"){var a=n;n=function(){var u=mr(l);a.call(u)}}var l=Us(t,0,!1,null,null,!1,!1,"",tl);return t._reactRootContainer=l,t[tt]=l.current,Ji(t.nodeType===8?t.parentNode:t),jt(function(){br(e,l,i,n)}),l}function Fr(t,e,i,n,r){var o=i._reactRootContainer;if(o){var s=o;if(typeof r=="function"){var a=r;r=function(){var l=mr(s);a.call(l)}}br(e,s,t,r)}else s=qh(i,e,t,r,n);return mr(s)}Ql=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var i=zi(e.pendingLanes);i!==0&&(ds(e,i|1),Ee(e,K()),!(B&6)&&(yi=K()+500,Mt()))}break;case 13:jt(function(){var n=it(t,1);if(n!==null){var r=me();je(n,t,1,r)}}),Ws(t,1)}};hs=function(t){if(t.tag===13){var e=it(t,134217728);if(e!==null){var i=me();je(e,t,134217728,i)}Ws(t,134217728)}};$l=function(t){if(t.tag===13){var e=xt(t),i=it(t,e);if(i!==null){var n=me();je(i,t,e,n)}Ws(t,e)}};ql=function(){return N};Yl=function(t,e){var i=N;try{return N=t,e()}finally{N=i}};xo=function(t,e,i){switch(e){case"input":if(fo(t,i),e=i.name,i.type==="radio"&&e!=null){for(i=t;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<i.length;e++){var n=i[e];if(n!==t&&n.form===t.form){var r=wr(n);if(!r)throw Error(C(90));Ml(n),fo(n,r)}}}break;case"textarea":bl(t,i);break;case"select":e=i.value,e!=null&&oi(t,!!i.multiple,e,!1)}};Il=Ns;Dl=jt;var Yh={usingClientEntryPoint:!1,Events:[hn,Zt,wr,Rl,zl,Ns]},Fi={findFiberByHostInstance:Rt,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Kh={bundleType:Fi.bundleType,version:Fi.version,rendererPackageName:Fi.rendererPackageName,rendererConfig:Fi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:rt.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Nl(t),t===null?null:t.stateNode},findFiberByHostInstance:Fi.findFiberByHostInstance||$h,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ln=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ln.isDisabled&&Ln.supportsFiber)try{yr=Ln.inject(Kh),$e=Ln}catch{}}be.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Yh;be.createPortal=function(t,e){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Qs(e))throw Error(C(200));return Qh(t,e,null,i)};be.createRoot=function(t,e){if(!Qs(t))throw Error(C(299));var i=!1,n="",r=yc;return e!=null&&(e.unstable_strictMode===!0&&(i=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Us(t,1,!1,null,null,i,!1,n,r),t[tt]=e.current,Ji(t.nodeType===8?t.parentNode:t),new Hs(e)};be.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(C(188)):(t=Object.keys(t).join(","),Error(C(268,t)));return t=Nl(e),t=t===null?null:t.stateNode,t};be.flushSync=function(t){return jt(t)};be.hydrate=function(t,e,i){if(!_r(e))throw Error(C(200));return Fr(null,t,e,!0,i)};be.hydrateRoot=function(t,e,i){if(!Qs(t))throw Error(C(405));var n=i!=null&&i.hydratedSources||null,r=!1,o="",s=yc;if(i!=null&&(i.unstable_strictMode===!0&&(r=!0),i.identifierPrefix!==void 0&&(o=i.identifierPrefix),i.onRecoverableError!==void 0&&(s=i.onRecoverableError)),e=pc(e,null,t,1,i??null,r,!1,o,s),t[tt]=e.current,Ji(t),n)for(t=0;t<n.length;t++)i=n[t],r=i._getVersion,r=r(i._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[i,r]:e.mutableSourceEagerHydrationData.push(i,r);return new Ar(e)};be.render=function(t,e,i){if(!_r(e))throw Error(C(200));return Fr(null,t,e,!1,i)};be.unmountComponentAtNode=function(t){if(!_r(t))throw Error(C(40));return t._reactRootContainer?(jt(function(){Fr(null,null,t,!1,function(){t._reactRootContainer=null,t[tt]=null})}),!0):!1};be.unstable_batchedUpdates=Ns;be.unstable_renderSubtreeIntoContainer=function(t,e,i,n){if(!_r(i))throw Error(C(200));if(t==null||t._reactInternals===void 0)throw Error(C(38));return Fr(t,e,i,!1,n)};be.version="18.3.1-next-f1338f8080-20240426";function vc(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(vc)}catch(t){console.error(t)}}vc(),vl.exports=be;var Xh=vl.exports,il=Xh;oo.createRoot=il.createRoot,oo.hydrateRoot=il.hydrateRoot;var Be=(t=>(t.W="KeyW",t.A="KeyA",t.S="KeyS",t.D="KeyD",t.ArrowUp="ArrowUp",t.ArrowDown="ArrowDown",t.ArrowLeft="ArrowLeft",t.ArrowRight="ArrowRight",t.Space="Space",t))(Be||{}),F=(t=>(t.BasicBerry="BasicBerry",t.WildMushroom="WildMushroom",t.CrystalFruit="CrystalFruit",t.VenomousFlower="VenomousFlower",t.AquaticPlant="AquaticPlant",t.RainbowNectar="RainbowNectar",t.StardustBerry="StardustBerry",t.DragonScale="DragonScale",t.EternalOrb="EternalOrb",t.OuroborosEssence="OuroborosEssence",t))(F||{}),_=(t=>(t.Growth="Growth",t.SpeedBoost="SpeedBoost",t.EvolutionBoost="EvolutionBoost",t.PowerCooldownReduction="PowerCooldownReduction",t.DoublePoints="DoublePoints",t.Regeneration="Regeneration",t.Invincibility="Invincibility",t.Poison="Poison",t.ReversedControls="ReversedControls",t.SlowDown="SlowDown",t.SegmentLoss="SegmentLoss",t.BlurredVision="BlurredVision",t.DisablePowers="DisablePowers",t.Transformation="Transformation",t.TimeWarp="TimeWarp",t))(_||{}),J=(t=>(t.StonePillar="StonePillar",t.CrystalFormation="CrystalFormation",t.IceWall="IceWall",t.ThornBush="ThornBush",t.MagicBarrier="MagicBarrier",t))(J||{}),ie=(t=>(t.WaterPool="WaterPool",t.FlameGeyser="FlameGeyser",t.MovingStoneBlock="MovingStoneBlock",t.PoisonGasCloud="PoisonGasCloud",t.LightningStrike="LightningStrike",t))(ie||{}),Ft=(t=>(t.Static="Static",t.Linear="Linear",t.Circular="Circular",t.PingPong="PingPong",t.Random="Random",t))(Ft||{}),ve=(t=>(t.PressurePlate="PressurePlate",t.AncientSwitch="AncientSwitch",t.MysticalPortal="MysticalPortal",t))(ve||{}),Lt=(t=>(t.FoodConsumption="FoodConsumption",t.Evolution="Evolution",t.PowerUsage="PowerUsage",t.Combo="Combo",t.SurvivalTime="SurvivalTime",t.TailConsumption="TailConsumption",t.EnvironmentalInteraction="EnvironmentalInteraction",t))(Lt||{}),se=(t=>(t.SelfCollision="SelfCollision",t.WallCollision="WallCollision",t.ObstacleCollision="ObstacleCollision",t.EnvironmentalHazard="EnvironmentalHazard",t.PoisonEffect="PoisonEffect",t))(se||{});class Sc{constructor(e){c(this,"config");c(this,"grid");c(this,"COLLISION_TOLERANCE",.1);c(this,"SAFE_SEGMENT_COUNT",4);this.config=e,this.initializeGrid()}initializeGrid(){this.grid=[];for(let e=0;e<this.config.gridWidth;e++){this.grid[e]=[];for(let i=0;i<this.config.gridHeight;i++)this.grid[e][i]={x:e,y:i,occupied:!1}}}reset(){this.initializeGrid()}updateSnakeGrid(e,i){this.clearSnakeFromGrid();const n=this.worldToGrid(e.x,e.y);this.isValidGridPosition(n.x,n.y)&&(this.grid[n.x][n.y]={x:n.x,y:n.y,occupied:!0,occupiedBy:"snake",segmentIndex:-1}),i.forEach((r,o)=>{const s=this.worldToGrid(r.x,r.y);this.isValidGridPosition(s.x,s.y)&&(this.grid[s.x][s.y]={x:s.x,y:s.y,occupied:!0,occupiedBy:"snake",segmentIndex:o})})}clearSnakeFromGrid(){for(let e=0;e<this.config.gridWidth;e++)for(let i=0;i<this.config.gridHeight;i++)this.grid[e][i].occupiedBy==="snake"&&(this.grid[e][i]={x:e,y:i,occupied:!1})}checkSelfCollision(e,i){const n={x:e.x,y:e.y};for(let r=this.SAFE_SEGMENT_COUNT;r<i.length;r++){const o=i[r],s={x:o.x,y:o.y};if(this.arePositionsEqual(n,s))return{hasCollision:!0,collisionPoint:s,collisionType:"SELF_COLLISION",collisionData:{segmentIndex:r}}}return{hasCollision:!1}}checkBoundaryCollision(e){const i=e.x,n=e.y;return i<0||i>=this.config.gridWidth||n<0||n>=this.config.gridHeight?{hasCollision:!0,collisionPoint:{x:i,y:n},collisionType:"BOUNDARY_COLLISION",collisionData:{boundary:this.getBoundaryType(i,n)}}:{hasCollision:!1}}getBoundaryType(e,i){return e<0?"left":e>=this.config.gridWidth?"right":i<0?"top":i>=this.config.gridHeight?"bottom":"unknown"}checkContinuousBodyCollision(e,i,n){const r={x:e.x,y:e.y},o=Math.abs(r.x-n.x)+Math.abs(r.y-n.y);if(o>1){const s=Math.ceil(o);for(let a=1;a<=s;a++){const l=a/s,u={x:Math.round(n.x+(r.x-n.x)*l),y:Math.round(n.y+(r.y-n.y)*l)};for(let d=this.SAFE_SEGMENT_COUNT;d<i.length;d++){const m=i[d];if(this.arePositionsEqual(u,{x:m.x,y:m.y}))return{hasCollision:!0,collisionPoint:u,collisionType:"SELF_COLLISION",collisionData:{segmentIndex:d,continuous:!0,step:a}}}}}return this.checkSelfCollision(e,i)}checkFoodCollision(e,i){const n={x:e.x,y:e.y};for(let r=0;r<i.length;r++){const o=i[r];if(this.arePositionsEqual(n,o))return{hasCollision:!0,collisionPoint:o,collisionType:"FOOD_COLLISION",collisionData:{foodIndex:r}}}return{hasCollision:!1}}checkObstacleCollision(e,i){const n={x:e.x,y:e.y};for(let r=0;r<i.length;r++){const o=i[r];if(this.arePositionsEqual(n,o))return{hasCollision:!0,collisionPoint:o,collisionType:"OBSTACLE_COLLISION",collisionData:{obstacleIndex:r}}}return{hasCollision:!1}}arePositionsEqual(e,i){return Math.abs(e.x-i.x)<this.COLLISION_TOLERANCE&&Math.abs(e.y-i.y)<this.COLLISION_TOLERANCE}worldToGrid(e,i){return{x:Math.floor(e),y:Math.floor(i)}}isValidGridPosition(e,i){return e>=0&&e<this.config.gridWidth&&i>=0&&i<this.config.gridHeight}getGridCell(e,i){return this.isValidGridPosition(e,i)?this.grid[e][i]:null}isPositionOccupied(e,i){const n=this.getGridCell(e,i);return n?n.occupied:!1}findEmptyPositions(){const e=[];for(let i=0;i<this.config.gridWidth;i++)for(let n=0;n<this.config.gridHeight;n++)this.grid[i][n].occupied||e.push({x:i,y:n});return e}getRandomEmptyPosition(){const e=this.findEmptyPositions();if(e.length===0)return null;const i=Math.floor(Math.random()*e.length);return e[i]}markPosition(e,i,n){return!this.isValidGridPosition(e,i)||this.grid[e][i].occupied?!1:(this.grid[e][i]={x:e,y:i,occupied:!0,occupiedBy:n},!0)}clearPosition(e,i){this.isValidGridPosition(e,i)&&(this.grid[e][i]={x:e,y:i,occupied:!1})}getConfig(){return{...this.config}}getGridDimensions(){return{width:this.config.gridWidth,height:this.config.gridHeight}}getCellSize(){return this.config.cellSize}performOptimizedCollisionCheck(e,i,n){const r=this.checkBoundaryCollision(e);return r.hasCollision?r:n?this.checkContinuousBodyCollision(e,i,n):this.checkSelfCollision(e,i)}}var v=(t=>(t.SpeedBoost="SpeedBoost",t.VenomStrike="VenomStrike",t.Constrict="Constrict",t.HoodExpansion="HoodExpansion",t.AquaticMovement="AquaticMovement",t.ColorChange="ColorChange",t.TimeWarp="TimeWarp",t.FireBreath="FireBreath",t.TailConsumption="TailConsumption",t.PowerCycling="PowerCycling",t.RealityManipulation="RealityManipulation",t))(v||{});class Zh{constructor(e){c(this,"config");c(this,"state");c(this,"evolutionLevels");this.config=e,this.state=this.initializeState(),this.evolutionLevels=this.initializeEvolutionLevels()}initializeState(){return{currentLevel:1,foodProgress:0,totalFoodConsumed:0,isTransformationInProgress:!1,transformationProgress:0,availablePowers:[],powerStates:new Map}}initializeEvolutionLevels(){const e=new Map;e.set(1,{level:1,name:"Hatchling",requiredFood:0,segmentCount:3,powers:[],visualPattern:{id:"hatchling",name:"Basic Green",colors:["#4CAF50"],pattern:"solid",intensity:1,animationSpeed:0},description:"A young snake just beginning its journey",speedMultiplier:1,scoreMultiplier:1}),e.set(2,{level:2,name:"Garden Snake",requiredFood:50,segmentCount:5,powers:["SpeedBoost"],visualPattern:{id:"garden",name:"Garden Stripes",colors:["#4CAF50","#2E7D32"],pattern:"stripes",intensity:1.1,animationSpeed:.5},description:"A common garden snake with basic speed abilities",speedMultiplier:1.1,scoreMultiplier:1.2});for(let i=3;i<=9;i++)e.set(i,{level:i,name:`Evolution Level ${i}`,requiredFood:i*50,segmentCount:i+2,powers:this.getPowersForLevel(i),visualPattern:this.getVisualPatternForLevel(i),description:`Evolution level ${i}`,speedMultiplier:1+(i-1)*.1,scoreMultiplier:1+(i-1)*.2});return e.set(10,{level:10,name:"Ouroboros",requiredFood:1600,segmentCount:30,powers:this.getPowersForLevel(10),visualPattern:this.getVisualPatternForLevel(10),description:"The ultimate serpent form",speedMultiplier:2,scoreMultiplier:3}),e}getPowersForLevel(e){return{2:["SpeedBoost"],3:["VenomStrike"],4:["Constrict"],5:["HoodExpansion"],6:["AquaticMovement"],7:["ColorChange"],8:["TimeWarp"],9:["FireBreath"],10:["TailConsumption"]}[e]||[]}getVisualPatternForLevel(e){return{3:{id:"venom",name:"Venomous Purple",colors:["#9C27B0","#4A148C"],pattern:"gradient",intensity:1.2,animationSpeed:1},4:{id:"constrictor",name:"Constrictor Brown",colors:["#8D6E63","#5D4037"],pattern:"scales",intensity:1.3,animationSpeed:.8}}[e]||{id:`level${e}`,name:`Level ${e} Pattern`,colors:["#4CAF50"],pattern:"solid",intensity:1+e*.1,animationSpeed:e*.2}}getCurrentLevel(){return this.state.currentLevel}getAvailablePowers(){return[...this.state.availablePowers]}getFoodProgress(){return this.state.foodProgress}getTotalFoodConsumed(){return this.state.totalFoodConsumed}isTransformationInProgress(){return this.state.isTransformationInProgress}getEvolutionLevel(e){return this.evolutionLevels.get(e)||null}addEvolutionProgress(e){this.state.foodProgress+=e,this.state.totalFoodConsumed+=e;const i=this.evolutionLevels.get(this.state.currentLevel),n=this.evolutionLevels.get(this.state.currentLevel+1);return!i||!n?null:this.state.foodProgress>=n.requiredFood?this.evolveToNextLevel():null}addFoodProgress(e){const i=this.addEvolutionProgress(e);return{evolved:i!==null,newLevel:i==null?void 0:i.newLevel}}evolveToNextLevel(){const e=this.state.currentLevel+1,i=this.evolutionLevels.get(e);if(!i)return{success:!1,newLevel:this.state.currentLevel,unlockedPowers:[],newVisualPattern:this.evolutionLevels.get(this.state.currentLevel).visualPattern,message:"Maximum evolution level reached"};this.state.currentLevel=e,this.state.isTransformationInProgress=!0,this.state.transformationProgress=0;const n=i.powers.filter(r=>!this.state.availablePowers.includes(r));return this.state.availablePowers.push(...n),n.forEach(r=>{this.state.powerStates.set(r,{type:r,isUnlocked:!0,isActive:!1,cooldownRemaining:0,duration:0,level:1})}),{success:!0,newLevel:e,unlockedPowers:n,newVisualPattern:i.visualPattern,message:`Evolved to ${i.name}!`}}getRequiredProgressForNextLevel(){const e=this.evolutionLevels.get(this.state.currentLevel+1);return e?e.requiredFood:0}forceEvolution(e){if(e<=this.state.currentLevel||!this.evolutionLevels.has(e))return!1;this.state.currentLevel=e,this.state.foodProgress=this.evolutionLevels.get(e).requiredFood,this.state.availablePowers=[];for(let i=1;i<=e;i++){const n=this.evolutionLevels.get(i);n&&this.state.availablePowers.push(...n.powers)}return this.state.availablePowers.forEach(i=>{this.state.powerStates.set(i,{type:i,isUnlocked:!0,isActive:!1,cooldownRemaining:0,duration:0,level:1})}),!0}update(e){this.state.isTransformationInProgress&&(this.state.transformationProgress+=e/2e3,this.state.transformationProgress>=1&&(this.state.isTransformationInProgress=!1,this.state.transformationProgress=0)),this.state.powerStates.forEach(i=>{i.cooldownRemaining>0&&(i.cooldownRemaining=Math.max(0,i.cooldownRemaining-e))})}getState(){return{...this.state,powerStates:new Map(this.state.powerStates)}}activatePower(e){const i=this.state.powerStates.get(e);return!i||!i.isUnlocked?!1:(i.isActive=!0,i.lastActivated=Date.now(),!0)}setLevel(e){if(e>=1&&e<=10){this.state.currentLevel=e;const i=this.evolutionLevels.get(e);i&&(this.state.foodProgress=i.requiredFood)}}getProgressToNextLevel(){const e=this.evolutionLevels.get(this.state.currentLevel+1);if(!e)return 1;const i=this.evolutionLevels.get(this.state.currentLevel),n=(i==null?void 0:i.requiredFood)||0,r=e.requiredFood,o=(this.state.foodProgress-n)/(r-n);return Math.max(0,Math.min(1,o))}getFoodRequiredForNextLevel(){const e=this.evolutionLevels.get(this.state.currentLevel+1);return e?e.requiredFood-this.state.foodProgress:0}getTransformationProgress(){return this.state.transformationProgress}getCurrentVisualPattern(){const e=this.evolutionLevels.get(this.state.currentLevel);return e?{baseColor:e.visualPattern.colors[0],patternType:e.visualPattern.pattern,intensity:e.visualPattern.intensity}:null}getEvolutionState(){return{...this.state}}getAllEvolutionLevels(){return Array.from(this.evolutionLevels.values())}reset(){this.state=this.initializeState()}}class xc{constructor(e){c(this,"config");c(this,"activePowers");c(this,"activeEffects");c(this,"powerDefinitions",new Map);c(this,"nextEffectId",0);this.config=e,this.activePowers=new Map,this.activeEffects=[],this.initializePowerDefinitions()}initializePowerDefinitions(){this.powerDefinitions=new Map,this.powerDefinitions.set(v.SpeedBoost,{type:v.SpeedBoost,name:"Speed Boost",description:"Increases movement speed for a short duration",cooldown:8e3,duration:3e3,energyCost:0,visualEffect:"SpeedTrail",audioEffect:"speedboost_activate",speedMultiplier:2,color:"#FFEB3B",glowIntensity:.8,environmentalInteractions:["WallPhasing"]}),this.powerDefinitions.set(v.VenomStrike,{type:v.VenomStrike,name:"Venom Strike",description:"Launches a venomous projectile that can shatter obstacles",cooldown:5e3,duration:0,energyCost:0,visualEffect:"VenomProjectile",audioEffect:"venom_strike",projectileSpeed:800,projectileRange:350,color:"#4CAF50",glowIntensity:.6,environmentalInteractions:["CrystalDestruction"]}),this.powerDefinitions.set(v.Constrict,{type:v.Constrict,name:"Constrict",description:"Squeezes through narrow passages and activates pressure plates",cooldown:1e4,duration:2e3,energyCost:0,visualEffect:"PowerActivation",audioEffect:"constrict_activate",color:"#8D6E63",glowIntensity:.7,environmentalInteractions:["PressurePlateActivation","NarrowPassage"],specialEffects:["DoubleFoodValue"]}),this.powerDefinitions.set(v.HoodExpansion,{type:v.HoodExpansion,name:"Hood Expansion",description:"Provides invincibility and intimidates harmful creatures",cooldown:15e3,duration:3e3,energyCost:0,visualEffect:"PowerActivation",audioEffect:"hood_expansion",color:"#FFC107",glowIntensity:.9,environmentalInteractions:["Intimidation"],specialEffects:["Invincibility","CreatureIntimidation"]}),this.powerDefinitions.set(v.AquaticMovement,{type:v.AquaticMovement,name:"Aquatic Movement",description:"Allows crossing water pools and underwater navigation",cooldown:0,duration:0,energyCost:0,visualEffect:"PowerActivation",audioEffect:"aquatic_movement",color:"#2E7D32",glowIntensity:.5,environmentalInteractions:["WaterTraversal","UnderwaterTunnels"],specialEffects:["Regeneration","BreathHolding"]}),this.powerDefinitions.set(v.ColorChange,{type:v.ColorChange,name:"Color Change",description:"Provides invisibility and camouflage abilities",cooldown:12e3,duration:5e3,energyCost:0,visualEffect:"PowerActivation",audioEffect:"color_change",color:"#E91E63",glowIntensity:.8,environmentalInteractions:["Invisibility","PoisonGasCamouflage"],specialEffects:["Invisibility","ConsumeAnyFood"]}),this.powerDefinitions.set(v.TimeWarp,{type:v.TimeWarp,name:"Time Warp",description:"Slows down moving hazards and provides temporal dodge",cooldown:2e4,duration:4e3,energyCost:0,visualEffect:"TimeWarp",audioEffect:"time_warp",color:"#3F51B5",glowIntensity:.9,environmentalInteractions:["HazardSlowing","TemporalDodge"],specialEffects:["FoodAttraction","TimeSlowing"]}),this.powerDefinitions.set(v.FireBreath,{type:v.FireBreath,name:"Fire Breath",description:"Breathes fire to destroy multiple obstacle types",cooldown:8e3,duration:1500,energyCost:0,visualEffect:"FireBreath",audioEffect:"fire_breath",range:200,damage:100,color:"#FF5722",glowIntensity:1,environmentalInteractions:["IceWallDestruction","ThornBushDestruction","WoodenBarrierDestruction","FlameGeyserDestruction","PoisonGasDestruction","EnemySpawnerDestruction"]}),this.powerDefinitions.set(v.TailConsumption,{type:v.TailConsumption,name:"Tail Consumption",description:"Strategically consume tail segments for navigation and bonuses",cooldown:3e3,duration:0,energyCost:0,visualEffect:"TailConsumption",audioEffect:"tail_consumption",color:"#FFD700",glowIntensity:1,environmentalInteractions:[],specialEffects:["StrategicLengthManagement","BonusPoints"]}),this.powerDefinitions.set(v.PowerCycling,{type:v.PowerCycling,name:"Power Cycling",description:"Activate any previous evolution abilities with cooldown",cooldown:25e3,duration:0,energyCost:0,visualEffect:"PowerCycling",audioEffect:"power_cycling",color:"#FFD700",glowIntensity:1,environmentalInteractions:[],specialEffects:["AccessAllPreviousPowers"]}),this.powerDefinitions.set(v.RealityManipulation,{type:v.RealityManipulation,name:"Reality Manipulation",description:"Reshape small environment sections and bend reality",cooldown:3e4,duration:6e3,energyCost:0,visualEffect:"RealityManipulation",audioEffect:"reality_manipulation",range:150,color:"#FFD700",glowIntensity:1,environmentalInteractions:["EnvironmentReshaping","ObstacleCreation","PathCreation"],specialEffects:["RealityBending","EnvironmentControl"]})}update(e){this.updatePowerStates(e),this.updateEffects(e)}updatePowerStates(e){this.activePowers.forEach((i,n)=>{i.cooldownRemaining>0&&(i.cooldownRemaining=Math.max(0,i.cooldownRemaining-e)),i.isActive&&i.remainingDuration!==void 0&&i.remainingDuration>0&&(i.remainingDuration=Math.max(0,i.remainingDuration-e),i.remainingDuration<=0&&this.deactivatePower(n))})}updateEffects(e){for(let i=this.activeEffects.length-1;i>=0;i--){const n=this.activeEffects[i];n.remainingLifetime-=e,n.position.x+=n.velocity.x*(e/1e3),n.position.y+=n.velocity.y*(e/1e3),this.updateSpecificEffect(n,e),n.remainingLifetime<=0&&this.activeEffects.splice(i,1)}}updateSpecificEffect(e,i){switch(e.type){case"VenomProjectile":e.data&&e.data.distanceTraveled&&Math.sqrt(Math.pow(e.velocity.x*(e.lifetime-e.remainingLifetime)/1e3,2)+Math.pow(e.velocity.y*(e.lifetime-e.remainingLifetime)/1e3,2))>=e.data.maxRange&&(e.remainingLifetime=0);break;case"SpeedTrail":e.size*=1-e.fadeRate*i/1e3;break}}activatePower(e,i,n,r){const o=this.powerDefinitions.get(e);if(!o)return{success:!1,powerType:e,effects:[],message:"Power not found"};const s=this.activePowers.get(e);if(!s)return{success:!1,powerType:e,effects:[],message:"Power not available"};if(s.cooldownRemaining>0)return{success:!1,powerType:e,effects:[],message:`Power on cooldown: ${Math.ceil(s.cooldownRemaining/1e3)}s`};if(s.isActive&&o.duration>0)return{success:!1,powerType:e,effects:[],message:"Power already active"};s.isActive=o.duration>0,s.remainingDuration=o.duration,s.cooldownRemaining=o.cooldown,s.lastActivated=performance.now();const a=this.createPowerEffects(e,i,n,o),l=r?this.checkEnvironmentalInteractions(e,i,n,r,o):[];return{success:!0,powerType:e,effects:a,environmentalInteractions:l,message:`${o.name} activated!`}}createPowerEffects(e,i,n,r){const o=[];switch(e){case v.SpeedBoost:o.push({type:"PowerActivation",position:{...i},velocity:{x:0,y:0},lifetime:500,remainingLifetime:500,color:r.color,size:this.config.cellSize*2,fadeRate:2});break;case v.VenomStrike:const s=r.projectileSpeed||800,a=r.projectileRange||350;o.push({type:"VenomProjectile",position:{...i},velocity:{x:n.x*s,y:n.y*s},lifetime:a/s*1e3,remainingLifetime:a/s*1e3,color:r.color,size:this.config.cellSize*.8,fadeRate:.5,data:{maxRange:a,distanceTraveled:0}});break;case v.Constrict:o.push({type:"ConstrictGlow",position:{...i},velocity:{x:0,y:0},lifetime:r.duration,remainingLifetime:r.duration,color:r.color,size:this.config.cellSize*3,fadeRate:.5,data:{pulseSpeed:2}});break;case v.HoodExpansion:o.push({type:"GoldenAura",position:{...i},velocity:{x:0,y:0},lifetime:r.duration,remainingLifetime:r.duration,color:r.color,size:this.config.cellSize*4,fadeRate:.3,data:{intensity:r.glowIntensity,expandRate:1.5}});break;case v.AquaticMovement:o.push({type:"AquaticShimmer",position:{...i},velocity:{x:0,y:0},lifetime:2e3,remainingLifetime:2e3,color:r.color,size:this.config.cellSize*2.5,fadeRate:1,data:{waveSpeed:3,shimmerIntensity:.7}});break;case v.ColorChange:o.push({type:"ColorShift",position:{...i},velocity:{x:0,y:0},lifetime:r.duration,remainingLifetime:r.duration,color:r.color,size:this.config.cellSize*2,fadeRate:.2,data:{colorCycleSpeed:2,shimmerEffect:!0}}),o.push({type:"InvisibilityShimmer",position:{...i},velocity:{x:0,y:0},lifetime:r.duration,remainingLifetime:r.duration,color:"#FFFFFF",size:this.config.cellSize*1.5,fadeRate:.1,data:{alpha:.3,shimmerRate:4}});break;case v.TimeWarp:o.push({type:"TimeWarp",position:{...i},velocity:{x:0,y:0},lifetime:r.duration,remainingLifetime:r.duration,color:r.color,size:this.config.cellSize*6,fadeRate:.2,data:{intensity:.8,rippleSpeed:2,timeSlowFactor:.3}}),o.push({type:"CelestialGlow",position:{...i},velocity:{x:0,y:0},lifetime:r.duration,remainingLifetime:r.duration,color:"#E8EAF6",size:this.config.cellSize*3,fadeRate:.3,data:{starIntensity:.9,twinkleSpeed:3}});break;case v.FireBreath:const l=r.range||200,u=r.duration||1500;for(let m=0;m<10;m++){const p=(m-5)*.15,x={x:n.x*Math.cos(p)-n.y*Math.sin(p),y:n.x*Math.sin(p)+n.y*Math.cos(p)};o.push({type:"DragonicFlames",position:{x:i.x+n.x*this.config.cellSize,y:i.y+n.y*this.config.cellSize},velocity:{x:x.x*400,y:x.y*400},lifetime:u,remainingLifetime:u,color:m%3===0?"#D32F2F":m%3===1?"#FF5722":"#FFC107",size:this.config.cellSize*(.6+Math.random()*.6),fadeRate:1.2,data:{maxRange:l,damage:r.damage||100,intensity:.9}})}break;case v.TailConsumption:o.push({type:"TailConsumption",position:{...i},velocity:{x:0,y:0},lifetime:1e3,remainingLifetime:1e3,color:r.color,size:this.config.cellSize*2,fadeRate:1,data:{spiralSpeed:4,mysticalIntensity:1,goldParticles:!0}});break;case v.PowerCycling:o.push({type:"PowerCycling",position:{...i},velocity:{x:0,y:0},lifetime:2e3,remainingLifetime:2e3,color:r.color,size:this.config.cellSize*4,fadeRate:.5,data:{cycleSpeed:2.5,powerAura:!0,colorShift:!0}});break;case v.RealityManipulation:const d=r.range||150;o.push({type:"RealityManipulation",position:{...i},velocity:{x:0,y:0},lifetime:r.duration,remainingLifetime:r.duration,color:r.color,size:d*2,fadeRate:.1,data:{distortionIntensity:1,realityWaveSpeed:1.5,manipulationRange:d}});for(let m=0;m<6;m++){const p=m/6*2*Math.PI,x=this.config.cellSize*2;o.push({type:"MysticalRunes",position:{x:i.x+Math.cos(p)*x,y:i.y+Math.sin(p)*x},velocity:{x:0,y:0},lifetime:r.duration,remainingLifetime:r.duration,color:"#FFF8E1",size:this.config.cellSize*.8,fadeRate:.2,data:{runeType:m,rotationSpeed:1,glowPulse:!0}})}break}return this.activeEffects.push(...o),o}deactivatePower(e){const i=this.activePowers.get(e);i&&(i.isActive=!1,i.remainingDuration!==void 0&&(i.remainingDuration=0))}isPowerActive(e){const i=this.activePowers.get(e);return i?i.isActive:!1}getPowerCooldown(e){const i=this.activePowers.get(e);return i?i.cooldownRemaining:0}getPowerDuration(e){const i=this.activePowers.get(e);return i&&i.remainingDuration!==void 0?i.remainingDuration:0}getSpeedMultiplier(){if(this.isPowerActive(v.SpeedBoost)){const e=this.powerDefinitions.get(v.SpeedBoost);return(e==null?void 0:e.speedMultiplier)||1}return 1}getActiveEffects(){return[...this.activeEffects]}getVisualState(){const e=[],i=new Map,n=new Map;return this.activePowers.forEach((r,o)=>{r.isActive&&e.push(o),i.set(o,r.cooldownRemaining),n.set(o,r.remainingDuration||0)}),{activePowers:e,effects:[...this.activeEffects],cooldowns:i,durations:n}}initializePower(e){if(!this.activePowers.has(e)){const i=this.powerDefinitions.get(e);i&&this.activePowers.set(e,{type:e,isUnlocked:!0,isActive:!1,cooldownRemaining:0,duration:i.duration,level:1,remainingDuration:0,lastActivated:0})}}removePower(e){this.activePowers.delete(e)}reset(){this.activePowers.clear(),this.activeEffects=[]}canActivatePressurePlate(){return this.isPowerActive(v.Constrict)}isRegenerationActive(){return this.activePowers.has(v.AquaticMovement)}isInvisible(){return this.isPowerActive(v.ColorChange)}isInvincible(){return this.isPowerActive(v.HoodExpansion)}canTraverseWater(){return this.activePowers.get(v.AquaticMovement)!==void 0}canConsumeAnyFood(){return this.isPowerActive(v.ColorChange)}getDoubleFoodValueMultiplier(){return this.isPowerActive(v.Constrict)?2:1}getRegenerationRate(){return this.isRegenerationActive()?.1:0}getInvisibilityAlpha(){return this.isInvisible()?.3:1}createRegenerationEffect(e){if(!this.isRegenerationActive())return[];const i=[];for(let n=0;n<3;n++)i.push({type:"RegenerationSparkle",position:{x:e.x+(Math.random()-.5)*this.config.cellSize,y:e.y+(Math.random()-.5)*this.config.cellSize},velocity:{x:(Math.random()-.5)*50,y:(Math.random()-.5)*50},lifetime:1e3,remainingLifetime:1e3,color:"#4CAF50",size:this.config.cellSize*.2,fadeRate:2});return this.activeEffects.push(...i),i}activateSpecialAbility(e,i){switch(e){case"PressurePlateActivation":return this.canActivatePressurePlate();case"Regeneration":return this.isRegenerationActive()?(this.createRegenerationEffect(i),!0):!1;case"Invisibility":return this.isInvisible();case"Invincibility":return this.isInvincible();case"WaterTraversal":return this.canTraverseWater();default:return!1}}checkProjectileCollisions(e){const i=[];for(let n=this.activeEffects.length-1;n>=0;n--){const r=this.activeEffects[n];if(r.type==="VenomProjectile"){for(const o of e)if(this.isProjectileCollidingWithObstacle(r,o)){const s={type:"VenomImpact",position:{...r.position},velocity:{x:0,y:0},lifetime:300,remainingLifetime:300,color:"#FF5722",size:this.config.cellSize*1.5,fadeRate:3};i.push(s),this.activeEffects.push(s),this.activeEffects.splice(n,1);break}}}return i}isProjectileCollidingWithObstacle(e,i){const n=Math.sqrt(Math.pow(e.position.x-i.x,2)+Math.pow(e.position.y-i.y,2)),r=(e.size+i.size)/2;return n<=r}checkEnvironmentalInteractions(e,i,n,r,o){const s=[];switch(e){case v.VenomStrike:const a=o.projectileRange||350;this.getObstaclesInPath(i,n,a,r).filter(S=>S.type===J.CrystalFormation&&S.isDestructible).forEach(S=>{s.push({type:"destroy",obstacleId:S.id,powerType:e,effects:this.createCrystalShatterEffect(S.position)})});break;case v.SpeedBoost:r.filter(S=>S.type===J.MagicBarrier&&this.isObstacleNearPosition(S,i,this.config.cellSize*2)).forEach(S=>{s.push({type:"phase",obstacleId:S.id,powerType:e,effects:this.createWallPhasingEffect(S.position)})});break;case v.Constrict:[].forEach(S=>{s.push({type:"activate",obstacleId:S.id,powerType:e,effects:this.createPressurePlateActivationEffect(S.position)})});break;case v.HoodExpansion:r.filter(S=>this.canIntimidateElement(S.type)&&this.isObstacleNearPosition(S,i,this.config.cellSize*3)).forEach(S=>{s.push({type:"activate",obstacleId:S.id,powerType:e,effects:this.createIntimidationEffect(S.position)})});break;case v.AquaticMovement:break;case v.ColorChange:break;case v.FireBreath:const p=o.range||200;this.getObstaclesInCone(i,n,p,r).filter(S=>this.canFireBreathDestroy(S.type)&&S.isDestructible).forEach(S=>{s.push({type:"destroy",obstacleId:S.id,powerType:e,damage:o.damage||100,effects:this.createObstacleDestructionEffect(S.position,S.type)})});break}return s}getObstaclesInPath(e,i,n,r){const o=[],s=this.config.cellSize;for(let a=0;a<n;a+=s/2){const l={x:e.x+i.x*a,y:e.y+i.y*a},u=Math.floor(l.x/s),d=Math.floor(l.y/s),m=r.find(p=>p.isActive&&u>=p.position.x&&u<p.position.x+p.size.x&&d>=p.position.y&&d<p.position.y+p.size.y);m&&!o.includes(m)&&o.push(m)}return o}getObstaclesInCone(e,i,n,r){const o=[],s=this.config.cellSize,a=Math.PI/4;return r.forEach(l=>{if(!l.isActive)return;const u={x:(l.position.x+l.size.x/2)*s,y:(l.position.y+l.size.y/2)*s},d=u.x-e.x,m=u.y-e.y;if(Math.sqrt(d*d+m*m)>n)return;const x=Math.atan2(m,d),S=Math.atan2(i.y,i.x),E=Math.abs(x-S);(E<=a/2||E>=2*Math.PI-a/2)&&o.push(l)}),o}isObstacleNearPosition(e,i,n){const r={x:(e.position.x+e.size.x/2)*this.config.cellSize,y:(e.position.y+e.size.y/2)*this.config.cellSize};return Math.sqrt(Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2))<=n}canFireBreathDestroy(e){return[J.IceWall,J.ThornBush].includes(e)}isTimeWarpActive(){return this.isPowerActive(v.TimeWarp)}getTimeSlowFactor(){return this.isTimeWarpActive()?.3:1}canAttractFood(){return this.activePowers.has(v.TimeWarp)}getFoodAttractionRadius(){return this.canAttractFood()?this.config.cellSize*5:0}hasHeatVision(){return this.activePowers.has(v.FireBreath)}isEnvironmentallyImmune(){return this.activePowers.has(v.FireBreath)}canConsumeTail(){return this.activePowers.has(v.TailConsumption)}canCyclePowers(){return this.activePowers.has(v.PowerCycling)}canManipulateReality(){return this.activePowers.has(v.RealityManipulation)}activateTailConsumption(e){if(!this.canConsumeTail())return!1;const i=this.activePowers.get(v.TailConsumption);return!i||i.cooldownRemaining>0?!1:(i.cooldownRemaining=this.getPowerCooldown(v.TailConsumption),i.lastActivated=performance.now(),!0)}cycleToPower(e){if(!this.canCyclePowers())return!1;const i=this.activePowers.get(v.PowerCycling);if(!i||i.cooldownRemaining>0||![v.SpeedBoost,v.VenomStrike,v.Constrict,v.HoodExpansion,v.AquaticMovement,v.ColorChange,v.TimeWarp,v.FireBreath].includes(e))return!1;const r=this.activePowers.get(e);return r&&(r.isActive=!0,r.remainingDuration!==void 0&&(r.remainingDuration=this.getPowerDuration(e)),r.cooldownRemaining=0),i.cooldownRemaining=this.getPowerCooldown(v.PowerCycling),i.lastActivated=performance.now(),!0}manipulateEnvironment(e,i){if(!this.canManipulateReality())return!1;const n=this.activePowers.get(v.RealityManipulation);if(!n||!n.isActive)return!1;switch(i){case"createPath":return!0;case"removeObstacle":return!0;case"createBarrier":return!0;default:return!1}}createFoodAttractionEffect(e){if(!this.canAttractFood())return[];const i=[],n=this.getFoodAttractionRadius();return i.push({type:"FoodAttraction",position:{...e},velocity:{x:0,y:0},lifetime:2e3,remainingLifetime:2e3,color:"#E8EAF6",size:n*2,fadeRate:.5,data:{attractionRadius:n,pulseSpeed:2}}),this.activeEffects.push(...i),i}createHeatVisionEffect(e,i){if(!this.hasHeatVision())return[];const n=[],r=this.config.cellSize*8;return n.push({type:"HeatVision",position:{...e},velocity:{x:i.x*200,y:i.y*200},lifetime:1e3,remainingLifetime:1e3,color:"#FF5722",size:this.config.cellSize*.5,fadeRate:1,data:{visionRange:r,heatIntensity:.8}}),this.activeEffects.push(...n),n}createCrystalShatterEffect(e){const i=[];for(let n=0;n<6;n++){const r=n/6*2*Math.PI;i.push({type:"CrystalShatter",position:{x:e.x*this.config.cellSize,y:e.y*this.config.cellSize},velocity:{x:Math.cos(r)*150,y:Math.sin(r)*150},lifetime:800,remainingLifetime:800,color:"#E1F5FE",size:this.config.cellSize*.3,fadeRate:1.5})}return i}createWallPhasingEffect(e){return[{type:"WallPhasing",position:{x:e.x*this.config.cellSize,y:e.y*this.config.cellSize},velocity:{x:0,y:0},lifetime:1e3,remainingLifetime:1e3,color:"#FFEB3B",size:this.config.cellSize*1.5,fadeRate:1,data:{alpha:.5}}]}createObstacleDestructionEffect(e,i){const n=[];let r="#FF5722",o=8;switch(i){case J.IceWall:r="#81D4FA",o=10;break;case J.ThornBush:r="#4CAF50",o=12;break}for(let s=0;s<o;s++){const a=s/o*2*Math.PI;n.push({type:"ObstacleDestruction",position:{x:e.x*this.config.cellSize,y:e.y*this.config.cellSize},velocity:{x:Math.cos(a)*(100+Math.random()*100),y:Math.sin(a)*(100+Math.random()*100)},lifetime:1e3+Math.random()*500,remainingLifetime:1e3+Math.random()*500,color:r,size:this.config.cellSize*(.2+Math.random()*.3),fadeRate:1.2})}return n}createPressurePlateActivationEffect(e){return[{type:"PowerActivation",position:{x:e.x*this.config.cellSize,y:e.y*this.config.cellSize},velocity:{x:0,y:0},lifetime:800,remainingLifetime:800,color:"#8D6E63",size:this.config.cellSize*2,fadeRate:1.5,data:{activationType:"pressure_plate"}}]}createIntimidationEffect(e){const i=[];for(let n=0;n<4;n++)i.push({type:"PowerActivation",position:{x:e.x*this.config.cellSize,y:e.y*this.config.cellSize},velocity:{x:0,y:0},lifetime:1200+n*200,remainingLifetime:1200+n*200,color:"#FFC107",size:this.config.cellSize*(2+n*.5),fadeRate:.8,data:{intimidationWave:!0,waveIndex:n}});return i}canIntimidateElement(e){return["HarmfulCreature","MysticalGuardian","PoisonGasCloud"].includes(e)}}class Jh{constructor(e,i){c(this,"snake");c(this,"movementQueue");c(this,"config");c(this,"segmentPaths");c(this,"collisionSystem");c(this,"evolutionSystem");c(this,"powerSystem");c(this,"previousHeadPosition");c(this,"SEGMENT_FOLLOW_DELAY",150);c(this,"CURVE_SMOOTHNESS",.3);c(this,"BREATHING_AMPLITUDE",.05);c(this,"BREATHING_FREQUENCY",2);c(this,"lastTailConsumptionTime");c(this,"tailConsumptionCount");this.config=e,this.movementQueue=[],this.segmentPaths=[],this.collisionSystem=new Sc(e),this.evolutionSystem=new Zh(e),this.powerSystem=new xc(e);const n=i||{x:Math.floor(e.gridWidth/2),y:Math.floor(e.gridHeight/2)};this.previousHeadPosition={...n},this.snake={segments:[],head:{x:n.x,y:n.y,rotation:0,scale:1,interpolatedX:n.x,interpolatedY:n.y},direction:{x:1,y:0},targetDirection:{x:1,y:0},speed:1,evolutionLevel:1,isAlive:!0,lastMoveTime:0,moveInterval:200,isMoving:!1};for(let r=1;r<3;r++)this.snake.segments.push({x:n.x-r,y:n.y,rotation:0,scale:1,interpolatedX:n.x-r,interpolatedY:n.y});this.initializeSegmentPaths(),this.updateCollisionGrid()}initializeSegmentPaths(){this.segmentPaths=[];for(let e=0;e<this.snake.segments.length;e++)this.segmentPaths.push({curve:this.createStraightCurve(this.snake.segments[e]),progress:1,duration:this.SEGMENT_FOLLOW_DELAY})}createStraightCurve(e){const i={x:e.x,y:e.y};return{startPoint:i,controlPoint1:i,controlPoint2:i,endPoint:i}}update(e){if(!this.snake.isAlive)return;const i=performance.now();this.evolutionSystem.update(e),this.powerSystem.update(e),this.snake.isMoving||this.updateBreathingAnimation(i),i-this.snake.lastMoveTime>=this.snake.moveInterval&&(this.move(),this.snake.lastMoveTime=i),this.updateSegmentInterpolation(e)}updateBreathingAnimation(e){if(this.snake.isMoving)return;const i=e*this.BREATHING_FREQUENCY*2*Math.PI/1e3,n=1+Math.sin(i)*this.BREATHING_AMPLITUDE;this.snake.head.scale=n;for(let r=0;r<this.snake.segments.length;r++){const o=Math.max(.3,1-r*.1);this.snake.segments[r].scale=1+Math.sin(i-r*.2)*this.BREATHING_AMPLITUDE*o}}updateSegmentInterpolation(e){const i=e/this.snake.moveInterval;for(let n=0;n<this.segmentPaths.length;n++){const r=this.segmentPaths[n];if(r.progress<1){r.progress=Math.min(1,r.progress+i);const o=this.evaluateBezierCurve(r.curve,r.progress);n<this.snake.segments.length&&(this.snake.segments[n].interpolatedX=o.x,this.snake.segments[n].interpolatedY=o.y,this.updateSegmentRotation(n,r.curve,r.progress))}}this.updateHeadInterpolation(i)}updateHeadInterpolation(e){if(this.snake.isMoving){const i=this.snake.head.x,n=this.snake.head.y;this.snake.head.interpolatedX!==void 0&&this.snake.head.interpolatedY!==void 0?(this.snake.head.interpolatedX+=(i-this.snake.head.interpolatedX)*e,this.snake.head.interpolatedY+=(n-this.snake.head.interpolatedY)*e):(this.snake.head.interpolatedX=i,this.snake.head.interpolatedY=n),this.snake.head.rotation=Math.atan2(this.snake.direction.y,this.snake.direction.x)}}updateSegmentRotation(e,i,n){const r=this.getBezierTangent(i,n);this.snake.segments[e].rotation=Math.atan2(r.y,r.x)}evaluateBezierCurve(e,i){const{startPoint:n,controlPoint1:r,controlPoint2:o,endPoint:s}=e,a=1-i,l=a*a,u=l*a,d=i*i,m=d*i;return{x:u*n.x+3*l*i*r.x+3*a*d*o.x+m*s.x,y:u*n.y+3*l*i*r.y+3*a*d*o.y+m*s.y}}getBezierTangent(e,i){const{startPoint:n,controlPoint1:r,controlPoint2:o,endPoint:s}=e,a=1-i,l=a*a,u=i*i,d={x:-3*l*n.x+3*l*r.x-6*a*i*r.x+6*a*i*o.x-3*u*o.x+3*u*s.x,y:-3*l*n.y+3*l*r.y-6*a*i*r.y+6*a*i*o.y-3*u*o.y+3*u*s.y},m=Math.sqrt(d.x*d.x+d.y*d.y);return m>0&&(d.x/=m,d.y/=m),d}queueDirection(e){this.isOppositeDirection(e,this.snake.direction)||(e.x!==this.snake.targetDirection.x||e.y!==this.snake.targetDirection.y)&&this.movementQueue.push({...e})}processMovementQueue(){if(this.movementQueue.length>0){const e=this.movementQueue.shift();this.isOppositeDirection(e,this.snake.direction)||(this.snake.targetDirection=e,this.snake.direction={...this.snake.targetDirection})}}isOppositeDirection(e,i){return e.x===-i.x&&e.y===-i.y&&(Math.abs(e.x)>0||Math.abs(e.y)>0)}move(){this.snake.isAlive&&(this.snake.isMoving=!0,this.processMovementQueue(),this.previousHeadPosition={x:this.snake.head.x,y:this.snake.head.y},this.snake.head.x+=this.snake.direction.x,this.snake.head.y+=this.snake.direction.y,this.updateCollisionGrid(),this.updateSegmentPaths(this.previousHeadPosition,!0),setTimeout(()=>{this.snake.isMoving=!1},this.snake.moveInterval*.7))}updateSegmentPaths(e,i){const n=[];for(let r=0;r<this.snake.segments.length;r++)n.push({x:this.snake.segments[r].x,y:this.snake.segments[r].y});for(let r=0;r<this.snake.segments.length;r++){const o=r===0?e:n[r-1],s=this.createCurvedPath({x:this.snake.segments[r].x,y:this.snake.segments[r].y},o,i&&r<3);this.snake.segments[r].x=o.x,this.snake.segments[r].y=o.y,r<this.segmentPaths.length&&(this.segmentPaths[r]={curve:s,progress:0,duration:this.SEGMENT_FOLLOW_DELAY+r*20})}}createCurvedPath(e,i,n){if(!n||e.x===i.x&&e.y===i.y)return{startPoint:e,controlPoint1:e,controlPoint2:i,endPoint:i};(e.x+i.x)/2,(e.y+i.y)/2;const r={x:i.x-e.x,y:i.y-e.y},o={x:-r.y,y:r.x},s=this.CURVE_SMOOTHNESS,a={x:e.x+r.x*.25+o.x*s,y:e.y+r.y*.25+o.y*s},l={x:i.x-r.x*.25+o.x*s,y:i.y-r.y*.25+o.y*s};return{startPoint:e,controlPoint1:a,controlPoint2:l,endPoint:i}}grow(e=1){const i=this.snake.segments[this.snake.segments.length-1];for(let n=0;n<e;n++){const r={x:i.x,y:i.y,rotation:i.rotation,scale:1,interpolatedX:i.x,interpolatedY:i.y};this.snake.segments.push(r),this.segmentPaths.push({curve:this.createStraightCurve(r),progress:1,duration:this.SEGMENT_FOLLOW_DELAY})}this.updateCollisionGrid()}updateCollisionGrid(){this.collisionSystem.updateSnakeGrid(this.snake.head,this.snake.segments)}checkSelfCollision(){return this.collisionSystem.checkSelfCollision(this.snake.head,this.snake.segments)}checkWallCollision(){const e=this.snake.head;return e.x<0||e.x>=this.config.gridWidth||e.y<0||e.y>=this.config.gridHeight}checkBoundaryCollision(){return this.collisionSystem.checkBoundaryCollision(this.snake.head)}checkContinuousBodyCollision(){return this.collisionSystem.checkContinuousBodyCollision(this.snake.head,this.snake.segments,this.previousHeadPosition)}performOptimizedCollisionCheck(){return this.collisionSystem.performOptimizedCollisionCheck(this.snake.head,this.snake.segments,this.previousHeadPosition)}checkSelfCollisionLegacy(){return this.checkSelfCollision().hasCollision}checkBoundaryCollisionLegacy(){return this.checkBoundaryCollision().hasCollision}getHeadPosition(){return{x:this.snake.head.interpolatedX||this.snake.head.x,y:this.snake.head.interpolatedY||this.snake.head.y}}getSegments(){return[...this.snake.segments]}getHead(){return{...this.snake.head}}getLength(){return this.snake.segments.length+1}getDirection(){return{...this.snake.direction}}isAlive(){return this.snake.isAlive}kill(){this.snake.isAlive=!1,this.snake.isMoving=!1}setSpeed(e){const i=this.powerSystem.getSpeedMultiplier(),n=e*i;this.snake.speed=Math.max(.1,Math.min(3,n)),this.snake.moveInterval=200/this.snake.speed}getSpeed(){return this.snake.speed}reset(e){const i=e||{x:Math.floor(this.config.gridWidth/2),y:Math.floor(this.config.gridHeight/2)};this.previousHeadPosition={...i},this.movementQueue=[],this.segmentPaths=[],this.snake={segments:[],head:{x:i.x,y:i.y,rotation:0,scale:1,interpolatedX:i.x,interpolatedY:i.y},direction:{x:1,y:0},targetDirection:{x:1,y:0},speed:200,evolutionLevel:1,isAlive:!0,lastMoveTime:0,moveInterval:200,isMoving:!1};for(let n=1;n<=3;n++)this.snake.segments.push({x:i.x-n,y:i.y,rotation:0,scale:1,interpolatedX:i.x-n,interpolatedY:i.y});this.evolutionSystem.reset(),this.powerSystem.reset(),this.collisionSystem.reset(),this.lastTailConsumptionTime=void 0,this.tailConsumptionCount=void 0}getEvolutionLevel(){return this.snake.evolutionLevel}setEvolutionLevel(e){this.snake.evolutionLevel=Math.max(1,Math.min(10,e))}consumeTail(e){if(this.snake.evolutionLevel<10)return{success:!1,segmentsConsumed:0,message:"Tail consumption only available at Ouroboros level (10)",strategicAdvantage:null};if(e<=0)return{success:!1,segmentsConsumed:0,message:"Invalid number of segments to consume",strategicAdvantage:null};const i=5,n=Math.max(0,this.snake.segments.length-(i-1)),r=Math.min(e,n);if(r<=0)return{success:!1,segmentsConsumed:0,message:"Cannot consume tail - minimum length reached",strategicAdvantage:null};const o=performance.now(),s=2e3;if(this.lastTailConsumptionTime!==void 0&&o-this.lastTailConsumptionTime<s)return{success:!1,segmentsConsumed:0,message:`Tail consumption on cooldown (${Math.ceil((s-(o-this.lastTailConsumptionTime))/1e3)}s remaining)`,strategicAdvantage:null};const a=this.snake.segments.splice(-r,r);this.segmentPaths.splice(-r,r),this.updateCollisionGrid();const l=this.calculateStrategicAdvantage(r);return this.lastTailConsumptionTime=o,this.tailConsumptionCount=(this.tailConsumptionCount||0)+1,{success:!0,segmentsConsumed:r,message:`Consumed ${r} tail segment${r>1?"s":""}`,strategicAdvantage:l,consumedSegmentPositions:a.map(u=>({x:u.x,y:u.y}))}}calculateStrategicAdvantage(e){const n=e*50,r=e>=3?"significant":e>=2?"moderate":"minor",o=3e3,s=1.2+e*.1;return{bonusPoints:n,navigationBonus:r,speedBoost:{multiplier:s,duration:o},mysticalEnergy:e*10}}canConsumeTailSegment(e){if(this.snake.evolutionLevel<10||e<0||e>=this.snake.segments.length)return!1;const i=Math.floor(this.snake.segments.length*.3);return e>=i}getClickableSegmentInfo(e){if(this.snake.evolutionLevel<10)return null;const i=Math.floor(e.x/this.config.cellSize),n=Math.floor(e.y/this.config.cellSize);let r=null;for(let o=0;o<this.snake.segments.length;o++){const s=this.snake.segments[o];if(s.x===i&&s.y===n){const a=this.canConsumeTailSegment(o),l={segmentIndex:o,position:{x:s.x,y:s.y},isConsumable:a,segmentsToTail:this.snake.segments.length-o,estimatedAdvantage:a?this.calculateStrategicAdvantage(this.snake.segments.length-o):null};(!r||a&&!r.isConsumable||a&&r.isConsumable&&o>r.segmentIndex)&&(r=l)}}return r}consumeTailFromSegment(e){if(!this.canConsumeTailSegment(e))return{success:!1,segmentsConsumed:0,message:"Cannot consume this segment",strategicAdvantage:null};const i=this.snake.segments.length-e;return this.consumeTail(i)}getTailConsumptionCooldown(){if(this.lastTailConsumptionTime===void 0)return 0;const e=performance.now(),i=2e3,n=e-this.lastTailConsumptionTime;return Math.max(0,i-n)}getTailConsumptionCount(){return this.tailConsumptionCount||0}consumeTailLegacy(e){return this.consumeTail(e).success}getSnakeState(){return{...this.snake,segments:[...this.snake.segments],head:{...this.snake.head},direction:{...this.snake.direction},targetDirection:{...this.snake.targetDirection}}}getCollisionSystem(){return this.collisionSystem}getPreviousHeadPosition(){return{...this.previousHeadPosition}}checkFoodCollision(e){return this.collisionSystem.checkFoodCollision(this.snake.head,e)}checkObstacleCollision(e){return this.collisionSystem.checkObstacleCollision(this.snake.head,e)}consumeFood(e,i=0){e>0&&this.grow(e);const n=this.evolutionSystem.addFoodProgress(i);return n.evolved&&(this.snake.evolutionLevel=n.newLevel,this.updateVisualAppearance(n.visualChanges),this.adjustEvolutionProperties(n.newLevel)),n}updateVisualAppearance(e){}adjustEvolutionProperties(e){const i=this.evolutionSystem.getEvolutionLevel(e);if(!i)return;this.initializePowersForLevel(e);const n=1+(e-1)*.1;this.setSpeed(this.snake.speed*n);const r=this.getLength(),o=i.segmentCount;r<o&&this.grow(o-r)}getAllPositions(){const e=[{x:this.snake.head.x,y:this.snake.head.y}];return this.snake.segments.forEach(i=>{e.push({x:i.x,y:i.y})}),e}getEvolutionSystem(){return this.evolutionSystem}getCurrentEvolutionLevel(){return this.evolutionSystem.getCurrentLevel()}getEvolutionProgress(){return this.evolutionSystem.getProgressToNextLevel()}getFoodProgress(){return this.evolutionSystem.getFoodProgress()}isTransforming(){return this.evolutionSystem.isTransformationInProgress()}getTransformationProgress(){return this.evolutionSystem.getTransformationProgress()}getAvailablePowers(){return this.evolutionSystem.getAvailablePowers()}getPowerSystem(){return this.powerSystem}activatePower(e){const i=this.getHeadPosition(),n=this.getDirection(),r=this.powerSystem.activatePower(e,i,n);return r.success&&this.evolutionSystem.activatePower(e),r}isPowerActive(e){return this.powerSystem.isPowerActive(e)}getPowerCooldown(e){return this.powerSystem.getPowerCooldown(e)}getPowerDuration(e){return this.powerSystem.getPowerDuration(e)}getPowerVisualState(){return this.powerSystem.getVisualState()}initializePowersForLevel(e){const i=this.evolutionSystem.getEvolutionLevel(e);i&&i.powers.forEach(n=>{this.powerSystem.initializePower(n)})}}class ef{constructor(e){c(this,"gl");c(this,"canvas");c(this,"cellSize");c(this,"segmentShaderProgram",null);c(this,"headShaderProgram",null);c(this,"segmentVertexBuffer",null);c(this,"headVertexBuffer",null);c(this,"tongueAnimationTime",0);c(this,"breathingTime",0);c(this,"transformationEffectTime",0);c(this,"SEGMENT_RADIUS",.4);c(this,"HEAD_SCALE_MULTIPLIER",1.2);c(this,"TONGUE_FLICK_FREQUENCY",.5);c(this,"TONGUE_FLICK_DURATION",.3);c(this,"BREATHING_FREQUENCY",2);c(this,"BREATHING_AMPLITUDE",.05);this.gl=e.gl,this.canvas=e.canvas,this.cellSize=e.cellSize,this.initializeShaders(),this.initializeBuffers()}initializeShaders(){if(!this.gl){console.warn("WebGL context not available - skipping shader initialization");return}const e=`
      attribute vec2 a_position;
      attribute vec2 a_texCoord;
      
      uniform mat3 u_transform;
      uniform vec2 u_resolution;
      uniform float u_scale;
      
      varying vec2 v_texCoord;
      varying vec2 v_position;
      
      void main() {
        vec3 position = u_transform * vec3(a_position * u_scale, 1.0);
        
        // Convert to clip space
        vec2 clipSpace = ((position.xy / u_resolution) * 2.0) - 1.0;
        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
        
        v_texCoord = a_texCoord;
        v_position = position.xy;
      }
    `,i=`
      precision mediump float;
      
      uniform vec3 u_baseColor;
      uniform vec3 u_secondaryColor;
      uniform float u_glowIntensity;
      uniform float u_time;
      uniform int u_patternType;
      uniform float u_transformationProgress;
      uniform vec2 u_segmentCenter;
      
      varying vec2 v_texCoord;
      varying vec2 v_position;
      
      // Pattern generation functions
      float generateStripePattern(vec2 coord) {
        float stripeWidth = 0.15;
        float stripeSpacing = 0.3;
        return step(mod(coord.y, stripeSpacing), stripeWidth);
      }
      
      float generateDiamondPattern(vec2 coord) {
        vec2 center = vec2(0.5, 0.5);
        vec2 offset = abs(coord - center);
        float diamond = max(offset.x, offset.y);
        return step(diamond, 0.2) * (1.0 - step(diamond, 0.15));
      }
      
      float generateScalePattern(vec2 coord) {
        vec2 scaled = coord * 8.0;
        vec2 grid = fract(scaled);
        float scale = length(grid - 0.5);
        return smoothstep(0.3, 0.4, scale);
      }
      
      void main() {
        vec2 center = vec2(0.5, 0.5);
        float dist = length(v_texCoord - center);
        
        // Base circular shape with smooth edges
        float alpha = 1.0 - smoothstep(0.4, 0.5, dist);
        
        if (alpha < 0.01) {
          discard;
        }
        
        vec3 color = u_baseColor;
        
        // Apply pattern based on type
        if (u_patternType == 1) { // Stripes
          float pattern = generateStripePattern(v_texCoord);
          color = mix(u_baseColor, u_secondaryColor, pattern);
        } else if (u_patternType == 2) { // Diamond
          float pattern = generateDiamondPattern(v_texCoord);
          color = mix(u_baseColor, u_secondaryColor, pattern);
        } else if (u_patternType == 3) { // Scales
          float pattern = generateScalePattern(v_texCoord);
          color = mix(u_baseColor, u_secondaryColor, pattern * 0.3);
        }
        
        // Add subtle gradient for 3D effect
        float gradient = 1.0 - (dist * 0.3);
        color *= gradient;
        
        // Add glow effect
        if (u_glowIntensity > 0.0) {
          float glow = exp(-dist * 3.0) * u_glowIntensity;
          color += vec3(glow * 0.2, glow * 0.3, glow * 0.5);
        }
        
        // Transformation effect
        if (u_transformationProgress > 0.0) {
          float transformGlow = sin(u_time * 10.0) * 0.5 + 0.5;
          color += vec3(transformGlow * u_transformationProgress * 0.5);
          alpha += transformGlow * u_transformationProgress * 0.3;
        }
        
        gl_FragColor = vec4(color, alpha);
      }
    `,n=`
      attribute vec2 a_position;
      attribute vec2 a_texCoord;
      
      uniform mat3 u_transform;
      uniform vec2 u_resolution;
      uniform float u_scale;
      uniform float u_headScale;
      
      varying vec2 v_texCoord;
      varying vec2 v_position;
      
      void main() {
        vec3 position = u_transform * vec3(a_position * u_scale * u_headScale, 1.0);
        
        vec2 clipSpace = ((position.xy / u_resolution) * 2.0) - 1.0;
        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
        
        v_texCoord = a_texCoord;
        v_position = position.xy;
      }
    `,r=`
      precision mediump float;
      
      uniform vec3 u_baseColor;
      uniform vec3 u_secondaryColor;
      uniform float u_glowIntensity;
      uniform float u_time;
      uniform int u_patternType;
      uniform float u_transformationProgress;
      uniform float u_tongueExtension;
      uniform vec2 u_eyePositions[2];
      uniform float u_eyeScale;
      
      varying vec2 v_texCoord;
      varying vec2 v_position;
      
      void main() {
        vec2 center = vec2(0.5, 0.5);
        float dist = length(v_texCoord - center);
        
        // Head shape (slightly elongated)
        vec2 headCoord = (v_texCoord - center) * vec2(1.2, 1.0) + center;
        float headDist = length(headCoord - center);
        float alpha = 1.0 - smoothstep(0.35, 0.5, headDist);
        
        if (alpha < 0.01) {
          discard;
        }
        
        vec3 color = u_baseColor;
        
        // Apply same patterns as body
        if (u_patternType == 1) { // Stripes
          float stripeWidth = 0.12;
          float stripeSpacing = 0.25;
          float pattern = step(mod(v_texCoord.y, stripeSpacing), stripeWidth);
          color = mix(u_baseColor, u_secondaryColor, pattern);
        } else if (u_patternType == 2) { // Diamond
          vec2 offset = abs(v_texCoord - center);
          float diamond = max(offset.x, offset.y);
          float pattern = step(diamond, 0.15) * (1.0 - step(diamond, 0.1));
          color = mix(u_baseColor, u_secondaryColor, pattern);
        }
        
        // Render eyes
        for (int i = 0; i < 2; i++) {
          vec2 eyePos = u_eyePositions[i];
          float eyeDist = length(v_texCoord - eyePos);
          float eyeRadius = 0.08 * u_eyeScale;
          
          if (eyeDist < eyeRadius) {
            // Eye white
            color = mix(color, vec3(0.9, 0.9, 0.8), 1.0 - smoothstep(eyeRadius * 0.7, eyeRadius, eyeDist));
            
            // Pupil
            float pupilRadius = eyeRadius * 0.4;
            if (eyeDist < pupilRadius) {
              color = mix(color, vec3(0.1, 0.1, 0.1), 1.0 - smoothstep(pupilRadius * 0.5, pupilRadius, eyeDist));
            }
          }
        }
        
        // Render forked tongue if extended
        if (u_tongueExtension > 0.0) {
          vec2 tongueStart = vec2(0.5, 0.7); // Front of head
          vec2 tongueDir = vec2(0.0, 1.0);
          
          // Main tongue body
          vec2 tongueEnd = tongueStart + tongueDir * (0.3 * u_tongueExtension);
          float tongueWidth = 0.02;
          
          // Distance to tongue line
          vec2 toPoint = v_texCoord - tongueStart;
          vec2 tongueVec = tongueEnd - tongueStart;
          float tongueLength = length(tongueVec);
          
          if (tongueLength > 0.0) {
            float t = clamp(dot(toPoint, tongueVec) / (tongueLength * tongueLength), 0.0, 1.0);
            vec2 projection = tongueStart + t * tongueVec;
            float distToTongue = length(v_texCoord - projection);
            
            if (distToTongue < tongueWidth && t > 0.0 && t < 1.0) {
              color = mix(color, vec3(0.8, 0.2, 0.3), 0.8); // Red tongue
            }
            
            // Forked tip
            if (t > 0.8) {
              vec2 fork1 = tongueEnd + vec2(-0.05, 0.05) * u_tongueExtension;
              vec2 fork2 = tongueEnd + vec2(0.05, 0.05) * u_tongueExtension;
              
              float distToFork1 = length(v_texCoord - fork1);
              float distToFork2 = length(v_texCoord - fork2);
              
              if (distToFork1 < tongueWidth * 0.7 || distToFork2 < tongueWidth * 0.7) {
                color = mix(color, vec3(0.8, 0.2, 0.3), 0.8);
              }
            }
          }
        }
        
        // Add gradient and glow effects
        float gradient = 1.0 - (headDist * 0.2);
        color *= gradient;
        
        if (u_glowIntensity > 0.0) {
          float glow = exp(-headDist * 2.5) * u_glowIntensity;
          color += vec3(glow * 0.3, glow * 0.4, glow * 0.6);
        }
        
        // Transformation effect
        if (u_transformationProgress > 0.0) {
          float transformGlow = sin(u_time * 12.0) * 0.5 + 0.5;
          color += vec3(transformGlow * u_transformationProgress * 0.7);
          alpha += transformGlow * u_transformationProgress * 0.4;
        }
        
        gl_FragColor = vec4(color, alpha);
      }
    `;this.segmentShaderProgram=this.createShaderProgram(e,i),this.headShaderProgram=this.createShaderProgram(n,r)}createShaderProgram(e,i){const n=this.gl;if(!n)return console.warn("WebGL context not available - running in test mode"),null;const r=this.compileShader(n.VERTEX_SHADER,e),o=this.compileShader(n.FRAGMENT_SHADER,i);if(!r||!o)return null;const s=n.createProgram();return s?(n.attachShader(s,r),n.attachShader(s,o),n.linkProgram(s),n.getProgramParameter(s,n.LINK_STATUS)?s:(console.error("Shader program linking failed:",n.getProgramInfoLog(s)),n.deleteProgram(s),null)):null}compileShader(e,i){const n=this.gl;if(!n)return null;const r=n.createShader(e);return r?(n.shaderSource(r,i),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(console.error("Shader compilation failed:",n.getShaderInfoLog(r)),n.deleteShader(r),null)):null}initializeBuffers(){const e=this.gl;if(!e){console.warn("WebGL context not available - skipping buffer initialization");return}const i=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,-.5,.5,0,1,.5,.5,1,1]);this.segmentVertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.segmentVertexBuffer),e.bufferData(e.ARRAY_BUFFER,i,e.STATIC_DRAW),this.headVertexBuffer=this.segmentVertexBuffer}update(e){this.tongueAnimationTime+=e/1e3,this.breathingTime+=e/1e3,this.transformationEffectTime+=e/1e3}render(e){!this.segmentShaderProgram||!this.headShaderProgram||!this.gl||(this.renderSegments(e),this.renderHead(e))}renderSegments(e){const i=this.gl;if(!i)return;const n=this.segmentShaderProgram;i.useProgram(n),i.bindBuffer(i.ARRAY_BUFFER,this.segmentVertexBuffer);const r=i.getAttribLocation(n,"a_position"),o=i.getAttribLocation(n,"a_texCoord");i.enableVertexAttribArray(r),i.enableVertexAttribArray(o),i.vertexAttribPointer(r,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(o,2,i.FLOAT,!1,16,8);const s=i.getUniformLocation(n,"u_resolution"),a=i.getUniformLocation(n,"u_baseColor"),l=i.getUniformLocation(n,"u_secondaryColor"),u=i.getUniformLocation(n,"u_glowIntensity"),d=i.getUniformLocation(n,"u_time"),m=i.getUniformLocation(n,"u_patternType"),p=i.getUniformLocation(n,"u_transformationProgress"),x=i.getUniformLocation(n,"u_transform"),S=i.getUniformLocation(n,"u_scale");i.uniform2f(s,this.canvas.width,this.canvas.height);const E=this.hexToRgb(e.visualPattern.baseColor),D=this.hexToRgb(e.visualPattern.secondaryColor);i.uniform3f(a,E.r,E.g,E.b),i.uniform3f(l,D.r,D.g,D.b),i.uniform1f(u,e.visualPattern.glowIntensity),i.uniform1f(d,this.transformationEffectTime),i.uniform1i(m,this.getPatternTypeId(e.visualPattern.patternType)),i.uniform1f(p,e.isTransforming?e.transformationProgress:0),e.segments.forEach((g,h)=>{const y=(g.interpolatedX??g.x)*this.cellSize+this.cellSize/2,w=(g.interpolatedY??g.y)*this.cellSize+this.cellSize/2;let M=g.scale;if(e.isIdle){const k=Math.max(.3,1-h*.1),A=Math.sin(e.breathingPhase-h*.2)*this.BREATHING_AMPLITUDE*k;M*=1+A}const P=this.createTransformMatrix(y,w,g.rotation);i.uniformMatrix3fv(x,!1,P),i.uniform1f(S,this.cellSize*this.SEGMENT_RADIUS*M),i.drawArrays(i.TRIANGLE_STRIP,0,4)})}renderHead(e){const i=this.gl;if(!i)return;const n=this.headShaderProgram;i.useProgram(n),i.bindBuffer(i.ARRAY_BUFFER,this.headVertexBuffer);const r=i.getAttribLocation(n,"a_position"),o=i.getAttribLocation(n,"a_texCoord");i.enableVertexAttribArray(r),i.enableVertexAttribArray(o),i.vertexAttribPointer(r,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(o,2,i.FLOAT,!1,16,8);const s=this.calculateHeadFeatures(e),a=i.getUniformLocation(n,"u_resolution"),l=i.getUniformLocation(n,"u_baseColor"),u=i.getUniformLocation(n,"u_secondaryColor"),d=i.getUniformLocation(n,"u_glowIntensity"),m=i.getUniformLocation(n,"u_time"),p=i.getUniformLocation(n,"u_patternType"),x=i.getUniformLocation(n,"u_transformationProgress"),S=i.getUniformLocation(n,"u_transform"),E=i.getUniformLocation(n,"u_scale"),D=i.getUniformLocation(n,"u_headScale"),g=i.getUniformLocation(n,"u_tongueExtension"),h=i.getUniformLocation(n,"u_eyePositions"),y=i.getUniformLocation(n,"u_eyeScale");i.uniform2f(a,this.canvas.width,this.canvas.height);const w=this.hexToRgb(e.visualPattern.baseColor),M=this.hexToRgb(e.visualPattern.secondaryColor);i.uniform3f(l,w.r,w.g,w.b),i.uniform3f(u,M.r,M.g,M.b),i.uniform1f(d,e.visualPattern.glowIntensity),i.uniform1f(m,this.transformationEffectTime),i.uniform1i(p,this.getPatternTypeId(e.visualPattern.patternType)),i.uniform1f(x,e.isTransforming?e.transformationProgress:0),i.uniform1f(g,s.tongueExtension),i.uniform2fv(h,[s.eyePositions[0].x,s.eyePositions[0].y,s.eyePositions[1].x,s.eyePositions[1].y]),i.uniform1f(y,s.eyeScale);const P=e.head,k=(P.interpolatedX??P.x)*this.cellSize+this.cellSize/2,A=(P.interpolatedY??P.y)*this.cellSize+this.cellSize/2;let G=P.scale*this.HEAD_SCALE_MULTIPLIER;if(e.isIdle){const ue=Math.sin(e.breathingPhase)*this.BREATHING_AMPLITUDE;G*=1+ue}const L=this.createTransformMatrix(k,A,P.rotation);i.uniformMatrix3fv(S,!1,L),i.uniform1f(E,this.cellSize*this.SEGMENT_RADIUS),i.uniform1f(D,G),i.drawArrays(i.TRIANGLE_STRIP,0,4)}calculateHeadFeatures(e){const i=this.tongueAnimationTime*this.TONGUE_FLICK_FREQUENCY,n=i-Math.floor(i);let r=0;if(n<this.TONGUE_FLICK_DURATION){const l=n/this.TONGUE_FLICK_DURATION;r=Math.sin(l*Math.PI)}const o=.15,s=[{x:.5-o,y:.35},{x:.5+o,y:.35}],a=Math.min(1.5,1+(e.evolutionLevel-1)*.1);return{eyePositions:s,tonguePosition:{x:.5,y:.7},tongueExtension:r,tongueAngle:0,eyeScale:a}}createTransformMatrix(e,i,n){const r=Math.cos(n),o=Math.sin(n);return new Float32Array([r,-o,e,o,r,i,0,0,1])}getPatternTypeId(e){switch(e){case"solid":return 0;case"stripes":return 1;case"diamond":return 2;case"scales":return 3;default:return 0}}hexToRgb(e){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16)/255,g:parseInt(i[2],16)/255,b:parseInt(i[3],16)/255}:{r:0,g:0,b:0}}createVisualState(e,i,n,r,o=!1,s=0,a=!1){return{head:e,segments:i,evolutionLevel:n,visualPattern:r,isTransforming:o,transformationProgress:s,isIdle:a,breathingPhase:this.breathingTime*this.BREATHING_FREQUENCY*2*Math.PI}}setQuality(e){console.log("Setting render quality:",e)}dispose(){const e=this.gl;e&&(this.segmentShaderProgram&&e.deleteProgram(this.segmentShaderProgram),this.headShaderProgram&&e.deleteProgram(this.headShaderProgram),this.segmentVertexBuffer&&e.deleteBuffer(this.segmentVertexBuffer))}}class tf{constructor(e=()=>performance.now()){c(this,"currentTransition",null);c(this,"TRANSITION_DURATION",2e3);c(this,"getTime");c(this,"EVOLUTION_PATTERNS",new Map([[1,{baseColor:"#4CAF50",secondaryColor:"#66BB6A",patternType:"solid",glowIntensity:0,scaleTexture:"basic",animationSpeed:1}],[2,{baseColor:"#4CAF50",secondaryColor:"#FFEB3B",patternType:"stripes",glowIntensity:.1,scaleTexture:"detailed",animationSpeed:1.1}],[3,{baseColor:"#795548",secondaryColor:"#FF5722",patternType:"diamond",glowIntensity:.2,scaleTexture:"diamond",animationSpeed:1.2}],[4,{baseColor:"#8D6E63",secondaryColor:"#3E2723",patternType:"reticulated",glowIntensity:.3,scaleTexture:"reticulated",animationSpeed:1}],[5,{baseColor:"#424242",secondaryColor:"#FFC107",patternType:"hooded",glowIntensity:.4,scaleTexture:"hooded",animationSpeed:1.3}],[6,{baseColor:"#2E7D32",secondaryColor:"#1B5E20",patternType:"aquatic",glowIntensity:.5,scaleTexture:"aquatic",animationSpeed:.9}],[7,{baseColor:"#E91E63",secondaryColor:"#9C27B0",patternType:"rainbow",glowIntensity:.6,scaleTexture:"iridescent",animationSpeed:1.4}],[8,{baseColor:"#3F51B5",secondaryColor:"#E8EAF6",patternType:"celestial",glowIntensity:.8,scaleTexture:"starry",animationSpeed:1.5}],[9,{baseColor:"#D32F2F",secondaryColor:"#FF9800",patternType:"draconic",glowIntensity:.9,scaleTexture:"draconic",animationSpeed:1.6}],[10,{baseColor:"#FFD700",secondaryColor:"#FFF8E1",patternType:"mystical",glowIntensity:1,scaleTexture:"mystical",animationSpeed:1.8}]]));this.getTime=e}getPatternForLevel(e){const i=this.EVOLUTION_PATTERNS.get(e);return i?{...i}:{...this.EVOLUTION_PATTERNS.get(1)}}startTransition(e,i){const n=this.getPatternForLevel(e),r=this.getPatternForLevel(i);this.currentTransition={fromPattern:n,toPattern:r,progress:0,duration:this.TRANSITION_DURATION,startTime:this.getTime()}}update(e){if(!this.currentTransition)return;const i=this.getTime()-this.currentTransition.startTime;this.currentTransition.progress=Math.min(1,i/this.currentTransition.duration),this.currentTransition.progress>=1&&(this.currentTransition=null)}getCurrentPattern(e){return this.currentTransition?this.interpolatePatterns(this.currentTransition.fromPattern,this.currentTransition.toPattern,this.currentTransition.progress):this.getPatternForLevel(e)}interpolatePatterns(e,i,n){const r=n*n*(3-2*n);return{baseColor:this.interpolateColor(e.baseColor,i.baseColor,r),secondaryColor:this.interpolateColor(e.secondaryColor,i.secondaryColor,r),patternType:r<.5?e.patternType:i.patternType,glowIntensity:this.lerp(e.glowIntensity,i.glowIntensity,r),scaleTexture:r<.5?e.scaleTexture:i.scaleTexture,animationSpeed:this.lerp(e.animationSpeed,i.animationSpeed,r)}}interpolateColor(e,i,n){const r=this.hexToRgb(e),o=this.hexToRgb(i),s=Math.round(this.lerp(r.r,o.r,n)),a=Math.round(this.lerp(r.g,o.g,n)),l=Math.round(this.lerp(r.b,o.b,n));return this.rgbToHex(s,a,l)}hexToRgb(e){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:{r:0,g:0,b:0}}rgbToHex(e,i,n){return"#"+((1<<24)+(e<<16)+(i<<8)+n).toString(16).slice(1)}lerp(e,i,n){return e+(i-e)*n}isTransitioning(){return this.currentTransition!==null}getTransitionProgress(){return this.currentTransition?this.currentTransition.progress:0}createCustomPattern(e,i,n,r=0,o="basic",s=1){return{baseColor:e,secondaryColor:i,patternType:n,glowIntensity:r,scaleTexture:o,animationSpeed:s}}registerPattern(e,i){this.EVOLUTION_PATTERNS.set(e,{...i})}getAllPatterns(){return new Map(this.EVOLUTION_PATTERNS)}validatePattern(e){const i=["solid","stripes","diamond","scales","reticulated","hooded","aquatic","rainbow","celestial","draconic","mystical"],n=["basic","detailed","diamond","reticulated","hooded","aquatic","iridescent","starry","draconic","mystical"];return this.isValidHexColor(e.baseColor)&&this.isValidHexColor(e.secondaryColor)&&i.includes(e.patternType)&&e.glowIntensity>=0&&e.glowIntensity<=2&&n.includes(e.scaleTexture)&&e.animationSpeed>0&&e.animationSpeed<=3}isValidHexColor(e){return/^#[0-9A-F]{6}$/i.test(e)}reset(){this.currentTransition=null}completeTransition(){this.currentTransition&&(this.currentTransition.progress=1,this.currentTransition=null)}}class nf{constructor(e){c(this,"canvas");c(this,"activeTouches",new Map);c(this,"gestureStartTime",0);c(this,"lastTapTime",0);c(this,"swipeThreshold",50);c(this,"tapThreshold",10);c(this,"holdThreshold",500);c(this,"doubleTapThreshold",300);c(this,"touchStartHandler");c(this,"touchMoveHandler");c(this,"touchEndHandler");c(this,"touchCancelHandler");c(this,"onDirectionChange");c(this,"onTailClick");c(this,"onPowerActivate");c(this,"onPause");c(this,"virtualControls");this.canvas=e,this.virtualControls={dpad:{center:{x:100,y:100},radius:60,visible:!1},powerButtons:[],pauseButton:{position:{x:50,y:50},radius:25}},this.touchStartHandler=this.handleTouchStart.bind(this),this.touchMoveHandler=this.handleTouchMove.bind(this),this.touchEndHandler=this.handleTouchEnd.bind(this),this.touchCancelHandler=this.handleTouchCancel.bind(this),this.attachEventListeners(),this.setupVirtualControls()}attachEventListeners(){if(typeof this.canvas.addEventListener!="function"){console.warn("Canvas does not support addEventListener - running in test mode");return}this.canvas.addEventListener("touchstart",this.touchStartHandler,{passive:!1}),this.canvas.addEventListener("touchmove",this.touchMoveHandler,{passive:!1}),this.canvas.addEventListener("touchend",this.touchEndHandler,{passive:!1}),this.canvas.addEventListener("touchcancel",this.touchCancelHandler,{passive:!1}),this.canvas.addEventListener("contextmenu",e=>e.preventDefault())}setupVirtualControls(){if(typeof this.canvas.getBoundingClientRect!="function"){this.virtualControls.dpad.center={x:100,y:400},this.virtualControls.pauseButton.position={x:450,y:50},this.setupPowerButtons();return}const e=this.canvas.getBoundingClientRect();this.virtualControls.dpad.center={x:e.width*.15,y:e.height*.85},this.virtualControls.pauseButton.position={x:e.width*.9,y:e.height*.1},this.setupPowerButtons()}setupPowerButtons(){const e=[v.SpeedBoost,v.VenomStrike,v.Constrict,v.HoodExpansion,v.AquaticMovement];if(typeof this.canvas.getBoundingClientRect!="function"){this.virtualControls.powerButtons=e.map((n,r)=>({position:{x:450,y:150+r*50},radius:20,powerType:n}));return}const i=this.canvas.getBoundingClientRect();this.virtualControls.powerButtons=e.map((n,r)=>({position:{x:i.width*.9,y:i.height*(.3+r*.1)},radius:20,powerType:n}))}handleTouchStart(e){e.preventDefault();const i=Array.from(e.changedTouches);this.gestureStartTime=Date.now();for(const n of i){this.activeTouches.set(n.identifier,n);const r=this.getTouchPosition(n);this.handleTouchInteraction(r,"start")}}handleTouchMove(e){e.preventDefault();const i=Array.from(e.changedTouches);for(const n of i)if(this.activeTouches.has(n.identifier)){this.activeTouches.set(n.identifier,n);const r=this.getTouchPosition(n);this.handleTouchInteraction(r,"move")}}handleTouchEnd(e){e.preventDefault();const i=Array.from(e.changedTouches),n=Date.now()-this.gestureStartTime;for(const r of i)if(this.activeTouches.has(r.identifier)){const o=this.activeTouches.get(r.identifier),s=this.getTouchPosition(r),a=this.getTouchPosition(o),l=this.analyzeGesture(a,s,n);this.handleGesture(l),this.activeTouches.delete(r.identifier)}}handleTouchCancel(e){e.preventDefault();const i=Array.from(e.changedTouches);for(const n of i)this.activeTouches.delete(n.identifier)}getTouchPosition(e){const i=this.canvas.getBoundingClientRect();return{x:e.clientX-i.left,y:e.clientY-i.top}}handleTouchInteraction(e,i){this.isInsideCircle(e,this.virtualControls.dpad.center,this.virtualControls.dpad.radius)&&(i==="start"||i==="move")&&this.handleDpadInteraction(e);for(const n of this.virtualControls.powerButtons)this.isInsideCircle(e,n.position,n.radius)&&i==="start"&&this.onPowerActivate&&this.onPowerActivate(n.powerType);this.isInsideCircle(e,this.virtualControls.pauseButton.position,this.virtualControls.pauseButton.radius)&&i==="start"&&this.onPause&&this.onPause()}handleDpadInteraction(e){const i=this.virtualControls.dpad.center,n=e.x-i.x,r=e.y-i.y,o=Math.sqrt(n*n+r*r);if(o>20){const s=n/o,a=r/o;let l={x:0,y:0};Math.abs(s)>Math.abs(a)?l.x=s>0?1:-1:l.y=a>0?1:-1,this.onDirectionChange&&this.onDirectionChange(l)}}analyzeGesture(e,i,n){const r=i.x-e.x,o=i.y-e.y,s=Math.sqrt(r*r+o*o);let a="tap";return n>this.holdThreshold&&s<this.tapThreshold?a="hold":s>this.swipeThreshold?a="swipe":s<this.tapThreshold&&(a="tap"),{type:a,startPosition:e,currentPosition:i,deltaPosition:{x:r,y:o},duration:n,distance:s}}handleGesture(e){switch(e.type){case"tap":this.handleTap(e);break;case"swipe":this.handleSwipe(e);break;case"hold":this.handleHold(e);break}}handleTap(e){const i=Date.now();i-this.lastTapTime<this.doubleTapThreshold&&this.onPause?this.onPause():this.onTailClick&&this.onTailClick(e.startPosition),this.lastTapTime=i}handleSwipe(e){const i=this.getSwipeDirection(e);this.onDirectionChange&&i.strength>.5&&this.onDirectionChange(i.direction)}handleHold(e){this.onPause&&this.onPause()}getSwipeDirection(e){const{deltaPosition:i,distance:n}=e,r=i.x/n,o=i.y/n;let s={x:0,y:0},a=0;return Math.abs(r)>Math.abs(o)?(s.x=r>0?1:-1,a=Math.abs(r)):(s.y=o>0?1:-1,a=Math.abs(o)),{direction:s,strength:a}}isInsideCircle(e,i,n){const r=e.x-i.x,o=e.y-i.y;return r*r+o*o<=n*n}showVirtualControls(e){this.virtualControls.dpad.visible=e}updateControlPositions(e,i){this.virtualControls.dpad.center={x:e*.15,y:i*.85},this.virtualControls.pauseButton.position={x:e*.9,y:i*.1},this.virtualControls.powerButtons.forEach((n,r)=>{n.position={x:e*.9,y:i*(.3+r*.1)}})}getVirtualControls(){return this.virtualControls}destroy(){typeof this.canvas.removeEventListener=="function"&&(this.canvas.removeEventListener("touchstart",this.touchStartHandler),this.canvas.removeEventListener("touchmove",this.touchMoveHandler),this.canvas.removeEventListener("touchend",this.touchEndHandler),this.canvas.removeEventListener("touchcancel",this.touchCancelHandler))}}class $s{constructor(){c(this,"browserInfo");c(this,"features");c(this,"polyfills",new Map);this.browserInfo=this.detectBrowser(),this.features=this.detectFeatures(),this.setupPolyfills()}detectBrowser(){const e=navigator.userAgent,i=navigator.platform;let n="Unknown",r="0",o="Unknown";if(e.includes("Chrome")&&!e.includes("Edg")){n="Chrome";const l=e.match(/Chrome\/(\d+)/);r=l?l[1]:"0",o="Blink"}else if(e.includes("Firefox")){n="Firefox";const l=e.match(/Firefox\/(\d+)/);r=l?l[1]:"0",o="Gecko"}else if(e.includes("Safari")&&!e.includes("Chrome")){n="Safari";const l=e.match(/Version\/(\d+)/);r=l?l[1]:"0",o="WebKit"}else if(e.includes("Edg")){n="Edge";const l=e.match(/Edg\/(\d+)/);r=l?l[1]:"0",o="Blink"}else if(e.includes("Opera")||e.includes("OPR")){n="Opera";const l=e.match(/(Opera|OPR)\/(\d+)/);r=l?l[2]:"0",o="Blink"}const s=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e),a=s&&/iPad|Android(?!.*Mobile)/i.test(e);return{name:n,version:r,engine:o,platform:i,isMobile:s,isTablet:a,supportsWebGL:this.testWebGLSupport(),supportsWebAudio:this.testWebAudioSupport(),supportsLocalStorage:this.testLocalStorageSupport(),supportsRequestAnimationFrame:this.testRequestAnimationFrameSupport(),supportsResizeObserver:this.testResizeObserverSupport(),supportsIntersectionObserver:this.testIntersectionObserverSupport()}}detectFeatures(){return{webgl:this.testWebGLSupport(),webAudio:this.testWebAudioSupport(),localStorage:this.testLocalStorageSupport(),requestAnimationFrame:this.testRequestAnimationFrameSupport(),resizeObserver:this.testResizeObserverSupport(),intersectionObserver:this.testIntersectionObserverSupport(),touchEvents:"ontouchstart"in window,pointerEvents:"onpointerdown"in window,gamepadAPI:"getGamepads"in navigator,fullscreenAPI:"requestFullscreen"in document.documentElement,visibilityAPI:"visibilityState"in document}}testWebGLSupport(){try{const e=document.createElement("canvas");return!!(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch{return!1}}testWebAudioSupport(){return!!(window.AudioContext||window.webkitAudioContext)}testLocalStorageSupport(){try{const e="test";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch{return!1}}testRequestAnimationFrameSupport(){return!!(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame)}testResizeObserverSupport(){return typeof ResizeObserver<"u"}testIntersectionObserverSupport(){return typeof IntersectionObserver<"u"}setupPolyfills(){this.setupRequestAnimationFramePolyfill(),this.setupPerformanceNowPolyfill(),this.setupConsolePolyfill(),this.setupArrayPolyfills(),this.setupObjectPolyfills()}setupRequestAnimationFramePolyfill(){if(!window.requestAnimationFrame){let e=0;window.requestAnimationFrame=i=>{const n=new Date().getTime(),r=Math.max(0,16-(n-e)),o=window.setTimeout(()=>{i(n+r)},r);return e=n+r,o},this.polyfills.set("requestAnimationFrame",!0)}window.cancelAnimationFrame||(window.cancelAnimationFrame=e=>{clearTimeout(e)})}setupPerformanceNowPolyfill(){if(window.performance||(window.performance={}),!window.performance.now){const e=Date.now();window.performance.now=()=>Date.now()-e,this.polyfills.set("performance.now",!0)}}setupConsolePolyfill(){window.console||(window.console={log:()=>{},warn:()=>{},error:()=>{},info:()=>{},debug:()=>{}},this.polyfills.set("console",!0))}setupArrayPolyfills(){Array.from||(Array.from=(e,i,n)=>{const r=Object(e),o=parseInt(r.length)||0,s=new Array(o);for(let a=0;a<o;a++)s[a]=i?i.call(n,r[a],a):r[a];return s},this.polyfills.set("Array.from",!0)),Array.prototype.includes||(Array.prototype.includes=function(e,i){const n=this.length,r=Math.max(i||0,0);for(let o=r;o<n;o++)if(this[o]===e)return!0;return!1},this.polyfills.set("Array.includes",!0))}setupObjectPolyfills(){Object.assign||(Object.assign=(e,...i)=>{if(e==null)throw new TypeError("Cannot convert undefined or null to object");const n=Object(e);for(let r=0;r<i.length;r++){const o=i[r];if(o!=null)for(const s in o)Object.prototype.hasOwnProperty.call(o,s)&&(n[s]=o[s])}return n},this.polyfills.set("Object.assign",!0))}getBrowserInfo(){return{...this.browserInfo}}getFeatures(){return{...this.features}}isFeatureSupported(e){return this.features[e]}getPolyfills(){return Array.from(this.polyfills.keys()).filter(e=>this.polyfills.get(e))}isModernBrowser(){const{name:e,version:i}=this.browserInfo,n=parseInt(i),r={Chrome:60,Firefox:55,Safari:12,Edge:79,Opera:47};return r[e]?n>=r[e]:!1}getRecommendedSettings(){const e=this.isModernBrowser(),{isMobile:i}=this.browserInfo;return{useWebGL:this.features.webgl&&e,useWebAudio:this.features.webAudio,enableAdvancedFeatures:e&&!i,particleQuality:i?"low":e?"high":"medium",enableTouchControls:this.features.touchEvents||i}}logCompatibilityInfo(){console.group("Browser Compatibility Information"),console.log("Browser:",this.browserInfo.name,this.browserInfo.version),console.log("Engine:",this.browserInfo.engine),console.log("Platform:",this.browserInfo.platform),console.log("Mobile:",this.browserInfo.isMobile),console.log("Modern Browser:",this.isModernBrowser()),console.log("Features:",this.features);const e=this.getPolyfills();e.length>0&&console.log("Active Polyfills:",e),console.log("Recommended Settings:",this.getRecommendedSettings()),console.groupEnd()}}class rf{constructor(e){c(this,"inputState");c(this,"keyDownHandler");c(this,"keyUpHandler");c(this,"mouseClickHandler");c(this,"touchStartHandler");c(this,"lastDirection");c(this,"lastSpaceState");c(this,"lastPowerKeyStates");c(this,"canvas");c(this,"touchInputManager");c(this,"browserCompatibility");c(this,"isTouchDevice");c(this,"onDirectionChange");c(this,"onPause");c(this,"onPowerActivate");c(this,"onTailClick");this.inputState={pressedKeys:new Set,currentDirection:{x:0,y:0}},this.lastDirection={x:0,y:0},this.lastSpaceState=!1,this.lastPowerKeyStates=new Map,this.canvas=e,this.browserCompatibility=new $s,this.isTouchDevice=this.browserCompatibility.getFeatures().touchEvents,this.keyDownHandler=this.handleKeyDown.bind(this),this.keyUpHandler=this.handleKeyUp.bind(this),this.mouseClickHandler=this.handleMouseClick.bind(this),this.touchStartHandler=this.handleTouchStart.bind(this),this.attachEventListeners(),this.setupTouchInput()}attachEventListeners(){document.addEventListener("keydown",this.keyDownHandler),document.addEventListener("keyup",this.keyUpHandler),this.canvas&&typeof this.canvas.addEventListener=="function"&&!this.isTouchDevice&&this.canvas.addEventListener("click",this.mouseClickHandler)}setupTouchInput(){this.canvas&&this.isTouchDevice&&(this.touchInputManager=new nf(this.canvas),this.touchInputManager.onDirectionChange=e=>{this.inputState.currentDirection=e,this.onDirectionChange&&this.onDirectionChange(e)},this.touchInputManager.onTailClick=e=>{this.onTailClick&&this.onTailClick(e)},this.touchInputManager.onPowerActivate=e=>{this.onPowerActivate&&this.onPowerActivate(e)},this.touchInputManager.onPause=()=>{this.onPause&&this.onPause()})}handleKeyDown(e){this.isGameKey(e.code)&&e.preventDefault(),this.inputState.pressedKeys.add(e.code),this.updateDirection()}handleKeyUp(e){this.inputState.pressedKeys.delete(e.code),this.updateDirection()}isGameKey(e){return Object.values(Be).includes(e)||this.isPowerKey(e)}isPowerKey(e){return["KeyQ","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight"].includes(e)}getPowerTypeFromKey(e){return{KeyQ:v.SpeedBoost,KeyE:v.VenomStrike,KeyR:v.Constrict,KeyT:v.HoodExpansion,KeyY:v.AquaticMovement,KeyU:v.ColorChange,KeyI:v.TimeWarp,KeyO:v.FireBreath,KeyP:v.TailConsumption,BracketLeft:v.PowerCycling,BracketRight:v.RealityManipulation}[e]||null}updateDirection(){const e=this.inputState.pressedKeys;let i={x:0,y:0};e.has(Be.W)||e.has(Be.ArrowUp)?i={x:0,y:-1}:e.has(Be.S)||e.has(Be.ArrowDown)?i={x:0,y:1}:e.has(Be.A)||e.has(Be.ArrowLeft)?i={x:-1,y:0}:(e.has(Be.D)||e.has(Be.ArrowRight))&&(i={x:1,y:0}),(i.x!==0||i.y!==0)&&(i.x!==this.inputState.currentDirection.x||i.y!==this.inputState.currentDirection.y)&&(this.inputState.currentDirection=i)}getCurrentDirection(){return{...this.inputState.currentDirection}}isKeyPressed(e){return this.inputState.pressedKeys.has(e)}isSpacePressed(){return this.inputState.pressedKeys.has(Be.Space)}getInputState(){return{pressedKeys:new Set(this.inputState.pressedKeys),currentDirection:{...this.inputState.currentDirection}}}update(e){const i=this.inputState.currentDirection;(i.x!==this.lastDirection.x||i.y!==this.lastDirection.y)&&((i.x!==0||i.y!==0)&&this.onDirectionChange&&this.onDirectionChange(i),this.lastDirection={...i});const n=this.isSpacePressed();n&&!this.lastSpaceState&&this.onPause&&this.onPause(),this.lastSpaceState=n,this.checkPowerKeys()}checkPowerKeys(){const e=["KeyQ","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight"];for(const i of e){const n=this.inputState.pressedKeys.has(i),r=this.lastPowerKeyStates.get(i)||!1;if(n&&!r&&this.onPowerActivate){const o=this.getPowerTypeFromKey(i);o&&this.onPowerActivate(o)}this.lastPowerKeyStates.set(i,n)}}handleMouseClick(e){if(!this.canvas||!this.onTailClick)return;const i=this.canvas.getBoundingClientRect(),n=e.clientX-i.left,r=e.clientY-i.top,o=this.canvas.width/i.width,s=this.canvas.height/i.height,a={x:n*o,y:r*s};this.onTailClick(a)}handleTouchStart(e){if(!this.canvas||!this.onTailClick)return;e.preventDefault();const i=e.touches[0];if(!i)return;const n=this.canvas.getBoundingClientRect(),r=i.clientX-n.left,o=i.clientY-n.top,s=this.canvas.width/n.width,a=this.canvas.height/n.height,l={x:r*s,y:o*a};this.onTailClick(l)}isTouchEnabled(){return this.isTouchDevice}getTouchInputManager(){return this.touchInputManager}updateTouchControlPositions(e,i){this.touchInputManager&&this.touchInputManager.updateControlPositions(e,i)}showVirtualControls(e){this.touchInputManager&&this.touchInputManager.showVirtualControls(e)}destroy(){document.removeEventListener("keydown",this.keyDownHandler),document.removeEventListener("keyup",this.keyUpHandler),this.canvas&&typeof this.canvas.removeEventListener=="function"&&this.canvas.removeEventListener("click",this.mouseClickHandler),this.touchInputManager&&this.touchInputManager.destroy()}}class of{constructor(e){c(this,"config");c(this,"state");c(this,"collisionSystem");this.config=e,this.collisionSystem=new Sc(e),this.state={obstacles:[],dynamicElements:[],interactiveFeatures:[]},this.initializeBasicObstacles(),this.initializeDynamicElements(),this.initializeInteractiveFeatures()}initializeBasicObstacles(){this.generateBasicLevel()}generateBasicLevel(){const e=[];this.addStonePillars(e),this.addCrystalFormations(e),this.addIceWalls(e),this.addMagicBarriers(e),this.state.obstacles=e}addStonePillars(e){[{x:5,y:5},{x:44,y:5},{x:5,y:29},{x:44,y:29},{x:15,y:12},{x:35,y:12},{x:25,y:20},{x:10,y:25},{x:40,y:25}].forEach((n,r)=>{e.push({id:`stone_pillar_${r}`,type:J.StonePillar,position:n,size:{x:1,y:1},isDestructible:!1,isActive:!0,health:100})})}addCrystalFormations(e){[{x:20,y:8},{x:30,y:8},{x:12,y:18},{x:38,y:18},{x:25,y:28}].forEach((n,r)=>{e.push({id:`crystal_formation_${r}`,type:J.CrystalFormation,position:n,size:{x:1,y:1},isDestructible:!0,requiredPower:"VenomStrike",isActive:!0,health:50})})}addIceWalls(e){const i=[{start:{x:8,y:15},end:{x:12,y:15}},{start:{x:38,y:15},end:{x:42,y:15}},{start:{x:25,y:5},end:{x:25,y:8}},{start:{x:25,y:26},end:{x:25,y:29}}];let n=0;i.forEach(r=>{if(r.start.x===r.end.x)for(let o=r.start.y;o<=r.end.y;o++)e.push({id:`ice_wall_${n++}`,type:J.IceWall,position:{x:r.start.x,y:o},size:{x:1,y:1},isDestructible:!0,requiredPower:"FireBreath",isActive:!0,health:30});else for(let o=r.start.x;o<=r.end.x;o++)e.push({id:`ice_wall_${n++}`,type:J.IceWall,position:{x:o,y:r.start.y},size:{x:1,y:1},isDestructible:!0,requiredPower:"FireBreath",isActive:!0,health:30})})}addMagicBarriers(e){[{x:18,y:10},{x:32,y:10},{x:15,y:22},{x:35,y:22}].forEach((n,r)=>{e.push({id:`magic_barrier_${r}`,type:J.MagicBarrier,position:n,size:{x:1,y:1},isDestructible:!1,requiredPower:"SpeedBoost",isActive:!0,health:void 0})})}update(e){this.updateDynamicElements(e),this.updateInteractiveFeatures(e),this.validateObstacles()}validateObstacles(){this.state.obstacles=this.state.obstacles.filter(e=>e.isActive&&(e.health===void 0||e.health>0))}checkObstacleCollision(e,i={x:1,y:1}){for(const n of this.state.obstacles){if(!n.isActive)continue;if(this.checkRectangleOverlap(e,i,n.position,n.size))return{hasCollision:!0,obstacle:n,penetrationDepth:1,collisionNormal:{x:0,y:-1}}}return{hasCollision:!1}}checkRectangleOverlap(e,i,n,r){return e.x<n.x+r.x&&e.x+i.x>n.x&&e.y<n.y+r.y&&e.y+i.y>n.y}checkSnakeObstacleCollision(e,i){const n=this.checkObstacleCollision(e);if(n.hasCollision)return n;for(const r of i){const o=this.checkObstacleCollision(r);if(o.hasCollision)return o}return{hasCollision:!1}}destroyObstacle(e,i){const n=this.state.obstacles.find(r=>r.id===e);return!n||!n.isActive||!n.isDestructible||n.requiredPower&&n.requiredPower!==i?!1:(n.isActive=!1,n.health=0,!0)}damageObstacle(e,i,n){const r=this.state.obstacles.find(o=>o.id===e);return!r||!r.isActive||!r.isDestructible||r.requiredPower&&r.requiredPower!==n?!1:(r.health!==void 0&&(r.health-=i,r.health<=0&&(r.isActive=!1,r.health=0)),!0)}getObstacles(){return this.state.obstacles.filter(e=>e.isActive)}getObstacleById(e){return this.state.obstacles.find(i=>i.id===e&&i.isActive)}getObstaclesInArea(e,i){return this.state.obstacles.filter(n=>{if(!n.isActive)return!1;const r=n.position.x+n.size.x-1,o=n.position.y+n.size.y-1;return n.position.x<=i.x&&r>=e.x&&n.position.y<=i.y&&o>=e.y})}getObstacleAt(e){return this.state.obstacles.find(i=>i.isActive?e.x>=i.position.x&&e.x<i.position.x+i.size.x&&e.y>=i.position.y&&e.y<i.position.y+i.size.y:!1)}clearObstacles(){this.state.obstacles=[]}addObstacle(e){this.state.obstacles.push(e)}removeObstacle(e){const i=this.state.obstacles.findIndex(n=>n.id===e);return i!==-1?(this.state.obstacles.splice(i,1),!0):!1}getEnvironmentState(){return{obstacles:[...this.state.obstacles],dynamicElements:[...this.state.dynamicElements],interactiveFeatures:[...this.state.interactiveFeatures]}}handlePowerInteraction(e){const i=this.getObstacleById(e.obstacleId);if(!i)return!1;switch(e.type){case"destroy":return this.destroyObstacle(e.obstacleId,e.powerType);case"damage":return this.damageObstacle(e.obstacleId,e.damage||50,e.powerType);case"phase":return i.type===J.MagicBarrier;default:return!1}}canPhaseThrough(e,i){const n=this.getObstacleById(e);return n?n.type===J.MagicBarrier&&i==="SpeedBoost"&&n.requiredPower==="SpeedBoost":!1}initializeDynamicElements(){const e=[];this.addWaterPools(e),this.addFlameGeysers(e),this.addMovingStoneBlocks(e),this.addPoisonGasClouds(e),this.addLightningStrikes(e),this.state.dynamicElements=e}addWaterPools(e){[{position:{x:8,y:8},size:{x:3,y:3}},{position:{x:35,y:8},size:{x:4,y:2}},{position:{x:15,y:25},size:{x:2,y:3}},{position:{x:30,y:22},size:{x:3,y:4}}].forEach((n,r)=>{e.push({id:`water_pool_${r}`,type:ie.WaterPool,position:n.position,size:n.size,isActive:!0,damage:0,requiredEvolutionLevel:6,activationTime:0,duration:-1,cooldownTime:0,lastActivation:0,currentPhase:"active",phaseTimer:0,visualData:{color:"#4A90E2",intensity:.7,animationSpeed:.5}})})}addFlameGeysers(e){[{x:12,y:15},{x:38,y:15},{x:25,y:10},{x:20,y:25}].forEach((n,r)=>{e.push({id:`flame_geyser_${r}`,type:ie.FlameGeyser,position:n,size:{x:1,y:1},isActive:!0,damage:25,activationTime:2e3,duration:1500,cooldownTime:4e3,lastActivation:Math.random()*6500,currentPhase:"inactive",phaseTimer:0,triggerCondition:{type:"timer",value:6500},visualData:{color:"#FF4500",intensity:1,particleCount:20,animationSpeed:2}})})}addMovingStoneBlocks(e){[{position:{x:5,y:12},path:[{x:5,y:12},{x:15,y:12},{x:5,y:12}]},{position:{x:40,y:18},path:[{x:40,y:18},{x:30,y:18},{x:40,y:18}]},{position:{x:25,y:5},path:[{x:25,y:5},{x:25,y:15},{x:25,y:5}]}].forEach((n,r)=>{e.push({id:`moving_stone_block_${r}`,type:ie.MovingStoneBlock,position:n.position,size:{x:2,y:2},isActive:!0,damage:30,activationTime:0,duration:-1,cooldownTime:0,lastActivation:0,currentPhase:"active",phaseTimer:0,movementPattern:{type:Ft.PingPong,speed:.5,path:n.path},currentTarget:n.path[1],pathIndex:0,movementTimer:0,visualData:{color:"#8B4513",intensity:.8}})})}addPoisonGasClouds(e){[{x:18,y:20},{x:32,y:12},{x:10,y:28}].forEach((n,r)=>{e.push({id:`poison_gas_cloud_${r}`,type:ie.PoisonGasCloud,position:n,size:{x:3,y:3},isActive:!0,damage:15,activationTime:1e3,duration:3e3,cooldownTime:5e3,lastActivation:Math.random()*9e3,currentPhase:"inactive",phaseTimer:0,triggerCondition:{type:"timer",value:9e3},movementPattern:{type:Ft.Random,speed:.2,bounds:{min:{x:n.x-2,y:n.y-2},max:{x:n.x+2,y:n.y+2}}},visualData:{color:"#9932CC",intensity:.6,particleCount:30,animationSpeed:.8}})})}addLightningStrikes(e){[{x:22,y:15},{x:28,y:15},{x:15,y:8},{x:35,y:25}].forEach((n,r)=>{e.push({id:`lightning_strike_${r}`,type:ie.LightningStrike,position:n,size:{x:1,y:1},isActive:!0,damage:40,activationTime:500,duration:200,cooldownTime:8e3,lastActivation:Math.random()*8700,currentPhase:"inactive",phaseTimer:0,triggerCondition:{type:"timer",value:8700},visualData:{color:"#FFFF00",intensity:1.5,particleCount:15,animationSpeed:5}})})}updateDynamicElements(e){for(const i of this.state.dynamicElements)i.isActive&&(this.updateElementPhase(i,e),i.movementPattern&&this.updateElementMovement(i,e))}updateElementPhase(e,i){var n;switch(e.phaseTimer+=i,e.currentPhase){case"inactive":if(((n=e.triggerCondition)==null?void 0:n.type)==="timer"){const r=e.triggerCondition.value,o=e.activationTime+e.duration+e.cooldownTime;e.phaseTimer>=r-o&&(e.currentPhase="warning",e.phaseTimer=0)}break;case"warning":e.phaseTimer>=e.activationTime&&(e.currentPhase="active",e.phaseTimer=0,e.lastActivation=Date.now());break;case"active":e.duration>0&&e.phaseTimer>=e.duration&&(e.currentPhase="cooldown",e.phaseTimer=0);break;case"cooldown":e.phaseTimer>=e.cooldownTime&&(e.currentPhase="inactive",e.phaseTimer=0);break}}updateElementMovement(e,i){const n=e.movementPattern;switch(e.movementTimer=(e.movementTimer||0)+i,n.type){case Ft.PingPong:this.updatePingPongMovement(e,n,i);break;case Ft.Circular:this.updateCircularMovement(e,n,i);break;case Ft.Random:this.updateRandomMovement(e,n,i);break;case Ft.Linear:this.updateLinearMovement(e,n,i);break}}updatePingPongMovement(e,i,n){if(!i.path||i.path.length<2)return;const r=i.speed*(n/1e3);e.pathIndex=e.pathIndex||0;const o=e.position,s=e.currentTarget||i.path[1],a=s.x-o.x,l=s.y-o.y,u=Math.sqrt(a*a+l*l);if(u<=r)e.position={...s},e.pathIndex=(e.pathIndex+1)%i.path.length,e.currentTarget=i.path[e.pathIndex];else{const d=a/u*r,m=l/u*r;e.position.x+=d,e.position.y+=m}}updateCircularMovement(e,i,n){if(!i.center||!i.radius)return;const r=i.speed/i.radius,o=e.movementTimer/1e3*r;e.position.x=i.center.x+Math.cos(o)*i.radius,e.position.y=i.center.y+Math.sin(o)*i.radius}updateRandomMovement(e,i,n){if(i.bounds){if(e.movementTimer>2e3){e.movementTimer=0;const r=i.speed*2,o=Math.random()*Math.PI*2,s=e.position.x+Math.cos(o)*r,a=e.position.y+Math.sin(o)*r;e.currentTarget={x:Math.max(i.bounds.min.x,Math.min(i.bounds.max.x,s)),y:Math.max(i.bounds.min.y,Math.min(i.bounds.max.y,a))}}if(e.currentTarget){const r=i.speed*(n/1e3),o=e.currentTarget.x-e.position.x,s=e.currentTarget.y-e.position.y,a=Math.sqrt(o*o+s*s);if(a>r){const l=o/a*r,u=s/a*r;e.position.x+=l,e.position.y+=u}}}}updateLinearMovement(e,i,n){if(!i.path||i.path.length<2)return;const r=i.speed*(n/1e3);e.pathIndex=e.pathIndex||0;const o=e.position,s=i.path[e.pathIndex],a=s.x-o.x,l=s.y-o.y,u=Math.sqrt(a*a+l*l);if(u<=r)e.position={...s},e.pathIndex=(e.pathIndex+1)%i.path.length;else{const d=a/u*r,m=l/u*r;e.position.x+=d,e.position.y+=m}}checkDynamicElementCollision(e,i,n={x:1,y:1}){for(const r of this.state.dynamicElements){if(!r.isActive)continue;if(this.checkRectangleOverlap(e,n,r.position,r.size)){let s=!1,a=0,l;switch(r.type){case ie.WaterPool:s=i>=(r.requiredEvolutionLevel||6),a=0;break;case ie.FlameGeyser:s=!1,a=r.currentPhase==="active"?r.damage:0,a>0&&(l=_.Poison);break;case ie.MovingStoneBlock:s=!1,a=r.damage;break;case ie.PoisonGasCloud:s=!0,a=r.currentPhase==="active"?r.damage:0,a>0&&(l=_.Poison);break;case ie.LightningStrike:s=!0,a=r.currentPhase==="active"?r.damage:0,a>0&&(l=_.SlowDown);break}return{hasCollision:!0,element:r,canPass:s,damage:a,effect:l}}}return{hasCollision:!1,canPass:!0,damage:0}}checkSnakeDynamicElementCollision(e,i,n){const r=this.checkDynamicElementCollision(e,n);if(r.hasCollision)return r;for(const o of i){const s=this.checkDynamicElementCollision(o,n);if(s.hasCollision&&!s.canPass)return s}return{hasCollision:!1,canPass:!0,damage:0}}getDynamicElements(){return this.state.dynamicElements.filter(e=>e.isActive)}getDynamicElementById(e){return this.state.dynamicElements.find(i=>i.id===e&&i.isActive)}getDynamicElementsInArea(e,i){return this.state.dynamicElements.filter(n=>{if(!n.isActive)return!1;const r=n.position.x+n.size.x-1,o=n.position.y+n.size.y-1;return n.position.x<=i.x&&r>=e.x&&n.position.y<=i.y&&o>=e.y})}addDynamicElement(e){this.state.dynamicElements.push(e)}removeDynamicElement(e){const i=this.state.dynamicElements.findIndex(n=>n.id===e);return i!==-1?(this.state.dynamicElements.splice(i,1),!0):!1}initializeInteractiveFeatures(){const e=[];this.addPressurePlates(e),this.addAncientSwitches(e),this.addMysticalPortals(e),this.state.interactiveFeatures=e}addPressurePlates(e){[{position:{x:10,y:10},connectedObstacles:["stone_pillar_4"]},{position:{x:40,y:10},connectedObstacles:["ice_wall_2","ice_wall_3"]},{position:{x:15,y:20},connectedObstacles:["crystal_formation_2"]},{position:{x:35,y:20},connectedObstacles:["magic_barrier_1"]}].forEach((n,r)=>{e.push({id:`pressure_plate_${r}`,type:ve.PressurePlate,position:n.position,size:{x:1,y:1},isActive:!0,isActivated:!1,requiresConstrictPower:!0,requiredWeight:8,activationProgress:0,lastActivationTime:0,activationDuration:5e3,cooldownTime:2e3,visualData:{baseColor:"#8B4513",activatedColor:"#FFD700",glowIntensity:.5,pulseSpeed:1,particleEffect:"pressure_activation"},connectedElements:n.connectedObstacles})})}addAncientSwitches(e){[{position:{x:5,y:15},requiredLength:12,connectedObstacles:["stone_pillar_0","stone_pillar_1"]},{position:{x:45,y:15},requiredLength:18,connectedObstacles:["ice_wall_8","ice_wall_9","ice_wall_10"]},{position:{x:25,y:5},requiredLength:25,connectedObstacles:["crystal_formation_0","crystal_formation_1"]},{position:{x:25,y:30},requiredLength:30,connectedObstacles:["magic_barrier_2","magic_barrier_3"]}].forEach((n,r)=>{e.push({id:`ancient_switch_${r}`,type:ve.AncientSwitch,position:n.position,size:{x:1,y:1},isActive:!0,isActivated:!1,requiredSnakeLength:n.requiredLength,activationProgress:0,lastActivationTime:0,activationDuration:1e4,cooldownTime:3e3,visualData:{baseColor:"#4A4A4A",activatedColor:"#00FFFF",glowIntensity:.8,pulseSpeed:.5,particleEffect:"ancient_runes"},connectedElements:n.connectedObstacles})})}addMysticalPortals(e){[{portal1:{position:{x:8,y:25},destination:{x:42,y:8}},portal2:{position:{x:42,y:8},destination:{x:8,y:25}},requiredLevel:7},{portal1:{position:{x:15,y:5},destination:{x:35,y:30}},portal2:{position:{x:35,y:30},destination:{x:15,y:5}},requiredLevel:8},{portal1:{position:{x:5,y:30},destination:{x:45,y:5}},portal2:{position:{x:45,y:5},destination:{x:5,y:30}},requiredLevel:9}].forEach((n,r)=>{e.push({id:`mystical_portal_${r}_a`,type:ve.MysticalPortal,position:n.portal1.position,size:{x:2,y:2},isActive:!0,isActivated:!1,requiredEvolutionLevel:n.requiredLevel,activationProgress:0,lastActivationTime:0,activationDuration:1e3,cooldownTime:5e3,visualData:{baseColor:"#9932CC",activatedColor:"#FF69B4",glowIntensity:1.2,pulseSpeed:2,particleEffect:"mystical_swirl"},teleportDestination:n.portal1.destination,unlockCondition:`evolution_level_${n.requiredLevel}`}),e.push({id:`mystical_portal_${r}_b`,type:ve.MysticalPortal,position:n.portal2.position,size:{x:2,y:2},isActive:!0,isActivated:!1,requiredEvolutionLevel:n.requiredLevel,activationProgress:0,lastActivationTime:0,activationDuration:1e3,cooldownTime:5e3,visualData:{baseColor:"#9932CC",activatedColor:"#FF69B4",glowIntensity:1.2,pulseSpeed:2,particleEffect:"mystical_swirl"},teleportDestination:n.portal2.destination,unlockCondition:`evolution_level_${n.requiredLevel}`})})}updateInteractiveFeatures(e){for(const i of this.state.interactiveFeatures)if(i.isActive)if(i.isActivated)i.activationProgress=Math.max(0,i.activationProgress-e/i.activationDuration),i.activationProgress<=0&&(i.isActivated=!1,i.lastActivationTime=Date.now(),this.reactivateConnectedElements(i));else{const n=Date.now()-i.lastActivationTime;if(n<i.cooldownTime){const r=n/i.cooldownTime;i.visualData.glowIntensity=.2+.3*r}else i.visualData.glowIntensity=.5+.3*Math.sin(Date.now()*i.visualData.pulseSpeed*.001)}}checkInteractiveFeatureCollision(e,i={x:1,y:1}){for(const n of this.state.interactiveFeatures){if(!n.isActive)continue;if(this.checkRectangleOverlap(e,i,n.position,n.size))return n}}activateInteractiveFeature(e,i,n,r){const o=this.state.interactiveFeatures.find(d=>d.id===e);if(!o||!o.isActive)return{success:!1,feature:o};const s=Date.now()-o.lastActivationTime;if(s<o.cooldownTime)return{success:!1,feature:o,message:`Feature is on cooldown for ${Math.ceil((o.cooldownTime-s)/1e3)} seconds`};let a=!1,l="";switch(o.type){case ve.PressurePlate:o.requiresConstrictPower&&r||o.requiredWeight&&i>=o.requiredWeight?a=!0:l=o.requiresConstrictPower?"Requires Constrict power (Python level 4+)":`Requires snake length of ${o.requiredWeight}+ segments`;break;case ve.AncientSwitch:o.requiredSnakeLength&&i>=o.requiredSnakeLength?a=!0:l=`Requires snake length of ${o.requiredSnakeLength}+ segments`;break;case ve.MysticalPortal:o.requiredEvolutionLevel&&n>=o.requiredEvolutionLevel?a=!0:l=`Requires evolution level ${o.requiredEvolutionLevel}+`;break}if(!a)return{success:!1,feature:o,message:l};o.isActivated=!0,o.activationProgress=1,o.lastActivationTime=Date.now();const u={};switch(o.type){case ve.PressurePlate:case ve.AncientSwitch:o.connectedElements&&(u.removeObstacles=[...o.connectedElements],this.deactivateConnectedElements(o));break;case ve.MysticalPortal:o.teleportDestination&&(u.teleportTo={...o.teleportDestination});break}return{success:!0,feature:o,message:`${o.type} activated!`,effects:u}}deactivateConnectedElements(e){if(e.connectedElements)for(const i of e.connectedElements){const n=this.state.obstacles.find(o=>o.id===i);n&&(n.isActive=!1);const r=this.state.dynamicElements.find(o=>o.id===i);r&&(r.isActive=!1)}}reactivateConnectedElements(e){if(e.connectedElements)for(const i of e.connectedElements){const n=this.state.obstacles.find(o=>o.id===i);n&&(n.isActive=!0);const r=this.state.dynamicElements.find(o=>o.id===i);r&&(r.isActive=!0)}}getInteractiveFeatures(){return this.state.interactiveFeatures.filter(e=>e.isActive)}getInteractiveFeatureById(e){return this.state.interactiveFeatures.find(i=>i.id===e&&i.isActive)}getInteractiveFeaturesInArea(e,i){return this.state.interactiveFeatures.filter(n=>{if(!n.isActive)return!1;const r=n.position.x+n.size.x-1,o=n.position.y+n.size.y-1;return n.position.x<=i.x&&r>=e.x&&n.position.y<=i.y&&o>=e.y})}addInteractiveFeature(e){this.state.interactiveFeatures.push(e)}removeInteractiveFeature(e){const i=this.state.interactiveFeatures.findIndex(n=>n.id===e);return i!==-1?(this.state.interactiveFeatures.splice(i,1),!0):!1}reset(){this.state={obstacles:[],dynamicElements:[],interactiveFeatures:[]},this.initializeBasicObstacles(),this.initializeDynamicElements(),this.initializeInteractiveFeatures()}}class sf{constructor(e){c(this,"gl");c(this,"canvas");c(this,"cellSize");c(this,"shaderProgram",null);c(this,"vertexBuffer",null);c(this,"colorBuffer",null);this.gl=e.gl,this.canvas=e.canvas,this.cellSize=e.cellSize,this.initializeShaders(),this.initializeBuffers()}initializeShaders(){const e=this.gl;if(!e){console.warn("WebGL context not available - skipping environment shader initialization");return}const i=`
      attribute vec2 a_position;
      attribute vec4 a_color;
      
      uniform vec2 u_resolution;
      
      varying vec4 v_color;
      
      void main() {
        // Convert from pixels to clip space
        vec2 clipSpace = ((a_position / u_resolution) * 2.0) - 1.0;
        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
        v_color = a_color;
      }
    `,n=`
      precision mediump float;
      
      varying vec4 v_color;
      
      void main() {
        gl_FragColor = v_color;
      }
    `,r=this.createShader(e.VERTEX_SHADER,i),o=this.createShader(e.FRAGMENT_SHADER,n);if(!r||!o)throw new Error("Failed to create shaders");if(this.shaderProgram=e.createProgram(),!this.shaderProgram)throw new Error("Failed to create shader program");if(e.attachShader(this.shaderProgram,r),e.attachShader(this.shaderProgram,o),e.linkProgram(this.shaderProgram),!e.getProgramParameter(this.shaderProgram,e.LINK_STATUS)){const s=e.getProgramInfoLog(this.shaderProgram);throw e.deleteProgram(this.shaderProgram),new Error(`Failed to link shader program: ${s}`)}}createShader(e,i){const n=this.gl;if(!n)return null;const r=n.createShader(e);if(!r)return null;if(n.shaderSource(r,i),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS)){const o=n.getShaderInfoLog(r);return n.deleteShader(r),console.error(`Shader compilation error: ${o}`),null}return r}initializeBuffers(){const e=this.gl;if(!e){console.warn("WebGL context not available - skipping environment buffer initialization");return}this.vertexBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer()}render(e,i=[],n=[]){if(!this.shaderProgram||!this.vertexBuffer||!this.colorBuffer)return;const r=this.gl;if(!r)return;r.useProgram(this.shaderProgram);const o=r.getUniformLocation(this.shaderProgram,"u_resolution");r.uniform2f(o,this.canvas.width,this.canvas.height);const s=[],a=[];if(e.forEach(d=>{if(!d.isActive)return;const m=this.getObstacleVertices(d),p=this.getObstacleColors(d);s.push(...m),a.push(...p)}),i.forEach(d=>{if(!d.isActive)return;const m=this.getDynamicElementVertices(d),p=this.getDynamicElementColors(d);s.push(...m),a.push(...p)}),n.forEach(d=>{if(!d.isActive)return;const m=this.getInteractiveFeatureVertices(d),p=this.getInteractiveFeatureColors(d);s.push(...m),a.push(...p)}),s.length===0)return;r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(s),r.DYNAMIC_DRAW);const l=r.getAttribLocation(this.shaderProgram,"a_position");r.enableVertexAttribArray(l),r.vertexAttribPointer(l,2,r.FLOAT,!1,0,0),r.bindBuffer(r.ARRAY_BUFFER,this.colorBuffer),r.bufferData(r.ARRAY_BUFFER,new Float32Array(a),r.DYNAMIC_DRAW);const u=r.getAttribLocation(this.shaderProgram,"a_color");r.enableVertexAttribArray(u),r.vertexAttribPointer(u,4,r.FLOAT,!1,0,0),r.drawArrays(r.TRIANGLES,0,s.length/2)}getObstacleVertices(e){const i=e.position.x*this.cellSize,n=e.position.y*this.cellSize,r=e.size.x*this.cellSize,o=e.size.y*this.cellSize;return[i,n,i+r,n,i,n+o,i+r,n,i+r,n+o,i,n+o]}getObstacleColors(e){let i;switch(e.type){case J.StonePillar:i=[.4,.4,.4,1];break;case J.CrystalFormation:i=[.6,.8,1,.8];break;case J.IceWall:i=[.8,.9,1,.9];break;case J.ThornBush:i=[.2,.6,.2,1];break;case J.MagicBarrier:i=[.8,.4,.8,.6];break;default:i=[.5,.5,.5,1]}if(e.health!==void 0&&e.health<100){const n=e.health/100;i[0]=Math.min(1,i[0]+(1-n)*.3)}return[...i,...i,...i,...i,...i,...i]}getDynamicElementVertices(e){const i=e.position.x*this.cellSize,n=e.position.y*this.cellSize,r=e.size.x*this.cellSize,o=e.size.y*this.cellSize;return[i,n,i+r,n,i,n+o,i+r,n,i+r,n+o,i,n+o]}getDynamicElementColors(e){var o;let i,n=1;switch(e.type){case ie.WaterPool:i=[.29,.56,.89,.7];break;case ie.FlameGeyser:i=[1,.27,0,1];break;case ie.MovingStoneBlock:i=[.55,.27,.07,1];break;case ie.PoisonGasCloud:i=[.6,.2,.8,.6];break;case ie.LightningStrike:i=[1,1,0,1];break;default:i=[.5,.5,.5,1]}switch(e.currentPhase){case"warning":n=.5+.5*Math.sin(Date.now()*.01),i[0]=Math.min(1,i[0]+.3);break;case"active":n=((o=e.visualData)==null?void 0:o.intensity)||1;break;case"cooldown":n=.3;break;case"inactive":n=.1;break}const r=[i[0]*n,i[1]*n,i[2]*n,i[3]];if(e.type===ie.LightningStrike&&e.currentPhase==="active"&&(r[0]=1,r[1]=1,r[2]=1,r[3]=1),e.type===ie.FlameGeyser&&e.currentPhase==="active"){const s=.8+.2*Math.sin(Date.now()*.02);r[0]*=s,r[1]*=s}return[...r,...r,...r,...r,...r,...r]}update(e){}getInteractiveFeatureVertices(e){const i=e.position.x*this.cellSize,n=e.position.y*this.cellSize,r=e.size.x*this.cellSize,o=e.size.y*this.cellSize;return[i,n,i+r,n,i,n+o,i+r,n,i+r,n+o,i,n+o]}getInteractiveFeatureColors(e){let i;if(e.isActivated){const n=this.hexToRgb(e.visualData.activatedColor);i=[n.r/255,n.g/255,n.b/255,1]}else{const n=this.hexToRgb(e.visualData.baseColor),r=e.visualData.glowIntensity;i=[n.r/255*r,n.g/255*r,n.b/255*r,.8]}switch(e.type){case ve.PressurePlate:i[0]=Math.min(1,i[0]+.1),i[1]=Math.min(1,i[1]+.1),i[2]=Math.min(1,i[2]+.05);break;case ve.AncientSwitch:i[0]=Math.max(.2,i[0]-.1),i[1]=Math.max(.2,i[1]-.1),i[2]=Math.max(.2,i[2]-.1);break;case ve.MysticalPortal:const n=Date.now()*.001,r=.5+.3*Math.sin(n*e.visualData.pulseSpeed);i[0]=Math.min(1,i[0]*r),i[1]=Math.min(1,i[1]*r),i[2]=Math.min(1,i[2]*r),i[3]=.9;break}return[...i,...i,...i,...i,...i,...i]}hexToRgb(e){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:{r:0,g:0,b:0}}setQuality(e){console.log("Setting environment render quality:",e)}dispose(){const e=this.gl;e&&(this.shaderProgram&&(e.deleteProgram(this.shaderProgram),this.shaderProgram=null),this.vertexBuffer&&(e.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null),this.colorBuffer&&(e.deleteBuffer(this.colorBuffer),this.colorBuffer=null))}}var wc=(t=>(t.SpeedTrail="SpeedTrail",t.VenomSpark="VenomSpark",t.FireBreath="FireBreath",t.TimeWarpRipple="TimeWarpRipple",t.InvisibilityShimmer="InvisibilityShimmer",t.EvolutionGlow="EvolutionGlow",t.TransformationSparkle="TransformationSparkle",t.MysticalRune="MysticalRune",t.CrystalShard="CrystalShard",t.IceFragment="IceFragment",t.StoneDust="StoneDust",t.FlameExplosion="FlameExplosion",t.Sparkle="Sparkle",t.Glow="Glow",t.Smoke="Smoke",t.Magic="Magic",t.Explosion="Explosion",t.Poison="Poison",t.TailConsumptionSpiral="TailConsumptionSpiral",t.MysticalDissolve="MysticalDissolve",t.OuroborosRune="OuroborosRune",t.MysticalMist="MysticalMist",t.FloatingDust="FloatingDust",t.FallingLeaves="FallingLeaves",t.AncientRunes="AncientRunes",t.CrystalGlimmer="CrystalGlimmer",t.TempleEmbers="TempleEmbers",t))(wc||{});class nl{constructor(e,i={}){c(this,"particles",[]);c(this,"particlePool",[]);c(this,"emitters",new Map);c(this,"particleDefinitions",new Map);c(this,"config");c(this,"nextParticleId",0);c(this,"activeParticleCount",0);c(this,"gl");c(this,"shaderProgram",null);c(this,"vertexBuffer",null);c(this,"colorBuffer",null);c(this,"sizeBuffer",null);c(this,"vertexData");c(this,"colorData");c(this,"sizeData");c(this,"maxBatchSize");this.gl=e,this.config={maxParticles:i.maxParticles||2e3,poolGrowthSize:i.poolGrowthSize||100,enableBatching:i.enableBatching!==!1,enableCulling:i.enableCulling!==!1,cullDistance:i.cullDistance||1e3},this.maxBatchSize=this.config.maxParticles,this.vertexData=new Float32Array(this.maxBatchSize*2),this.colorData=new Float32Array(this.maxBatchSize*4),this.sizeData=new Float32Array(this.maxBatchSize),this.initializeParticleDefinitions(),this.initializeWebGL(),this.initializeParticlePool()}initializeParticleDefinitions(){this.particleDefinitions.set("SpeedTrail",{type:"SpeedTrail",lifetime:.5,size:8,sizeVariation:2,speed:50,speedVariation:20,color:[.3,.8,1,.8],colorVariation:[.1,.1,.1,.2],gravity:0,fadeRate:2,scaleRate:-1.5,rotationSpeed:0,blendMode:"additive"}),this.particleDefinitions.set("VenomSpark",{type:"VenomSpark",lifetime:.8,size:6,sizeVariation:3,speed:80,speedVariation:30,color:[.6,.2,.8,1],colorVariation:[.2,.1,.1,0],gravity:-20,fadeRate:1.5,scaleRate:-.8,rotationSpeed:5,blendMode:"additive"}),this.particleDefinitions.set("FireBreath",{type:"FireBreath",lifetime:1.2,size:12,sizeVariation:6,speed:120,speedVariation:40,color:[1,.4,.1,.9],colorVariation:[0,.3,.2,.1],gravity:-10,fadeRate:1,scaleRate:.5,rotationSpeed:2,blendMode:"additive"}),this.particleDefinitions.set("TimeWarpRipple",{type:"TimeWarpRipple",lifetime:2,size:20,sizeVariation:5,speed:30,speedVariation:10,color:[.8,.9,1,.6],colorVariation:[.1,.1,0,.2],gravity:0,fadeRate:.8,scaleRate:2,rotationSpeed:1,blendMode:"normal"}),this.particleDefinitions.set("InvisibilityShimmer",{type:"InvisibilityShimmer",lifetime:.6,size:4,sizeVariation:2,speed:20,speedVariation:15,color:[1,1,1,.4],colorVariation:[0,0,0,.2],gravity:0,fadeRate:2.5,scaleRate:0,rotationSpeed:8,blendMode:"additive"}),this.particleDefinitions.set("EvolutionGlow",{type:"EvolutionGlow",lifetime:3,size:15,sizeVariation:8,speed:40,speedVariation:20,color:[1,.8,.3,.8],colorVariation:[0,.2,.3,.1],gravity:-5,fadeRate:.5,scaleRate:1.2,rotationSpeed:1.5,blendMode:"additive"}),this.particleDefinitions.set("TransformationSparkle",{type:"TransformationSparkle",lifetime:2.5,size:8,sizeVariation:4,speed:60,speedVariation:30,color:[.9,.9,1,1],colorVariation:[.1,.1,0,0],gravity:0,fadeRate:1,scaleRate:-.5,rotationSpeed:10,blendMode:"additive"}),this.particleDefinitions.set("MysticalRune",{type:"MysticalRune",lifetime:4,size:25,sizeVariation:5,speed:15,speedVariation:8,color:[.7,.3,.9,.7],colorVariation:[.2,.1,.1,.1],gravity:0,fadeRate:.3,scaleRate:.8,rotationSpeed:.5,blendMode:"additive"}),this.particleDefinitions.set("CrystalShard",{type:"CrystalShard",lifetime:2,size:10,sizeVariation:5,speed:100,speedVariation:50,color:[.6,.8,1,.9],colorVariation:[.1,.1,0,.1],gravity:150,fadeRate:1.2,scaleRate:-.3,rotationSpeed:15,blendMode:"normal"}),this.particleDefinitions.set("IceFragment",{type:"IceFragment",lifetime:1.8,size:8,sizeVariation:4,speed:90,speedVariation:40,color:[.8,.9,1,.8],colorVariation:[.1,.1,0,.1],gravity:120,fadeRate:1.5,scaleRate:-.5,rotationSpeed:12,blendMode:"normal"}),this.particleDefinitions.set("StoneDust",{type:"StoneDust",lifetime:1.5,size:6,sizeVariation:3,speed:70,speedVariation:35,color:[.5,.4,.3,.7],colorVariation:[.1,.1,.1,.1],gravity:80,fadeRate:1.8,scaleRate:-.8,rotationSpeed:8,blendMode:"normal"}),this.particleDefinitions.set("FlameExplosion",{type:"FlameExplosion",lifetime:1,size:18,sizeVariation:8,speed:150,speedVariation:60,color:[1,.3,0,1],colorVariation:[0,.4,.2,0],gravity:-30,fadeRate:2,scaleRate:1.5,rotationSpeed:3,blendMode:"additive"}),this.particleDefinitions.set("Sparkle",{type:"Sparkle",lifetime:1.5,size:6,sizeVariation:3,speed:40,speedVariation:20,color:[1,1,.8,1],colorVariation:[0,0,.2,0],gravity:0,fadeRate:1,scaleRate:0,rotationSpeed:5,blendMode:"additive"}),this.particleDefinitions.set("Glow",{type:"Glow",lifetime:2,size:12,sizeVariation:4,speed:20,speedVariation:10,color:[.8,.9,1,.6],colorVariation:[.1,.1,0,.1],gravity:0,fadeRate:.8,scaleRate:.5,rotationSpeed:1,blendMode:"additive"}),this.particleDefinitions.set("Smoke",{type:"Smoke",lifetime:3,size:16,sizeVariation:8,speed:30,speedVariation:15,color:[.4,.4,.4,.5],colorVariation:[.1,.1,.1,.1],gravity:-20,fadeRate:.6,scaleRate:1,rotationSpeed:.5,blendMode:"normal"}),this.particleDefinitions.set("Magic",{type:"Magic",lifetime:2.5,size:10,sizeVariation:5,speed:50,speedVariation:25,color:[.9,.5,1,.8],colorVariation:[.1,.2,0,.1],gravity:-10,fadeRate:1.2,scaleRate:.3,rotationSpeed:8,blendMode:"additive"}),this.particleDefinitions.set("Explosion",{type:"Explosion",lifetime:1.5,size:15,sizeVariation:8,speed:120,speedVariation:50,color:[1,.6,.2,1],colorVariation:[0,.2,.3,0],gravity:20,fadeRate:1.8,scaleRate:1.2,rotationSpeed:10,blendMode:"additive"}),this.particleDefinitions.set("Poison",{type:"Poison",lifetime:2,size:8,sizeVariation:4,speed:40,speedVariation:20,color:[.4,.8,.2,.8],colorVariation:[.2,.1,.1,.1],gravity:-15,fadeRate:1.5,scaleRate:.5,rotationSpeed:6,blendMode:"additive"}),this.particleDefinitions.set("TailConsumptionSpiral",{type:"TailConsumptionSpiral",lifetime:3,size:12,sizeVariation:4,speed:80,speedVariation:20,color:[1,.8,.2,.9],colorVariation:[0,.1,.1,.1],gravity:0,fadeRate:1.5,scaleRate:.8,rotationSpeed:12,blendMode:"additive"}),this.particleDefinitions.set("MysticalDissolve",{type:"MysticalDissolve",lifetime:2,size:8,sizeVariation:3,speed:30,speedVariation:15,color:[.8,.9,1,.7],colorVariation:[.1,.1,0,.2],gravity:-20,fadeRate:2,scaleRate:.5,rotationSpeed:6,blendMode:"additive"}),this.particleDefinitions.set("OuroborosRune",{type:"OuroborosRune",lifetime:4,size:15,sizeVariation:5,speed:20,speedVariation:10,color:[1,.9,.3,1],colorVariation:[0,.1,.2,0],gravity:0,fadeRate:.8,scaleRate:1.2,rotationSpeed:3,blendMode:"additive"}),this.particleDefinitions.set("MysticalMist",{type:"MysticalMist",lifetime:8,size:20,sizeVariation:10,speed:15,speedVariation:8,color:[.7,.8,.9,.3],colorVariation:[.1,.1,.1,.1],gravity:-5,fadeRate:.4,scaleRate:.8,rotationSpeed:.5,blendMode:"normal"}),this.particleDefinitions.set("FloatingDust",{type:"FloatingDust",lifetime:12,size:3,sizeVariation:2,speed:8,speedVariation:5,color:[.8,.7,.6,.4],colorVariation:[.1,.1,.1,.1],gravity:-2,fadeRate:.3,scaleRate:.2,rotationSpeed:1,blendMode:"normal"}),this.particleDefinitions.set("FallingLeaves",{type:"FallingLeaves",lifetime:6,size:8,sizeVariation:4,speed:25,speedVariation:15,color:[.4,.6,.2,.8],colorVariation:[.2,.2,.1,.1],gravity:30,fadeRate:.8,scaleRate:-.2,rotationSpeed:4,blendMode:"normal"}),this.particleDefinitions.set("AncientRunes",{type:"AncientRunes",lifetime:10,size:12,sizeVariation:6,speed:10,speedVariation:5,color:[.9,.7,.3,.6],colorVariation:[.1,.1,.1,.1],gravity:0,fadeRate:.5,scaleRate:.3,rotationSpeed:1,blendMode:"additive"}),this.particleDefinitions.set("CrystalGlimmer",{type:"CrystalGlimmer",lifetime:3,size:6,sizeVariation:3,speed:20,speedVariation:10,color:[.8,.9,1,.9],colorVariation:[.1,.1,0,.1],gravity:0,fadeRate:1.5,scaleRate:.5,rotationSpeed:8,blendMode:"additive"}),this.particleDefinitions.set("TempleEmbers",{type:"TempleEmbers",lifetime:5,size:4,sizeVariation:2,speed:12,speedVariation:8,color:[1,.6,.2,.7],colorVariation:[0,.2,.1,.1],gravity:-15,fadeRate:1,scaleRate:-.3,rotationSpeed:2,blendMode:"additive"})}initializeWebGL(){const e=this.gl;if(!e){console.warn("WebGL context not available - skipping particle system WebGL initialization");return}const i=`
      attribute vec2 a_position;
      attribute vec4 a_color;
      attribute float a_size;
      
      uniform vec2 u_resolution;
      
      varying vec4 v_color;
      
      void main() {
        vec2 clipSpace = ((a_position / u_resolution) * 2.0) - 1.0;
        gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
        gl_PointSize = a_size;
        v_color = a_color;
      }
    `,n=`
      precision mediump float;
      
      varying vec4 v_color;
      
      void main() {
        vec2 center = gl_PointCoord - vec2(0.5, 0.5);
        float dist = length(center);
        
        // Create circular particle with soft edges
        float alpha = 1.0 - smoothstep(0.3, 0.5, dist);
        
        if (alpha < 0.01) {
          discard;
        }
        
        gl_FragColor = vec4(v_color.rgb, v_color.a * alpha);
      }
    `,r=this.compileShader(e.VERTEX_SHADER,i),o=this.compileShader(e.FRAGMENT_SHADER,n);if(!r||!o)throw new Error("Failed to compile particle shaders");if(this.shaderProgram=e.createProgram(),!this.shaderProgram)throw new Error("Failed to create particle shader program");if(e.attachShader(this.shaderProgram,r),e.attachShader(this.shaderProgram,o),e.linkProgram(this.shaderProgram),!e.getProgramParameter(this.shaderProgram,e.LINK_STATUS)){const s=e.getProgramInfoLog(this.shaderProgram);throw e.deleteProgram(this.shaderProgram),new Error(`Failed to link particle shader program: ${s}`)}this.vertexBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.sizeBuffer=e.createBuffer()}compileShader(e,i){const n=this.gl;if(!n)return null;const r=n.createShader(e);if(!r)return null;if(n.shaderSource(r,i),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS)){const o=n.getShaderInfoLog(r);return n.deleteShader(r),console.error(`Particle shader compilation error: ${o}`),null}return r}initializeParticlePool(){for(let e=0;e<this.config.poolGrowthSize;e++)this.particlePool.push(this.createParticle())}createParticle(){return{id:this.nextParticleId++,type:"Sparkle",position:{x:0,y:0},velocity:{x:0,y:0},size:1,color:[1,1,1,1],lifetime:0,maxLifetime:1,rotation:0,rotationSpeed:0,gravity:0,fadeRate:1,scaleRate:0,isActive:!1}}getParticleFromPool(){if(this.particlePool.length===0)if(this.activeParticleCount<this.config.maxParticles)for(let e=0;e<this.config.poolGrowthSize;e++)this.particlePool.push(this.createParticle());else return null;return this.particlePool.pop()||null}returnParticleToPool(e){e.isActive=!1,this.particlePool.push(e),this.activeParticleCount--}createEmitter(e,i,n,r,o=-1,s={x:0,y:-1},a=Math.PI/4){const l={id:e,position:{...i},type:n,emissionRate:r,duration:o,direction:{...s},spread:a,isActive:!0,timeActive:0,lastEmissionTime:0};return this.emitters.set(e,l),l}createBurst(e,i,n,r={x:0,y:-1},o=Math.PI*2){const s=this.particleDefinitions.get(i);if(s)for(let a=0;a<n;a++){const l=this.getParticleFromPool();if(!l)break;this.initializeParticle(l,e,i,r,o,s),this.particles.push(l),this.activeParticleCount++}}initializeParticle(e,i,n,r,o,s){e.type=n,e.position={...i},e.isActive=!0;const a=Math.atan2(r.y,r.x)+(Math.random()-.5)*o,l=s.speed+(Math.random()-.5)*s.speedVariation;e.velocity={x:Math.cos(a)*l,y:Math.sin(a)*l},e.size=s.size+(Math.random()-.5)*s.sizeVariation,e.lifetime=s.lifetime,e.maxLifetime=s.lifetime,e.rotation=Math.random()*Math.PI*2,e.rotationSpeed=s.rotationSpeed+(Math.random()-.5)*s.rotationSpeed*.5,e.gravity=s.gravity,e.fadeRate=s.fadeRate,e.scaleRate=s.scaleRate,e.color=[Math.max(0,Math.min(1,s.color[0]+(Math.random()-.5)*s.colorVariation[0])),Math.max(0,Math.min(1,s.color[1]+(Math.random()-.5)*s.colorVariation[1])),Math.max(0,Math.min(1,s.color[2]+(Math.random()-.5)*s.colorVariation[2])),Math.max(0,Math.min(1,s.color[3]+(Math.random()-.5)*s.colorVariation[3]))]}update(e){const i=e/1e3;this.updateEmitters(i),this.updateParticles(i),this.cleanupParticles()}updateEmitters(e){for(const[i,n]of this.emitters){if(!n.isActive)continue;if(n.timeActive+=e,n.duration>0&&n.timeActive>=n.duration){n.isActive=!1;continue}const r=n.timeActive-n.lastEmissionTime,o=1/n.emissionRate;if(r>=o){const s=Math.floor(r/o);for(let a=0;a<s;a++){const l=this.getParticleFromPool();if(!l)break;const u=this.particleDefinitions.get(n.type);u&&(this.initializeParticle(l,n.position,n.type,n.direction,n.spread,u),this.particles.push(l),this.activeParticleCount++)}n.lastEmissionTime=n.timeActive}}}updateParticles(e){for(const i of this.particles){if(!i.isActive)continue;if(i.lifetime-=e,i.lifetime<=0){i.isActive=!1;continue}i.position.x+=i.velocity.x*e,i.position.y+=i.velocity.y*e,i.velocity.y+=i.gravity*e,i.rotation+=i.rotationSpeed*e,i.size+=i.scaleRate*e,i.size=Math.max(0,i.size);const n=i.lifetime/i.maxLifetime,r=Math.pow(n,i.fadeRate);i.color[3]=i.color[3]*r}}cleanupParticles(){for(let e=this.particles.length-1;e>=0;e--){const i=this.particles[e];i.isActive||(this.particles.splice(e,1),this.returnParticleToPool(i))}}render(e={x:0,y:0}){if(!this.shaderProgram||this.particles.length===0)return;const i=this.gl;if(!i)return;let n=0;const r=this.config.cullDistance*this.config.cullDistance;for(const u of this.particles){if(!u.isActive||n>=this.maxBatchSize)continue;if(this.config.enableCulling){const p=u.position.x-e.x,x=u.position.y-e.y;if(p*p+x*x>r)continue}const d=n*2,m=n*4;this.vertexData[d]=u.position.x,this.vertexData[d+1]=u.position.y,this.colorData[m]=u.color[0],this.colorData[m+1]=u.color[1],this.colorData[m+2]=u.color[2],this.colorData[m+3]=u.color[3],this.sizeData[n]=u.size,n++}if(n===0)return;i.useProgram(this.shaderProgram);const o=i.getUniformLocation(this.shaderProgram,"u_resolution");i.uniform2f(o,i.canvas.width,i.canvas.height),i.bindBuffer(i.ARRAY_BUFFER,this.vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.vertexData.subarray(0,n*2),i.DYNAMIC_DRAW);const s=i.getAttribLocation(this.shaderProgram,"a_position");i.enableVertexAttribArray(s),i.vertexAttribPointer(s,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),i.bufferData(i.ARRAY_BUFFER,this.colorData.subarray(0,n*4),i.DYNAMIC_DRAW);const a=i.getAttribLocation(this.shaderProgram,"a_color");i.enableVertexAttribArray(a),i.vertexAttribPointer(a,4,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.sizeBuffer),i.bufferData(i.ARRAY_BUFFER,this.sizeData.subarray(0,n),i.DYNAMIC_DRAW);const l=i.getAttribLocation(this.shaderProgram,"a_size");i.enableVertexAttribArray(l),i.vertexAttribPointer(l,1,i.FLOAT,!1,0,0),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.drawArrays(i.POINTS,0,n)}createSpeedTrailEffect(e,i){this.createBurst(e,"SpeedTrail",3,i,Math.PI/6)}createVenomStrikeEffect(e,i){this.createBurst(e,"VenomSpark",8,i,Math.PI/3)}createFireBreathEffect(e,i){const n={x:i.x-e.x,y:i.y-e.y},r=Math.sqrt(n.x*n.x+n.y*n.y);if(r>0){n.x/=r,n.y/=r;const o=Math.floor(r/20);for(let s=0;s<=o;s++){const a=s/o,l={x:e.x+n.x*r*a,y:e.y+n.y*r*a};this.createBurst(l,"FireBreath",5,n,Math.PI/4)}}}createTimeWarpEffect(e,i){this.createBurst(e,"TimeWarpRipple",12,{x:0,y:0},Math.PI*2);for(let n=1;n<3;n++)setTimeout(()=>{this.createBurst(e,"TimeWarpRipple",12,{x:0,y:0},Math.PI*2)},n*200)}createInvisibilityEffect(e){const i=`invisibility_${Date.now()}`;this.createEmitter(i,e,"InvisibilityShimmer",15,2)}createEvolutionTransformationEffect(e,i,n){this.createBurst(e,"EvolutionGlow",20,{x:0,y:0},Math.PI*2),setTimeout(()=>{this.createBurst(e,"TransformationSparkle",15,{x:0,y:0},Math.PI*2)},500),n>=7&&setTimeout(()=>{this.createBurst(e,"MysticalRune",8,{x:0,y:0},Math.PI*2)},1e3)}createCrystalDestructionEffect(e){this.createBurst(e,"CrystalShard",12,{x:0,y:-1},Math.PI)}createIceDestructionEffect(e){this.createBurst(e,"IceFragment",10,{x:0,y:-1},Math.PI)}createStoneDestructionEffect(e){this.createBurst(e,"StoneDust",15,{x:0,y:-1},Math.PI)}createFlameExplosionEffect(e){this.createBurst(e,"FlameExplosion",20,{x:0,y:0},Math.PI*2)}createTailConsumptionEffect(e,i){const n=Math.min(30,i*8);for(let o=0;o<n;o++){const s=o/n*Math.PI*4,a=20+o/n*60,l={x:e.x+Math.cos(s)*a,y:e.y+Math.sin(s)*a},u={x:Math.cos(s+Math.PI/2),y:Math.sin(s+Math.PI/2)};setTimeout(()=>{this.createBurst(l,"TailConsumptionSpiral",1,u,0)},o*50)}this.createBurst(e,"OuroborosRune",8,{x:0,y:0},Math.PI*2);const r=Math.min(5,Math.ceil(i/2));for(let o=0;o<r;o++)setTimeout(()=>{this.createBurst(e,"Magic",6,{x:0,y:0},Math.PI*2)},o*300)}createMysticalDissolveEffect(e){this.createBurst(e,"MysticalDissolve",8,{x:0,y:0},Math.PI*2),setTimeout(()=>{this.createBurst(e,"Sparkle",4,{x:0,y:0},Math.PI*2)},200)}createDeathEffect(e,i){switch(i){case"SelfCollision":this.createBurst(e,"Explosion",15,{x:0,y:0},Math.PI*2);break;case"WallCollision":this.createBurst(e,"StoneDust",12,{x:0,y:-1},Math.PI);break;case"ObstacleCollision":this.createBurst(e,"CrystalShard",10,{x:0,y:-1},Math.PI);break;case"EnvironmentalHazard":this.createBurst(e,"FlameExplosion",18,{x:0,y:0},Math.PI*2);break;case"PoisonEffect":this.createBurst(e,"Poison",12,{x:0,y:0},Math.PI*2);break;default:this.createBurst(e,"Explosion",15,{x:0,y:0},Math.PI*2)}setTimeout(()=>{this.createBurst(e,"Sparkle",8,{x:0,y:0},Math.PI*2)},300)}createWeatherEffect(e,i){const n=`weather_${e}_${Date.now()}`;switch(e){case"mystical_forest":this.createEmitter(`${n}_mist`,{x:Math.random()*i.width,y:-20},"MysticalMist",2,-1,{x:0,y:1},Math.PI/8),this.createEmitter(`${n}_leaves`,{x:Math.random()*i.width,y:-20},"FallingLeaves",1,-1,{x:.2,y:1},Math.PI/6);break;case"ancient_temple":this.createEmitter(`${n}_dust`,{x:Math.random()*i.width,y:i.height+20},"FloatingDust",3,-1,{x:0,y:-1},Math.PI/4),this.createEmitter(`${n}_runes`,{x:Math.random()*i.width,y:Math.random()*i.height},"AncientRunes",.5,-1,{x:0,y:-1},Math.PI*2),this.createEmitter(`${n}_embers`,{x:Math.random()*i.width,y:i.height+20},"TempleEmbers",1.5,-1,{x:0,y:-1},Math.PI/3);break;case"crystal_cavern":this.createEmitter(`${n}_glimmer`,{x:Math.random()*i.width,y:Math.random()*i.height},"CrystalGlimmer",2,-1,{x:0,y:0},Math.PI*2),this.createEmitter(`${n}_mist`,{x:Math.random()*i.width,y:i.height+20},"MysticalMist",1,-1,{x:0,y:-1},Math.PI/6);break;default:this.createEmitter(`${n}_dust`,{x:Math.random()*i.width,y:i.height+20},"FloatingDust",2,-1,{x:0,y:-1},Math.PI/4)}return n}stopWeatherEffect(e){for(const[i,n]of this.emitters)i.startsWith(e)&&(n.isActive=!1)}createAmbientParticles(e){const i=`ambient_${Date.now()}`;this.createEmitter(`${i}_dust`,{x:Math.random()*e.width,y:Math.random()*e.height},"FloatingDust",.5,-1,{x:0,y:-1},Math.PI*2),this.createEmitter(`${i}_sparkles`,{x:Math.random()*e.width,y:Math.random()*e.height},"Sparkle",.2,-1,{x:0,y:0},Math.PI*2)}removeEmitter(e){this.emitters.delete(e)}updateEmitterPosition(e,i){const n=this.emitters.get(e);n&&(n.position={...i})}getActiveParticleCount(){return this.activeParticleCount}getPoolSize(){return this.particlePool.length}getPerformanceStats(){return{activeParticles:this.activeParticleCount,poolSize:this.particlePool.length,emitterCount:this.emitters.size,maxParticles:this.config.maxParticles}}clear(){this.particles.forEach(e=>{this.returnParticleToPool(e)}),this.particles=[],this.activeParticleCount=0,this.emitters.clear()}setMaxParticles(e){if(e!==this.config.maxParticles&&(this.config.maxParticles=e,this.maxBatchSize=e,this.vertexData=new Float32Array(this.maxBatchSize*2),this.colorData=new Float32Array(this.maxBatchSize*4),this.sizeData=new Float32Array(this.maxBatchSize),this.particles.length>e)){const i=this.particles.splice(e);this.particlePool.push(...i),this.activeParticleCount=Math.min(this.activeParticleCount,e)}}setEffectsEnabled(e){e||this.clear()}getMaxParticles(){return this.config.maxParticles}getMemoryUsage(){const i=this.vertexData.byteLength+this.colorData.byteLength+this.sizeData.byteLength;return(this.particles.length+this.particlePool.length)*32+i}optimizeMemory(){const e=Math.min(this.config.poolGrowthSize*2,this.config.maxParticles/4);this.particlePool.length>e&&this.particlePool.splice(e),this.particles.length>this.activeParticleCount*1.5&&(this.particles=this.particles.filter(i=>i.isActive))}dispose(){const e=this.gl;e&&(this.shaderProgram&&(e.deleteProgram(this.shaderProgram),this.shaderProgram=null),this.vertexBuffer&&(e.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null),this.colorBuffer&&(e.deleteBuffer(this.colorBuffer),this.colorBuffer=null),this.sizeBuffer&&(e.deleteBuffer(this.sizeBuffer),this.sizeBuffer=null),this.particles.length=0,this.particlePool.length=0,this.emitters.clear())}}class af{constructor(){c(this,"scoreState");c(this,"scoreHistory",[]);c(this,"highScores",[]);c(this,"STORAGE_KEY","ouroboros-high-scores");c(this,"MAX_HIGH_SCORES",10);c(this,"COMBO_TIME_WINDOW",3e3);c(this,"SURVIVAL_BONUS_INTERVAL",3e4);this.scoreState=this.initializeScoreState(),this.loadHighScores()}initializeScoreState(){return{currentScore:0,highScore:0,evolutionLevelMultiplier:1,comboMultiplier:1,comboCount:0,lastScoreTime:0,totalFoodConsumed:0,evolutionBonuses:0,powerUsageBonuses:0,survivalTimeBonus:0,gameStartTime:Date.now()}}startNewGame(){this.scoreState=this.initializeScoreState(),this.scoreHistory=[],this.updateHighScore()}addFoodConsumptionScore(e,i,n){const r=i.pointsAwarded,o=this.calculateEvolutionMultiplier(n),s=this.updateComboMultiplier(),a=Math.floor(r*o*s);this.scoreState.currentScore+=a,this.scoreState.totalFoodConsumed++,this.scoreState.evolutionLevelMultiplier=o,this.scoreState.comboMultiplier=s,this.scoreState.lastScoreTime=Date.now();const l={type:Lt.FoodConsumption,points:a,multiplier:o*s,timestamp:Date.now(),description:`Consumed ${e}`,evolutionLevel:n};return this.scoreHistory.push(l),this.updateHighScore(),a}addEvolutionBonus(e,i){const r=Math.pow(2,i-1),o=Math.floor(1e3*r);this.scoreState.currentScore+=o,this.scoreState.evolutionBonuses+=o,this.resetCombo();const s={type:Lt.Evolution,points:o,multiplier:r,timestamp:Date.now(),description:`Evolved to level ${i}`,evolutionLevel:i};return this.scoreHistory.push(s),this.updateHighScore(),o}addPowerUsageBonus(e,i,n){if(!n)return 0;const r=this.getPowerBaseBonus(e),o=this.calculateEvolutionMultiplier(i),s=Math.floor(r*o);this.scoreState.currentScore+=s,this.scoreState.powerUsageBonuses+=s;const a={type:Lt.PowerUsage,points:s,multiplier:o,timestamp:Date.now(),description:`Used ${e} effectively`,evolutionLevel:i};return this.scoreHistory.push(a),this.updateHighScore(),s}addTailConsumptionBonus(e,i){const n=e.bonusPoints,r=e.mysticalEnergy*10,o=n+r;this.scoreState.currentScore+=o;const s={type:Lt.TailConsumption,points:o,multiplier:1,timestamp:Date.now(),description:"Ouroboros tail consumption",evolutionLevel:i};return this.scoreHistory.push(s),this.updateHighScore(),o}addSurvivalTimeBonus(){const e=this.getSurvivalTime(),i=Math.floor(e/6e4),n=i*500;if(n>this.scoreState.survivalTimeBonus){const r=n-this.scoreState.survivalTimeBonus;this.scoreState.currentScore+=r,this.scoreState.survivalTimeBonus=n;const o={type:Lt.SurvivalTime,points:r,multiplier:1,timestamp:Date.now(),description:`Survived ${i} minutes`,evolutionLevel:0};return this.scoreHistory.push(o),this.updateHighScore(),r}return 0}calculateEvolutionMultiplier(e){return 1+(e-1)*.2}updateComboMultiplier(){return Date.now()-this.scoreState.lastScoreTime<=this.COMBO_TIME_WINDOW?(this.scoreState.comboCount++,this.scoreState.comboMultiplier=Math.min(1+this.scoreState.comboCount*.1,3)):this.resetCombo(),this.scoreState.comboMultiplier}resetCombo(){this.scoreState.comboCount=0,this.scoreState.comboMultiplier=1}getPowerBaseBonus(e){return{[v.SpeedBoost]:100,[v.VenomStrike]:200,[v.Constrict]:150,[v.HoodExpansion]:250,[v.AquaticMovement]:300,[v.ColorChange]:350,[v.TimeWarp]:500,[v.FireBreath]:750,[v.TailConsumption]:1e3,[v.PowerCycling]:1200,[v.RealityManipulation]:1500}[e]||100}updateHighScore(){this.scoreState.currentScore>this.scoreState.highScore&&(this.scoreState.highScore=this.scoreState.currentScore)}saveHighScore(e,i){const n=Date.now(),r=n-this.scoreState.gameStartTime,o={score:this.scoreState.currentScore,evolutionLevel:e,survivalTime:r,foodConsumed:this.scoreState.totalFoodConsumed,timestamp:n,playerName:i};this.highScores.push(o),this.highScores.sort((s,a)=>a.score-s.score),this.highScores=this.highScores.slice(0,this.MAX_HIGH_SCORES),this.persistHighScores()}loadHighScores(){try{const e=localStorage.getItem(this.STORAGE_KEY);e&&(this.highScores=JSON.parse(e),this.highScores.length>0&&(this.scoreState.highScore=this.highScores[0].score))}catch(e){console.warn("Failed to load high scores from localStorage:",e),this.highScores=[]}}persistHighScores(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.highScores))}catch(e){console.warn("Failed to save high scores to localStorage:",e)}}getScoreState(){return{...this.scoreState}}getHighScores(){return[...this.highScores]}getScoreHistory(){return[...this.scoreHistory]}getCurrentScore(){return this.scoreState.currentScore}getHighScore(){return this.scoreState.highScore}getComboInfo(){return{count:this.scoreState.comboCount,multiplier:this.scoreState.comboMultiplier}}getSurvivalTime(){return Date.now()-this.scoreState.gameStartTime}getFormattedSurvivalTime(){const e=this.getSurvivalTime(),i=Math.floor(e/6e4),n=Math.floor(e%6e4/1e3);return`${i}:${n.toString().padStart(2,"0")}`}shouldAwardSurvivalBonus(){const e=this.getSurvivalTime(),i=Math.floor(e/6e4),n=Math.floor(this.scoreState.survivalTimeBonus/500);return i>n}addPoints(e){this.scoreState.currentScore+=e,this.updateHighScore();const i={type:Lt.FoodConsumption,points:e,multiplier:1,timestamp:Date.now(),description:`Manual points addition: ${e}`,evolutionLevel:1};this.scoreHistory.push(i),this.scoreState.lastScoreTime=Date.now()}reset(){this.scoreState=this.initializeScoreState(),this.scoreHistory=[]}}class lf{constructor(e,i){c(this,"gameState");c(this,"gameOverState");c(this,"scoreSystem");c(this,"config");c(this,"pauseCallbacks",[]);c(this,"resumeCallbacks",[]);c(this,"gameOverCallbacks",[]);c(this,"deathAnimationTimer",0);c(this,"lastSurvivalBonusCheck",0);c(this,"accumulatedTime",0);c(this,"SURVIVAL_BONUS_CHECK_INTERVAL",3e4);this.scoreSystem=e,this.config={deathAnimationDuration:2e3,pauseOnFocusLoss:!0,enableAutoSave:!0,...i},this.gameState={isRunning:!1,isPaused:!1,lastFrameTime:0,deltaTime:0,fps:0},this.gameOverState={isGameOver:!1,deathReason:se.SelfCollision,finalScore:0,finalEvolutionLevel:1,survivalTime:0,deathAnimation:{isPlaying:!1,progress:0,duration:this.config.deathAnimationDuration}},this.setupEventListeners()}setupEventListeners(){this.config.pauseOnFocusLoss&&(window.addEventListener("blur",()=>{this.gameState.isRunning&&!this.gameState.isPaused&&!this.gameOverState.isGameOver&&this.pause()}),document.addEventListener("visibilitychange",()=>{document.hidden&&this.gameState.isRunning&&!this.gameState.isPaused&&!this.gameOverState.isGameOver&&this.pause()})),document.addEventListener("keydown",e=>{e.code==="Space"&&!this.gameOverState.isGameOver&&(e.preventDefault(),this.togglePause())})}startGame(){this.gameState.isRunning=!0,this.gameState.isPaused=!1,this.gameState.lastFrameTime=performance.now(),this.lastSurvivalBonusCheck=0,this.accumulatedTime=0,this.gameOverState.isGameOver=!1,this.gameOverState.deathAnimation.isPlaying=!1,this.gameOverState.deathAnimation.progress=0,this.scoreSystem.startNewGame()}stopGame(){this.gameState.isRunning=!1,this.gameState.isPaused=!1}pause(){!this.gameState.isRunning||this.gameOverState.isGameOver||(this.gameState.isPaused=!0,this.pauseCallbacks.forEach(e=>e()))}resume(){!this.gameState.isRunning||this.gameOverState.isGameOver||(this.gameState.isPaused=!1,this.gameState.lastFrameTime=performance.now(),this.resumeCallbacks.forEach(e=>e()))}togglePause(){this.gameState.isPaused?this.resume():this.pause()}triggerGameOver(e,i,n){if(this.gameOverState.isGameOver)return;const r=this.scoreSystem.getScoreState();this.gameOverState={isGameOver:!0,deathReason:e,finalScore:r.currentScore,finalEvolutionLevel:i,survivalTime:this.scoreSystem.getSurvivalTime(),deathAnimation:{isPlaying:!0,progress:0,duration:this.config.deathAnimationDuration}},this.scoreSystem.saveHighScore(i),this.deathAnimationTimer=0,this.gameOverCallbacks.forEach(o=>o(this.gameOverState)),console.log(`Game Over: ${e}, Final Score: ${this.gameOverState.finalScore}, Evolution Level: ${i}`)}update(e){this.gameState.deltaTime=e,this.gameState.fps=1e3/e,this.gameOverState.deathAnimation.isPlaying&&(this.deathAnimationTimer+=e,this.gameOverState.deathAnimation.progress=Math.min(this.deathAnimationTimer/this.gameOverState.deathAnimation.duration,1),this.gameOverState.deathAnimation.progress>=1&&(this.gameOverState.deathAnimation.isPlaying=!1)),!this.gameOverState.isGameOver&&!this.gameState.isPaused&&(this.accumulatedTime+=e,this.checkSurvivalTimeBonus())}checkSurvivalTimeBonus(){if(this.accumulatedTime-this.lastSurvivalBonusCheck>=this.SURVIVAL_BONUS_CHECK_INTERVAL){if(this.scoreSystem.shouldAwardSurvivalBonus()){const e=this.scoreSystem.addSurvivalTimeBonus();e>0&&console.log(`Survival time bonus awarded: ${e} points`)}this.lastSurvivalBonusCheck=this.accumulatedTime}}restartGame(){this.gameOverState={isGameOver:!1,deathReason:se.SelfCollision,finalScore:0,finalEvolutionLevel:1,survivalTime:0,deathAnimation:{isPlaying:!1,progress:0,duration:this.config.deathAnimationDuration}},this.deathAnimationTimer=0,this.accumulatedTime=0,this.lastSurvivalBonusCheck=0,this.startGame()}getGameState(){return{...this.gameState}}getGameOverState(){return{...this.gameOverState}}isGameRunning(){return this.gameState.isRunning}isGamePaused(){return this.gameState.isPaused}isGameOver(){return this.gameOverState.isGameOver}isDeathAnimationPlaying(){return this.gameOverState.deathAnimation.isPlaying}getDeathAnimationProgress(){return this.gameOverState.deathAnimation.progress}getFPS(){return this.gameState.fps}getDeltaTime(){return this.gameState.deltaTime}getDeathReason(){return this.gameOverState.deathReason}getDeathReasonMessage(){return{[se.SelfCollision]:"The serpent consumed itself in confusion",[se.WallCollision]:"The serpent struck the ancient barriers",[se.ObstacleCollision]:"The serpent was blocked by mystical obstacles",[se.EnvironmentalHazard]:"The serpent succumbed to environmental dangers",[se.PoisonEffect]:"The serpent was overcome by toxic effects"}[this.gameOverState.deathReason]||"The serpent's journey has ended"}onPause(e){this.pauseCallbacks.push(e)}onResume(e){this.resumeCallbacks.push(e)}onGameOver(e){this.gameOverCallbacks.push(e)}removePauseCallback(e){const i=this.pauseCallbacks.indexOf(e);i>-1&&this.pauseCallbacks.splice(i,1)}removeResumeCallback(e){const i=this.resumeCallbacks.indexOf(e);i>-1&&this.resumeCallbacks.splice(i,1)}removeGameOverCallback(e){const i=this.gameOverCallbacks.indexOf(e);i>-1&&this.gameOverCallbacks.splice(i,1)}dispose(){this.pauseCallbacks=[],this.resumeCallbacks=[],this.gameOverCallbacks=[],document.removeEventListener("keydown",this.togglePause),window.removeEventListener("blur",this.pause),document.removeEventListener("visibilitychange",this.pause)}}class uf{constructor(){c(this,"frameCount",0);c(this,"lastFrameTime",0);c(this,"frameTimeHistory",[]);c(this,"HISTORY_SIZE",60);c(this,"TARGET_FPS",60);c(this,"MIN_ACCEPTABLE_FPS",45);c(this,"FRAME_DROP_THRESHOLD",5);c(this,"currentMetrics",{fps:60,frameTime:16.67,memoryUsage:0,particleCount:0,renderCalls:0,audioLatency:0});c(this,"currentQuality",{particleQuality:"high",lightingQuality:"high",textureQuality:"high",shadowQuality:"high",effectsEnabled:!0});c(this,"frameDropCount",0);c(this,"qualityAdjustmentCooldown",0);c(this,"QUALITY_ADJUSTMENT_COOLDOWN",3e3);c(this,"onQualityChange")}setQualityChangeCallback(e){this.onQualityChange=e}startFrame(){this.lastFrameTime=performance.now()}endFrame(){const i=performance.now()-this.lastFrameTime;if(this.frameTimeHistory.push(i),this.frameTimeHistory.length>this.HISTORY_SIZE&&this.frameTimeHistory.shift(),this.frameCount++,this.frameTimeHistory.length>=10){const n=this.frameTimeHistory.reduce((r,o)=>r+o,0)/this.frameTimeHistory.length;this.currentMetrics.fps=1e3/n,this.currentMetrics.frameTime=n,this.checkPerformanceAndAdjustQuality()}}checkPerformanceAndAdjustQuality(){if(this.qualityAdjustmentCooldown>0){this.qualityAdjustmentCooldown-=this.currentMetrics.frameTime;return}this.currentMetrics.fps<this.MIN_ACCEPTABLE_FPS?(this.frameDropCount++,this.frameDropCount>=this.FRAME_DROP_THRESHOLD&&(this.reduceGraphicsQuality(),this.frameDropCount=0,this.qualityAdjustmentCooldown=this.QUALITY_ADJUSTMENT_COOLDOWN)):this.currentMetrics.fps>this.TARGET_FPS+5?(this.frameDropCount=Math.max(0,this.frameDropCount-1),this.frameDropCount===0&&this.canIncreaseQuality()&&(this.increaseGraphicsQuality(),this.qualityAdjustmentCooldown=this.QUALITY_ADJUSTMENT_COOLDOWN)):this.frameDropCount=Math.max(0,this.frameDropCount-1)}reduceGraphicsQuality(){let e=!1;this.currentQuality.shadowQuality!=="low"?(this.currentQuality.shadowQuality=this.currentQuality.shadowQuality==="high"?"medium":"low",e=!0):this.currentQuality.particleQuality!=="low"?(this.currentQuality.particleQuality=this.currentQuality.particleQuality==="high"?"medium":"low",e=!0):this.currentQuality.lightingQuality!=="low"?(this.currentQuality.lightingQuality=this.currentQuality.lightingQuality==="high"?"medium":"low",e=!0):this.currentQuality.effectsEnabled?(this.currentQuality.effectsEnabled=!1,e=!0):this.currentQuality.textureQuality!=="low"&&(this.currentQuality.textureQuality=this.currentQuality.textureQuality==="high"?"medium":"low",e=!0),e&&this.onQualityChange&&(console.warn("Performance degraded, reducing graphics quality:",this.currentQuality),this.onQualityChange(this.currentQuality))}increaseGraphicsQuality(){let e=!1;this.currentQuality.textureQuality!=="high"?(this.currentQuality.textureQuality=this.currentQuality.textureQuality==="low"?"medium":"high",e=!0):this.currentQuality.effectsEnabled?this.currentQuality.lightingQuality!=="high"?(this.currentQuality.lightingQuality=this.currentQuality.lightingQuality==="low"?"medium":"high",e=!0):this.currentQuality.particleQuality!=="high"?(this.currentQuality.particleQuality=this.currentQuality.particleQuality==="low"?"medium":"high",e=!0):this.currentQuality.shadowQuality!=="high"&&(this.currentQuality.shadowQuality=this.currentQuality.shadowQuality==="low"?"medium":"high",e=!0):(this.currentQuality.effectsEnabled=!0,e=!0),e&&this.onQualityChange&&(console.log("Performance improved, increasing graphics quality:",this.currentQuality),this.onQualityChange(this.currentQuality))}canIncreaseQuality(){return this.currentQuality.textureQuality!=="high"||!this.currentQuality.effectsEnabled||this.currentQuality.lightingQuality!=="high"||this.currentQuality.particleQuality!=="high"||this.currentQuality.shadowQuality!=="high"}updateMetrics(e){Object.assign(this.currentMetrics,e)}getMetrics(){return{...this.currentMetrics}}getQuality(){return{...this.currentQuality}}setQuality(e){Object.assign(this.currentQuality,e),this.onQualityChange&&this.onQualityChange(this.currentQuality)}getMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize/(1024*1024):0}reset(){this.frameCount=0,this.frameTimeHistory=[],this.frameDropCount=0,this.qualityAdjustmentCooldown=0,this.currentMetrics={fps:60,frameTime:16.67,memoryUsage:0,particleCount:0,renderCalls:0,audioLatency:0}}}class cf{constructor(e,i,n=1e3){c(this,"pool",[]);c(this,"active",new Set);c(this,"createFn");c(this,"resetFn");c(this,"maxSize");this.createFn=e,this.resetFn=i,this.maxSize=n}acquire(){let e;return this.pool.length>0?e=this.pool.pop():e=this.createFn(),this.active.add(e),e}release(e){this.active.has(e)&&(this.active.delete(e),this.resetFn&&this.resetFn(e),this.pool.length<this.maxSize&&this.pool.push(e))}clear(){this.pool=[],this.active.clear()}size(){return this.pool.length}activeCount(){return this.active.size}preAllocate(e){for(let i=0;i<e&&this.pool.length<this.maxSize;i++)this.pool.push(this.createFn())}}class df{constructor(e,i=256){c(this,"textures",new Map);c(this,"gl");c(this,"maxTextureMemory");c(this,"currentMemoryUsage",0);c(this,"BYTES_PER_PIXEL",4);this.gl=e,this.maxTextureMemory=i*1024*1024}loadTexture(e,i){try{const n=this.textures.get(e);if(n)return n.referenceCount++,n.lastUsed=Date.now(),n.texture;const r=this.gl.createTexture();if(!r)return console.error("Failed to create WebGL texture"),null;const o=i.width*i.height*this.BYTES_PER_PIXEL;if(this.currentMemoryUsage+o>this.maxTextureMemory&&(this.cleanupUnusedTextures(),this.currentMemoryUsage+o>this.maxTextureMemory))return console.warn("Texture memory limit exceeded, cannot load texture:",e),this.gl.deleteTexture(r),null;this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,i),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR);const s={id:e,texture:r,width:i.width,height:i.height,lastUsed:Date.now(),referenceCount:1};return this.textures.set(e,s),this.currentMemoryUsage+=o,r}catch(n){return console.error("Error loading texture:",e,n),null}}getTexture(e){const i=this.textures.get(e);return i?(i.lastUsed=Date.now(),i.referenceCount++,i.texture):null}releaseTexture(e){const i=this.textures.get(e);i&&(i.referenceCount=Math.max(0,i.referenceCount-1))}cleanupUnusedTextures(){const e=Date.now(),i=3e4;for(const[n,r]of this.textures.entries())r.referenceCount===0&&e-r.lastUsed>i&&this.deleteTexture(n)}deleteTexture(e){const i=this.textures.get(e);if(i){this.gl.deleteTexture(i.texture);const n=i.width*i.height*this.BYTES_PER_PIXEL;this.currentMemoryUsage-=n,this.textures.delete(e)}}getMemoryUsage(){return this.currentMemoryUsage}getTextureCount(){return this.textures.size}cleanup(){for(const[e]of this.textures)this.deleteTexture(e);this.textures.clear(),this.currentMemoryUsage=0}forceCleanup(){for(const[e,i]of this.textures.entries())i.referenceCount===0&&this.deleteTexture(e)}}class hf{constructor(e){c(this,"textureManager");c(this,"particlePools",new Map);c(this,"audioBufferCache",new Map);c(this,"maxAudioCacheSize",50);this.textureManager=new df(e)}getTextureManager(){return this.textureManager}createParticlePool(e,i,n,r=1e3){const o=new cf(i,n,r);return this.particlePools.set(e,o),o}getParticlePool(e){return this.particlePools.get(e)||null}cacheAudioBuffer(e,i){if(this.audioBufferCache.size>=this.maxAudioCacheSize){const n=this.audioBufferCache.keys().next().value;this.audioBufferCache.delete(n)}this.audioBufferCache.set(e,i)}getAudioBuffer(e){return this.audioBufferCache.get(e)||null}getMemoryStats(){return{textureMemory:this.textureManager.getMemoryUsage(),textureCount:this.textureManager.getTextureCount(),particlePoolCount:this.particlePools.size,audioBufferCount:this.audioBufferCache.size}}cleanup(){this.textureManager.cleanup(),this.particlePools.forEach(e=>e.clear()),this.particlePools.clear(),this.audioBufferCache.clear()}performGarbageCollection(){this.textureManager.forceCleanup(),this.particlePools.forEach((e,i)=>{e.activeCount()===0&&e.size()>100&&e.clear()}),"gc"in window&&typeof window.gc=="function"&&window.gc()}dispose(){this.cleanup()}}class ff{constructor(){c(this,"errorLog",[]);c(this,"maxLogSize",100);c(this,"fallbackState",{webglFallback:!1,audioFallback:!1,reducedEffects:!1,lowQualityMode:!1});c(this,"onFallbackChange");c(this,"onCriticalError");this.setupGlobalErrorHandlers()}setupGlobalErrorHandlers(){window.addEventListener("error",e=>{var i;this.handleError({type:"general",message:e.message,stack:(i=e.error)==null?void 0:i.stack,timestamp:Date.now(),context:{filename:e.filename,lineno:e.lineno,colno:e.colno},severity:"high"})}),window.addEventListener("unhandledrejection",e=>{var i;this.handleError({type:"general",message:`Unhandled promise rejection: ${e.reason}`,stack:(i=e.reason)==null?void 0:i.stack,timestamp:Date.now(),context:{reason:e.reason},severity:"medium"})})}setFallbackChangeCallback(e){this.onFallbackChange=e}setCriticalErrorCallback(e){this.onCriticalError=e}handleError(e){switch(this.errorLog.push(e),this.errorLog.length>this.maxLogSize&&this.errorLog.shift(),console.error(`[${e.type.toUpperCase()}] ${e.message}`,e),e.type){case"webgl":this.handleWebGLError(e);break;case"audio":this.handleAudioError(e);break;case"memory":this.handleMemoryError(e);break;case"performance":this.handlePerformanceError(e);break}e.severity==="critical"&&this.onCriticalError&&this.onCriticalError(e)}handleWebGLError(e){this.fallbackState.webglFallback||(console.warn("WebGL error detected, enabling fallback mode"),this.fallbackState.webglFallback=!0,this.fallbackState.reducedEffects=!0,this.notifyFallbackChange())}handleAudioError(e){this.fallbackState.audioFallback||(console.warn("Audio error detected, enabling silent fallback mode"),this.fallbackState.audioFallback=!0,this.notifyFallbackChange())}handleMemoryError(e){console.warn("Memory error detected, enabling low quality mode"),this.fallbackState.lowQualityMode=!0,this.fallbackState.reducedEffects=!0,this.notifyFallbackChange()}handlePerformanceError(e){this.fallbackState.lowQualityMode||(console.warn("Performance error detected, reducing quality"),this.fallbackState.reducedEffects=!0,this.notifyFallbackChange())}notifyFallbackChange(){this.onFallbackChange&&this.onFallbackChange({...this.fallbackState})}getFallbackState(){return{...this.fallbackState}}getErrorLog(){return[...this.errorLog]}getErrorsByType(e){return this.errorLog.filter(i=>i.type===e)}getRecentErrors(e=5){const i=Date.now()-e*60*1e3;return this.errorLog.filter(n=>n.timestamp>i)}clearErrorLog(){this.errorLog=[]}checkWebGLSupport(e){try{if(!e)return this.handleError({type:"webgl",message:"WebGL context is null",timestamp:Date.now(),severity:"critical"}),!1;const i=e.createTexture();return i?(e.deleteTexture(i),!0):(this.handleError({type:"webgl",message:"Failed to create WebGL texture",timestamp:Date.now(),severity:"high"}),!1)}catch(i){return this.handleError({type:"webgl",message:`WebGL support check failed: ${i}`,stack:i instanceof Error?i.stack:void 0,timestamp:Date.now(),severity:"critical"}),!1}}checkAudioSupport(){try{if(!window.AudioContext&&!window.webkitAudioContext)return this.handleError({type:"audio",message:"Web Audio API not supported",timestamp:Date.now(),severity:"medium"}),!1;const e=window.AudioContext||window.webkitAudioContext;return new e().close(),!0}catch(e){return this.handleError({type:"audio",message:`Audio support check failed: ${e}`,stack:e instanceof Error?e.stack:void 0,timestamp:Date.now(),severity:"medium"}),!1}}wrapAsyncOperation(e,i,n){return e().catch(r=>(this.handleError({type:i,message:`Async operation failed: ${r.message||r}`,stack:r.stack,timestamp:Date.now(),context:n,severity:"medium"}),null))}wrapSyncOperation(e,i,n,r){try{return e()}catch(o){return this.handleError({type:i,message:`Sync operation failed: ${o instanceof Error?o.message:o}`,stack:o instanceof Error?o.stack:void 0,timestamp:Date.now(),context:n,severity:"medium"}),r??null}}createSafeWebGLContext(e){try{const i={alpha:!1,antialias:!0,depth:!0,failIfMajorPerformanceCaveat:!1,powerPreference:"default",premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1};let n=e.getContext("webgl",i)||e.getContext("experimental-webgl",i);return n||(n=e.getContext("webgl",{failIfMajorPerformanceCaveat:!1})||e.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!1})),n&&this.checkWebGLSupport(n)?n:null}catch(i){return this.handleError({type:"webgl",message:`Failed to create WebGL context: ${i}`,stack:i instanceof Error?i.stack:void 0,timestamp:Date.now(),severity:"critical"}),null}}}class gf{constructor(e){c(this,"loadedTextures",new Map);c(this,"loadedAudio",new Map);c(this,"loadedFonts",new Set);c(this,"audioContext",null);c(this,"onProgress");c(this,"onError");this.audioContext=e||null}setProgressCallback(e){this.onProgress=e}setErrorCallback(e){this.onError=e}async loadAssets(e){const i=Object.keys(e.textures).length+Object.keys(e.audio).length+Object.keys(e.fonts).length;let n=0;const r=(o,s)=>{this.onProgress&&this.onProgress({loaded:n,total:i,percentage:n/i*100,currentAsset:o,phase:s})};try{r("Loading textures...","textures");for(const[o,s]of Object.entries(e.textures)){const a=await this.loadTexture(o,s);!a.success&&this.onError&&this.onError(`Failed to load texture ${o}: ${a.error}`),n++,r(o,"textures")}r("Loading fonts...","fonts");for(const[o,s]of Object.entries(e.fonts)){const a=await this.loadFont(o,s);!a.success&&this.onError&&this.onError(`Failed to load font ${o}: ${a.error}`),n++,r(o,"fonts")}r("Loading audio...","audio");for(const[o,s]of Object.entries(e.audio)){const a=await this.loadAudio(o,s);!a.success&&this.onError&&this.onError(`Failed to load audio ${o}: ${a.error}`),n++,r(o,"audio")}return r("Complete","complete"),!0}catch(o){return this.onError&&this.onError(`Asset loading failed: ${o}`),!1}}async loadTexture(e,i){return new Promise(n=>{const r=new Image;let o=!1;const s=()=>{this.loadedTextures.set(e,r),n({success:!0,asset:r,fallbackUsed:o})},a=()=>{const l=document.createElement("canvas");l.width=64,l.height=64;const u=l.getContext("2d");if(u){u.fillStyle=this.getFallbackColor(e),u.fillRect(0,0,64,64);const d=new Image;d.onload=()=>{this.loadedTextures.set(e,d),o=!0,n({success:!0,asset:d,fallbackUsed:o})},d.src=l.toDataURL()}else n({success:!1,error:`Failed to load texture and create fallback: ${i}`,fallbackUsed:!1})};r.onload=s,r.onerror=a,r.crossOrigin="anonymous",setTimeout(()=>{r.complete||(r.onload=null,r.onerror=null,a())},1e4),r.src=i})}getFallbackColor(e){const i=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9"];let n=0;for(let r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r)&4294967295;return i[Math.abs(n)%i.length]}async loadAudio(e,i){if(!this.audioContext)return{success:!1,error:"No audio context available",fallbackUsed:!1};try{const n=await fetch(i);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const r=await n.arrayBuffer(),o=await this.audioContext.decodeAudioData(r);return this.loadedAudio.set(e,o),{success:!0,asset:o,fallbackUsed:!1}}catch(n){try{const r=this.audioContext.createBuffer(1,44100,44100);return this.loadedAudio.set(e,r),{success:!0,asset:r,fallbackUsed:!0}}catch{return{success:!1,error:`Failed to load audio and create fallback: ${n}`,fallbackUsed:!1}}}}async loadFont(e,i){try{const n=new FontFace(e,`url(${i})`);return await n.load(),document.fonts.add(n),this.loadedFonts.add(e),{success:!0,fallbackUsed:!1}}catch(n){return this.loadedFonts.add(e),{success:!0,error:`Font loading failed, using fallback: ${n}`,fallbackUsed:!0}}}getTexture(e){return this.loadedTextures.get(e)||null}getAudio(e){return this.loadedAudio.get(e)||null}hasFont(e){return this.loadedFonts.has(e)}preloadCriticalAssets(e){const i={textures:{},audio:{},fonts:{}},n=["snake-head","snake-body","food-basic"],r=["eat-sound"],o=["game-font"];if(e.textures)for(const s of n)e.textures[s]&&(i.textures[s]=e.textures[s]);if(e.audio)for(const s of r)e.audio[s]&&(i.audio[s]=e.audio[s]);if(e.fonts)for(const s of o)e.fonts[s]&&(i.fonts[s]=e.fonts[s]);return this.loadAssets(i)}loadRemainingAssets(e){const i={textures:{},audio:{},fonts:{}};for(const[n,r]of Object.entries(e.textures))this.loadedTextures.has(n)||(i.textures[n]=r);for(const[n,r]of Object.entries(e.audio))this.loadedAudio.has(n)||(i.audio[n]=r);for(const[n,r]of Object.entries(e.fonts))this.loadedFonts.has(n)||(i.fonts[n]=r);return this.loadAssets(i)}getLoadedAssetCount(){return{textures:this.loadedTextures.size,audio:this.loadedAudio.size,fonts:this.loadedFonts.size}}cleanup(){this.loadedTextures.clear(),this.loadedAudio.clear(),this.loadedFonts.clear()}}class mf{constructor(e,i){c(this,"canvas");c(this,"config");c(this,"responsiveConfig");c(this,"resizeObserver");c(this,"orientationChangeHandler");c(this,"resizeHandler");c(this,"onResize");c(this,"resizeTimeout");this.canvas=e,this.config=i;const n=i.gridWidth*i.cellSize,r=i.gridHeight*i.cellSize;this.responsiveConfig={minWidth:Math.min(320,n*.5),minHeight:Math.min(480,r*.5),maxWidth:n*1.5,maxHeight:r*1.5,aspectRatio:n/r,scaleFactor:1},this.orientationChangeHandler=this.handleOrientationChange.bind(this),this.resizeHandler=this.handleResize.bind(this),this.setupResponsiveCanvas(),this.attachEventListeners()}setupResponsiveCanvas(){this.updateCanvasSize(),typeof ResizeObserver<"u"&&(this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.canvas.parentElement||document.body))}attachEventListeners(){var e;window.addEventListener("resize",this.resizeHandler,{passive:!0}),window.addEventListener("orientationchange",this.orientationChangeHandler,{passive:!0}),"visualViewport"in window&&((e=window.visualViewport)==null||e.addEventListener("resize",this.resizeHandler,{passive:!0}))}handleResize(){clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(()=>{this.updateCanvasSize()},100)}handleOrientationChange(){setTimeout(()=>{this.updateCanvasSize()},200)}updateCanvasSize(){const e=this.getViewportInfo(),i=this.calculateOptimalCanvasSize(e);this.canvas.width=i.width,this.canvas.height=i.height,this.canvas.style.width=`${i.displayWidth}px`,this.canvas.style.height=`${i.displayHeight}px`,this.responsiveConfig.scaleFactor=i.width/(this.config.gridWidth*this.config.cellSize),this.onResize&&this.onResize(e,{width:i.width,height:i.height})}getViewportInfo(){const e=window.innerWidth,i=window.innerHeight,n=window.devicePixelRatio||1,r=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||e<=768&&"ontouchstart"in window,o=r&&Math.min(e,i)>=768,s=e>i?"landscape":"portrait";return{width:e,height:i,devicePixelRatio:n,isMobile:r,isTablet:o,orientation:s}}calculateOptimalCanvasSize(e){const{width:i,height:n,devicePixelRatio:r,isMobile:o}=e,s=i*(o?.95:.9),a=n*(o?.85:.9);let l=s,u=l/this.responsiveConfig.aspectRatio;u>a&&(u=a,l=u*this.responsiveConfig.aspectRatio),l=Math.max(this.responsiveConfig.minWidth,Math.min(this.responsiveConfig.maxWidth,l)),u=Math.max(this.responsiveConfig.minHeight,Math.min(this.responsiveConfig.maxHeight,u));const d=Math.floor(l*r),m=Math.floor(u*r);return{width:d,height:m,displayWidth:l,displayHeight:u}}getScaleFactor(){return this.responsiveConfig.scaleFactor}convertScreenToCanvas(e,i){const n=this.canvas.getBoundingClientRect(),r=this.canvas.width/n.width,o=this.canvas.height/n.height;return{x:(e-n.left)*r,y:(i-n.top)*o}}convertCanvasToGrid(e,i){const n=this.config.cellSize*this.responsiveConfig.scaleFactor;return{x:Math.floor(e/n),y:Math.floor(i/n)}}getCurrentViewportInfo(){return this.getViewportInfo()}destroy(){var e;window.removeEventListener("resize",this.resizeHandler),window.removeEventListener("orientationchange",this.orientationChangeHandler),"visualViewport"in window&&((e=window.visualViewport)==null||e.removeEventListener("resize",this.resizeHandler)),this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeTimeout&&clearTimeout(this.resizeTimeout)}}class pf{constructor(e){c(this,"state");c(this,"config");c(this,"occupiedPositions");c(this,"foodDefinitions",new Map);c(this,"foodCombinations",[]);this.config=e,this.occupiedPositions=new Set,this.initializeFoodDefinitions(),this.initializeFoodCombinations(),this.state={activeFoods:[],spawnTimer:0,lastSpawnTime:0,spawnInterval:2e3,maxSimultaneousFoods:6,minSimultaneousFoods:3,recentConsumptions:[],activeEffects:[]}}initializeFoodDefinitions(){this.foodDefinitions=new Map,this.foodDefinitions.set(F.BasicBerry,{type:F.BasicBerry,name:"Basic Berry",evolutionLevel:1,basePoints:10,spawnWeight:100,effects:[{type:_.Growth,duration:0,magnitude:1}],visualData:{color:"#FF6B6B",pattern:"solid"}}),this.foodDefinitions.set(F.WildMushroom,{type:F.WildMushroom,name:"Wild Mushroom",evolutionLevel:2,basePoints:15,spawnWeight:80,effects:[{type:_.Growth,duration:0,magnitude:1},{type:_.SpeedBoost,duration:3e3,magnitude:1.2}],negativeEffects:[{type:_.Poison,duration:2e3,magnitude:1}],visualData:{color:"#8B4513",secondaryColor:"#DEB887",pattern:"spotted"}}),this.foodDefinitions.set(F.CrystalFruit,{type:F.CrystalFruit,name:"Crystal Fruit",evolutionLevel:3,basePoints:25,spawnWeight:60,effects:[{type:_.Growth,duration:0,magnitude:2},{type:_.PowerCooldownReduction,duration:5e3,magnitude:.5}],negativeEffects:[{type:_.SlowDown,duration:3e3,magnitude:.7},{type:_.BlurredVision,duration:2e3,magnitude:1}],visualData:{color:"#87CEEB",secondaryColor:"#E0FFFF",pattern:"crystalline",glowIntensity:.8}}),this.foodDefinitions.set(F.VenomousFlower,{type:F.VenomousFlower,name:"Venomous Flower",evolutionLevel:4,basePoints:30,spawnWeight:50,effects:[{type:_.Growth,duration:0,magnitude:2},{type:_.EvolutionBoost,duration:0,magnitude:1.5}],negativeEffects:[{type:_.Poison,duration:4e3,magnitude:2},{type:_.SegmentLoss,duration:0,magnitude:1}],visualData:{color:"#9932CC",secondaryColor:"#FF1493",pattern:"petaled"}}),this.foodDefinitions.set(F.AquaticPlant,{type:F.AquaticPlant,name:"Aquatic Plant",evolutionLevel:5,basePoints:40,spawnWeight:40,effects:[{type:_.Growth,duration:0,magnitude:3},{type:_.Regeneration,duration:1e4,magnitude:1}],negativeEffects:[{type:_.ReversedControls,duration:5e3,magnitude:1},{type:_.SlowDown,duration:4e3,magnitude:.6}],visualData:{color:"#20B2AA",secondaryColor:"#00CED1",pattern:"flowing"}}),this.foodDefinitions.set(F.RainbowNectar,{type:F.RainbowNectar,name:"Rainbow Nectar",evolutionLevel:6,basePoints:50,spawnWeight:30,effects:[{type:_.Growth,duration:0,magnitude:3},{type:_.DoublePoints,duration:8e3,magnitude:2}],negativeEffects:[{type:_.DisablePowers,duration:6e3,magnitude:1},{type:_.BlurredVision,duration:3e3,magnitude:1}],visualData:{color:"#FF69B4",secondaryColor:"#FFD700",pattern:"rainbow",glowIntensity:1}}),this.foodDefinitions.set(F.StardustBerry,{type:F.StardustBerry,name:"Stardust Berry",evolutionLevel:7,basePoints:75,spawnWeight:20,effects:[{type:_.Growth,duration:0,magnitude:4},{type:_.TimeWarp,duration:5e3,magnitude:.5}],negativeEffects:[{type:_.Poison,duration:6e3,magnitude:3},{type:_.SegmentLoss,duration:0,magnitude:2}],visualData:{color:"#4B0082",secondaryColor:"#FFD700",pattern:"starry",glowIntensity:1.2}}),this.foodDefinitions.set(F.DragonScale,{type:F.DragonScale,name:"Dragon Scale",evolutionLevel:8,basePoints:100,spawnWeight:15,effects:[{type:_.Growth,duration:0,magnitude:5},{type:_.Invincibility,duration:3e3,magnitude:1}],negativeEffects:[{type:_.ReversedControls,duration:8e3,magnitude:1},{type:_.DisablePowers,duration:1e4,magnitude:1},{type:_.SegmentLoss,duration:0,magnitude:3}],visualData:{color:"#DC143C",secondaryColor:"#FFD700",pattern:"scaled",glowIntensity:1.5}}),this.foodDefinitions.set(F.EternalOrb,{type:F.EternalOrb,name:"Eternal Orb",evolutionLevel:9,basePoints:150,spawnWeight:10,effects:[{type:_.Growth,duration:0,magnitude:6},{type:_.EvolutionBoost,duration:0,magnitude:2},{type:_.PowerCooldownReduction,duration:15e3,magnitude:.3}],negativeEffects:[{type:_.Poison,duration:1e4,magnitude:4},{type:_.ReversedControls,duration:12e3,magnitude:1},{type:_.SegmentLoss,duration:0,magnitude:4}],visualData:{color:"#FFD700",secondaryColor:"#FFFFFF",pattern:"orb",glowIntensity:2}}),this.foodDefinitions.set(F.OuroborosEssence,{type:F.OuroborosEssence,name:"Ouroboros Essence",evolutionLevel:10,basePoints:200,spawnWeight:5,effects:[{type:_.Growth,duration:0,magnitude:8},{type:_.Transformation,duration:0,magnitude:1},{type:_.DoublePoints,duration:2e4,magnitude:3}],negativeEffects:[{type:_.Poison,duration:15e3,magnitude:5},{type:_.ReversedControls,duration:15e3,magnitude:1},{type:_.DisablePowers,duration:2e4,magnitude:1},{type:_.SegmentLoss,duration:0,magnitude:5}],visualData:{color:"#800080",secondaryColor:"#FFD700",pattern:"mystical",glowIntensity:3}})}initializeFoodCombinations(){this.foodCombinations=[{name:"Nature's Bounty",foods:[F.BasicBerry,F.WildMushroom],bonusMultiplier:1.5,specialEffect:{type:_.Regeneration,duration:5e3,magnitude:1}},{name:"Crystal Power",foods:[F.CrystalFruit,F.VenomousFlower],bonusMultiplier:2,specialEffect:{type:_.PowerCooldownReduction,duration:8e3,magnitude:.4}},{name:"Aquatic Harmony",foods:[F.AquaticPlant,F.RainbowNectar],bonusMultiplier:2.5,specialEffect:{type:_.SpeedBoost,duration:1e4,magnitude:1.3}},{name:"Celestial Feast",foods:[F.StardustBerry,F.DragonScale],bonusMultiplier:3,specialEffect:{type:_.Invincibility,duration:5e3,magnitude:1}},{name:"Divine Transcendence",foods:[F.EternalOrb,F.OuroborosEssence],bonusMultiplier:5,specialEffect:{type:_.Transformation,duration:0,magnitude:2}},{name:"Evolution Chain",foods:[F.BasicBerry,F.CrystalFruit,F.StardustBerry],bonusMultiplier:4,specialEffect:{type:_.EvolutionBoost,duration:0,magnitude:3}}]}update(e,i,n=[],r=1){this.state.spawnTimer+=e,this.updateOccupiedPositions(i,n),this.updateActiveEffects(e),this.cleanupConsumptionHistory(),this.shouldSpawnFood()&&(this.spawnFood(r),this.state.lastSpawnTime=performance.now(),this.state.spawnTimer=0),this.removeExpiredFood()}updateActiveEffects(e){this.state.activeEffects=this.state.activeEffects.filter(i=>i.duration>0?(i.duration-=e,i.duration>0):!1)}cleanupConsumptionHistory(){const e=performance.now(),i=1e4;this.state.recentConsumptions=this.state.recentConsumptions.filter(n=>e-n.timestamp<i)}shouldSpawnFood(){const i=performance.now()-this.state.lastSpawnTime;return this.state.activeFoods.length<this.state.minSimultaneousFoods||this.state.activeFoods.length<this.state.maxSimultaneousFoods&&i>=this.state.spawnInterval}spawnFood(e=1){const i=this.state.activeFoods.length,n=this.state.maxSimultaneousFoods-i;if(n<=0)return;const r=Math.min(Math.floor(Math.random()*3)+1,n);for(let o=0;o<r;o++){const s=this.findValidSpawnPosition();if(s){const a=this.selectFoodType(e),l=this.createFood(s,a);this.state.activeFoods.push(l)}}}selectFoodType(e){const i=[];this.foodDefinitions.forEach((o,s)=>{let a=o.spawnWeight;const l=Math.abs(o.evolutionLevel-e);l===0?a*=3:l===1?a*=2:l===2?a*=1:l<=4?a*=.3:a*=.1,o.evolutionLevel>e+2&&(a*=.2),i.push({type:s,weight:a})});const n=i.reduce((o,s)=>o+s.weight,0);let r=Math.random()*n;for(const o of i)if(r-=o.weight,r<=0)return o.type;return F.BasicBerry}findValidSpawnPosition(){let i=0;for(;i<50;){const n={x:Math.floor(Math.random()*this.config.gridWidth),y:Math.floor(Math.random()*this.config.gridHeight)},r=`${n.x},${n.y}`;if(!this.occupiedPositions.has(r)&&!this.isFoodAtPosition(n))return n;i++}return null}createFood(e,i=F.BasicBerry){const n=performance.now(),r=this.foodDefinitions.get(i);if(!r)throw new Error(`Food definition not found for type: ${i}`);return{id:`food_${n}_${Math.random().toString(36).substring(2,9)}`,type:i,position:{...e},evolutionLevel:r.evolutionLevel,points:r.basePoints,effects:r.effects.map(s=>({...s})),spawnTime:n,isSpecial:r.evolutionLevel>=7}}updateOccupiedPositions(e,i){this.occupiedPositions.clear(),e.forEach(n=>{this.occupiedPositions.add(`${Math.floor(n.x)},${Math.floor(n.y)}`)}),i.forEach(n=>{this.occupiedPositions.add(`${Math.floor(n.x)},${Math.floor(n.y)}`)})}isFoodAtPosition(e){return this.state.activeFoods.some(i=>i.position.x===e.x&&i.position.y===e.y)}removeExpiredFood(){const e=performance.now(),i=3e4;this.state.activeFoods=this.state.activeFoods.filter(n=>e-n.spawnTime<i)}consumeFood(e,i){const n=this.state.activeFoods.findIndex(a=>a.id===e);if(n===-1)return{success:!1,pointsAwarded:0,segmentsToGrow:0,effects:[],evolutionProgress:0};const r=this.state.activeFoods[n];this.state.activeFoods.splice(n,1),this.state.recentConsumptions.push({type:r.type,timestamp:performance.now()});const o=this.calculateConsumptionResult(r,i),s=this.checkFoodCombinations();return s.multiplier>1&&(o.pointsAwarded=Math.floor(o.pointsAwarded*s.multiplier),o.evolutionProgress=Math.floor(o.evolutionProgress*s.multiplier),s.specialEffect&&o.effects.push(s.specialEffect)),o.effects.forEach(a=>{a.duration>0&&this.state.activeEffects.push({...a})}),o}calculateConsumptionResult(e,i){var d;const n=this.foodDefinitions.get(e.type);if(!n)return{success:!1,pointsAwarded:0,segmentsToGrow:0,effects:[],evolutionProgress:0};const r=Math.abs(n.evolutionLevel-i),o=this.isFoodAppropriateForLevel(e.type,i);let s=n.basePoints,a=0,l=0,u=[];if(o)u=[...n.effects],a=((d=n.effects.find(m=>m.type===_.Growth))==null?void 0:d.magnitude)||0,l=s,r===0&&(s=Math.floor(s*1.2),l=Math.floor(l*1.2));else{n.negativeEffects&&(u=[...n.negativeEffects]),s=Math.floor(s*.3),l=Math.floor(s*.1);const m=u.find(p=>p.type===_.SegmentLoss);m&&(a=-m.magnitude)}return{success:!0,pointsAwarded:s,segmentsToGrow:a,effects:u,evolutionProgress:l}}isFoodAppropriateForLevel(e,i){const n=this.foodDefinitions.get(e);if(!n)return!1;const r=Math.abs(n.evolutionLevel-i);return n.evolutionLevel>i+3?!1:r<=2}checkFoodCombinations(){const e=this.state.recentConsumptions.slice(-5).map(i=>i.type);for(const i of this.foodCombinations)if(this.hasFoodCombination(e,i.foods))return{multiplier:i.bonusMultiplier,reason:i.name,specialEffect:i.specialEffect};return{multiplier:1,reason:"No combination"}}hasFoodCombination(e,i){const n=new Map;return e.forEach(r=>{n.set(r,(n.get(r)||0)+1)}),i.every(r=>{const o=i.filter(a=>a===r).length;return(n.get(r)||0)>=o})}getFoodAtPosition(e){return this.state.activeFoods.find(i=>i.position.x===Math.floor(e.x)&&i.position.y===Math.floor(e.y))||null}getActiveFoods(){return[...this.state.activeFoods]}getFoodCount(){return this.state.activeFoods.length}clearAllFood(){this.state.activeFoods=[]}setSpawnInterval(e){this.state.spawnInterval=Math.max(500,e)}setMaxSimultaneousFoods(e){this.state.maxSimultaneousFoods=Math.max(1,Math.min(20,e))}setMinSimultaneousFoods(e){this.state.minSimultaneousFoods=Math.max(1,Math.min(this.state.maxSimultaneousFoods,e))}getFoodState(){return{...this.state,activeFoods:[...this.state.activeFoods]}}getActiveEffects(){return[...this.state.activeEffects]}getFoodDefinition(e){return this.foodDefinitions.get(e)}getAllFoodDefinitions(){return Array.from(this.foodDefinitions.values())}getFoodCombinations(){return[...this.foodCombinations]}getRecentConsumptions(){return[...this.state.recentConsumptions]}clearActiveEffects(){this.state.activeEffects=[]}clearConsumptionHistory(){this.state.recentConsumptions=[]}hasActiveEffect(e){return this.state.activeEffects.some(i=>i.type===e)}getActiveEffectMagnitude(e){const i=this.state.activeEffects.find(n=>n.type===e);return i?i.magnitude:0}forceSpawnFood(e,i){const n=e||this.findValidSpawnPosition();if(n){const r=i||F.BasicBerry,o=this.createFood(n,r);return this.state.activeFoods.push(o),o}return null}simulateConsumption(e,i){const n=this.foodDefinitions.get(e);if(!n)return{success:!1,pointsAwarded:0,segmentsToGrow:0,effects:[],evolutionProgress:0};const r={id:"test_food",type:e,position:{x:0,y:0},evolutionLevel:n.evolutionLevel,points:n.basePoints,effects:[...n.effects],spawnTime:performance.now(),isSpecial:n.evolutionLevel>=7};return this.calculateConsumptionResult(r,i)}}var Hn=(t=>(t.SPEED_BOOST="speed_boost",t.VENOM_STRIKE="venom_strike",t.CONSTRICT="constrict",t.HOOD_EXPANSION="hood_expansion",t.AQUATIC_MOVEMENT="aquatic_movement",t.COLOR_CHANGE="color_change",t.TIME_WARP="time_warp",t.FIRE_BREATH="fire_breath",t.TAIL_CONSUMPTION="tail_consumption",t.EVOLUTION_TRANSFORM="evolution_transform",t.EVOLUTION_COMPLETE="evolution_complete",t.FOOD_BASIC="food_basic",t.FOOD_SPECIAL="food_special",t.FOOD_NEGATIVE="food_negative",t.FOOD_COMBINATION="food_combination",t.BACKGROUND_MUSIC="background_music",t.AMBIENT_MYSTICAL="ambient_mystical",t.GAME_OVER="game_over",t.PAUSE="pause",t.RESUME="resume",t))(Hn||{});class yf{constructor(){c(this,"audioContext",null);c(this,"masterGainNode",null);c(this,"sfxGainNode",null);c(this,"musicGainNode",null);c(this,"ambientGainNode",null);c(this,"audioClips",new Map);c(this,"activeAudioSources",new Map);c(this,"isInitialized",!1);c(this,"isMuted",!1);c(this,"masterVolume",1);c(this,"sfxVolume",.8);c(this,"musicVolume",.6);c(this,"ambientVolume",.4);this.initializeAudioContext(),this.setupAudioClips()}initializeAudioContext(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.setupAudioNodes(),this.isInitialized=!0}catch(e){console.warn("Web Audio API not supported:",e),this.isInitialized=!1}}setupAudioNodes(){this.audioContext&&(this.masterGainNode=this.audioContext.createGain(),this.masterGainNode.connect(this.audioContext.destination),this.masterGainNode.gain.value=this.masterVolume,this.sfxGainNode=this.audioContext.createGain(),this.sfxGainNode.connect(this.masterGainNode),this.sfxGainNode.gain.value=this.sfxVolume,this.musicGainNode=this.audioContext.createGain(),this.musicGainNode.connect(this.masterGainNode),this.musicGainNode.gain.value=this.musicVolume,this.ambientGainNode=this.audioContext.createGain(),this.ambientGainNode.connect(this.masterGainNode),this.ambientGainNode.gain.value=this.ambientVolume)}setupAudioClips(){this.registerAudioClip("speed_boost",{id:"speed_boost",buffer:null,volume:.7,pitch:1.2,loop:!1,category:"sfx"}),this.registerAudioClip("venom_strike",{id:"venom_strike",buffer:null,volume:.8,pitch:.9,loop:!1,category:"sfx"}),this.registerAudioClip("constrict",{id:"constrict",buffer:null,volume:.6,pitch:.8,loop:!1,category:"sfx"}),this.registerAudioClip("hood_expansion",{id:"hood_expansion",buffer:null,volume:.9,pitch:1,loop:!1,category:"sfx"}),this.registerAudioClip("aquatic_movement",{id:"aquatic_movement",buffer:null,volume:.5,pitch:1.1,loop:!1,category:"sfx"}),this.registerAudioClip("color_change",{id:"color_change",buffer:null,volume:.4,pitch:1.3,loop:!1,category:"sfx"}),this.registerAudioClip("time_warp",{id:"time_warp",buffer:null,volume:.8,pitch:.7,loop:!1,category:"sfx"}),this.registerAudioClip("fire_breath",{id:"fire_breath",buffer:null,volume:1,pitch:.8,loop:!1,category:"sfx"}),this.registerAudioClip("tail_consumption",{id:"tail_consumption",buffer:null,volume:.9,pitch:1,loop:!1,category:"sfx"}),this.registerAudioClip("evolution_transform",{id:"evolution_transform",buffer:null,volume:.8,pitch:1,loop:!1,category:"sfx"}),this.registerAudioClip("evolution_complete",{id:"evolution_complete",buffer:null,volume:.9,pitch:1.1,loop:!1,category:"sfx"}),this.registerAudioClip("food_basic",{id:"food_basic",buffer:null,volume:.5,pitch:1,loop:!1,category:"sfx"}),this.registerAudioClip("food_special",{id:"food_special",buffer:null,volume:.7,pitch:1.2,loop:!1,category:"sfx"}),this.registerAudioClip("food_negative",{id:"food_negative",buffer:null,volume:.6,pitch:.8,loop:!1,category:"sfx"}),this.registerAudioClip("food_combination",{id:"food_combination",buffer:null,volume:.8,pitch:1.3,loop:!1,category:"sfx"}),this.registerAudioClip("background_music",{id:"background_music",buffer:null,volume:1,pitch:1,loop:!0,category:"music"}),this.registerAudioClip("ambient_mystical",{id:"ambient_mystical",buffer:null,volume:.3,pitch:1,loop:!0,category:"ambient"}),this.registerAudioClip("game_over",{id:"game_over",buffer:null,volume:.8,pitch:.9,loop:!1,category:"sfx"}),this.registerAudioClip("pause",{id:"pause",buffer:null,volume:.5,pitch:1,loop:!1,category:"sfx"}),this.registerAudioClip("resume",{id:"resume",buffer:null,volume:.5,pitch:1.1,loop:!1,category:"sfx"})}registerAudioClip(e,i){this.audioClips.set(e,i)}async loadAudioBuffer(e,i){if(!this.audioContext||!this.isInitialized){console.warn("Audio context not initialized");return}try{const n=await this.audioContext.decodeAudioData(i),r=this.audioClips.get(e);r&&(r.buffer=n)}catch(n){console.error(`Failed to load audio buffer for ${e}:`,n)}}playSound(e,i){if(!this.audioContext||!this.isInitialized||this.isMuted)return null;const n=this.audioClips.get(e);if(!n||!n.buffer)return console.warn(`Audio clip not found or not loaded: ${e}`),null;try{const r=this.audioContext.createBufferSource(),o=this.audioContext.createGain();r.buffer=n.buffer,r.loop=n.loop;const s=(i==null?void 0:i.pitch)??n.pitch;r.playbackRate.value=s,r.connect(o);const a=this.getCategoryGainNode(n.category);a&&o.connect(a);const l=((i==null?void 0:i.volume)??n.volume)*this.getCategoryVolume(n.category);o.gain.value=l,i!=null&&i.spatial&&this.applySpatialAudio(o,i.spatial),i!=null&&i.fadeIn&&(o.gain.setValueAtTime(0,this.audioContext.currentTime),o.gain.linearRampToValueAtTime(l,this.audioContext.currentTime+i.fadeIn));const u=`${e}_${Date.now()}_${Math.random()}`;return r.onended=()=>{this.activeAudioSources.delete(u)},this.activeAudioSources.set(u,r),r.start(),u}catch(r){return console.error(`Failed to play sound ${e}:`,r),null}}stopSound(e){const i=this.activeAudioSources.get(e);if(i)try{i.stop(),this.activeAudioSources.delete(e)}catch(n){console.warn(`Failed to stop sound ${e}:`,n)}}stopAllSounds(){this.activeAudioSources.forEach((e,i)=>{try{e.stop()}catch(n){console.warn(`Failed to stop sound ${i}:`,n)}}),this.activeAudioSources.clear()}playPowerSound(e){const i=this.getPowerSoundType(e);return this.playSound(i)}playEvolutionSound(){return this.playSound("evolution_transform")}playEvolutionCompleteSound(){return this.playSound("evolution_complete")}playFoodSound(e=!1,i=!1,n=!1){return n?this.playSound("food_combination"):i?this.playSound("food_negative"):e?this.playSound("food_special"):this.playSound("food_basic")}startBackgroundMusic(){return this.playSound("background_music",{fadeIn:2})}startAmbientSounds(){return this.playSound("ambient_mystical",{fadeIn:1})}getPowerSoundType(e){switch(e){case v.SpeedBoost:return"speed_boost";case v.VenomStrike:return"venom_strike";case v.Constrict:return"constrict";case v.HoodExpansion:return"hood_expansion";case v.AquaticMovement:return"aquatic_movement";case v.ColorChange:return"color_change";case v.TimeWarp:return"time_warp";case v.FireBreath:return"fire_breath";case v.TailConsumption:return"tail_consumption";default:return"speed_boost"}}getCategoryGainNode(e){switch(e){case"sfx":return this.sfxGainNode;case"music":return this.musicGainNode;case"ambient":return this.ambientGainNode;default:return this.sfxGainNode}}getCategoryVolume(e){switch(e){case"sfx":return this.sfxVolume;case"music":return this.musicVolume;case"ambient":return this.ambientVolume;default:return this.sfxVolume}}applySpatialAudio(e,i){if(!this.audioContext)return;const n=this.audioContext.createPanner();n.panningModel="HRTF",n.distanceModel="inverse",n.refDistance=1,n.maxDistance=i.falloffDistance,n.rolloffFactor=1,n.positionX.value=i.position.x,n.positionY.value=i.position.y,n.positionZ.value=0,e.disconnect(),e.connect(n),n.connect(this.getCategoryGainNode("sfx")||this.masterGainNode)}setMasterVolume(e){this.masterVolume=Math.max(0,Math.min(1,e)),this.masterGainNode&&(this.masterGainNode.gain.value=this.masterVolume)}setSfxVolume(e){this.sfxVolume=Math.max(0,Math.min(1,e)),this.sfxGainNode&&(this.sfxGainNode.gain.value=this.sfxVolume)}setMusicVolume(e){this.musicVolume=Math.max(0,Math.min(1,e)),this.musicGainNode&&(this.musicGainNode.gain.value=this.musicVolume)}setAmbientVolume(e){this.ambientVolume=Math.max(0,Math.min(1,e)),this.ambientGainNode&&(this.ambientGainNode.gain.value=this.ambientVolume)}mute(){this.isMuted=!0,this.masterGainNode&&(this.masterGainNode.gain.value=0)}unmute(){this.isMuted=!1,this.masterGainNode&&(this.masterGainNode.gain.value=this.masterVolume)}isMutedState(){return this.isMuted}isAudioSupported(){return this.isInitialized}getActiveSourceCount(){return this.activeAudioSources.size}dispose(){this.stopAllSounds(),this.audioContext&&this.audioContext.state!=="closed"&&this.audioContext.close(),this.audioClips.clear(),this.activeAudioSources.clear(),this.isInitialized=!1}}class vf{constructor(){c(this,"soundManager");c(this,"backgroundMusicId",null);c(this,"ambientSoundId",null);c(this,"isGameMuted",!1);this.soundManager=new yf}async initialize(){if(!this.soundManager.isAudioSupported()){console.warn("Audio not supported, running in silent mode");return}this.startBackgroundAudio()}startBackgroundAudio(){this.isGameMuted||(this.backgroundMusicId=this.soundManager.startBackgroundMusic(),this.ambientSoundId=this.soundManager.startAmbientSounds())}stopBackgroundAudio(){this.backgroundMusicId&&(this.soundManager.stopSound(this.backgroundMusicId),this.backgroundMusicId=null),this.ambientSoundId&&(this.soundManager.stopSound(this.ambientSoundId),this.ambientSoundId=null)}playPowerActivation(e){this.isGameMuted||this.soundManager.playPowerSound(e)}playEvolutionSequence(){this.isGameMuted||(this.soundManager.playEvolutionSound(),setTimeout(()=>{this.soundManager.playEvolutionCompleteSound()},1500))}playFoodConsumption(e,i=!1,n=!1){if(this.isGameMuted)return;const r=this.isSpecialFood(e);this.soundManager.playFoodSound(r,i,n)}playGamePause(){this.isGameMuted||this.soundManager.playSound(Hn.PAUSE)}playGameResume(){this.isGameMuted||this.soundManager.playSound(Hn.RESUME)}playGameOver(){this.soundManager.playSound(Hn.GAME_OVER)}setMasterVolume(e){this.soundManager.setMasterVolume(e)}setSfxVolume(e){this.soundManager.setSfxVolume(e)}setMusicVolume(e){this.soundManager.setMusicVolume(e)}setAmbientVolume(e){this.soundManager.setAmbientVolume(e)}mute(){this.isGameMuted=!0,this.soundManager.mute(),this.stopBackgroundAudio()}unmute(){this.isGameMuted=!1,this.soundManager.unmute(),this.startBackgroundAudio()}isMuted(){return this.isGameMuted}async loadAudioBuffer(e,i){await this.soundManager.loadAudioBuffer(e,i)}isAudioSupported(){return this.soundManager.isAudioSupported()}getActiveSourceCount(){return this.soundManager.getActiveSourceCount()}dispose(){this.stopBackgroundAudio(),this.soundManager.dispose()}isSpecialFood(e){return[F.CrystalFruit,F.VenomousFlower,F.RainbowNectar,F.StardustBerry,F.DragonScale,F.EternalOrb,F.OuroborosEssence].includes(e)}}class Sf{constructor(e,i,n={}){c(this,"lights",new Map);c(this,"ambientLighting");c(this,"config");c(this,"gl");c(this,"canvas");c(this,"lightingShaderProgram",null);c(this,"lightingFramebuffer",null);c(this,"lightingTexture",null);c(this,"quadVertexBuffer",null);c(this,"frameTime",0);c(this,"lastPerformanceCheck",0);c(this,"performanceCheckInterval",1e3);this.gl=e,this.canvas=i,this.config={maxLights:n.maxLights||32,enableShadows:n.enableShadows!==!1,shadowQuality:n.shadowQuality||"medium",ambientIntensity:n.ambientIntensity||.3,lightFalloffExponent:n.lightFalloffExponent||2,performanceMode:n.performanceMode||!1},this.ambientLighting={baseColor:[.2,.25,.35],intensity:this.config.ambientIntensity,evolutionModifier:1,environmentModifier:1},this.initializeWebGL()}initializeWebGL(){const e=this.gl;if(!e){console.warn("WebGL context not available - skipping lighting system WebGL initialization");return}const i=`
      attribute vec2 a_position;
      attribute vec2 a_texCoord;
      
      varying vec2 v_texCoord;
      
      void main() {
        gl_Position = vec4(a_position, 0.0, 1.0);
        v_texCoord = a_texCoord;
      }
    `,n=`
      precision mediump float;
      
      uniform vec2 u_resolution;
      uniform vec3 u_ambientColor;
      uniform float u_ambientIntensity;
      uniform float u_time;
      
      // Light uniforms (up to 32 lights)
      uniform int u_lightCount;
      uniform vec2 u_lightPositions[32];
      uniform vec3 u_lightColors[32];
      uniform float u_lightIntensities[32];
      uniform float u_lightRadii[32];
      uniform int u_lightTypes[32];
      uniform float u_lightFlickerSpeeds[32];
      uniform float u_lightFlickerIntensities[32];
      uniform float u_lightPulseSpeeds[32];
      uniform float u_lightPulseIntensities[32];
      
      varying vec2 v_texCoord;
      
      float calculateLightContribution(int index, vec2 fragCoord) {
        vec2 lightPos = u_lightPositions[index];
        float lightRadius = u_lightRadii[index];
        float lightIntensity = u_lightIntensities[index];
        int lightType = u_lightTypes[index];
        
        float distance = length(fragCoord - lightPos);
        
        if (distance > lightRadius) {
          return 0.0;
        }
        
        // Base attenuation
        float attenuation = 1.0 - pow(distance / lightRadius, 2.0);
        
        // Apply light type effects
        float finalIntensity = lightIntensity;
        
        if (lightType == 1) { // Flickering
          float flickerSpeed = u_lightFlickerSpeeds[index];
          float flickerIntensity = u_lightFlickerIntensities[index];
          float flicker = sin(u_time * flickerSpeed) * 0.5 + 0.5;
          finalIntensity *= (1.0 - flickerIntensity * 0.5) + (flickerIntensity * flicker);
        } else if (lightType == 2) { // Pulsing
          float pulseSpeed = u_lightPulseSpeeds[index];
          float pulseIntensity = u_lightPulseIntensities[index];
          float pulse = sin(u_time * pulseSpeed) * 0.5 + 0.5;
          finalIntensity *= (1.0 - pulseIntensity * 0.3) + (pulseIntensity * 0.3 * pulse);
        } else if (lightType == 3) { // Glowing
          float glow = sin(u_time * 2.0) * 0.1 + 0.9;
          finalIntensity *= glow;
        } else if (lightType == 4) { // Mystical
          float mystical = sin(u_time * 1.5 + distance * 0.1) * 0.2 + 0.8;
          finalIntensity *= mystical;
        } else if (lightType == 5) { // Fire
          float fire1 = sin(u_time * 8.0 + distance * 0.2) * 0.3;
          float fire2 = sin(u_time * 12.0 + distance * 0.15) * 0.2;
          finalIntensity *= (0.7 + fire1 + fire2);
        } else if (lightType == 6) { // Lightning
          float lightning = step(0.95, sin(u_time * 50.0)) * 2.0;
          finalIntensity *= max(0.1, lightning);
        }
        
        return attenuation * finalIntensity;
      }
      
      void main() {
        vec2 fragCoord = v_texCoord * u_resolution;
        
        // Start with ambient lighting
        vec3 finalColor = u_ambientColor * u_ambientIntensity;
        
        // Add contribution from each light
        for (int i = 0; i < 32; i++) {
          if (i >= u_lightCount) break;
          
          float contribution = calculateLightContribution(i, fragCoord);
          if (contribution > 0.0) {
            finalColor += u_lightColors[i] * contribution;
          }
        }
        
        // Clamp to prevent over-bright areas
        finalColor = min(finalColor, vec3(1.0));
        
        gl_FragColor = vec4(finalColor, 1.0);
      }
    `;this.lightingShaderProgram=this.createShaderProgram(i,n);const r=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);this.quadVertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadVertexBuffer),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),this.createLightingFramebuffer()}createShaderProgram(e,i){const n=this.gl;if(!n)return null;const r=this.compileShader(n.VERTEX_SHADER,e),o=this.compileShader(n.FRAGMENT_SHADER,i);if(!r||!o)return null;const s=n.createProgram();return s?(n.attachShader(s,r),n.attachShader(s,o),n.linkProgram(s),n.getProgramParameter(s,n.LINK_STATUS)?s:(console.error("Lighting shader program linking failed:",n.getProgramInfoLog(s)),n.deleteProgram(s),null)):null}compileShader(e,i){const n=this.gl;if(!n)return null;const r=n.createShader(e);return r?(n.shaderSource(r,i),n.compileShader(r),n.getShaderParameter(r,n.COMPILE_STATUS)?r:(console.error("Lighting shader compilation failed:",n.getShaderInfoLog(r)),n.deleteShader(r),null)):null}createLightingFramebuffer(){const e=this.gl;if(!e){console.warn("WebGL context not available - skipping lighting framebuffer creation");return}this.lightingFramebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.lightingFramebuffer),this.lightingTexture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.lightingTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.canvas.width,this.canvas.height,0,e.RGBA,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.lightingTexture,0),e.checkFramebufferStatus(e.FRAMEBUFFER)!==e.FRAMEBUFFER_COMPLETE&&console.error("Lighting framebuffer is not complete"),e.bindFramebuffer(e.FRAMEBUFFER,null)}addLight(e){const i={...e,timeAlive:0};return this.lights.set(e.id,i),i}removeLight(e){this.lights.delete(e)}updateLight(e,i){const n=this.lights.get(e);n&&Object.assign(n,i)}getLight(e){return this.lights.get(e)}createSnakeGlow(e,i){const n="snake_glow";this.removeLight(n);let r,o,s,a;switch(i){case 1:return n;case 2:r=[.3,.8,.3],o=.3,s=60,a="static";break;case 3:r=[.6,.2,.8],o=.4,s=70,a="pulsing";break;case 4:r=[.8,.6,.2],o=.5,s=80,a="glowing";break;case 5:r=[1,.8,.3],o=.6,s=90,a="pulsing";break;case 6:r=[.2,.7,.9],o=.7,s=100,a="glowing";break;case 7:r=[.8,.5,1],o=.8,s=120,a="mystical";break;case 8:r=[.9,.9,1],o=1,s=150,a="mystical";break;case 9:r=[1,.4,.1],o=1.2,s=180,a="fire";break;case 10:r=[1,.9,.3],o=1.5,s=200,a="mystical";break;default:r=[.5,.5,.5],o=.2,s=50,a="static"}return this.addLight({id:n,position:{...e},color:r,intensity:o,radius:s,type:a,isActive:!0,pulseSpeed:2,pulseIntensity:.3,flickerSpeed:8,flickerIntensity:.2}),n}createPowerLight(e,i,n=2){const r=`power_${i}_${Date.now()}`;let o,s,a,l;switch(i){case"SpeedBoost":o=[.3,.8,1],s=.8,a=100,l="pulsing";break;case"VenomStrike":o=[.6,.2,.8],s=1,a=80,l="flickering";break;case"FireBreath":o=[1,.3,0],s=1.5,a=150,l="fire";break;case"TimeWarp":o=[.8,.9,1],s=1.2,a=200,l="mystical";break;case"Invisibility":o=[1,1,1],s=.5,a=60,l="flickering";break;default:o=[.8,.8,.8],s=.6,a=80,l="glowing"}return this.addLight({id:r,position:{...e},color:o,intensity:s,radius:a,type:l,isActive:!0,lifetime:n,pulseSpeed:4,pulseIntensity:.4,flickerSpeed:12,flickerIntensity:.3}),r}createEnvironmentalLight(e,i){const n=`env_${i}_${Date.now()}`;let r,o,s,a;switch(i){case"CrystalFormation":r=[.6,.8,1],o=.6,s=90,a="glowing";break;case"FlameGeyser":r=[1,.4,.1],o=1,s=120,a="fire";break;case"MysticalPortal":r=[.8,.4,1],o=.8,s=100,a="mystical";break;case"LightningStrike":r=[1,1,.8],o=2,s=200,a="lightning";break;default:r=[.5,.5,.6],o=.4,s=70,a="static"}return this.addLight({id:n,position:{...e},color:r,intensity:o,radius:s,type:a,isActive:!0,lifetime:i==="LightningStrike"?.2:-1,pulseSpeed:3,pulseIntensity:.5,flickerSpeed:15,flickerIntensity:.4}),n}updateAmbientLighting(e,i="default"){switch(this.ambientLighting.evolutionModifier=Math.min(2,1+(e-1)*.1),i){case"mystical_forest":this.ambientLighting.environmentModifier=.8,this.ambientLighting.baseColor=[.15,.25,.2];break;case"ancient_temple":this.ambientLighting.environmentModifier=.6,this.ambientLighting.baseColor=[.25,.2,.15];break;case"crystal_cavern":this.ambientLighting.environmentModifier=.9,this.ambientLighting.baseColor=[.2,.25,.35];break;default:this.ambientLighting.environmentModifier=1,this.ambientLighting.baseColor=[.2,.25,.35]}}update(e){const i=e/1e3;this.frameTime+=e;for(const[n,r]of this.lights)if(r.isActive&&(r.timeAlive!==void 0&&(r.timeAlive+=i),r.lifetime!==void 0&&r.lifetime>0&&r.timeAlive!==void 0&&r.timeAlive>=r.lifetime)){r.isActive=!1;continue}for(const[n,r]of this.lights)r.isActive||this.lights.delete(n);this.frameTime-this.lastPerformanceCheck>this.performanceCheckInterval&&(this.checkPerformance(),this.lastPerformanceCheck=this.frameTime)}checkPerformance(){const e=this.lights.size;e>this.config.maxLights*.8&&!this.config.performanceMode?(console.warn("High light count detected, enabling performance mode"),this.config.performanceMode=!0,this.config.shadowQuality="low"):e<this.config.maxLights*.5&&this.config.performanceMode&&(console.log("Light count reduced, disabling performance mode"),this.config.performanceMode=!1,this.config.shadowQuality="medium")}render(e){if(!this.lightingShaderProgram||!this.quadVertexBuffer)return;const i=this.gl;if(!i)return;i.bindFramebuffer(i.FRAMEBUFFER,this.lightingFramebuffer),i.viewport(0,0,this.canvas.width,this.canvas.height);const n=this.ambientLighting.intensity*this.ambientLighting.evolutionModifier*this.ambientLighting.environmentModifier;i.clearColor(this.ambientLighting.baseColor[0]*n,this.ambientLighting.baseColor[1]*n,this.ambientLighting.baseColor[2]*n,1),i.clear(i.COLOR_BUFFER_BIT),i.useProgram(this.lightingShaderProgram);const r=i.getUniformLocation(this.lightingShaderProgram,"u_resolution"),o=i.getUniformLocation(this.lightingShaderProgram,"u_ambientColor"),s=i.getUniformLocation(this.lightingShaderProgram,"u_ambientIntensity"),a=i.getUniformLocation(this.lightingShaderProgram,"u_time"),l=i.getUniformLocation(this.lightingShaderProgram,"u_lightCount");i.uniform2f(r,this.canvas.width,this.canvas.height),i.uniform3fv(o,this.ambientLighting.baseColor),i.uniform1f(s,n),i.uniform1f(a,e/1e3);const u=Array.from(this.lights.values()).filter(x=>x.isActive),d=Math.min(u.length,this.config.maxLights);if(i.uniform1i(l,d),d>0){const x=new Float32Array(d*2),S=new Float32Array(d*3),E=new Float32Array(d),D=new Float32Array(d),g=new Int32Array(d),h=new Float32Array(d),y=new Float32Array(d),w=new Float32Array(d),M=new Float32Array(d);for(let P=0;P<d;P++){const k=u[P];x[P*2]=k.position.x,x[P*2+1]=k.position.y,S[P*3]=k.color[0],S[P*3+1]=k.color[1],S[P*3+2]=k.color[2],E[P]=k.intensity,D[P]=k.radius,g[P]=this.getLightTypeId(k.type),h[P]=k.flickerSpeed||8,y[P]=k.flickerIntensity||.2,w[P]=k.pulseSpeed||2,M[P]=k.pulseIntensity||.3}i.uniform2fv(i.getUniformLocation(this.lightingShaderProgram,"u_lightPositions"),x),i.uniform3fv(i.getUniformLocation(this.lightingShaderProgram,"u_lightColors"),S),i.uniform1fv(i.getUniformLocation(this.lightingShaderProgram,"u_lightIntensities"),E),i.uniform1fv(i.getUniformLocation(this.lightingShaderProgram,"u_lightRadii"),D),i.uniform1iv(i.getUniformLocation(this.lightingShaderProgram,"u_lightTypes"),g),i.uniform1fv(i.getUniformLocation(this.lightingShaderProgram,"u_lightFlickerSpeeds"),h),i.uniform1fv(i.getUniformLocation(this.lightingShaderProgram,"u_lightFlickerIntensities"),y),i.uniform1fv(i.getUniformLocation(this.lightingShaderProgram,"u_lightPulseSpeeds"),w),i.uniform1fv(i.getUniformLocation(this.lightingShaderProgram,"u_lightPulseIntensities"),M)}i.bindBuffer(i.ARRAY_BUFFER,this.quadVertexBuffer);const m=i.getAttribLocation(this.lightingShaderProgram,"a_position"),p=i.getAttribLocation(this.lightingShaderProgram,"a_texCoord");i.enableVertexAttribArray(m),i.enableVertexAttribArray(p),i.vertexAttribPointer(m,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(p,2,i.FLOAT,!1,16,8),i.drawArrays(i.TRIANGLE_STRIP,0,4),i.bindFramebuffer(i.FRAMEBUFFER,null)}getLightTypeId(e){switch(e){case"static":return 0;case"flickering":return 1;case"pulsing":return 2;case"glowing":return 3;case"mystical":return 4;case"fire":return 5;case"lightning":return 6;default:return 0}}getLightingTexture(){return this.lightingTexture}getPerformanceMetrics(){return{lightCount:this.lights.size,performanceMode:this.config.performanceMode,frameTime:this.frameTime}}getActiveLightCount(){return Array.from(this.lights.values()).filter(e=>e.isActive).length}reset(){this.lights.clear(),this.ambientLighting={baseColor:[.2,.2,.3],intensity:.3,evolutionModifier:1,environmentModifier:1},this.frameTime=0,this.lastPerformanceCheck=0}dispose(){const e=this.gl;e&&(this.lightingShaderProgram&&e.deleteProgram(this.lightingShaderProgram),this.lightingFramebuffer&&e.deleteFramebuffer(this.lightingFramebuffer),this.lightingTexture&&e.deleteTexture(this.lightingTexture),this.quadVertexBuffer&&e.deleteBuffer(this.quadVertexBuffer),this.lights.clear())}}class xf{constructor(e){c(this,"canvas");c(this,"gl",null);c(this,"config");c(this,"state");c(this,"animationFrameId",null);c(this,"snakeManager");c(this,"snakeRenderer");c(this,"visualPatternManager");c(this,"inputManager");c(this,"environmentSystem");c(this,"environmentRenderer");c(this,"particleSystem");c(this,"scoreSystem");c(this,"gameStateManager");c(this,"foodManager");c(this,"audioManager");c(this,"lightingSystem");c(this,"powerSystem");c(this,"performanceMonitor");c(this,"memoryManager");c(this,"errorHandler");c(this,"assetLoader");c(this,"responsiveManager");c(this,"browserCompatibility");c(this,"fallbackState",{webglFallback:!1,audioFallback:!1,reducedEffects:!1,lowQualityMode:!1});c(this,"currentQuality",{particleQuality:"high",lightingQuality:"high",textureQuality:"high",shadowQuality:"high",effectsEnabled:!0});c(this,"gameLoop",()=>{if(!this.state.isRunning)return;this.performanceMonitor.startFrame();const e=performance.now();this.state.deltaTime=e-this.state.lastFrameTime,this.state.lastFrameTime=e,this.state.fps=1e3/this.state.deltaTime;try{this.gameStateManager.update(this.state.deltaTime),!this.gameStateManager.isGamePaused()&&!this.gameStateManager.isGameOver()&&this.update(this.state.deltaTime),this.render(),this.updatePerformanceMetrics()}catch(i){this.errorHandler.handleError({type:"general",message:`Game loop error: ${i}`,stack:i instanceof Error?i.stack:void 0,timestamp:Date.now(),severity:"high"})}this.performanceMonitor.endFrame(),this.animationFrameId=requestAnimationFrame(this.gameLoop)});this.canvas=e,this.browserCompatibility=new $s,this.errorHandler=new ff,this.setupErrorHandling(),this.gl=this.errorHandler.createSafeWebGLContext(e),this.gl||(console.warn("WebGL not available, falling back to canvas rendering"),this.fallbackState.webglFallback=!0),this.config={gridWidth:50,gridHeight:35,cellSize:35,targetFPS:60},this.state={isRunning:!1,isPaused:!1,lastFrameTime:0,deltaTime:0,fps:0},this.performanceMonitor=new uf,this.memoryManager=new hf(this.gl),this.assetLoader=new gf,this.setupPerformanceMonitoring(),this.setupCanvas(),this.setupWebGL(),this.initializeGameSystems()}setupCanvas(){const e=this.config.gridWidth*this.config.cellSize,i=this.config.gridHeight*this.config.cellSize;this.canvas.width=e,this.canvas.height=i,this.canvas.style.width=`${e}px`,this.canvas.style.height=`${i}px`}setupErrorHandling(){this.errorHandler.setFallbackChangeCallback(e=>{this.fallbackState=e,this.handleFallbackStateChange(e)}),this.errorHandler.setCriticalErrorCallback(e=>{console.error("Critical error occurred:",e),this.handleCriticalError(e)})}setupPerformanceMonitoring(){this.performanceMonitor.setQualityChangeCallback(e=>{this.currentQuality=e,this.applyQualitySettings(e)})}handleFallbackStateChange(e){e.webglFallback&&!this.fallbackState.webglFallback&&(console.warn("Switching to WebGL fallback mode"),this.reinitializeWithFallback()),e.audioFallback&&!this.fallbackState.audioFallback&&console.warn("Audio disabled due to errors"),e.reducedEffects&&(console.warn("Reducing visual effects for better performance"),this.currentQuality.effectsEnabled=!1,this.applyQualitySettings(this.currentQuality))}handleCriticalError(e){this.fallbackState.lowQualityMode=!0,this.currentQuality={particleQuality:"low",lightingQuality:"low",textureQuality:"low",shadowQuality:"low",effectsEnabled:!1},this.applyQualitySettings(this.currentQuality)}applyQualitySettings(e){if(this.particleSystem){const i=e.particleQuality==="high"?1500:e.particleQuality==="medium"?750:300;this.particleSystem.setMaxParticles(i),this.particleSystem.setEffectsEnabled(e.effectsEnabled)}this.snakeRenderer&&this.snakeRenderer.setQuality(e),this.environmentRenderer&&this.environmentRenderer.setQuality(e)}reinitializeWithFallback(){try{this.particleSystem&&this.particleSystem.dispose(),this.particleSystem=new nl(this.gl,{maxParticles:300,enableBatching:!1,enableCulling:!0,cullDistance:Math.max(this.canvas.width,this.canvas.height)})}catch(e){this.errorHandler.handleError({type:"general",message:`Fallback initialization failed: ${e}`,timestamp:Date.now(),severity:"high"})}}setupWebGL(){if(!this.gl)return;const e=this.gl;try{e.viewport(0,0,this.canvas.width,this.canvas.height),e.clearColor(.1,.1,.18,1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)}catch(i){this.errorHandler.handleError({type:"webgl",message:`WebGL setup failed: ${i}`,timestamp:Date.now(),severity:"high"})}}initializeGameSystems(){this.scoreSystem=new af,this.gameStateManager=new lf(this.scoreSystem,{deathAnimationDuration:2e3,pauseOnFocusLoss:!0,enableAutoSave:!0}),this.inputManager=new rf(this.canvas);const e={x:Math.floor(this.config.gridWidth/2),y:Math.floor(this.config.gridHeight/2)};this.snakeManager=new Jh(this.config,e),this.visualPatternManager=new tf;const i={gl:this.gl,canvas:this.canvas,cellSize:this.config.cellSize,gridWidth:this.config.gridWidth,gridHeight:this.config.gridHeight};this.snakeRenderer=new ef(i),this.environmentSystem=new of(this.config);const n={gl:this.gl,canvas:this.canvas,cellSize:this.config.cellSize,gridWidth:this.config.gridWidth,gridHeight:this.config.gridHeight};this.environmentRenderer=new sf(n),this.particleSystem=new nl(this.gl,{maxParticles:1500,enableBatching:!0,enableCulling:!0,cullDistance:Math.max(this.canvas.width,this.canvas.height)*1.5}),this.foodManager=new pf(this.config),this.audioManager=new vf,this.audioManager.initialize().catch(o=>{console.warn("Audio initialization failed:",o)});const r={maxLights:20,enableShadows:!0,shadowQuality:"medium",ambientIntensity:.3,lightFalloffExponent:2,performanceMode:!1};this.lightingSystem=new Sf(this.gl,this.canvas,r),this.powerSystem=new xc(this.config),this.setupInputHandling(),this.setupGameStateCallbacks()}setupInputHandling(){this.inputManager.onDirectionChange=e=>{!this.gameStateManager.isGamePaused()&&!this.gameStateManager.isGameOver()&&this.snakeManager.queueDirection(e)},this.inputManager.onPowerActivate=e=>{if(this.gameStateManager.isGamePaused()||this.gameStateManager.isGameOver())return;const i=this.snakeManager.activatePower(e);if(i.success){console.log(`Power activated: ${i.message}`);const n=this.snakeManager.getEvolutionSystem().getCurrentLevel();this.scoreSystem.addPowerUsageBonus(e,n,!0),this.audioManager.playPowerActivation(e),this.handlePowerParticleEffects(i),this.handlePowerLightingEffects(i)}else console.log(`Power activation failed: ${i.message}`)},this.inputManager.onTailClick=e=>{if(this.gameStateManager.isGamePaused()||this.gameStateManager.isGameOver())return;const i=this.snakeManager.getClickableSegmentInfo(e);if(i&&i.isConsumable){const n=this.snakeManager.consumeTailFromSegment(i.segmentIndex);if(n.success){if(console.log(`Tail consumption: ${n.message}`),n.strategicAdvantage){const r=this.snakeManager.getEvolutionSystem().getCurrentLevel();this.scoreSystem.addTailConsumptionBonus(n.strategicAdvantage,r)}this.handleTailConsumptionEffects(n,i.position),n.strategicAdvantage&&this.applyStrategicAdvantages(n.strategicAdvantage)}else console.log(`Tail consumption failed: ${n.message}`)}else i&&!i.isConsumable&&console.log("Cannot consume this segment - only tail segments are consumable")}}setupGameStateCallbacks(){this.gameStateManager.onGameOver(e=>{console.log(`Game Over: ${e.deathReason}`),console.log(`Final Score: ${e.finalScore}`),console.log(`Evolution Level: ${e.finalEvolutionLevel}`),console.log(`Survival Time: ${this.scoreSystem.getFormattedSurvivalTime()}`)})}start(){this.gameStateManager.isGameRunning()||(this.gameStateManager.startGame(),this.state.isRunning=!0,this.state.lastFrameTime=performance.now(),this.gameLoop())}stop(){this.gameStateManager.stopGame(),this.state.isRunning=!1,this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}pause(){const e=this.gameStateManager.isGamePaused();this.gameStateManager.togglePause(),this.state.isPaused=this.gameStateManager.isGamePaused(),!e&&this.gameStateManager.isGamePaused()?this.audioManager.playGamePause():e&&!this.gameStateManager.isGamePaused()&&this.audioManager.playGameResume()}restart(){const e={x:Math.floor(this.config.gridWidth/2),y:Math.floor(this.config.gridHeight/2)};this.snakeManager.reset(e),this.environmentSystem.reset(),this.foodManager.clearAllFood(),this.foodManager.clearActiveEffects(),this.foodManager.clearConsumptionHistory(),this.visualPatternManager.reset(),this.particleSystem.clear(),this.lightingSystem.reset(),this.audioManager.startBackgroundAudio(),this.gameStateManager.restartGame(),this.state.isRunning||this.start()}updatePerformanceMetrics(){const e=this.memoryManager.getMemoryStats(),i=this.particleSystem?this.particleSystem.getActiveParticleCount():0;this.performanceMonitor.updateMetrics({memoryUsage:this.performanceMonitor.getMemoryUsage(),particleCount:i,renderCalls:this.getRenderCallCount()}),e.textureMemory>200*1024*1024&&this.memoryManager.performGarbageCollection()}getRenderCallCount(){let e=1;if(this.snakeRenderer&&(e+=1),this.environmentRenderer&&(e+=1),this.particleSystem){const i=this.particleSystem.getActiveParticleCount();e+=Math.ceil(i/100)}return e}update(e){this.inputManager.update(e),this.environmentSystem.update(e),this.snakeManager.update(e);const i=this.snakeManager.getSnakeState(),n=[i.head,...i.segments.map(o=>({x:o.x,y:o.y}))],r=this.environmentSystem.getObstacles().map(o=>o.position);this.foodManager.update(e,n,r,i.evolutionLevel),this.lightingSystem.update(e),this.handleCollisions(),this.handleFoodConsumption(),this.visualPatternManager.update(e),this.snakeRenderer.update(e),this.environmentRenderer.update(e),this.particleSystem.update(e),this.handleEvolutionTransitions()}handleCollisions(){const e=this.snakeManager.getSnakeState();if(this.snakeManager.checkSelfCollision()){this.triggerGameOver(se.SelfCollision);return}if(this.snakeManager.checkWallCollision()){this.triggerGameOver(se.WallCollision);return}const i=this.environmentSystem.checkSnakeObstacleCollision(e.head,e.segments.map(r=>({x:r.x,y:r.y})));if(i.hasCollision&&i.obstacle){this.triggerGameOver(se.ObstacleCollision);return}const n=this.environmentSystem.checkSnakeDynamicElementCollision(e.head,e.segments.map(r=>({x:r.x,y:r.y})),e.evolutionLevel);if(n.hasCollision&&n.damage>0&&!n.canPass){this.triggerGameOver(se.EnvironmentalHazard);return}}handleFoodConsumption(){const e=this.snakeManager.getSnakeState(),i=this.snakeManager.getEvolutionSystem(),n=this.foodManager.getFoodAtPosition(e.head);if(n){const r=this.foodManager.consumeFood(n.id,e.evolutionLevel);if(r.success){this.scoreSystem.addFoodPoints(n.type,r.pointsAwarded,e.evolutionLevel),r.segmentsToGrow>0?this.snakeManager.grow(r.segmentsToGrow):r.segmentsToGrow<0&&this.snakeManager.shrink(Math.abs(r.segmentsToGrow)),r.evolutionProgress>0&&i.addEvolutionProgress(r.evolutionProgress),this.applyFoodEffects(r.effects);const o=!this.isFoodAppropriateForLevel(n.type,e.evolutionLevel),s=r.pointsAwarded>n.points;this.audioManager.playFoodConsumption(n.type,o,s);const a={x:n.position.x*this.config.cellSize+this.config.cellSize/2,y:n.position.y*this.config.cellSize+this.config.cellSize/2};o?this.particleSystem.createNegativeFoodEffect(a,n.type):n.isSpecial?this.particleSystem.createSpecialFoodEffect(a,n.type):this.particleSystem.createFoodConsumptionEffect(a,n.type),n.isSpecial&&this.lightingSystem.addTemporaryLight({position:a,color:this.getFoodLightColor(n.type),intensity:.8,radius:100,duration:2e3})}}}handleEvolutionTransitions(){const e=this.snakeManager.getEvolutionSystem();if(e.isTransformationInProgress()&&!this.visualPatternManager.isTransitioning()){const i=e.getCurrentLevel(),n=i-1;this.scoreSystem.addEvolutionBonus(n,i),this.visualPatternManager.startTransition(n,i),this.audioManager.playEvolutionSequence();const r=this.snakeManager.getSnakeState(),o={x:r.head.x*this.config.cellSize+this.config.cellSize/2,y:r.head.y*this.config.cellSize+this.config.cellSize/2};this.particleSystem.createEvolutionTransformationEffect(o,n,i),this.lightingSystem.addEvolutionLighting(o,i),this.lightingSystem.updateAmbientLighting(i)}}render(){const e=this.gl;e.clear(e.COLOR_BUFFER_BIT),this.lightingSystem.applyAmbientLighting(e),this.renderEnvironment(),this.renderFood(),this.renderSnake(),this.renderLighting(),this.renderParticles()}renderEnvironment(){const e=this.environmentSystem.getObstacles();this.environmentRenderer.render(e)}renderSnake(){const e=this.snakeManager.getSnakeState(),i=this.snakeManager.getEvolutionSystem(),n=this.visualPatternManager.getCurrentPattern(e.evolutionLevel),r=this.snakeRenderer.createVisualState(e.head,e.segments,e.evolutionLevel,n,i.isTransformationInProgress(),i.getTransformationProgress(),!e.isMoving);this.snakeRenderer.render(r)}renderFood(){this.foodManager.getActiveFoods().forEach(i=>{const n={x:i.position.x*this.config.cellSize,y:i.position.y*this.config.cellSize};this.renderFoodItem(i,n)})}renderFoodItem(e,i){if(!this.gl)return;const n=this.gl,r=this.foodManager.getFoodDefinition(e.type);if(!r)return;const o=this.hexToRgb(r.visualData.color),s=this.config.cellSize*.8;n.clearColor(o.r,o.g,o.b,1);const a=i.x+(this.config.cellSize-s)/2,l=i.y+(this.config.cellSize-s)/2,u=n.getParameter(n.VIEWPORT);n.enable(n.SCISSOR_TEST),n.scissor(a,this.canvas.height-l-s,s,s),n.clear(n.COLOR_BUFFER_BIT),n.disable(n.SCISSOR_TEST),n.viewport(u[0],u[1],u[2],u[3])}renderLighting(){const e=this.snakeManager.getSnakeState();if(e.evolutionLevel>=8){const i={x:e.head.x*this.config.cellSize+this.config.cellSize/2,y:e.head.y*this.config.cellSize+this.config.cellSize/2};this.lightingSystem.addSnakeGlow(i,e.evolutionLevel)}this.lightingSystem.render(this.gl)}renderParticles(){const e={x:this.canvas.width/2,y:this.canvas.height/2};this.particleSystem.render(e)}handlePowerParticleEffects(e){const i=this.snakeManager.getSnakeState(),n={x:i.head.x*this.config.cellSize+this.config.cellSize/2,y:i.head.y*this.config.cellSize+this.config.cellSize/2},r=i.direction;switch(e.powerType){case v.SpeedBoost:this.particleSystem.createSpeedTrailEffect(n,r);break;case v.VenomStrike:this.particleSystem.createVenomStrikeEffect(n,r);break;case v.FireBreath:const o={x:n.x+r.x*200,y:n.y+r.y*200};this.particleSystem.createFireBreathEffect(n,o);break;case v.TimeWarp:this.particleSystem.createTimeWarpEffect(n,150);break;case v.ColorChange:this.particleSystem.createInvisibilityEffect(n);break;default:this.particleSystem.createBurst(n,wc.Sparkle,5,r,Math.PI/3);break}e.environmentalInteractions&&e.environmentalInteractions.forEach(o=>{const s=this.environmentSystem.getObstacles().find(a=>a.id===o.obstacleId);if(s&&o.type==="destroy"){const a={x:s.position.x*this.config.cellSize+s.size.x*this.config.cellSize/2,y:s.position.y*this.config.cellSize+s.size.y*this.config.cellSize/2};switch(s.type){case"CrystalFormation":this.particleSystem.createCrystalDestructionEffect(a);break;case"IceWall":this.particleSystem.createIceDestructionEffect(a);break;case"StonePillar":this.particleSystem.createStoneDestructionEffect(a);break;default:this.particleSystem.createFlameExplosionEffect(a);break}}})}handlePowerLightingEffects(e){const i=this.snakeManager.getSnakeState(),n={x:i.head.x*this.config.cellSize+this.config.cellSize/2,y:i.head.y*this.config.cellSize+this.config.cellSize/2};switch(e.powerType){case v.SpeedBoost:this.lightingSystem.addPowerLight(n,[0,.8,1],.6,150,3e3);break;case v.VenomStrike:this.lightingSystem.addPowerLight(n,[.6,.2,.8],.8,200,2e3);break;case v.FireBreath:const r=i.direction;for(let o=1;o<=5;o++){const s={x:n.x+r.x*o*40,y:n.y+r.y*o*40};this.lightingSystem.addPowerLight(s,[1,.3,0],.9,120,1500)}break;case v.TimeWarp:this.lightingSystem.addPowerLight(n,[.8,0,.8],1,300,5e3);break;case v.ColorChange:this.lightingSystem.addFlickeringLight(n,[.5,.5,1],.3,100,4e3);break;default:this.lightingSystem.addPowerLight(n,[1,1,0],.5,100,2e3);break}}getCanvas(){return this.canvas}getWebGLContext(){return this.gl}getConfig(){return{...this.config}}getState(){return{...this.state}}getSnakeManager(){return this.snakeManager}getVisualPatternManager(){return this.visualPatternManager}getEnvironmentSystem(){return this.environmentSystem}getParticleSystem(){return this.particleSystem}getScoreSystem(){return this.scoreSystem}getGameStateManager(){return this.gameStateManager}handleTailConsumptionEffects(e,i){const n={x:i.x*this.config.cellSize+this.config.cellSize/2,y:i.y*this.config.cellSize+this.config.cellSize/2};this.particleSystem.createTailConsumptionEffect(n,e.segmentsConsumed),e.consumedSegmentPositions&&e.consumedSegmentPositions.forEach((r,o)=>{const s={x:r.x*this.config.cellSize+this.config.cellSize/2,y:r.y*this.config.cellSize+this.config.cellSize/2};setTimeout(()=>{this.particleSystem.createMysticalDissolveEffect(s)},o*100)})}applyStrategicAdvantages(e){if(e.speedBoost){const i=this.snakeManager.getSpeed(),n=i*e.speedBoost.multiplier;this.snakeManager.setSpeed(n),setTimeout(()=>{this.snakeManager.setSpeed(i)},e.speedBoost.duration),console.log(`Speed boost applied: ${e.speedBoost.multiplier}x for ${e.speedBoost.duration}ms`)}e.bonusPoints>0&&console.log(`Bonus points awarded: ${e.bonusPoints}`),e.navigationBonus!=="minor"&&console.log(`Navigation advantage: ${e.navigationBonus}`),e.mysticalEnergy>0&&console.log(`Mystical energy gained: ${e.mysticalEnergy}`)}async loadAssets(e){try{return await this.assetLoader.preloadCriticalAssets(e)||console.warn("Critical assets failed to load, continuing with fallbacks"),this.assetLoader.loadRemainingAssets(e).catch(n=>{this.errorHandler.handleError({type:"general",message:`Background asset loading failed: ${n}`,timestamp:Date.now(),severity:"low"})}),!0}catch(i){return this.errorHandler.handleError({type:"general",message:`Asset loading failed: ${i}`,timestamp:Date.now(),severity:"medium"}),!1}}getPerformanceMetrics(){return this.performanceMonitor.getMetrics()}getMemoryStats(){return this.memoryManager.getMemoryStats()}getErrorLog(){return this.errorHandler.getErrorLog()}getFallbackState(){return this.fallbackState}getCurrentQuality(){return this.currentQuality}setQuality(e){Object.assign(this.currentQuality,e),this.applyQualitySettings(this.currentQuality)}enableResponsiveMode(e){this.responsiveManager||(this.responsiveManager=new mf(this.canvas,this.config),this.responsiveManager.onResize=(i,n)=>{this.handleCanvasResize(n.width,n.height),this.inputManager&&this.inputManager.isTouchEnabled()&&(this.inputManager.updateTouchControlPositions(n.width,n.height),this.inputManager.showVirtualControls(i.isMobile)),e&&e(i,n)})}handleResize(e,i){this.handleCanvasResize(e,i)}handleCanvasResize(e,i){this.gl&&this.gl.viewport(0,0,e,i),this.snakeRenderer&&this.snakeRenderer.updateViewport&&this.snakeRenderer.updateViewport(e,i),this.environmentRenderer&&this.environmentRenderer.updateViewport&&this.environmentRenderer.updateViewport(e,i),this.particleSystem&&this.particleSystem.updateViewport(e,i),this.lightingSystem&&this.lightingSystem.updateViewport(e,i)}isFoodAppropriateForLevel(e,i){const n=this.foodManager.getFoodDefinition(e);return n?Math.abs(n.evolutionLevel-i)<=2&&n.evolutionLevel<=i+3:!1}applyFoodEffects(e){e.forEach(i=>{switch(i.type){case"SpeedBoost":this.snakeManager.applySpeedModifier(i.magnitude,i.duration);break;case"SlowDown":this.snakeManager.applySpeedModifier(i.magnitude,i.duration);break;case"Poison":console.log(`Poison effect applied: magnitude ${i.magnitude}, duration ${i.duration}`);break;case"ReversedControls":this.inputManager.setReversedControls(!0,i.duration);break;case"BlurredVision":this.particleSystem.addScreenEffect("blur",i.duration,i.magnitude);break;case"DisablePowers":this.snakeManager.disablePowers(i.duration);break;case"Invincibility":this.snakeManager.setInvincibility(!0,i.duration);break;case"Regeneration":this.snakeManager.enableRegeneration(i.duration,i.magnitude);break;case"PowerCooldownReduction":this.snakeManager.reducePowerCooldowns(i.magnitude,i.duration);break;case"DoublePoints":this.scoreSystem.setPointsMultiplier(i.magnitude,i.duration);break;case"TimeWarp":this.applyTimeWarpEffect(i.magnitude,i.duration);break;default:console.log(`Unknown food effect: ${i.type}`)}})}applyTimeWarpEffect(e,i){this.environmentSystem.setTimeScale(e),this.particleSystem.setTimeScale(e),setTimeout(()=>{this.environmentSystem.setTimeScale(1),this.particleSystem.setTimeScale(1)},i)}getFoodLightColor(e){switch(e){case F.CrystalFruit:return[.5,.8,1];case F.VenomousFlower:return[.6,.2,.8];case F.RainbowNectar:return[1,.4,.7];case F.StardustBerry:return[.3,0,.5];case F.DragonScale:return[.9,.1,.1];case F.EternalOrb:return[1,.8,0];case F.OuroborosEssence:return[.5,0,.5];default:return[1,1,1]}}hexToRgb(e){const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return i?{r:parseInt(i[1],16)/255,g:parseInt(i[2],16)/255,b:parseInt(i[3],16)/255}:{r:1,g:1,b:1}}triggerGameOver(e){const i=this.snakeManager.getEvolutionSystem().getCurrentLevel(),n=this.snakeManager.getSnakeState();this.audioManager.playGameOver(),this.audioManager.stopBackgroundAudio();const r={x:n.head.x*this.config.cellSize+this.config.cellSize/2,y:n.head.y*this.config.cellSize+this.config.cellSize/2};this.particleSystem.createDeathEffect(r,i),this.lightingSystem.addDeathLighting(r),this.gameStateManager.triggerGameOver(e,i,{x:n.head.x,y:n.head.y})}getFoodManager(){return this.foodManager}getAudioManager(){return this.audioManager}getLightingSystem(){return this.lightingSystem}dispose(){this.stop(),this.audioManager&&this.audioManager.dispose(),this.particleSystem&&this.particleSystem.dispose(),this.lightingSystem&&this.lightingSystem.dispose(),this.memoryManager&&this.memoryManager.dispose(),this.gl&&this.gl.getExtension("WEBGL_lose_context")&&this.gl.getExtension("WEBGL_lose_context").loseContext()}getBrowserCompatibility(){return this.browserCompatibility}getResponsiveManager(){return this.responsiveManager}}class wf{constructor(e){c(this,"gameEngine");c(this,"optimizationLevel","high");c(this,"targetFPS",60);c(this,"performanceHistory",[]);c(this,"lastOptimizationTime",0);this.gameEngine=e,this.setupOptimization()}setupOptimization(){setInterval(()=>{this.checkAndOptimize()},5e3)}checkAndOptimize(){const e=performance.now();if(e-this.lastOptimizationTime<1e4)return;const i=this.gameEngine.getPerformanceMetrics();this.performanceHistory.push(i.fps),this.performanceHistory.length>10&&this.performanceHistory.shift();const n=this.performanceHistory.reduce((r,o)=>r+o,0)/this.performanceHistory.length;n<this.targetFPS*.8?this.reduceQuality():n>this.targetFPS*.95&&this.optimizationLevel!=="high"&&this.increaseQuality(),this.lastOptimizationTime=e}reduceQuality(){switch(console.log("Reducing graphics quality for better performance"),this.optimizationLevel){case"high":this.optimizationLevel="medium",this.gameEngine.setQuality({particleQuality:"medium",lightingQuality:"medium",textureQuality:"medium",shadowQuality:"medium",effectsEnabled:!0});break;case"medium":this.optimizationLevel="low",this.gameEngine.setQuality({particleQuality:"low",lightingQuality:"low",textureQuality:"low",shadowQuality:"low",effectsEnabled:!1});break}}increaseQuality(){switch(console.log("Increasing graphics quality"),this.optimizationLevel){case"low":this.optimizationLevel="medium",this.gameEngine.setQuality({particleQuality:"medium",lightingQuality:"medium",textureQuality:"medium",shadowQuality:"medium",effectsEnabled:!0});break;case"medium":this.optimizationLevel="high",this.gameEngine.setQuality({particleQuality:"high",lightingQuality:"high",textureQuality:"high",shadowQuality:"high",effectsEnabled:!0});break}}optimizeForDevice(){this.gameEngine.getCanvas();const e=this.gameEngine.getWebGLContext();if(!e){this.optimizationLevel="low";return}/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.optimizationLevel="medium",this.targetFPS=30);const n=e.getParameter(e.MAX_TEXTURE_SIZE),r=e.getParameter(e.MAX_RENDERBUFFER_SIZE);(n<2048||r<2048)&&(this.optimizationLevel="low"),this.applyOptimization()}applyOptimization(){const e={particleQuality:this.optimizationLevel,lightingQuality:this.optimizationLevel,textureQuality:this.optimizationLevel,shadowQuality:this.optimizationLevel,effectsEnabled:this.optimizationLevel!=="low"};this.gameEngine.setQuality(e)}getOptimizationLevel(){return this.optimizationLevel}getPerformanceReport(){const e=this.gameEngine.getPerformanceMetrics(),i=this.gameEngine.getMemoryStats();return{currentFPS:e.fps,averageFPS:this.performanceHistory.length>0?this.performanceHistory.reduce((n,r)=>n+r,0)/this.performanceHistory.length:0,optimizationLevel:this.optimizationLevel,memoryUsage:i.textureMemory+i.bufferMemory,particleCount:e.particleCount,renderCalls:e.renderCalls,recommendations:this.getRecommendations()}}getRecommendations(){const e=[],i=this.gameEngine.getPerformanceMetrics();return i.fps<30&&e.push("Consider reducing graphics quality"),i.particleCount>1e3&&e.push("High particle count detected - may impact performance"),i.memoryUsage>200&&e.push("High memory usage detected"),i.renderCalls>50&&e.push("High render call count - consider batching"),e}}class rl{constructor(e){c(this,"gameEngine");c(this,"polishEffects",new Map);this.gameEngine=e,this.setupPolishEffects()}setupPolishEffects(){this.polishEffects.set("screenShake",{intensity:0,duration:0,timeRemaining:0}),this.polishEffects.set("colorGrading",{enabled:!0,evolutionLevel:1}),this.polishEffects.set("cameraEffects",{zoom:1,targetZoom:1,smoothing:.1})}addScreenShake(e,i){const n=this.polishEffects.get("screenShake");n&&(n.intensity=Math.max(n.intensity,e),n.duration=i,n.timeRemaining=i)}updateColorGrading(e){const i=this.polishEffects.get("colorGrading");i&&(i.evolutionLevel=e)}setCameraZoom(e){const i=this.polishEffects.get("cameraEffects");i&&(i.targetZoom=e)}update(e){this.updateScreenShake(e),this.updateCameraEffects(e)}updateScreenShake(e){const i=this.polishEffects.get("screenShake");i&&i.timeRemaining>0&&(i.timeRemaining-=e,i.timeRemaining<=0&&(i.intensity=0,i.timeRemaining=0))}updateCameraEffects(e){const i=this.polishEffects.get("cameraEffects");if(i){const n=i.targetZoom-i.zoom;i.zoom+=n*i.smoothing*(e/16.67)}}getScreenShakeOffset(){const e=this.polishEffects.get("screenShake");if(e&&e.intensity>0){const i=e.intensity*(e.timeRemaining/e.duration);return{x:(Math.random()-.5)*i*10,y:(Math.random()-.5)*i*10}}return{x:0,y:0}}getCameraZoom(){const e=this.polishEffects.get("cameraEffects");return e?e.zoom:1}getColorGradingLevel(){const e=this.polishEffects.get("colorGrading");return e?e.evolutionLevel:1}}class ol{constructor(e){c(this,"gameEngine");c(this,"flowState","tutorial");c(this,"milestones",new Set);this.gameEngine=e,this.setupFlowTracking()}setupFlowTracking(){this.gameEngine.getSnakeManager().getEvolutionSystem(),setInterval(()=>{this.checkFlowProgress()},1e3)}checkFlowProgress(){const i=this.gameEngine.getSnakeManager().getCurrentEvolutionLevel(),r=this.gameEngine.getScoreSystem().getCurrentScore();i>=8?this.flowState="endgame":i>=5?this.flowState="late_game":i>=3?this.flowState="mid_game":r>100&&(this.flowState="early_game"),this.checkMilestones(i,r)}checkMilestones(e,i){e>=2&&!this.milestones.has("first_evolution")&&(this.milestones.add("first_evolution"),this.triggerMilestone("First Evolution!","You evolved to Garden Snake")),e>=2&&!this.milestones.has("first_power")&&(this.milestones.add("first_power"),this.triggerMilestone("Power Unlocked!","Speed Boost is now available")),e>=5&&!this.milestones.has("mid_game")&&(this.milestones.add("mid_game"),this.triggerMilestone("Halfway There!","You reached Cobra level")),e>=10&&!this.milestones.has("ouroboros")&&(this.milestones.add("ouroboros"),this.triggerMilestone("OUROBOROS ACHIEVED!","You have reached the ultimate form")),i>=1e3&&!this.milestones.has("score_1000")&&(this.milestones.add("score_1000"),this.triggerMilestone("Score Master!","1000 points achieved"))}triggerMilestone(e,i){console.log(`🎉 MILESTONE: ${e} - ${i}`);const n=this.gameEngine.getParticleSystem(),o=this.gameEngine.getSnakeManager().getSnakeState(),s={x:o.head.x*35+17.5,y:o.head.y*35+17.5};n.createBurst(s,"sparkle",20,{x:0,y:0},Math.PI*2)}getFlowState(){return this.flowState}getMilestones(){return Array.from(this.milestones)}getProgressSummary(){const e=this.gameEngine.getSnakeManager(),i=e.getCurrentEvolutionLevel(),n=this.gameEngine.getScoreSystem();return{flowState:this.flowState,evolutionLevel:i,evolutionName:e.getEvolutionSystem().getCurrentEvolutionName(),score:n.getCurrentScore(),milestonesAchieved:this.milestones.size,totalMilestones:6,progressPercentage:Math.min(100,i/10*100)}}}class Cf{constructor(e){c(this,"gameEngine");c(this,"optimizer");c(this,"polishManager");c(this,"flowManager");c(this,"isInitialized",!1);this.gameEngine=new xf(e),this.optimizer=new wf(this.gameEngine),this.polishManager=new rl(this.gameEngine),this.flowManager=new ol(this.gameEngine),this.setupIntegration()}setupIntegration(){this.setupEnhancedCallbacks(),this.optimizer.optimizeForDevice(),this.gameEngine.getAudioManager().startBackgroundAudio(),this.isInitialized=!0}setupEnhancedCallbacks(){const e=this.gameEngine.getSnakeManager(),i=e.getEvolutionSystem(),n=this.gameEngine.getGameStateManager();this.gameEngine.getAudioManager(),this.gameEngine.getLightingSystem(),this.gameEngine.getParticleSystem();const r=i.onEvolution;i.onEvolution=(s,a)=>{r&&r(s,a),this.handleEvolutionEffects(s,a)},n.onGameOver(s=>{this.handleGameOverEffects(s.deathReason)});const o=e.onPowerActivation;e.onPowerActivation=(s,a)=>{o&&o(s,a),a&&this.handlePowerActivationEffects(s)}}handleEvolutionEffects(e,i){console.log(`🐍 Evolution: ${e} → ${i}`),this.polishManager.addScreenShake(.5,1e3),this.polishManager.updateColorGrading(i),i>=8&&(this.polishManager.setCameraZoom(1.2),setTimeout(()=>{this.polishManager.setCameraZoom(1)},2e3)),i===10&&this.handleOuroborosEvolution()}handleOuroborosEvolution(){console.log("🌟 OUROBOROS FORM ACHIEVED! 🌟"),this.polishManager.addScreenShake(1,3e3);const e=this.gameEngine.getParticleSystem(),n=this.gameEngine.getSnakeManager().getSnakeState(),r={x:n.head.x*35+17.5,y:n.head.y*35+17.5};for(let s=0;s<5;s++)setTimeout(()=>{e.createBurst(r,"sparkle",50,{x:0,y:0},Math.PI*2)},s*200);this.gameEngine.getLightingSystem().addTemporaryLight({position:r,color:[1,.8,0],intensity:2,radius:300,duration:5e3})}handlePowerActivationEffects(e){switch(e){case v.FireBreath:this.polishManager.addScreenShake(.3,500);break;case v.VenomStrike:this.polishManager.addScreenShake(.2,300);break;case v.TimeWarp:this.polishManager.addScreenShake(.1,1e3);break}}handleGameOverEffects(e){console.log(`💀 Game Over: ${e}`),this.polishManager.addScreenShake(.8,2e3),this.gameEngine.getAudioManager().stopBackgroundAudio()}start(){if(!this.isInitialized)throw new Error("Game integration not initialized");this.gameEngine.start()}stop(){this.gameEngine.stop()}pause(){this.gameEngine.pause()}restart(){this.gameEngine.restart(),this.polishManager=new rl(this.gameEngine),this.flowManager=new ol(this.gameEngine)}update(e){this.polishManager.update(e);const i=this.polishManager.getScreenShakeOffset();i.x!==0||i.y}getGameEngine(){return this.gameEngine}getOptimizer(){return this.optimizer}getPolishManager(){return this.polishManager}getFlowManager(){return this.flowManager}getPerformanceReport(){return{optimizer:this.optimizer.getPerformanceReport(),flow:this.flowManager.getProgressSummary(),gameEngine:{fps:this.gameEngine.getPerformanceMetrics().fps,memoryUsage:this.gameEngine.getMemoryStats(),fallbackState:this.gameEngine.getFallbackState()}}}runDiagnostics(){const e=this.gameEngine.getSnakeManager(),i=this.gameEngine.getFoodManager(),n=this.gameEngine.getEnvironmentSystem(),r=this.gameEngine.getAudioManager(),o=this.gameEngine.getLightingSystem(),s=this.gameEngine.getParticleSystem();return{systems:{snake:{isAlive:e.isAlive(),evolutionLevel:e.getCurrentEvolutionLevel(),length:e.getLength(),availablePowers:e.getAvailablePowers().length},food:{activeFoods:i.getFoodCount(),activeEffects:i.getActiveEffects().length},environment:{obstacles:n.getObstacles().length,dynamicElements:n.getDynamicElements().length},audio:{isSupported:r.isAudioSupported(),activeSources:r.getActiveSourceCount(),isMuted:r.isMuted()},lighting:{activeLights:o.getActiveLightCount()},particles:{activeParticles:s.getActiveParticleCount()}},integration:{isInitialized:this.isInitialized,optimizationLevel:this.optimizer.getOptimizationLevel(),flowState:this.flowManager.getFlowState(),milestones:this.flowManager.getMilestones()}}}async testCompleteGameFlow(){console.log("🧪 Testing complete game flow...");try{if(!this.runDiagnostics().integration.isInitialized)throw new Error("Game integration not properly initialized");const i=this.gameEngine.getSnakeManager(),n=i.getEvolutionSystem();for(let l=2;l<=10;l++)if(n.forceEvolution(l),await new Promise(u=>setTimeout(u,100)),n.getCurrentLevel()!==l)throw new Error(`Evolution to level ${l} failed`);for(const l of i.getAvailablePowers()){const u=i.activatePower(l);!u.success&&u.message!=="Power is on cooldown"&&console.warn(`Power ${l} activation failed: ${u.message}`)}const r=this.gameEngine.getFoodManager(),o=r.forceSpawnFood({x:10,y:10},F.BasicBerry);if(!o)throw new Error("Food spawning failed");if(!r.consumeFood(o.id,1).success)throw new Error("Food consumption failed");const a=this.gameEngine.getAudioManager();return a.isAudioSupported()&&a.playPowerActivation(v.SpeedBoost),console.log("✅ Complete game flow test passed!"),!0}catch(e){return console.error("❌ Complete game flow test failed:",e),!1}}dispose(){this.gameEngine.dispose()}}const Ef=({onGameEngineReady:t})=>{const e=O.useRef(null),i=O.useRef(null),n=O.useRef(null),[r,o]=O.useState(!1),[s,a]=O.useState(null),[l,u]=O.useState(null),[d,m]=O.useState({width:1750,height:1225});return O.useEffect(()=>{const p=new $s;if(u(p.getBrowserInfo()),!!e.current){try{const x=new Cf(e.current);n.current=x;const S=x.getGameEngine(),E=(D,g)=>{m(g),S.handleResize&&S.handleResize(g.width,g.height)};S.enableResponsiveMode&&S.enableResponsiveMode(E),x.start(),o(!0),t&&t(x)}catch(x){const S=x instanceof Error?x.message:"Failed to initialize game";a(S),console.error("Game initialization error:",x)}return()=>{n.current&&n.current.dispose()}}},[t]),s?f.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2rem",color:"#ff6b6b",backgroundColor:"#2a2a3e",borderRadius:"8px",border:"2px solid #ff6b6b"},children:[f.jsx("h2",{children:"Game Initialization Error"}),f.jsx("p",{children:s}),f.jsx("p",{style:{fontSize:"0.9em",opacity:.8},children:"Please ensure your browser supports WebGL"})]}):f.jsxs("div",{ref:i,style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"1rem",width:"100%",height:"100%",minHeight:"100vh",padding:"1rem",boxSizing:"border-box"},children:[f.jsx("canvas",{ref:e,style:{border:"2px solid #4a4a6a",borderRadius:"4px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.3)",backgroundColor:"#1a1a2e",maxWidth:"100%",maxHeight:"80vh",objectFit:"contain"}}),r&&f.jsx("div",{style:{color:"#a0a0b0",fontSize:l!=null&&l.isMobile?"0.8em":"0.9em",textAlign:"center",maxWidth:"90%"},children:l!=null&&l.isMobile?f.jsxs(f.Fragment,{children:[f.jsx("p",{children:"Swipe to control the snake"}),f.jsx("p",{children:"Tap to consume tail • Double-tap to pause"}),f.jsx("p",{children:"Use virtual controls for powers"})]}):f.jsxs(f.Fragment,{children:[f.jsx("p",{children:"Use WASD or Arrow Keys to control the snake"}),f.jsx("p",{children:"Press Space to pause/resume"}),f.jsx("p",{children:"Click on tail to consume (Ouroboros level)"})]})}),l&&!l.supportsWebGL&&f.jsx("div",{style:{color:"#ffa500",fontSize:"0.8em",textAlign:"center",backgroundColor:"rgba(255, 165, 0, 0.1)",padding:"0.5rem",borderRadius:"4px",border:"1px solid #ffa500"},children:"⚠️ WebGL not supported. Game running in compatibility mode."})]})},Pf=t=>({[v.SpeedBoost]:"Speed Boost",[v.VenomStrike]:"Venom Strike",[v.Constrict]:"Constrict",[v.HoodExpansion]:"Hood Expansion",[v.AquaticMovement]:"Aquatic Movement",[v.ColorChange]:"Color Change",[v.TimeWarp]:"Time Warp",[v.FireBreath]:"Fire Breath",[v.TailConsumption]:"Tail Consumption",[v.PowerCycling]:"Power Cycling",[v.RealityManipulation]:"Reality Manipulation"})[t]||t,sl=t=>({[v.SpeedBoost]:"Q",[v.VenomStrike]:"E",[v.Constrict]:"R",[v.HoodExpansion]:"T",[v.AquaticMovement]:"Y",[v.ColorChange]:"U",[v.TimeWarp]:"I",[v.FireBreath]:"O",[v.TailConsumption]:"P",[v.PowerCycling]:"[",[v.RealityManipulation]:"]"})[t]||"?",kf=t=>({1:"Hatchling",2:"Garden Snake",3:"Viper",4:"Python",5:"Cobra",6:"Anaconda",7:"Rainbow Serpent",8:"Celestial Serpent",9:"Ancient Dragon Serpent",10:"Ouroboros"})[t]||`Level ${t}`,Mf=({gameState:t,evolutionLevel:e=1,scoreState:i,powerState:n,onPowerActivate:r})=>{const o=l=>{r&&n&&(n.cooldowns.get(l)||0)<=0&&r(l)},s=l=>{const u=Math.floor(l/1e3),d=Math.floor(u/60),m=u%60;return`${d}:${m.toString().padStart(2,"0")}`},a=i?Date.now()-i.gameStartTime:0;return f.jsxs("div",{style:{position:"absolute",top:"1rem",left:"1rem",right:"1rem",display:"flex",justifyContent:"space-between",alignItems:"flex-start",color:"#e0e0e0",fontFamily:'"Segoe UI", Tahoma, Geneva, Verdana, sans-serif',fontSize:"0.9rem",pointerEvents:"none",zIndex:10},children:[f.jsxs("div",{style:{backgroundColor:"rgba(15, 15, 26, 0.95)",padding:"0.75rem 1rem",borderRadius:"8px",border:"2px solid rgba(138, 43, 226, 0.3)",boxShadow:"0 4px 12px rgba(138, 43, 226, 0.2)",backdropFilter:"blur(10px)",minWidth:"200px"},children:[f.jsx("div",{style:{fontSize:"1rem",fontWeight:"bold",marginBottom:"0.5rem",color:"#dda0dd",textShadow:"0 0 8px rgba(138, 43, 226, 0.5)"},children:kf(e)}),f.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8,marginBottom:"0.25rem"},children:["Level ",e,"/10"]}),f.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:["Status: ",f.jsx("span",{style:{color:t.isPaused?"#ffa500":"#90ee90",fontWeight:"bold"},children:t.isPaused?"PAUSED":"ACTIVE"})]}),f.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:["FPS: ",Math.round(t.fps)]})]}),n&&n.cooldowns.size>0&&f.jsxs("div",{style:{backgroundColor:"rgba(15, 15, 26, 0.95)",padding:"0.75rem 1rem",borderRadius:"8px",border:"2px solid rgba(138, 43, 226, 0.3)",boxShadow:"0 4px 12px rgba(138, 43, 226, 0.2)",backdropFilter:"blur(10px)",pointerEvents:"auto",maxWidth:"400px"},children:[f.jsx("div",{style:{marginBottom:"0.75rem",textAlign:"center",fontSize:"0.9rem",fontWeight:"bold",color:"#dda0dd",textShadow:"0 0 8px rgba(138, 43, 226, 0.5)"},children:"Mystical Powers"}),f.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",justifyContent:"center"},children:Array.from(n.cooldowns.entries()).map(([l,u])=>{const d=n.activePowers.includes(l),m=n.durations.get(l)||0,p=u>0;return f.jsxs("button",{onClick:()=>o(l),disabled:p,style:{padding:"0.5rem 0.75rem",fontSize:"0.8rem",border:d?"2px solid rgba(76, 175, 80, 0.8)":p?"2px solid rgba(100, 100, 100, 0.5)":"2px solid rgba(138, 43, 226, 0.5)",borderRadius:"6px",backgroundColor:d?"rgba(76, 175, 80, 0.2)":p?"rgba(100, 100, 100, 0.1)":"rgba(138, 43, 226, 0.1)",color:p?"#888":"#e0e0e0",cursor:p?"not-allowed":"pointer",pointerEvents:"auto",position:"relative",minWidth:"70px",transition:"all 0.2s ease",boxShadow:d?"0 0 12px rgba(76, 175, 80, 0.4)":p?"none":"0 0 8px rgba(138, 43, 226, 0.3)",textShadow:d?"0 0 4px rgba(76, 175, 80, 0.8)":"none"},title:`${Pf(l)} (Press ${sl(l)})`,onMouseEnter:x=>{p||(x.currentTarget.style.transform="scale(1.05)",x.currentTarget.style.boxShadow="0 0 16px rgba(138, 43, 226, 0.6)")},onMouseLeave:x=>{x.currentTarget.style.transform="scale(1)",x.currentTarget.style.boxShadow=d?"0 0 12px rgba(76, 175, 80, 0.4)":p?"none":"0 0 8px rgba(138, 43, 226, 0.3)"},children:[f.jsx("div",{style:{fontWeight:"bold"},children:sl(l)}),d&&m>0&&f.jsxs("div",{style:{fontSize:"0.7rem",color:"#90ee90",fontWeight:"bold"},children:[Math.ceil(m/1e3),"s"]}),p&&f.jsxs("div",{style:{fontSize:"0.7rem",color:"#ff6b6b"},children:[Math.ceil(u/1e3),"s"]})]},l)})})]}),f.jsxs("div",{style:{backgroundColor:"rgba(15, 15, 26, 0.95)",padding:"0.75rem 1rem",borderRadius:"8px",border:"2px solid rgba(138, 43, 226, 0.3)",boxShadow:"0 4px 12px rgba(138, 43, 226, 0.2)",backdropFilter:"blur(10px)",textAlign:"right",minWidth:"180px"},children:[f.jsx("div",{style:{fontSize:"1.1rem",fontWeight:"bold",marginBottom:"0.5rem",color:"#ffd700",textShadow:"0 0 8px rgba(255, 215, 0, 0.5)"},children:i?i.currentScore.toLocaleString():"0"}),f.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8,marginBottom:"0.25rem"},children:["High: ",i?i.highScore.toLocaleString():"0"]}),i&&i.comboCount>1&&f.jsxs("div",{style:{fontSize:"0.8rem",color:"#ff69b4",fontWeight:"bold",marginBottom:"0.25rem"},children:["Combo: ",i.comboCount,"x"]}),f.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:["Time: ",s(a)]}),i&&f.jsxs("div",{style:{fontSize:"0.8rem",opacity:.8},children:["Food: ",i.totalFoodConsumed]})]})]})},Tf=({onStartGame:t,onShowInstructions:e,highScore:i})=>f.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(15, 15, 26, 0.98)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(10px)"},children:[f.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:`
          radial-gradient(circle at 20% 30%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 80% 70%, rgba(75, 0, 130, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, rgba(72, 61, 139, 0.05) 0%, transparent 70%)
        `,zIndex:-1}}),f.jsxs("div",{style:{textAlign:"center",marginBottom:"3rem"},children:[f.jsx("h1",{style:{fontSize:"4rem",fontWeight:"bold",background:"linear-gradient(45deg, #dda0dd, #9370db, #8a2be2)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"0 0 30px rgba(138, 43, 226, 0.5)",marginBottom:"1rem",fontFamily:'"Cinzel", serif, "Times New Roman", serif'},children:"OUROBOROS"}),f.jsx("h2",{style:{fontSize:"1.5rem",color:"#dda0dd",fontWeight:"normal",letterSpacing:"0.2em",textShadow:"0 0 10px rgba(138, 43, 226, 0.3)",fontFamily:'"Cinzel", serif, "Times New Roman", serif'},children:"The Eternal Serpent"}),f.jsx("p",{style:{fontSize:"1rem",color:"#b19cd9",marginTop:"1rem",fontStyle:"italic",opacity:.8},children:"Evolve through 10 mystical forms • Master ancient powers • Consume your own tail"})]}),i>0&&f.jsxs("div",{style:{backgroundColor:"rgba(138, 43, 226, 0.1)",border:"2px solid rgba(138, 43, 226, 0.3)",borderRadius:"12px",padding:"1rem 2rem",marginBottom:"2rem",textAlign:"center"},children:[f.jsx("div",{style:{fontSize:"0.9rem",color:"#dda0dd",marginBottom:"0.25rem"},children:"Best Achievement"}),f.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#ffd700",textShadow:"0 0 8px rgba(255, 215, 0, 0.5)"},children:i.toLocaleString()})]}),f.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",alignItems:"center"},children:[f.jsx("button",{onClick:t,style:{padding:"1rem 3rem",fontSize:"1.2rem",fontWeight:"bold",color:"#ffffff",backgroundColor:"rgba(138, 43, 226, 0.2)",border:"2px solid #8a2be2",borderRadius:"12px",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(138, 43, 226, 0.3)",textShadow:"0 0 8px rgba(138, 43, 226, 0.5)",minWidth:"200px"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="rgba(138, 43, 226, 0.4)",n.currentTarget.style.boxShadow="0 6px 20px rgba(138, 43, 226, 0.5)",n.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="rgba(138, 43, 226, 0.2)",n.currentTarget.style.boxShadow="0 4px 15px rgba(138, 43, 226, 0.3)",n.currentTarget.style.transform="translateY(0)"},children:"Begin Evolution"}),f.jsx("button",{onClick:e,style:{padding:"0.75rem 2rem",fontSize:"1rem",color:"#dda0dd",backgroundColor:"transparent",border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease",minWidth:"200px"},onMouseEnter:n=>{n.currentTarget.style.backgroundColor="rgba(138, 43, 226, 0.1)",n.currentTarget.style.borderColor="#8a2be2",n.currentTarget.style.color="#ffffff"},onMouseLeave:n=>{n.currentTarget.style.backgroundColor="transparent",n.currentTarget.style.borderColor="rgba(138, 43, 226, 0.5)",n.currentTarget.style.color="#dda0dd"},children:"Ancient Wisdom"})]}),f.jsxs("div",{style:{position:"absolute",bottom:"2rem",textAlign:"center",color:"#8a8a8a",fontSize:"0.8rem"},children:[f.jsx("p",{children:"Use WASD or Arrow Keys • Space to Pause • Q-P for Powers"}),f.jsx("p",{style:{marginTop:"0.5rem",fontSize:"0.7rem",opacity:.7},children:'"The serpent that devours its own tail symbolizes the eternal cycle of creation and destruction"'})]})]}),bf=t=>{switch(t){case se.SelfCollision:return{title:"The Serpent Consumed Itself",description:"Your journey ended in the ancient cycle of self-consumption"};case se.WallCollision:return{title:"Bound by Ancient Barriers",description:"The mystical boundaries proved too strong to overcome"};case se.ObstacleCollision:return{title:"Crushed by Stone and Crystal",description:"The environment's challenges proved insurmountable"};case se.EnvironmentalHazard:return{title:"Consumed by Elemental Forces",description:"Fire, poison, or lightning claimed your serpentine form"};case se.PoisonEffect:return{title:"Venom Coursed Through Your Scales",description:"The toxic essence overwhelmed your mystical defenses"};default:return{title:"The Journey Ends",description:"Your evolution has reached its conclusion"}}},Af=t=>({1:"Hatchling",2:"Garden Snake",3:"Viper",4:"Python",5:"Cobra",6:"Anaconda",7:"Rainbow Serpent",8:"Celestial Serpent",9:"Ancient Dragon Serpent",10:"Ouroboros"})[t]||`Level ${t}`,_f=t=>{const e=Math.floor(t/1e3),i=Math.floor(e/60),n=Math.floor(i/60);return n>0?`${n}:${(i%60).toString().padStart(2,"0")}:${(e%60).toString().padStart(2,"0")}`:`${i}:${(e%60).toString().padStart(2,"0")}`},Ff=({finalScore:t,finalEvolutionLevel:e,survivalTime:i,deathReason:n,scoreState:r,isNewHighScore:o,onRestart:s,onMainMenu:a})=>{const l=bf(n),u=Af(e);return f.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(15, 15, 26, 0.98)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:1e3,backdropFilter:"blur(10px)"},children:[f.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:`
          radial-gradient(circle at 30% 40%, rgba(139, 69, 19, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 70% 60%, rgba(178, 34, 34, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 50% 50%, rgba(75, 0, 130, 0.05) 0%, transparent 70%)
        `,zIndex:-1}}),f.jsxs("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[f.jsx("h1",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#cd853f",textShadow:"0 0 20px rgba(205, 133, 63, 0.5)",marginBottom:"0.5rem",fontFamily:'"Cinzel", serif, "Times New Roman", serif'},children:l.title}),f.jsx("p",{style:{fontSize:"1.1rem",color:"#dda0dd",fontStyle:"italic",opacity:.9},children:l.description})]}),f.jsxs("div",{style:{backgroundColor:"rgba(138, 43, 226, 0.1)",border:"2px solid rgba(138, 43, 226, 0.3)",borderRadius:"12px",padding:"1.5rem 2rem",marginBottom:"2rem",textAlign:"center",minWidth:"300px"},children:[f.jsx("div",{style:{fontSize:"1rem",color:"#dda0dd",marginBottom:"0.5rem"},children:"Final Evolution"}),f.jsx("div",{style:{fontSize:"1.8rem",fontWeight:"bold",color:e===10?"#ffd700":"#9370db",textShadow:e===10?"0 0 15px rgba(255, 215, 0, 0.5)":"0 0 10px rgba(147, 112, 219, 0.5)",marginBottom:"0.25rem"},children:u}),f.jsxs("div",{style:{fontSize:"0.9rem",color:"#b19cd9",opacity:.8},children:["Level ",e," of 10"]}),e===10&&f.jsx("div",{style:{fontSize:"0.9rem",color:"#ffd700",fontWeight:"bold",marginTop:"0.5rem",textShadow:"0 0 8px rgba(255, 215, 0, 0.5)"},children:"🐍 OUROBOROS ACHIEVED! 🐍"})]}),f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem",marginBottom:"2rem",minWidth:"400px"},children:[f.jsxs("div",{style:{backgroundColor:"rgba(255, 215, 0, 0.1)",border:"2px solid rgba(255, 215, 0, 0.3)",borderRadius:"8px",padding:"1rem",textAlign:"center"},children:[f.jsx("div",{style:{fontSize:"0.9rem",color:"#ffd700",marginBottom:"0.25rem"},children:"Final Score"}),f.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#ffffff",textShadow:"0 0 8px rgba(255, 215, 0, 0.5)"},children:t.toLocaleString()}),o&&f.jsx("div",{style:{fontSize:"0.8rem",color:"#ffd700",fontWeight:"bold",marginTop:"0.25rem",textShadow:"0 0 8px rgba(255, 215, 0, 0.8)"},children:"NEW HIGH SCORE!"})]}),f.jsxs("div",{style:{backgroundColor:"rgba(72, 61, 139, 0.1)",border:"2px solid rgba(72, 61, 139, 0.3)",borderRadius:"8px",padding:"1rem",textAlign:"center"},children:[f.jsx("div",{style:{fontSize:"0.9rem",color:"#dda0dd",marginBottom:"0.25rem"},children:"Survival Time"}),f.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#ffffff"},children:_f(i)})]}),f.jsxs("div",{style:{backgroundColor:"rgba(34, 139, 34, 0.1)",border:"2px solid rgba(34, 139, 34, 0.3)",borderRadius:"8px",padding:"1rem",textAlign:"center"},children:[f.jsx("div",{style:{fontSize:"0.9rem",color:"#90ee90",marginBottom:"0.25rem"},children:"Food Consumed"}),f.jsx("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#ffffff"},children:r.totalFoodConsumed})]}),f.jsxs("div",{style:{backgroundColor:"rgba(255, 105, 180, 0.1)",border:"2px solid rgba(255, 105, 180, 0.3)",borderRadius:"8px",padding:"1rem",textAlign:"center"},children:[f.jsx("div",{style:{fontSize:"0.9rem",color:"#ff69b4",marginBottom:"0.25rem"},children:"Best Combo"}),f.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"#ffffff"},children:[r.comboCount,"x"]})]})]}),f.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[f.jsx("button",{onClick:s,style:{padding:"1rem 2rem",fontSize:"1.1rem",fontWeight:"bold",color:"#ffffff",backgroundColor:"rgba(138, 43, 226, 0.2)",border:"2px solid #8a2be2",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(138, 43, 226, 0.3)",textShadow:"0 0 8px rgba(138, 43, 226, 0.5)"},onMouseEnter:d=>{d.currentTarget.style.backgroundColor="rgba(138, 43, 226, 0.4)",d.currentTarget.style.boxShadow="0 6px 20px rgba(138, 43, 226, 0.5)",d.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:d=>{d.currentTarget.style.backgroundColor="rgba(138, 43, 226, 0.2)",d.currentTarget.style.boxShadow="0 4px 15px rgba(138, 43, 226, 0.3)",d.currentTarget.style.transform="translateY(0)"},children:"Evolve Again"}),f.jsx("button",{onClick:a,style:{padding:"1rem 2rem",fontSize:"1.1rem",color:"#dda0dd",backgroundColor:"transparent",border:"2px solid rgba(138, 43, 226, 0.5)",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:d=>{d.currentTarget.style.backgroundColor="rgba(138, 43, 226, 0.1)",d.currentTarget.style.borderColor="#8a2be2",d.currentTarget.style.color="#ffffff"},onMouseLeave:d=>{d.currentTarget.style.backgroundColor="transparent",d.currentTarget.style.borderColor="rgba(138, 43, 226, 0.5)",d.currentTarget.style.color="#dda0dd"},children:"Return to Menu"})]}),f.jsx("div",{style:{position:"absolute",bottom:"2rem",textAlign:"center",color:"#8a8a8a",fontSize:"0.8rem",fontStyle:"italic",maxWidth:"600px",lineHeight:"1.4"},children:f.jsx("p",{children:'"In the end, all serpents return to the beginning. The cycle of evolution continues eternal, each death a new birth, each ending a fresh start."'})})]})},Lf=({onClose:t})=>f.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(15, 15, 26, 0.98)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-start",zIndex:1e3,backdropFilter:"blur(10px)",overflowY:"auto",padding:"2rem"},children:[f.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:`
          radial-gradient(circle at 25% 25%, rgba(138, 43, 226, 0.1) 0%, transparent 50%),
          radial-gradient(circle at 75% 75%, rgba(75, 0, 130, 0.1) 0%, transparent 50%)
        `,zIndex:-1}}),f.jsxs("div",{style:{textAlign:"center",marginBottom:"2rem"},children:[f.jsx("h1",{style:{fontSize:"2.5rem",fontWeight:"bold",background:"linear-gradient(45deg, #dda0dd, #9370db)",backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",textShadow:"0 0 20px rgba(138, 43, 226, 0.5)",marginBottom:"0.5rem",fontFamily:'"Cinzel", serif, "Times New Roman", serif'},children:"Ancient Wisdom"}),f.jsx("p",{style:{fontSize:"1rem",color:"#dda0dd",fontStyle:"italic"},children:"Master the secrets of serpentine evolution"})]}),f.jsxs("div",{style:{maxWidth:"800px",width:"100%",display:"grid",gap:"1.5rem"},children:[f.jsxs("div",{style:{backgroundColor:"rgba(138, 43, 226, 0.1)",border:"2px solid rgba(138, 43, 226, 0.3)",borderRadius:"12px",padding:"1.5rem"},children:[f.jsx("h2",{style:{fontSize:"1.3rem",color:"#dda0dd",marginBottom:"1rem",textAlign:"center"},children:"🎮 Mystical Controls"}),f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.75rem",fontSize:"0.9rem",color:"#e0e0e0"},children:[f.jsxs("div",{children:[f.jsx("strong",{children:"WASD / Arrow Keys:"})," Guide your serpent"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"Space:"})," Pause the eternal dance"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"Q-P Keys:"})," Activate mystical powers"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"Mouse Click:"})," Consume tail (Ouroboros only)"]})]})]}),f.jsxs("div",{style:{backgroundColor:"rgba(75, 0, 130, 0.1)",border:"2px solid rgba(75, 0, 130, 0.3)",borderRadius:"12px",padding:"1.5rem"},children:[f.jsx("h2",{style:{fontSize:"1.3rem",color:"#dda0dd",marginBottom:"1rem",textAlign:"center"},children:"🐍 The Path of Evolution"}),f.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))",gap:"0.75rem",fontSize:"0.85rem",color:"#e0e0e0"},children:[f.jsxs("div",{children:[f.jsx("strong",{children:"1. Hatchling:"})," Your humble beginning"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"2. Garden Snake:"})," Speed Boost power"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"3. Viper:"})," Venom Strike ability"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"4. Python:"})," Constrict power"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"5. Cobra:"})," Hood Expansion defense"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"6. Anaconda:"})," Aquatic Movement"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"7. Rainbow Serpent:"})," Color Change"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"8. Celestial Serpent:"})," Time Warp"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"9. Ancient Dragon:"})," Fire Breath"]}),f.jsxs("div",{children:[f.jsx("strong",{children:"10. Ouroboros:"})," Tail Consumption"]})]})]}),f.jsxs("div",{style:{backgroundColor:"rgba(255, 215, 0, 0.1)",border:"2px solid rgba(255, 215, 0, 0.3)",borderRadius:"12px",padding:"1.5rem"},children:[f.jsx("h2",{style:{fontSize:"1.3rem",color:"#ffd700",marginBottom:"1rem",textAlign:"center"},children:"✨ Mystical Powers"}),f.jsxs("div",{style:{fontSize:"0.9rem",color:"#e0e0e0",lineHeight:"1.6"},children:[f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Speed Boost (Q):"})," Accelerate through dangers and phase through magic barriers"]}),f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Venom Strike (E):"})," Shatter crystal formations and destroy stone weak points"]}),f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Fire Breath (O):"})," Incinerate ice walls, thorn bushes, and wooden barriers"]}),f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Time Warp (I):"})," Slow moving hazards and gain temporal advantage"]}),f.jsxs("p",{children:[f.jsx("strong",{children:"Tail Consumption (P):"})," Click your tail segments to strategically reduce length"]})]})]}),f.jsxs("div",{style:{backgroundColor:"rgba(34, 139, 34, 0.1)",border:"2px solid rgba(34, 139, 34, 0.3)",borderRadius:"12px",padding:"1.5rem"},children:[f.jsx("h2",{style:{fontSize:"1.3rem",color:"#90ee90",marginBottom:"1rem",textAlign:"center"},children:"🍃 Sacred Nourishment"}),f.jsxs("div",{style:{fontSize:"0.9rem",color:"#e0e0e0",lineHeight:"1.6"},children:[f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Evolution-Specific Foods:"})," Consume foods matching your current evolution level for optimal growth"]}),f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Wrong Level Foods:"})," Eating inappropriate foods causes negative effects like poison or reversed controls"]}),f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Food Combinations:"})," Consuming certain food sequences grants bonus multipliers"]}),f.jsxs("p",{children:[f.jsx("strong",{children:"Eternal Orbs:"})," The ultimate nourishment, available only to the Ouroboros form"]})]})]}),f.jsxs("div",{style:{backgroundColor:"rgba(178, 34, 34, 0.1)",border:"2px solid rgba(178, 34, 34, 0.3)",borderRadius:"12px",padding:"1.5rem"},children:[f.jsx("h2",{style:{fontSize:"1.3rem",color:"#ff6b6b",marginBottom:"1rem",textAlign:"center"},children:"⚡ Environmental Trials"}),f.jsxs("div",{style:{fontSize:"0.9rem",color:"#e0e0e0",lineHeight:"1.6"},children:[f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Static Obstacles:"})," Stone pillars, crystal formations, ice walls, and magic barriers block your path"]}),f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Dynamic Hazards:"})," Flame geysers, poison gas clouds, and lightning strikes appear and disappear"]}),f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Interactive Elements:"})," Pressure plates, ancient switches, and mystical portals await activation"]}),f.jsxs("p",{children:[f.jsx("strong",{children:"Power Interactions:"})," Use specific abilities to overcome environmental challenges"]})]})]}),f.jsxs("div",{style:{backgroundColor:"rgba(255, 105, 180, 0.1)",border:"2px solid rgba(255, 105, 180, 0.3)",borderRadius:"12px",padding:"1.5rem"},children:[f.jsx("h2",{style:{fontSize:"1.3rem",color:"#ff69b4",marginBottom:"1rem",textAlign:"center"},children:"🏆 Path to Glory"}),f.jsxs("div",{style:{fontSize:"0.9rem",color:"#e0e0e0",lineHeight:"1.6"},children:[f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Evolution Multipliers:"})," Higher evolution levels grant greater point multipliers"]}),f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Combo System:"})," Consecutive food consumption builds powerful combo multipliers"]}),f.jsxs("p",{style:{marginBottom:"0.75rem"},children:[f.jsx("strong",{children:"Survival Bonus:"})," Longer survival times contribute to your final score"]}),f.jsxs("p",{children:[f.jsx("strong",{children:"Ultimate Goal:"})," Reach the Ouroboros form and master the art of tail consumption"]})]})]})]}),f.jsx("button",{onClick:t,style:{marginTop:"2rem",padding:"1rem 2rem",fontSize:"1.1rem",fontWeight:"bold",color:"#ffffff",backgroundColor:"rgba(138, 43, 226, 0.2)",border:"2px solid #8a2be2",borderRadius:"8px",cursor:"pointer",transition:"all 0.3s ease",boxShadow:"0 4px 15px rgba(138, 43, 226, 0.3)",textShadow:"0 0 8px rgba(138, 43, 226, 0.5)"},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="rgba(138, 43, 226, 0.4)",e.currentTarget.style.boxShadow="0 6px 20px rgba(138, 43, 226, 0.5)",e.currentTarget.style.transform="translateY(-2px)"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="rgba(138, 43, 226, 0.2)",e.currentTarget.style.boxShadow="0 4px 15px rgba(138, 43, 226, 0.3)",e.currentTarget.style.transform="translateY(0)"},children:"Begin Your Journey"})]});class Rf extends O.Component{constructor(i){super(i);c(this,"handleRetry",()=>{this.setState({hasError:!1,error:void 0,errorInfo:void 0})});this.state={hasError:!1}}static getDerivedStateFromError(i){return{hasError:!0,error:i}}componentDidCatch(i,n){console.error("ErrorBoundary caught an error:",i,n),this.setState({error:i,errorInfo:n}),this.props.onError&&this.props.onError(i,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:f.jsxs("div",{className:"error-boundary",children:[f.jsxs("div",{className:"error-content",children:[f.jsx("h2",{children:"Something went wrong"}),f.jsx("p",{children:"The game encountered an unexpected error and needs to restart."}),f.jsxs("div",{className:"error-actions",children:[f.jsx("button",{onClick:this.handleRetry,className:"retry-button",children:"Try Again"}),f.jsx("button",{onClick:()=>window.location.reload(),className:"reload-button",children:"Reload Game"})]}),!1]}),f.jsx("style",{jsx:!0,children:`
            .error-boundary {
              display: flex;
              align-items: center;
              justify-content: center;
              min-height: 100vh;
              background: linear-gradient(135deg, #1a1a2e, #16213e);
              color: #ffffff;
              font-family: 'Arial', sans-serif;
            }
            
            .error-content {
              text-align: center;
              padding: 2rem;
              background: rgba(255, 255, 255, 0.1);
              border-radius: 12px;
              backdrop-filter: blur(10px);
              border: 1px solid rgba(255, 255, 255, 0.2);
              max-width: 500px;
            }
            
            .error-content h2 {
              color: #ff6b6b;
              margin-bottom: 1rem;
              font-size: 1.5rem;
            }
            
            .error-content p {
              margin-bottom: 2rem;
              color: #cccccc;
              line-height: 1.5;
            }
            
            .error-actions {
              display: flex;
              gap: 1rem;
              justify-content: center;
              margin-bottom: 1rem;
            }
            
            .retry-button, .reload-button {
              padding: 0.75rem 1.5rem;
              border: none;
              border-radius: 6px;
              cursor: pointer;
              font-weight: 600;
              transition: all 0.2s ease;
            }
            
            .retry-button {
              background: #4ecdc4;
              color: #ffffff;
            }
            
            .retry-button:hover {
              background: #45b7aa;
              transform: translateY(-1px);
            }
            
            .reload-button {
              background: #ff6b6b;
              color: #ffffff;
            }
            
            .reload-button:hover {
              background: #ff5252;
              transform: translateY(-1px);
            }
            
            .error-details {
              margin-top: 1rem;
              text-align: left;
            }
            
            .error-details summary {
              cursor: pointer;
              color: #ffd93d;
              margin-bottom: 0.5rem;
            }
            
            .error-stack {
              background: rgba(0, 0, 0, 0.3);
              padding: 1rem;
              border-radius: 4px;
              font-size: 0.8rem;
              overflow-x: auto;
              white-space: pre-wrap;
              color: #ff9999;
            }
          `})]}):this.props.children}}function zf(){const[t,e]=O.useState("menu"),[i,n]=O.useState(null),[r,o]=O.useState({isRunning:!1,isPaused:!1,lastFrameTime:0,deltaTime:0,fps:0}),[s,a]=O.useState(1),[l,u]=O.useState(),[d,m]=O.useState(),[p,x]=O.useState(null);O.useState(null),O.useState(!1);const S=O.useCallback(()=>{try{const k=localStorage.getItem("ouroboros-high-score");return k?parseInt(k,10):0}catch{return 0}},[]),E=O.useCallback(k=>{try{localStorage.setItem("ouroboros-high-score",k.toString())}catch{}},[]),D=O.useCallback(k=>{if(i){const L=i.getGameEngine().getSnakeManager().activatePower(k);console.log("Power activation result:",L)}},[i]),g=O.useCallback(k=>{n(k);const A=k.getGameEngine(),G=setInterval(()=>{const L=A.getState();o(L);const ue=A.getSnakeManager();a(ue.getCurrentEvolutionLevel()),m(ue.getPowerVisualState());const ot=A.getScoreSystem();ot&&u(ot.getState());const st=A.getGameStateManager();if(st){const wi=st.getGameOverState();if(wi.isGameOver&&t==="game"){const Ci=(l==null?void 0:l.currentScore)||0,Ei=S(),Ht=Ci>Ei;Ht&&E(Ci),x({finalScore:Ci,finalEvolutionLevel:s,survivalTime:Date.now()-((l==null?void 0:l.gameStartTime)||Date.now()),deathReason:wi.deathReason,isNewHighScore:Ht}),e("gameOver")}}},100);return()=>clearInterval(G)},[t,l,s,S,E]),h=O.useCallback(()=>{e("game")},[]),y=O.useCallback(()=>{e("instructions")},[]),w=O.useCallback(()=>{e("menu")},[]),M=O.useCallback(()=>{i&&i.restart(),x(null),e("game")},[i]),P=O.useCallback(()=>{i&&(i.dispose(),n(null)),x(null),e("menu")},[i]);return t==="menu"?f.jsx(Tf,{onStartGame:h,onShowInstructions:y,highScore:S()}):t==="instructions"?f.jsx(Lf,{onClose:w}):t==="gameOver"&&p&&l?f.jsx(Ff,{finalScore:p.finalScore,finalEvolutionLevel:p.finalEvolutionLevel,survivalTime:p.survivalTime,deathReason:p.deathReason,scoreState:l,isNewHighScore:p.isNewHighScore,onRestart:M,onMainMenu:P}):f.jsxs("div",{style:{width:"100vw",height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#0f0f1a",position:"relative",background:`
        radial-gradient(circle at 20% 20%, rgba(138, 43, 226, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(75, 0, 130, 0.05) 0%, transparent 50%),
        linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 100%)
      `},children:[f.jsx(Ef,{onGameEngineReady:g}),i&&f.jsx(Mf,{gameState:r,evolutionLevel:s,scoreState:l,powerState:d,onPowerActivate:D}),r.isPaused&&f.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(15, 15, 26, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:500,backdropFilter:"blur(5px)"},children:f.jsxs("div",{style:{textAlign:"center",color:"#dda0dd",fontSize:"2rem",fontWeight:"bold",textShadow:"0 0 20px rgba(138, 43, 226, 0.5)"},children:[f.jsx("div",{style:{marginBottom:"1rem"},children:"PAUSED"}),f.jsx("div",{style:{fontSize:"1rem",opacity:.8},children:"Press Space to continue your evolution"})]})}),!1,!1,f.jsx("style",{jsx:!0,children:`
        .performance-debug {
          position: fixed;
          top: 10px;
          right: 10px;
          background: rgba(0, 0, 0, 0.8);
          color: white;
          padding: 1rem;
          border-radius: 8px;
          font-family: monospace;
          font-size: 12px;
          z-index: 1000;
          min-width: 200px;
        }
        
        .performance-debug h3 {
          margin: 0 0 0.5rem 0;
          color: #4ecdc4;
        }
        
        .performance-debug div {
          margin: 0.25rem 0;
        }
        
        .performance-debug button {
          margin-top: 0.5rem;
          padding: 0.25rem 0.5rem;
          background: #ff6b6b;
          color: white;
          border: none;
          border-radius: 4px;
          cursor: pointer;
          font-size: 10px;
        }
        
        .performance-toggle {
          position: fixed;
          top: 10px;
          right: 10px;
          background: rgba(0, 0, 0, 0.6);
          color: white;
          border: none;
          padding: 0.5rem;
          border-radius: 4px;
          cursor: pointer;
          font-size: 10px;
          z-index: 1000;
        }
        
        .performance-toggle:hover {
          background: rgba(0, 0, 0, 0.8);
        }
      `})]})}function If(){const t=(e,i)=>{console.error("Application error:",e,i)};return f.jsx(Rf,{onError:t,children:f.jsx(zf,{})})}oo.createRoot(document.getElementById("root")).render(f.jsx(Gc.StrictMode,{children:f.jsx(If,{})}));
